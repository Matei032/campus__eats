ã‡
FC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
new+ .!
WebApplicationOptions/ D
{ 
Args 
=	 

args 
, 
ContentRootPath 
= 

AppContext  
.  !
BaseDirectory! .
,. /
WebRootPath 
= 
$str 
} 
) 
; 
if 
( 
! 
builder 
. 
Environment 
. 
IsDevelopment &
(& '
)' (
)( )
{   
builder!! 
.!! 
Configuration!! 
.!! 
Sources!! !
."" 	
OfType""	 
<"" 
	Microsoft"" 
."" 

Extensions"" $
.""$ %
Configuration""% 2
.""2 3
Json""3 7
.""7 8#
JsonConfigurationSource""8 O
>""O P
(""P Q
)""Q R
.## 	
ToList##	 
(## 
)## 
.$$ 	
ForEach$$	 
($$ 
s$$ 
=>$$ 
s$$ 
.$$ 
ReloadOnChange$$ &
=$$' (
false$$) .
)$$. /
;$$/ 0
}%% 
var(( 
port(( 
=((	 

Environment(( 
.(( "
GetEnvironmentVariable(( -
(((- .
$str((. 4
)((4 5
??((6 8
$str((9 ?
;((? @
builder)) 
.)) 
WebHost)) 
.)) 
UseUrls)) 
()) 
$")) 
$str)) )
{))) *
port))* .
})). /
"))/ 0
)))0 1
;))1 2
var,, 
connectionString,, 
=,, 
Environment,, "
.,," #"
GetEnvironmentVariable,,# 9
(,,9 :
$str,,: H
),,H I
;,,I J
if.. 
(.. 
string.. 

...
 
IsNullOrEmpty.. 
(.. 
connectionString.. )
)..) *
)..* +
{// 
connectionString11 
=11 
builder11 
.11 
Configuration11 ,
.11, -
GetConnectionString11- @
(11@ A
$str11A T
)11T U
;11U V
Console22 
.22 
	WriteLine22 
(22 
$str22 :
)22: ;
;22; <
}33 
else44 
{55 
Console77 
.77 
	WriteLine77 
(77 
$str77 ;
)77; <
;77< =
var:: 
lastPart:: 
=:: 
connectionString:: #
.::# $
Length::$ *
>::+ ,
$num::- /
?::0 1
connectionString::2 B
.::B C
	Substring::C L
(::L M
connectionString::M ]
.::] ^
Length::^ d
-::e f
$num::g i
)::i j
:::k l
connectionString::m }
;::} ~
Console;; 
.;; 
	WriteLine;; 
(;; 
$";; 
$str;; ;
{;;; <
lastPart;;< D
};;D E
";;E F
);;F G
;;;G H
}<< 
var?? 
dataSourceBuilder?? 
=?? 
new?? #
NpgsqlDataSourceBuilder?? 3
(??3 4
connectionString??4 D
)??D E
;??E F
dataSourceBuilder@@ 
.@@ 
EnableDynamicJson@@ #
(@@# $
)@@$ %
;@@% &
varAA 

dataSourceAA 
=AA 
dataSourceBuilderAA "
.AA" #
BuildAA# (
(AA( )
)AA) *
;AA* +
builderBB 
.BB 
ServicesBB 
.BB 
AddDbContextBB 
<BB 
AppDbContextBB *
>BB* +
(BB+ ,
optionsBB, 3
=>BB4 6
optionsBB7 >
.BB> ?
	UseNpgsqlBB? H
(BBH I

dataSourceBBI S
)BBS T
)BBT U
;BBU V
varEE 
stripeSecretKeyEE 
=EE 
EnvironmentEE !
.EE! ""
GetEnvironmentVariableEE" 8
(EE8 9
$strEE9 L
)EEL M
??FF 
builderFF  
.FF  !
ConfigurationFF! .
[FF. /
$strFF/ A
]FFA B
??GG 
$strGG 
;GG 
varII 
stripePublicKeyII 
=II 
EnvironmentII !
.II! ""
GetEnvironmentVariableII" 8
(II8 9
$strII9 L
)IIL M
??JJ 
builderJJ  
.JJ  !
ConfigurationJJ! .
[JJ. /
$strJJ/ A
]JJA B
??KK 
$strKK 
;KK 
varMM 
stripeWebhookSecretMM 
=MM 
EnvironmentMM %
.MM% &"
GetEnvironmentVariableMM& <
(MM< =
$strMM= T
)MMT U
??NN 
builderNN $
.NN$ %
ConfigurationNN% 2
[NN2 3
$strNN3 I
]NNI J
??OO 
$strOO 
;OO  
builderQQ 
.QQ 
ServicesQQ 
.QQ 
	ConfigureQQ 
<QQ 
StripeSettingsQQ )
>QQ) *
(QQ* +
optionsQQ+ 2
=>QQ3 5
{RR 
optionsSS 
.SS 
	PublicKeySS 
=SS 
stripePublicKeySS '
;SS' (
optionsTT 
.TT 
	SecretKeyTT 
=TT 
stripeSecretKeyTT '
;TT' (
optionsUU 
.UU 
WebhookSecretUU 
=UU 
stripeWebhookSecretUU /
;UU/ 0
}VV 
)VV 
;VV 
builderXX 
.XX 
ServicesXX 
.XX 
AddSingletonXX 
<XX 
StripeXX $
.XX$ %
StripeClientXX% 1
>XX1 2
(XX2 3
providerXX3 ;
=>XX< >
{YY 
returnZZ 

newZZ 
StripeZZ 
.ZZ 
StripeClientZZ "
(ZZ" #
stripeSecretKeyZZ# 2
)ZZ2 3
;ZZ3 4
}[[ 
)[[ 
;[[ 
builder^^ 
.^^ 
Services^^ 
.^^ 

AddMediatR^^ 
(^^ 
cfg^^ 
=>^^  "
{__ 
cfg`` 
.`` (
RegisterServicesFromAssembly`` $
(``$ %
typeof``% +
(``+ ,
Program``, 3
)``3 4
.``4 5
Assembly``5 =
)``= >
;``> ?
cfgaa 
.aa 
AddOpenBehavioraa 
(aa 
typeofaa 
(aa 
ValidationBehavioraa 1
<aa1 2
,aa2 3
>aa3 4
)aa4 5
)aa5 6
;aa6 7
}bb 
)bb 
;bb 
buildercc 
.cc 
Servicescc 
.cc %
AddValidatorsFromAssemblycc *
(cc* +
typeofcc+ 1
(cc1 2
Programcc2 9
)cc9 :
.cc: ;
Assemblycc; C
)ccC D
;ccD E
builderff 
.ff 
Servicesff 
.ff 
	AddScopedff 
<ff 
IJwtServiceff &
,ff& '

JwtServiceff( 2
>ff2 3
(ff3 4
)ff4 5
;ff5 6
varii 
jwtSecretKeyii 
=ii 
Environmentii 
.ii "
GetEnvironmentVariableii 5
(ii5 6
$strii6 F
)iiF G
??jj 
builderjj 
.jj 
Configurationjj 
[jj 
$strjj ,
]jj, -
!jj- .
;jj. /
varll 
	jwtIssuerll 
=ll 
Environmentll 
.ll "
GetEnvironmentVariablell 2
(ll2 3
$strll3 ?
)ll? @
??mm 
buildermm 
.mm 
Configurationmm 
[mm 
$strmm )
]mm) *
!mm* +
;mm+ ,
varoo 
jwtAudienceoo 
=oo 
Environmentoo 
.oo "
GetEnvironmentVariableoo 4
(oo4 5
$stroo5 C
)ooC D
??pp 
builderpp 
.pp 
Configurationpp 
[pp 
$strpp +
]pp+ ,
!pp, -
;pp- .
builderrr 
.rr 
Servicesrr 
.rr 
AddAuthenticationrr "
(rr" #
JwtBearerDefaultsrr# 4
.rr4 5 
AuthenticationSchemerr5 I
)rrI J
.ss 
AddJwtBearerss 
(ss 
optionsss 
=>ss 
{tt 
optionsuu 
.uu %
TokenValidationParametersuu )
=uu* +
newuu, /%
TokenValidationParametersuu0 I
{vv 	$
ValidateIssuerSigningKeyww $
=ww% &
trueww' +
,ww+ ,
IssuerSigningKeyxx 
=xx 
newxx " 
SymmetricSecurityKeyxx# 7
(xx7 8
Encodingyy 
.yy 
UTF8yy 
.yy 
GetBytesyy &
(yy& '
jwtSecretKeyyy' 3
)yy3 4
)yy4 5
,yy5 6
ValidateIssuerzz 
=zz 
truezz !
,zz! "
ValidIssuer{{ 
={{ 
	jwtIssuer{{ #
,{{# $
ValidateAudience|| 
=|| 
true|| #
,||# $
ValidAudience}} 
=}} 
jwtAudience}} '
,}}' (
ValidateLifetime~~ 
=~~ 
true~~ #
,~~# $
	ClockSkew 
= 
TimeSpan  
.  !
Zero! %
,% &
RoleClaimType
€€ 
=
€€ 

ClaimTypes
€€ &
.
€€& '
Role
€€' +
,
€€+ ,
NameClaimType
 
=
 

ClaimTypes
 &
.
& '
NameIdentifier
' 5
}
‚‚ 	
;
‚‚	 

}
ƒƒ 
)
ƒƒ 
;
ƒƒ 
builder†† 
.
†† 
Services
†† 
.
†† 
AddAuthorization
†† !
(
††! "
)
††" #
;
††# $
builder‰‰ 
.
‰‰ 
Services
‰‰ 
.
‰‰ %
AddEndpointsApiExplorer
‰‰ (
(
‰‰( )
)
‰‰) *
;
‰‰* +
builderŠŠ 
.
ŠŠ 
Services
ŠŠ 
.
ŠŠ 
AddSwaggerGen
ŠŠ 
(
ŠŠ 
options
ŠŠ &
=>
ŠŠ' )
{‹‹ 
options
ŒŒ 
.
ŒŒ 
CustomSchemaIds
ŒŒ 
(
ŒŒ 
type
ŒŒ  
=>
ŒŒ! #
type
ŒŒ$ (
.
ŒŒ( )
FullName
ŒŒ) 1
?
ŒŒ1 2
.
ŒŒ2 3
Replace
ŒŒ3 :
(
ŒŒ: ;
$str
ŒŒ; >
,
ŒŒ> ?
$str
ŒŒ@ C
)
ŒŒC D
)
ŒŒD E
;
ŒŒE F
options
 
.
 #
AddSecurityDefinition
 !
(
! "
$str
" *
,
* +
new
, /
	Microsoft
0 9
.
9 :
OpenApi
: A
.
A B
Models
B H
.
H I#
OpenApiSecurityScheme
I ^
{
 
Name
 
=
 
$str
 
,
 
Type
  $
=
% &
	Microsoft
' 0
.
0 1
OpenApi
1 8
.
8 9
Models
9 ?
.
? @ 
SecuritySchemeType
@ R
.
R S
Http
S W
,
W X
Scheme
 
=
 
$str
 
,
 
BearerFormat
 '
=
( )
$str
* /
,
/ 0
In
1 3
=
4 5
	Microsoft
6 ?
.
? @
OpenApi
@ G
.
G H
Models
H N
.
N O
ParameterLocation
O `
.
` a
Header
a g
,
g h
Description
‘‘ 
=
‘‘ 
$str
‘‘ u
}
’’ 
)
’’ 
;
’’ 
options
““ 
.
““ $
AddSecurityRequirement
““ "
(
““" #
new
““# &
	Microsoft
““' 0
.
““0 1
OpenApi
““1 8
.
““8 9
Models
““9 ?
.
““? @(
OpenApiSecurityRequirement
““@ Z
{
”” 
{
•• 	
new
••
 
	Microsoft
•• 
.
•• 
OpenApi
•• 
.
••  
Models
••  &
.
••& '#
OpenApiSecurityScheme
••' <
{
••= >
	Reference
••? H
=
••I J
new
••K N
	Microsoft
••O X
.
••X Y
OpenApi
••Y `
.
••` a
Models
••a g
.
••g h
OpenApiReference
••h x
{
••y z
Type
••{ 
=••€ 
	Microsoft••‚ ‹
.••‹ Œ
OpenApi••Œ “
.••“ ”
Models••” š
.••š ›
ReferenceType••› ¨
.••¨ ©
SecurityScheme••© ·
,••· ¸
Id••¹ »
=••¼ ½
$str••¾ Æ
}••Ç È
}••É Ê
,••Ê Ë
Array••Ì Ñ
.••Ñ Ò
Empty••Ò ×
<••× Ø
string••Ø Ş
>••Ş ß
(••ß à
)••à á
}••â ã
}
–– 
)
–– 
;
–– 
}—— 
)
—— 
;
—— 
builderšš 
.
šš 
Services
šš 
.
šš 
AddCors
šš 
(
šš 
options
šš  
=>
šš! #
{›› 
options
œœ 
.
œœ 
	AddPolicy
œœ 
(
œœ 
$str
œœ %
,
œœ% &
policy
œœ' -
=>
œœ. 0
{
 
policy
 
.
  
SetIsOriginAllowed
 !
(
! "
origin
" (
=>
) +
{
ŸŸ 	
if
   
(
   
string
   
.
    
IsNullOrWhiteSpace
   )
(
  ) *
origin
  * 0
)
  0 1
)
  1 2
return
  3 9
false
  : ?
;
  ? @
try
¡¡ 
{
¢¢ 
var
££ 
uri
££ 
=
££ 
new
££ 
Uri
££ !
(
££! "
origin
££" (
)
££( )
;
££) *
return
¤¤ 
uri
¤¤ 
.
¤¤ 
Host
¤¤ 
==
¤¤  "
$str
¤¤# .
||
¥¥ 
uri
¥¥ 
.
¥¥ 
Host
¥¥ 
==
¥¥  "
$str
¥¥# .
||
¦¦ 
uri
¦¦ 
.
¦¦ 
Host
¦¦ 
.
¦¦  
EndsWith
¦¦  (
(
¦¦( )
$str
¦¦) 8
)
¦¦8 9
||
§§ 
uri
§§ 
.
§§ 
Host
§§ 
.
§§  
EndsWith
§§  (
(
§§( )
$str
§§) 6
)
§§6 7
;
§§7 8
}
¨¨ 
catch
©© 
{
©© 
return
©© 
false
©©  
;
©©  !
}
©©" #
}
ªª 	
)
ªª	 

.
«« 	
AllowAnyHeader
««	 
(
«« 
)
«« 
.
¬¬ 	
AllowAnyMethod
¬¬	 
(
¬¬ 
)
¬¬ 
.
­­ 	
AllowCredentials
­­	 
(
­­ 
)
­­ 
;
­­ 
}
®® 
)
®® 
;
®® 
}¯¯ 
)
¯¯ 
;
¯¯ 
var±± 
app
±± 
=
±± 	
builder
±±
 
.
±± 
Build
±± 
(
±± 
)
±± 
;
±± 
app²² 
.
²² 
UseCors
²² 
(
²² 
$str
²² 
)
²² 
;
²² 
appµµ 
.
µµ 

UseSwagger
µµ 
(
µµ 
)
µµ 
;
µµ 
app¶¶ 
.
¶¶ 
UseSwaggerUI
¶¶ 
(
¶¶ 
)
¶¶ 
;
¶¶ 
app¸¸ 
.
¸¸ 
UseAuthentication
¸¸ 
(
¸¸ 
)
¸¸ 
;
¸¸ 
if»» 
(
»» 
app
»» 
.
»» 
Environment
»» 
.
»» 
IsDevelopment
»» !
(
»»! "
)
»»" #
)
»»# $
{¼¼ 
app
½½ 
.
½½ 
Use
½½ 
(
½½ 
async
½½ 
(
½½ 
ctx
½½ 
,
½½ 
next
½½ 
)
½½ 
=>
½½  
{
¾¾ 
if
¿¿ 

(
¿¿ 
ctx
¿¿ 
.
¿¿ 
Request
¿¿ 
.
¿¿ 
Path
¿¿ 
.
¿¿  
StartsWithSegments
¿¿ /
(
¿¿/ 0
$str
¿¿0 6
)
¿¿6 7
&&
ÀÀ 
!
ÀÀ 
(
ÀÀ 
ctx
ÀÀ 
.
ÀÀ 
User
ÀÀ 
?
ÀÀ 
.
ÀÀ 
Identity
ÀÀ #
?
ÀÀ# $
.
ÀÀ$ %
IsAuthenticated
ÀÀ% 4
??
ÀÀ5 7
false
ÀÀ8 =
)
ÀÀ= >
)
ÀÀ> ?
{
ÁÁ 	
using
ÂÂ 
var
ÂÂ 
scope
ÂÂ 
=
ÂÂ 
app
ÂÂ !
.
ÂÂ! "
Services
ÂÂ" *
.
ÂÂ* +
CreateScope
ÂÂ+ 6
(
ÂÂ6 7
)
ÂÂ7 8
;
ÂÂ8 9
var
ÃÃ 
db
ÃÃ 
=
ÃÃ 
scope
ÃÃ 
.
ÃÃ 
ServiceProvider
ÃÃ *
.
ÃÃ* + 
GetRequiredService
ÃÃ+ =
<
ÃÃ= >
AppDbContext
ÃÃ> J
>
ÃÃJ K
(
ÃÃK L
)
ÃÃL M
;
ÃÃM N
var
ÄÄ 
devUser
ÄÄ 
=
ÄÄ 
await
ÄÄ 
db
ÄÄ  "
.
ÄÄ" #
Users
ÄÄ# (
.
ÄÄ( )
OrderByDescending
ÄÄ) :
(
ÄÄ: ;
u
ÄÄ; <
=>
ÄÄ= ?
u
ÄÄ@ A
.
ÄÄA B
	CreatedAt
ÄÄB K
)
ÄÄK L
.
ÄÄL M!
FirstOrDefaultAsync
ÄÄM `
(
ÄÄ` a
u
ÄÄa b
=>
ÄÄc e
u
ÄÄf g
.
ÄÄg h
Role
ÄÄh l
==
ÄÄm o
$str
ÄÄp w
||
ÄÄx z
u
ÄÄ{ |
.
ÄÄ| }
RoleÄÄ} 
==ÄÄ‚ „
$strÄÄ… Œ
)ÄÄŒ 
??
ÅÅ 
await
ÅÅ 
db
ÅÅ 
.
ÅÅ 
Users
ÅÅ !
.
ÅÅ! "
OrderByDescending
ÅÅ" 3
(
ÅÅ3 4
u
ÅÅ4 5
=>
ÅÅ6 8
u
ÅÅ9 :
.
ÅÅ: ;
	CreatedAt
ÅÅ; D
)
ÅÅD E
.
ÅÅE F!
FirstOrDefaultAsync
ÅÅF Y
(
ÅÅY Z
)
ÅÅZ [
;
ÅÅ[ \
if
ÆÆ 
(
ÆÆ 
devUser
ÆÆ 
!=
ÆÆ 
null
ÆÆ 
)
ÆÆ  
{
ÇÇ 
var
ÈÈ 
claims
ÈÈ 
=
ÈÈ 
new
ÈÈ  
List
ÈÈ! %
<
ÈÈ% &
Claim
ÈÈ& +
>
ÈÈ+ ,
{
ÉÉ 
new
ÊÊ 
(
ÊÊ 

ClaimTypes
ÊÊ "
.
ÊÊ" #
NameIdentifier
ÊÊ# 1
,
ÊÊ1 2
devUser
ÊÊ3 :
.
ÊÊ: ;
Id
ÊÊ; =
.
ÊÊ= >
ToString
ÊÊ> F
(
ÊÊF G
)
ÊÊG H
)
ÊÊH I
,
ÊÊI J
new
ËË 
(
ËË 
$str
ËË 
,
ËË 
devUser
ËË &
.
ËË& '
Id
ËË' )
.
ËË) *
ToString
ËË* 2
(
ËË2 3
)
ËË3 4
)
ËË4 5
,
ËË5 6
new
ÌÌ 
(
ÌÌ 

ClaimTypes
ÌÌ "
.
ÌÌ" #
Email
ÌÌ# (
,
ÌÌ( )
devUser
ÌÌ* 1
.
ÌÌ1 2
Email
ÌÌ2 7
)
ÌÌ7 8
,
ÌÌ8 9
new
ÍÍ 
(
ÍÍ 

ClaimTypes
ÍÍ "
.
ÍÍ" #
Name
ÍÍ# '
,
ÍÍ' (
string
ÍÍ) /
.
ÍÍ/ 0 
IsNullOrWhiteSpace
ÍÍ0 B
(
ÍÍB C
devUser
ÍÍC J
.
ÍÍJ K
FullName
ÍÍK S
)
ÍÍS T
?
ÍÍU V
devUser
ÍÍW ^
.
ÍÍ^ _
Email
ÍÍ_ d
:
ÍÍe f
devUser
ÍÍg n
.
ÍÍn o
FullName
ÍÍo w
)
ÍÍw x
,
ÍÍx y
new
ÎÎ 
(
ÎÎ 

ClaimTypes
ÎÎ "
.
ÎÎ" #
Role
ÎÎ# '
,
ÎÎ' (
string
ÎÎ) /
.
ÎÎ/ 0 
IsNullOrWhiteSpace
ÎÎ0 B
(
ÎÎB C
devUser
ÎÎC J
.
ÎÎJ K
Role
ÎÎK O
)
ÎÎO P
?
ÎÎQ R
$str
ÎÎS Z
:
ÎÎ[ \
devUser
ÎÎ] d
.
ÎÎd e
Role
ÎÎe i
)
ÎÎi j
,
ÎÎj k
new
ÏÏ 
(
ÏÏ 
$str
ÏÏ 
,
ÏÏ 
string
ÏÏ  &
.
ÏÏ& ' 
IsNullOrWhiteSpace
ÏÏ' 9
(
ÏÏ9 :
devUser
ÏÏ: A
.
ÏÏA B
Role
ÏÏB F
)
ÏÏF G
?
ÏÏH I
$str
ÏÏJ Q
:
ÏÏR S
devUser
ÏÏT [
.
ÏÏ[ \
Role
ÏÏ\ `
)
ÏÏ` a
}
ĞĞ 
;
ĞĞ 
ctx
ÑÑ 
.
ÑÑ 
User
ÑÑ 
=
ÑÑ 
new
ÑÑ 
ClaimsPrincipal
ÑÑ .
(
ÑÑ. /
new
ÑÑ/ 2
ClaimsIdentity
ÑÑ3 A
(
ÑÑA B
claims
ÑÑB H
,
ÑÑH I 
authenticationType
ÑÑJ \
:
ÑÑ\ ]
$str
ÑÑ^ i
)
ÑÑi j
)
ÑÑj k
;
ÑÑk l
}
ÒÒ 
}
ÓÓ 	
await
ÔÔ 
next
ÔÔ 
(
ÔÔ 
)
ÔÔ 
;
ÔÔ 
}
ÕÕ 
)
ÕÕ 
;
ÕÕ 
}ÖÖ 
app×× 
.
×× 
UseAuthorization
×× 
(
×× 
)
×× 
;
×× 
usingÚÚ 
(
ÚÚ 
var
ÚÚ 

scope
ÚÚ 
=
ÚÚ 
app
ÚÚ 
.
ÚÚ 
Services
ÚÚ 
.
ÚÚ  
CreateScope
ÚÚ  +
(
ÚÚ+ ,
)
ÚÚ, -
)
ÚÚ- .
{ÛÛ 
var
ÜÜ 
context
ÜÜ 
=
ÜÜ 
scope
ÜÜ 
.
ÜÜ 
ServiceProvider
ÜÜ '
.
ÜÜ' ( 
GetRequiredService
ÜÜ( :
<
ÜÜ: ;
AppDbContext
ÜÜ; G
>
ÜÜG H
(
ÜÜH I
)
ÜÜI J
;
ÜÜJ K
try
İİ 
{
ŞŞ 
Console
ßß 
.
ßß 
	WriteLine
ßß 
(
ßß 
$str
ßß 5
)
ßß5 6
;
ßß6 7
await
àà 
context
àà 
.
àà 
Database
àà 
.
àà 
MigrateAsync
àà +
(
àà+ ,
)
àà, -
;
àà- .
Console
áá 
.
áá 
	WriteLine
áá 
(
áá 
$str
áá =
)
áá= >
;
áá> ?
Console
ãã 
.
ãã 
	WriteLine
ãã 
(
ãã 
$str
ãã 2
)
ãã2 3
;
ãã3 4
await
ää 
DatabaseSeeder
ää 
.
ää 
	SeedAsync
ää &
(
ää& '
context
ää' .
)
ää. /
;
ää/ 0
Console
åå 
.
åå 
	WriteLine
åå 
(
åå 
$str
åå :
)
åå: ;
;
åå; <
}
ææ 
catch
çç 	
(
çç
 
	Exception
çç 
ex
çç 
)
çç 
{
èè 
var
éé 
logger
éé 
=
éé 
scope
éé 
.
éé 
ServiceProvider
éé *
.
éé* + 
GetRequiredService
éé+ =
<
éé= >
ILogger
éé> E
<
ééE F
Program
ééF M
>
ééM N
>
ééN O
(
ééO P
)
ééP Q
;
ééQ R
logger
êê 
.
êê 
LogError
êê 
(
êê 
ex
êê 
,
êê 
$str
êê A
)
êêA B
;
êêB C
throw
ëë 
;
ëë 
}
ìì 
}íí 
varğğ 
	authGroup
ğğ 
=
ğğ 
app
ğğ 
.
ğğ 
MapGroup
ğğ 
(
ğğ 
$str
ğğ '
)
ğğ' (
.
ğğ( )
WithTags
ğğ) 1
(
ğğ1 2
$str
ğğ2 B
)
ğğB C
;
ğğC D
	authGroupòò 	
.
òò	 

MapPost
òò
 
(
òò 
$str
òò 
,
òò 
async
òò $
(
òò% &
Register
òò& .
.
òò. /
Command
òò/ 6
command
òò7 >
,
òò> ?
ISender
òò@ G
sender
òòH N
)
òòN O
=>
òòP R
{óó 
var
ôô 
result
ôô 
=
ôô 
await
ôô 
sender
ôô 
.
ôô 
Send
ôô "
(
ôô" #
command
ôô# *
)
ôô* +
;
ôô+ ,
return
õõ 

result
õõ 
.
õõ 
	IsSuccess
õõ 
?
öö 	
Results
öö
 
.
öö 
Created
öö 
(
öö 
$"
öö 
$str
öö '
{
öö' (
result
öö( .
.
öö. /
Value
öö/ 4
!
öö4 5
.
öö5 6
Id
öö6 8
}
öö8 9
"
öö9 :
,
öö: ;
result
öö< B
.
ööB C
Value
ööC H
)
ööH I
:
÷÷ 	
Results
÷÷
 
.
÷÷ 

BadRequest
÷÷ 
(
÷÷ 
new
÷÷  
{
÷÷! "
errors
÷÷# )
=
÷÷* +
result
÷÷, 2
.
÷÷2 3
Errors
÷÷3 9
}
÷÷: ;
)
÷÷; <
;
÷÷< =
}øø 
)
øø 
.ùù 
WithName
ùù 	
(
ùù	 

$str
ùù
 
)
ùù 
.úú 
AllowAnonymous
úú 
(
úú 
)
úú 
.ûû 
Produces
ûû 	
<
ûû	 

UserDto
ûû
 
>
ûû 
(
ûû 
StatusCodes
ûû 
.
ûû 
Status201Created
ûû /
)
ûû/ 0
.üü 
Produces
üü 	
<
üü	 

object
üü
 
>
üü 
(
üü 
StatusCodes
üü 
.
üü !
Status400BadRequest
üü 1
)
üü1 2
;
üü2 3
	authGroupşş 	
.
şş	 

MapPost
şş
 
(
şş 
$str
şş 
,
şş 
async
şş !
(
şş" #
Login
şş# (
.
şş( )
Query
şş) .
query
şş/ 4
,
şş4 5
ISender
şş6 =
sender
şş> D
)
şşD E
=>
şşF H
{ÿÿ 
var
€€ 
result
€€ 
=
€€ 
await
€€ 
sender
€€ 
.
€€ 
Send
€€ "
(
€€" #
query
€€# (
)
€€( )
;
€€) *
return
 

result
 
.
 
	IsSuccess
 
?
 
Results
 %
.
% &
Ok
& (
(
( )
result
) /
.
/ 0
Value
0 5
)
5 6
:
7 8
Results
9 @
.
@ A

BadRequest
A K
(
K L
new
L O
{
P Q
errors
R X
=
Y Z
result
[ a
.
a b
Errors
b h
}
i j
)
j k
;
k l
}‚‚ 
)
‚‚ 
.ƒƒ 
WithName
ƒƒ 	
(
ƒƒ	 

$str
ƒƒ
 
)
ƒƒ 
.„„ 
AllowAnonymous
„„ 
(
„„ 
)
„„ 
.…… 
Produces
…… 	
<
……	 

AuthResponseDto
……
 
>
…… 
(
…… 
StatusCodes
…… &
.
……& '
Status200OK
……' 2
)
……2 3
.†† 
Produces
†† 	
<
††	 

object
††
 
>
†† 
(
†† 
StatusCodes
†† 
.
†† !
Status400BadRequest
†† 1
)
††1 2
;
††2 3
	authGroupˆˆ 	
.
ˆˆ	 

MapGet
ˆˆ
 
(
ˆˆ 
$str
ˆˆ 
,
ˆˆ 
async
ˆˆ 
(
ˆˆ 
ClaimsPrincipal
ˆˆ .
user
ˆˆ/ 3
,
ˆˆ3 4
ISender
ˆˆ5 <
sender
ˆˆ= C
)
ˆˆC D
=>
ˆˆE G
{‰‰ 
var
ŠŠ 
userIdClaim
ŠŠ 
=
ŠŠ 
user
ŠŠ 
.
ŠŠ 
	FindFirst
ŠŠ $
(
ŠŠ$ %

ClaimTypes
ŠŠ% /
.
ŠŠ/ 0
NameIdentifier
ŠŠ0 >
)
ŠŠ> ?
?
ŠŠ? @
.
ŠŠ@ A
Value
ŠŠA F
??
‹‹ 
user
‹‹ 
.
‹‹ 
	FindFirst
‹‹ $
(
‹‹$ %
$str
‹‹% *
)
‹‹* +
?
‹‹+ ,
.
‹‹, -
Value
‹‹- 2
;
‹‹2 3
if
 
(
 
string
 
.
 
IsNullOrEmpty
 
(
 
userIdClaim
 (
)
( )
||
* ,
!
- .
Guid
. 2
.
2 3
TryParse
3 ;
(
; <
userIdClaim
< G
,
G H
out
I L
var
M P
userId
Q W
)
W X
)
X Y
{
 
return
 
Results
 
.
 
Unauthorized
 #
(
# $
)
$ %
;
% &
}
 
var
’’ 
result
’’ 
=
’’ 
await
’’ 
sender
’’ 
.
’’ 
Send
’’ "
(
’’" #
new
’’# &
GetCurrentUser
’’' 5
.
’’5 6
Query
’’6 ;
{
’’< =
UserId
’’> D
=
’’E F
userId
’’G M
}
’’N O
)
’’O P
;
’’P Q
return
““ 

result
““ 
.
““ 
	IsSuccess
““ 
?
““ 
Results
““ %
.
““% &
Ok
““& (
(
““( )
result
““) /
.
““/ 0
Value
““0 5
)
““5 6
:
““7 8
Results
““9 @
.
““@ A
NotFound
““A I
(
““I J
new
““J M
{
““N O
errors
““P V
=
““W X
result
““Y _
.
““_ `
Errors
““` f
}
““g h
)
““h i
;
““i j
}”” 
)
”” 
.•• 
WithName
•• 	
(
••	 

$str
••
 
)
•• 
.–– "
RequireAuthorization
–– 
(
–– 
)
–– 
.—— 
Produces
—— 	
<
——	 

UserDto
——
 
>
—— 
(
—— 
StatusCodes
—— 
.
—— 
Status200OK
—— *
)
——* +
.˜˜ 
Produces
˜˜ 	
(
˜˜	 

StatusCodes
˜˜
 
.
˜˜ #
Status401Unauthorized
˜˜ +
)
˜˜+ ,
.™™ 
Produces
™™ 	
<
™™	 

object
™™
 
>
™™ 
(
™™ 
StatusCodes
™™ 
.
™™ 
Status404NotFound
™™ /
)
™™/ 0
;
™™0 1
varœœ 
	menuGroup
œœ 
=
œœ 
app
œœ 
.
œœ 
MapGroup
œœ 
(
œœ 
$str
œœ '
)
œœ' (
.
œœ( )
WithTags
œœ) 1
(
œœ1 2
$str
œœ2 8
)
œœ8 9
;
œœ9 :
	menuGroup 	
.
	 

MapGet

 
(
 
$str
 
,
 
async
 
(
 
ISender
 $
sender
% +
)
+ ,
=>
- /
{ŸŸ 
var
   
result
   
=
   
await
   
sender
   
.
   
Send
   "
(
  " #
new
  # &
GetMenu
  ' .
.
  . /
Query
  / 4
(
  4 5
)
  5 6
)
  6 7
;
  7 8
return
¡¡ 

result
¡¡ 
.
¡¡ 
	IsSuccess
¡¡ 
?
¡¡ 
Results
¡¡ %
.
¡¡% &
Ok
¡¡& (
(
¡¡( )
result
¡¡) /
.
¡¡/ 0
Value
¡¡0 5
)
¡¡5 6
:
¡¡7 8
Results
¡¡9 @
.
¡¡@ A

BadRequest
¡¡A K
(
¡¡K L
new
¡¡L O
{
¡¡P Q
error
¡¡R W
=
¡¡X Y
result
¡¡Z `
.
¡¡` a
Error
¡¡a f
}
¡¡g h
)
¡¡h i
;
¡¡i j
}¢¢ 
)
¢¢ 
.££ 
WithName
££ 	
(
££	 

$str
££
 
)
££ 
.¤¤ 
AllowAnonymous
¤¤ 
(
¤¤ 
)
¤¤ 
.¥¥ 
Produces
¥¥ 	
<
¥¥	 

List
¥¥
 
<
¥¥ 

ProductDto
¥¥ 
>
¥¥ 
>
¥¥ 
(
¥¥ 
StatusCodes
¥¥ '
.
¥¥' (
Status200OK
¥¥( 3
)
¥¥3 4
;
¥¥4 5
	menuGroup§§ 	
.
§§	 

MapGet
§§
 
(
§§ 
$str
§§ 
,
§§ 
async
§§ $
(
§§% &
Guid
§§& *
id
§§+ -
,
§§- .
ISender
§§/ 6
sender
§§7 =
)
§§= >
=>
§§? A
{¨¨ 
var
©© 
result
©© 
=
©© 
await
©© 
sender
©© 
.
©© 
Send
©© "
(
©©" #
new
©©# &
GetProductById
©©' 5
.
©©5 6
Query
©©6 ;
(
©©; <
id
©©< >
)
©©> ?
)
©©? @
;
©©@ A
return
ªª 

result
ªª 
.
ªª 
	IsSuccess
ªª 
?
ªª 
Results
ªª %
.
ªª% &
Ok
ªª& (
(
ªª( )
result
ªª) /
.
ªª/ 0
Value
ªª0 5
)
ªª5 6
:
ªª7 8
Results
ªª9 @
.
ªª@ A
NotFound
ªªA I
(
ªªI J
new
ªªJ M
{
ªªN O
error
ªªP U
=
ªªV W
result
ªªX ^
.
ªª^ _
Error
ªª_ d
}
ªªe f
)
ªªf g
;
ªªg h
}«« 
)
«« 
.¬¬ 
WithName
¬¬ 	
(
¬¬	 

$str
¬¬
 
)
¬¬ 
.­­ 
AllowAnonymous
­­ 
(
­­ 
)
­­ 
.®® 
Produces
®® 	
<
®®	 


ProductDto
®®
 
>
®® 
(
®® 
StatusCodes
®® !
.
®®! "
Status200OK
®®" -
)
®®- .
.¯¯ 
Produces
¯¯ 	
<
¯¯	 

object
¯¯
 
>
¯¯ 
(
¯¯ 
StatusCodes
¯¯ 
.
¯¯ 
Status404NotFound
¯¯ /
)
¯¯/ 0
;
¯¯0 1
	menuGroup±± 	
.
±±	 

MapPost
±±
 
(
±± 
$str
±± 
,
±± 
async
±± 
(
±± 
CreateProduct
±± +
.
±±+ ,
Command
±±, 3
command
±±4 ;
,
±±; <
ISender
±±= D
sender
±±E K
)
±±K L
=>
±±M O
{²² 
var
³³ 
result
³³ 
=
³³ 
await
³³ 
sender
³³ 
.
³³ 
Send
³³ "
(
³³" #
command
³³# *
)
³³* +
;
³³+ ,
if
´´ 
(
´´ 
!
´´ 	
result
´´	 
.
´´ 
	IsSuccess
´´ 
)
´´ 
return
µµ 
Results
µµ 
.
µµ 

BadRequest
µµ !
(
µµ! "
new
µµ" %
{
µµ& '
errors
µµ( .
=
µµ/ 0
result
µµ1 7
.
µµ7 8
Errors
µµ8 >
.
µµ> ?
Any
µµ? B
(
µµB C
)
µµC D
?
µµE F
result
µµG M
.
µµM N
Errors
µµN T
:
µµU V
new
µµW Z
List
µµ[ _
<
µµ_ `
string
µµ` f
>
µµf g
{
µµh i
result
µµj p
.
µµp q
Error
µµq v
!
µµv w
}
µµx y
}
µµz {
)
µµ{ |
;
µµ| }
return
·· 

Results
·· 
.
·· 
CreatedAtRoute
·· !
(
··! "
$str
··" 2
,
··2 3
new
··4 7
{
··8 9
id
··: <
=
··= >
result
··? E
.
··E F
Value
··F K
!
··K L
.
··L M
Id
··M O
}
··P Q
,
··Q R
result
··S Y
.
··Y Z
Value
··Z _
)
··_ `
;
··` a
}¸¸ 
)
¸¸ 
.¹¹ 
WithName
¹¹ 	
(
¹¹	 

$str
¹¹
 
)
¹¹ 
.ºº 
Produces
ºº 	
<
ºº	 


ProductDto
ºº
 
>
ºº 
(
ºº 
StatusCodes
ºº !
.
ºº! "
Status201Created
ºº" 2
)
ºº2 3
.»» 
Produces
»» 	
<
»»	 

object
»»
 
>
»» 
(
»» 
StatusCodes
»» 
.
»» !
Status400BadRequest
»» 1
)
»»1 2
;
»»2 3
	menuGroup½½ 	
.
½½	 

MapPut
½½
 
(
½½ 
$str
½½ 
,
½½ 
async
½½ $
(
½½% &
Guid
½½& *
id
½½+ -
,
½½- .
UpdateProduct
½½/ <
.
½½< =
Command
½½= D
command
½½E L
,
½½L M
ISender
½½N U
sender
½½V \
)
½½\ ]
=>
½½^ `
{¾¾ 
if
¿¿ 
(
¿¿ 
id
¿¿ 

!=
¿¿ 
command
¿¿ 
.
¿¿ 
Id
¿¿ 
)
¿¿ 
return
ÀÀ 
Results
ÀÀ 
.
ÀÀ 

BadRequest
ÀÀ !
(
ÀÀ! "
new
ÀÀ" %
{
ÀÀ& '
error
ÀÀ( -
=
ÀÀ. /
$str
ÀÀ0 W
}
ÀÀX Y
)
ÀÀY Z
;
ÀÀZ [
var
ÂÂ 
result
ÂÂ 
=
ÂÂ 
await
ÂÂ 
sender
ÂÂ 
.
ÂÂ 
Send
ÂÂ "
(
ÂÂ" #
command
ÂÂ# *
)
ÂÂ* +
;
ÂÂ+ ,
if
ÃÃ 
(
ÃÃ 
!
ÃÃ 	
result
ÃÃ	 
.
ÃÃ 
	IsSuccess
ÃÃ 
)
ÃÃ 
return
ÄÄ 
Results
ÄÄ 
.
ÄÄ 

BadRequest
ÄÄ !
(
ÄÄ! "
new
ÄÄ" %
{
ÄÄ& '
errors
ÄÄ( .
=
ÄÄ/ 0
result
ÄÄ1 7
.
ÄÄ7 8
Errors
ÄÄ8 >
.
ÄÄ> ?
Any
ÄÄ? B
(
ÄÄB C
)
ÄÄC D
?
ÄÄE F
result
ÄÄG M
.
ÄÄM N
Errors
ÄÄN T
:
ÄÄU V
new
ÄÄW Z
List
ÄÄ[ _
<
ÄÄ_ `
string
ÄÄ` f
>
ÄÄf g
{
ÄÄh i
result
ÄÄj p
.
ÄÄp q
Error
ÄÄq v
!
ÄÄv w
}
ÄÄx y
}
ÄÄz {
)
ÄÄ{ |
;
ÄÄ| }
return
ÆÆ 

Results
ÆÆ 
.
ÆÆ 
Ok
ÆÆ 
(
ÆÆ 
result
ÆÆ 
.
ÆÆ 
Value
ÆÆ "
)
ÆÆ" #
;
ÆÆ# $
}ÇÇ 
)
ÇÇ 
.ÈÈ 
WithName
ÈÈ 	
(
ÈÈ	 

$str
ÈÈ
 
)
ÈÈ 
.ÉÉ 
Produces
ÉÉ 	
<
ÉÉ	 


ProductDto
ÉÉ
 
>
ÉÉ 
(
ÉÉ 
StatusCodes
ÉÉ !
.
ÉÉ! "
Status200OK
ÉÉ" -
)
ÉÉ- .
.ÊÊ 
Produces
ÊÊ 	
<
ÊÊ	 

object
ÊÊ
 
>
ÊÊ 
(
ÊÊ 
StatusCodes
ÊÊ 
.
ÊÊ !
Status400BadRequest
ÊÊ 1
)
ÊÊ1 2
;
ÊÊ2 3
	menuGroupÌÌ 	
.
ÌÌ	 

	MapDelete
ÌÌ
 
(
ÌÌ 
$str
ÌÌ  
,
ÌÌ  !
async
ÌÌ" '
(
ÌÌ( )
Guid
ÌÌ) -
id
ÌÌ. 0
,
ÌÌ0 1
ISender
ÌÌ2 9
sender
ÌÌ: @
)
ÌÌ@ A
=>
ÌÌB D
{ÍÍ 
var
ÎÎ 
result
ÎÎ 
=
ÎÎ 
await
ÎÎ 
sender
ÎÎ 
.
ÎÎ 
Send
ÎÎ "
(
ÎÎ" #
new
ÎÎ# &
DeleteProduct
ÎÎ' 4
.
ÎÎ4 5
Command
ÎÎ5 <
(
ÎÎ< =
id
ÎÎ= ?
)
ÎÎ? @
)
ÎÎ@ A
;
ÎÎA B
return
ÏÏ 

result
ÏÏ 
.
ÏÏ 
	IsSuccess
ÏÏ 
?
ÏÏ 
Results
ÏÏ %
.
ÏÏ% &
	NoContent
ÏÏ& /
(
ÏÏ/ 0
)
ÏÏ0 1
:
ÏÏ2 3
Results
ÏÏ4 ;
.
ÏÏ; <

BadRequest
ÏÏ< F
(
ÏÏF G
new
ÏÏG J
{
ÏÏK L
error
ÏÏM R
=
ÏÏS T
result
ÏÏU [
.
ÏÏ[ \
Error
ÏÏ\ a
}
ÏÏb c
)
ÏÏc d
;
ÏÏd e
}ĞĞ 
)
ĞĞ 
.ÑÑ 
WithName
ÑÑ 	
(
ÑÑ	 

$str
ÑÑ
 
)
ÑÑ 
.ÒÒ 
Produces
ÒÒ 	
(
ÒÒ	 

StatusCodes
ÒÒ
 
.
ÒÒ  
Status204NoContent
ÒÒ (
)
ÒÒ( )
.ÓÓ 
Produces
ÓÓ 	
<
ÓÓ	 

object
ÓÓ
 
>
ÓÓ 
(
ÓÓ 
StatusCodes
ÓÓ 
.
ÓÓ !
Status400BadRequest
ÓÓ 1
)
ÓÓ1 2
;
ÓÓ2 3
varÖÖ 
ordersGroup
ÖÖ 
=
ÖÖ 
app
ÖÖ 
.
ÖÖ 
MapGroup
ÖÖ 
(
ÖÖ 
$str
ÖÖ +
)
ÖÖ+ ,
.
ÖÖ, -
WithTags
ÖÖ- 5
(
ÖÖ5 6
$str
ÖÖ6 >
)
ÖÖ> ?
;
ÖÖ? @
ordersGroupØØ 
.
ØØ 
MapPost
ØØ 
(
ØØ 
$str
ØØ 
,
ØØ 
async
ØØ 
(
ØØ  
CreateOrder
ØØ  +
.
ØØ+ ,
Command
ØØ, 3
command
ØØ4 ;
,
ØØ; <
ClaimsPrincipal
ØØ= L
user
ØØM Q
,
ØØQ R
ISender
ØØS Z
sender
ØØ[ a
)
ØØa b
=>
ØØc e
{ÙÙ 
var
ÚÚ 
userIdClaim
ÚÚ 
=
ÚÚ 
user
ÚÚ 
.
ÚÚ 
	FindFirst
ÚÚ $
(
ÚÚ$ %

ClaimTypes
ÚÚ% /
.
ÚÚ/ 0
NameIdentifier
ÚÚ0 >
)
ÚÚ> ?
?
ÚÚ? @
.
ÚÚ@ A
Value
ÚÚA F
??
ÚÚG I
user
ÚÚJ N
.
ÚÚN O
	FindFirst
ÚÚO X
(
ÚÚX Y
$str
ÚÚY ^
)
ÚÚ^ _
?
ÚÚ_ `
.
ÚÚ` a
Value
ÚÚa f
;
ÚÚf g
if
ÛÛ 
(
ÛÛ 
string
ÛÛ 
.
ÛÛ 
IsNullOrEmpty
ÛÛ 
(
ÛÛ 
userIdClaim
ÛÛ (
)
ÛÛ( )
||
ÛÛ* ,
!
ÛÛ- .
Guid
ÛÛ. 2
.
ÛÛ2 3
TryParse
ÛÛ3 ;
(
ÛÛ; <
userIdClaim
ÛÛ< G
,
ÛÛG H
out
ÛÛI L
var
ÛÛM P!
authenticatedUserId
ÛÛQ d
)
ÛÛd e
)
ÛÛe f
{
ÜÜ 
return
İİ 
Results
İİ 
.
İİ 
Unauthorized
İİ #
(
İİ# $
)
İİ$ %
;
İİ% &
}
ŞŞ 
if
ßß 
(
ßß 
command
ßß 
.
ßß 
UserId
ßß 
!=
ßß !
authenticatedUserId
ßß -
)
ßß- .
{
ßß/ 0
return
ßß1 7
Results
ßß8 ?
.
ßß? @
Forbid
ßß@ F
(
ßßF G
)
ßßG H
;
ßßH I
}
ßßJ K
var
áá 
result
áá 
=
áá 
await
áá 
sender
áá 
.
áá 
Send
áá "
(
áá" #
command
áá# *
)
áá* +
;
áá+ ,
return
ââ 

result
ââ 
.
ââ 
	IsSuccess
ââ 
?
ââ 
Results
ââ %
.
ââ% &
Created
ââ& -
(
ââ- .
$"
ââ. 0
$str
ââ0 <
{
ââ< =
result
ââ= C
.
ââC D
Value
ââD I
!
ââI J
.
ââJ K
Id
ââK M
}
ââM N
"
ââN O
,
ââO P
result
ââQ W
.
ââW X
Value
ââX ]
)
ââ] ^
:
ââ_ `
Results
ââa h
.
ââh i

BadRequest
ââi s
(
ââs t
new
âât w
{
ââx y
errorsââz €
=ââ ‚
resultââƒ ‰
.ââ‰ Š
ErrorsââŠ 
}ââ‘ ’
)ââ’ “
;ââ“ ”
}ãã 
)
ãã 
.ää 
WithName
ää 	
(
ää	 

$str
ää
 
)
ää 
.åå "
RequireAuthorization
åå 
(
åå 
)
åå 
.ææ 
Produces
ææ 	
<
ææ	 

OrderDto
ææ
 
>
ææ 
(
ææ 
StatusCodes
ææ 
.
ææ  
Status201Created
ææ  0
)
ææ0 1
.çç 
Produces
çç 	
(
çç	 

StatusCodes
çç
 
.
çç #
Status401Unauthorized
çç +
)
çç+ ,
.èè 
Produces
èè 	
(
èè	 

StatusCodes
èè
 
.
èè  
Status403Forbidden
èè (
)
èè( )
.éé 
Produces
éé 	
<
éé	 

object
éé
 
>
éé 
(
éé 
StatusCodes
éé 
.
éé !
Status400BadRequest
éé 1
)
éé1 2
;
éé2 3
ordersGroupëë 
.
ëë 
MapGet
ëë 
(
ëë 
$str
ëë (
,
ëë( )
async
ëë* /
(
ëë0 1
Guid
ëë1 5
userId
ëë6 <
,
ëë< =
ClaimsPrincipal
ëë> M
user
ëëN R
,
ëëR S
ISender
ëëT [
sender
ëë\ b
)
ëëb c
=>
ëëd f
{ìì 
var
íí 
userIdClaim
íí 
=
íí 
user
íí 
.
íí 
	FindFirst
íí $
(
íí$ %

ClaimTypes
íí% /
.
íí/ 0
NameIdentifier
íí0 >
)
íí> ?
?
íí? @
.
íí@ A
Value
ííA F
??
ííG I
user
ííJ N
.
ííN O
	FindFirst
ííO X
(
ííX Y
$str
ííY ^
)
íí^ _
?
íí_ `
.
íí` a
Value
íía f
;
ííf g
if
îî 
(
îî 
string
îî 
.
îî 
IsNullOrEmpty
îî 
(
îî 
userIdClaim
îî (
)
îî( )
||
îî* ,
!
îî- .
Guid
îî. 2
.
îî2 3
TryParse
îî3 ;
(
îî; <
userIdClaim
îî< G
,
îîG H
out
îîI L
var
îîM P!
authenticatedUserId
îîQ d
)
îîd e
)
îîe f
{
ïï 
return
ğğ 
Results
ğğ 
.
ğğ 
Unauthorized
ğğ #
(
ğğ# $
)
ğğ$ %
;
ğğ% &
}
ññ 
var
òò 
userRole
òò 
=
òò 
user
òò 
.
òò 
	FindFirst
òò !
(
òò! "

ClaimTypes
òò" ,
.
òò, -
Role
òò- 1
)
òò1 2
?
òò2 3
.
òò3 4
Value
òò4 9
;
òò9 :
if
óó 
(
óó 
userId
óó 
!=
óó !
authenticatedUserId
óó %
&&
óó& (
userRole
óó) 1
!=
óó2 4
$str
óó5 <
&&
óó= ?
userRole
óó@ H
!=
óóI K
$str
óóL S
)
óóS T
{
ôô 
return
õõ 
Results
õõ 
.
õõ 
Forbid
õõ 
(
õõ 
)
õõ 
;
õõ  
}
öö 
var
÷÷ 
result
÷÷ 
=
÷÷ 
await
÷÷ 
sender
÷÷ 
.
÷÷ 
Send
÷÷ "
(
÷÷" #
new
÷÷# &
GetUserOrders
÷÷' 4
.
÷÷4 5
Query
÷÷5 :
{
÷÷; <
UserId
÷÷= C
=
÷÷D E
userId
÷÷F L
}
÷÷M N
)
÷÷N O
;
÷÷O P
return
øø 

result
øø 
.
øø 
	IsSuccess
øø 
?
øø 
Results
øø %
.
øø% &
Ok
øø& (
(
øø( )
result
øø) /
.
øø/ 0
Value
øø0 5
)
øø5 6
:
øø7 8
Results
øø9 @
.
øø@ A

BadRequest
øøA K
(
øøK L
new
øøL O
{
øøP Q
errors
øøR X
=
øøY Z
result
øø[ a
.
øøa b
Errors
øøb h
}
øøi j
)
øøj k
;
øøk l
}ùù 
)
ùù 
.úú 
WithName
úú 	
(
úú	 

$str
úú
 
)
úú 
.ûû "
RequireAuthorization
ûû 
(
ûû 
)
ûû 
.üü 
Produces
üü 	
<
üü	 

List
üü
 
<
üü 
OrderDto
üü 
>
üü 
>
üü 
(
üü 
StatusCodes
üü %
.
üü% &
Status200OK
üü& 1
)
üü1 2
.ıı 
Produces
ıı 	
(
ıı	 

StatusCodes
ıı
 
.
ıı #
Status401Unauthorized
ıı +
)
ıı+ ,
.şş 
Produces
şş 	
(
şş	 

StatusCodes
şş
 
.
şş  
Status403Forbidden
şş (
)
şş( )
.ÿÿ 
Produces
ÿÿ 	
<
ÿÿ	 

object
ÿÿ
 
>
ÿÿ 
(
ÿÿ 
StatusCodes
ÿÿ 
.
ÿÿ !
Status400BadRequest
ÿÿ 1
)
ÿÿ1 2
;
ÿÿ2 3
ordersGroup 
.
 
MapGet
 
(
 
$str
 $
,
$ %
async
& +
(
, -
Guid
- 1
orderId
2 9
,
9 :
ClaimsPrincipal
; J
user
K O
,
O P
ISender
Q X
sender
Y _
)
_ `
=>
a c
{‚‚ 
var
ƒƒ 
userIdClaim
ƒƒ 
=
ƒƒ 
user
ƒƒ 
.
ƒƒ 
	FindFirst
ƒƒ $
(
ƒƒ$ %

ClaimTypes
ƒƒ% /
.
ƒƒ/ 0
NameIdentifier
ƒƒ0 >
)
ƒƒ> ?
?
ƒƒ? @
.
ƒƒ@ A
Value
ƒƒA F
??
ƒƒG I
user
ƒƒJ N
.
ƒƒN O
	FindFirst
ƒƒO X
(
ƒƒX Y
$str
ƒƒY ^
)
ƒƒ^ _
?
ƒƒ_ `
.
ƒƒ` a
Value
ƒƒa f
;
ƒƒf g
if
„„ 
(
„„ 
string
„„ 
.
„„ 
IsNullOrEmpty
„„ 
(
„„ 
userIdClaim
„„ (
)
„„( )
||
„„* ,
!
„„- .
Guid
„„. 2
.
„„2 3
TryParse
„„3 ;
(
„„; <
userIdClaim
„„< G
,
„„G H
out
„„I L
var
„„M P!
authenticatedUserId
„„Q d
)
„„d e
)
„„e f
{
…… 
return
†† 
Results
†† 
.
†† 
Unauthorized
†† #
(
††# $
)
††$ %
;
††% &
}
‡‡ 
var
ˆˆ 
result
ˆˆ 
=
ˆˆ 
await
ˆˆ 
sender
ˆˆ 
.
ˆˆ 
Send
ˆˆ "
(
ˆˆ" #
new
ˆˆ# &
GetOrderById
ˆˆ' 3
.
ˆˆ3 4
Query
ˆˆ4 9
{
ˆˆ: ;
OrderId
ˆˆ< C
=
ˆˆD E
orderId
ˆˆF M
,
ˆˆM N
UserId
ˆˆO U
=
ˆˆV W!
authenticatedUserId
ˆˆX k
}
ˆˆl m
)
ˆˆm n
;
ˆˆn o
return
‰‰ 

result
‰‰ 
.
‰‰ 
	IsSuccess
‰‰ 
?
‰‰ 
Results
‰‰ %
.
‰‰% &
Ok
‰‰& (
(
‰‰( )
result
‰‰) /
.
‰‰/ 0
Value
‰‰0 5
)
‰‰5 6
:
‰‰7 8
Results
‰‰9 @
.
‰‰@ A
NotFound
‰‰A I
(
‰‰I J
new
‰‰J M
{
‰‰N O
errors
‰‰P V
=
‰‰W X
result
‰‰Y _
.
‰‰_ `
Errors
‰‰` f
}
‰‰g h
)
‰‰h i
;
‰‰i j
}ŠŠ 
)
ŠŠ 
.‹‹ 
WithName
‹‹ 	
(
‹‹	 

$str
‹‹
 
)
‹‹ 
.ŒŒ "
RequireAuthorization
ŒŒ 
(
ŒŒ 
)
ŒŒ 
. 
Produces
 	
<
	 

OrderDto

 
>
 
(
 
StatusCodes
 
.
  
Status200OK
  +
)
+ ,
. 
Produces
 	
(
	 

StatusCodes

 
.
 #
Status401Unauthorized
 +
)
+ ,
. 
Produces
 	
<
	 

object

 
>
 
(
 
StatusCodes
 
.
 
Status404NotFound
 /
)
/ 0
;
0 1
ordersGroup‘‘ 
.
‘‘ 
	MapDelete
‘‘ 
(
‘‘ 
$str
‘‘ '
,
‘‘' (
async
‘‘) .
(
‘‘/ 0
Guid
‘‘0 4
orderId
‘‘5 <
,
‘‘< =
string
‘‘> D
?
‘‘D E 
cancellationReason
‘‘F X
,
‘‘X Y
ClaimsPrincipal
‘‘Z i
user
‘‘j n
,
‘‘n o
ISender
‘‘p w
sender
‘‘x ~
)
‘‘~ 
=>‘‘€ ‚
{’’ 
var
““ 
userIdClaim
““ 
=
““ 
user
““ 
.
““ 
	FindFirst
““ $
(
““$ %

ClaimTypes
““% /
.
““/ 0
NameIdentifier
““0 >
)
““> ?
?
““? @
.
““@ A
Value
““A F
??
““G I
user
““J N
.
““N O
	FindFirst
““O X
(
““X Y
$str
““Y ^
)
““^ _
?
““_ `
.
““` a
Value
““a f
;
““f g
if
”” 
(
”” 
string
”” 
.
”” 
IsNullOrEmpty
”” 
(
”” 
userIdClaim
”” (
)
””( )
||
””* ,
!
””- .
Guid
””. 2
.
””2 3
TryParse
””3 ;
(
””; <
userIdClaim
””< G
,
””G H
out
””I L
var
””M P!
authenticatedUserId
””Q d
)
””d e
)
””e f
{
•• 
return
–– 
Results
–– 
.
–– 
Unauthorized
–– #
(
––# $
)
––$ %
;
––% &
}
—— 
var
˜˜ 
result
˜˜ 
=
˜˜ 
await
˜˜ 
sender
˜˜ 
.
˜˜ 
Send
˜˜ "
(
˜˜" #
new
˜˜# &
CancelOrder
˜˜' 2
.
˜˜2 3
Command
˜˜3 :
{
™™ 
OrderId
šš 
=
šš 
orderId
šš 
,
šš 
UserId
›› 
=
›› !
authenticatedUserId
›› $
,
››$ % 
CancellationReason
œœ 
=
œœ  
cancellationReason
œœ /
}
 
)
 
;
 
return
 

result
 
.
 
	IsSuccess
 
?
 
Results
 %
.
% &
Ok
& (
(
( )
result
) /
.
/ 0
Value
0 5
)
5 6
:
7 8
Results
9 @
.
@ A

BadRequest
A K
(
K L
new
L O
{
P Q
errors
R X
=
Y Z
result
[ a
.
a b
Errors
b h
}
i j
)
j k
;
k l
}ŸŸ 
)
ŸŸ 
.   
WithName
   	
(
  	 

$str
  
 
)
   
.¡¡ "
RequireAuthorization
¡¡ 
(
¡¡ 
)
¡¡ 
.¢¢ 
Produces
¢¢ 	
<
¢¢	 

OrderDto
¢¢
 
>
¢¢ 
(
¢¢ 
StatusCodes
¢¢ 
.
¢¢  
Status200OK
¢¢  +
)
¢¢+ ,
.££ 
Produces
££ 	
(
££	 

StatusCodes
££
 
.
££ #
Status401Unauthorized
££ +
)
££+ ,
.¤¤ 
Produces
¤¤ 	
<
¤¤	 

object
¤¤
 
>
¤¤ 
(
¤¤ 
StatusCodes
¤¤ 
.
¤¤ !
Status400BadRequest
¤¤ 1
)
¤¤1 2
;
¤¤2 3
var§§ 
kitchenGroup
§§ 
=
§§ 
app
§§ 
.
§§ 
MapGroup
§§ 
(
§§  
$str
§§  -
)
§§- .
.
§§. /
WithTags
§§/ 7
(
§§7 8
$str
§§8 A
)
§§A B
;
§§B C
kitchenGroup©© 
.
©© 
MapGet
©© 
(
©© 
$str
©© 
,
©© 
async
©©  %
(
©©& '
ISender
©©' .
sender
©©/ 5
)
©©5 6
=>
©©7 9
{ªª 
var
«« 
result
«« 
=
«« 
await
«« 
sender
«« 
.
«« 
Send
«« "
(
««" #
new
««# &
GetPendingOrders
««' 7
.
««7 8
Query
««8 =
(
««= >
)
««> ?
)
««? @
;
««@ A
return
¬¬ 

result
¬¬ 
.
¬¬ 
	IsSuccess
¬¬ 
?
¬¬ 
Results
¬¬ %
.
¬¬% &
Ok
¬¬& (
(
¬¬( )
result
¬¬) /
.
¬¬/ 0
Value
¬¬0 5
)
¬¬5 6
:
¬¬7 8
Results
¬¬9 @
.
¬¬@ A

BadRequest
¬¬A K
(
¬¬K L
new
¬¬L O
{
¬¬P Q
errors
¬¬R X
=
¬¬Y Z
result
¬¬[ a
.
¬¬a b
Errors
¬¬b h
}
¬¬i j
)
¬¬j k
;
¬¬k l
}­­ 
)
­­ 
.®® 
WithName
®® 	
(
®®	 

$str
®®
 
)
®® 
.¯¯ "
RequireAuthorization
¯¯ 
(
¯¯ 
policy
¯¯ 
=>
¯¯ 
policy
¯¯  &
.
¯¯& '
RequireRole
¯¯' 2
(
¯¯2 3
$str
¯¯3 :
,
¯¯: ;
$str
¯¯< C
)
¯¯C D
)
¯¯D E
.°° 
Produces
°° 	
<
°°	 

List
°°
 
<
°° 
OrderDto
°° 
>
°° 
>
°° 
(
°° 
StatusCodes
°° %
.
°°% &
Status200OK
°°& 1
)
°°1 2
.±± 
Produces
±± 	
(
±±	 

StatusCodes
±±
 
.
±± #
Status401Unauthorized
±± +
)
±±+ ,
.²² 
Produces
²² 	
(
²²	 

StatusCodes
²²
 
.
²²  
Status403Forbidden
²² (
)
²²( )
.³³ 
Produces
³³ 	
<
³³	 

object
³³
 
>
³³ 
(
³³ 
StatusCodes
³³ 
.
³³ !
Status400BadRequest
³³ 1
)
³³1 2
;
³³2 3
kitchenGroupµµ 
.
µµ 
MapPatch
µµ 
(
µµ 
$str
µµ 5
,
µµ5 6
async
µµ7 <
(
µµ= >
Guid
µµ> B
orderId
µµC J
,
µµJ K
UpdateOrderStatus
µµL ]
.
µµ] ^
Command
µµ^ e
command
µµf m
,
µµm n
ISender
µµo v
sender
µµw }
)
µµ} ~
=>µµ 
{¶¶ 
var
·· 
updatedCommand
·· 
=
·· 
command
··  
with
··! %
{
··& '
OrderId
··( /
=
··0 1
orderId
··2 9
}
··: ;
;
··; <
var
¸¸ 
result
¸¸ 
=
¸¸ 
await
¸¸ 
sender
¸¸ 
.
¸¸ 
Send
¸¸ "
(
¸¸" #
updatedCommand
¸¸# 1
)
¸¸1 2
;
¸¸2 3
return
¹¹ 

result
¹¹ 
.
¹¹ 
	IsSuccess
¹¹ 
?
¹¹ 
Results
¹¹ %
.
¹¹% &
Ok
¹¹& (
(
¹¹( )
result
¹¹) /
.
¹¹/ 0
Value
¹¹0 5
)
¹¹5 6
:
¹¹7 8
Results
¹¹9 @
.
¹¹@ A

BadRequest
¹¹A K
(
¹¹K L
new
¹¹L O
{
¹¹P Q
errors
¹¹R X
=
¹¹Y Z
result
¹¹[ a
.
¹¹a b
Errors
¹¹b h
}
¹¹i j
)
¹¹j k
;
¹¹k l
}ºº 
)
ºº 
.»» 
WithName
»» 	
(
»»	 

$str
»»
 
)
»» 
.¼¼ "
RequireAuthorization
¼¼ 
(
¼¼ 
policy
¼¼ 
=>
¼¼ 
policy
¼¼  &
.
¼¼& '
RequireRole
¼¼' 2
(
¼¼2 3
$str
¼¼3 :
,
¼¼: ;
$str
¼¼< C
)
¼¼C D
)
¼¼D E
.½½ 
Produces
½½ 	
<
½½	 

OrderDto
½½
 
>
½½ 
(
½½ 
StatusCodes
½½ 
.
½½  
Status200OK
½½  +
)
½½+ ,
.¾¾ 
Produces
¾¾ 	
(
¾¾	 

StatusCodes
¾¾
 
.
¾¾ #
Status401Unauthorized
¾¾ +
)
¾¾+ ,
.¿¿ 
Produces
¿¿ 	
(
¿¿	 

StatusCodes
¿¿
 
.
¿¿  
Status403Forbidden
¿¿ (
)
¿¿( )
.ÀÀ 
Produces
ÀÀ 	
<
ÀÀ	 

object
ÀÀ
 
>
ÀÀ 
(
ÀÀ 
StatusCodes
ÀÀ 
.
ÀÀ !
Status400BadRequest
ÀÀ 1
)
ÀÀ1 2
;
ÀÀ2 3
kitchenGroupÂÂ 
.
ÂÂ 
MapGet
ÂÂ 
(
ÂÂ 
$str
ÂÂ &
,
ÂÂ& '
async
ÂÂ( -
(
ÂÂ. /
DateTime
ÂÂ/ 7
?
ÂÂ7 8

reportDate
ÂÂ9 C
,
ÂÂC D
ISender
ÂÂE L
sender
ÂÂM S
)
ÂÂS T
=>
ÂÂU W
{ÃÃ 
var
ÄÄ 
result
ÄÄ 
=
ÄÄ 
await
ÄÄ 
sender
ÄÄ 
.
ÄÄ 
Send
ÄÄ "
(
ÄÄ" #
new
ÄÄ# &%
GetDailyInventoryReport
ÄÄ' >
.
ÄÄ> ?
Query
ÄÄ? D
{
ÄÄE F

ReportDate
ÄÄG Q
=
ÄÄR S

reportDate
ÄÄT ^
}
ÄÄ_ `
)
ÄÄ` a
;
ÄÄa b
return
ÅÅ 

result
ÅÅ 
.
ÅÅ 
	IsSuccess
ÅÅ 
?
ÅÅ 
Results
ÅÅ %
.
ÅÅ% &
Ok
ÅÅ& (
(
ÅÅ( )
result
ÅÅ) /
.
ÅÅ/ 0
Value
ÅÅ0 5
)
ÅÅ5 6
:
ÅÅ7 8
Results
ÅÅ9 @
.
ÅÅ@ A

BadRequest
ÅÅA K
(
ÅÅK L
new
ÅÅL O
{
ÅÅP Q
errors
ÅÅR X
=
ÅÅY Z
result
ÅÅ[ a
.
ÅÅa b
Errors
ÅÅb h
}
ÅÅi j
)
ÅÅj k
;
ÅÅk l
}ÆÆ 
)
ÆÆ 
.ÇÇ 
WithName
ÇÇ 	
(
ÇÇ	 

$str
ÇÇ
 #
)
ÇÇ# $
.ÈÈ "
RequireAuthorization
ÈÈ 
(
ÈÈ 
policy
ÈÈ 
=>
ÈÈ 
policy
ÈÈ  &
.
ÈÈ& '
RequireRole
ÈÈ' 2
(
ÈÈ2 3
$str
ÈÈ3 :
,
ÈÈ: ;
$str
ÈÈ< C
)
ÈÈC D
)
ÈÈD E
.ÉÉ 
Produces
ÉÉ 	
<
ÉÉ	 

object
ÉÉ
 
>
ÉÉ 
(
ÉÉ 
StatusCodes
ÉÉ 
.
ÉÉ 
Status200OK
ÉÉ )
)
ÉÉ) *
.ÊÊ 
Produces
ÊÊ 	
(
ÊÊ	 

StatusCodes
ÊÊ
 
.
ÊÊ #
Status401Unauthorized
ÊÊ +
)
ÊÊ+ ,
.ËË 
Produces
ËË 	
(
ËË	 

StatusCodes
ËË
 
.
ËË  
Status403Forbidden
ËË (
)
ËË( )
.ÌÌ 
Produces
ÌÌ 	
<
ÌÌ	 

object
ÌÌ
 
>
ÌÌ 
(
ÌÌ 
StatusCodes
ÌÌ 
.
ÌÌ !
Status400BadRequest
ÌÌ 1
)
ÌÌ1 2
;
ÌÌ2 3
varÏÏ 
paymentsGroup
ÏÏ 
=
ÏÏ 
app
ÏÏ 
.
ÏÏ 
MapGroup
ÏÏ  
(
ÏÏ  !
$str
ÏÏ! /
)
ÏÏ/ 0
.
ÏÏ0 1
WithTags
ÏÏ1 9
(
ÏÏ9 :
$str
ÏÏ: D
)
ÏÏD E
;
ÏÏE F
paymentsGroupÑÑ 
.
ÑÑ 
MapPost
ÑÑ 
(
ÑÑ 
$str
ÑÑ  
,
ÑÑ  !
async
ÑÑ" '
(
ÑÑ( )
ProcessPayment
ÑÑ) 7
.
ÑÑ7 8
Command
ÑÑ8 ?
command
ÑÑ@ G
,
ÑÑG H
ISender
ÑÑI P
sender
ÑÑQ W
)
ÑÑW X
=>
ÑÑY [
{
ÒÒ 
var
ÓÓ 
result
ÓÓ 
=
ÓÓ 
await
ÓÓ 
sender
ÓÓ !
.
ÓÓ! "
Send
ÓÓ" &
(
ÓÓ& '
command
ÓÓ' .
)
ÓÓ. /
;
ÓÓ/ 0
return
ÔÔ 
result
ÔÔ 
.
ÔÔ 
	IsSuccess
ÔÔ 
?
ÕÕ 
Results
ÕÕ 
.
ÕÕ 
Ok
ÕÕ 
(
ÕÕ 
result
ÕÕ 
.
ÕÕ  
Value
ÕÕ  %
)
ÕÕ% &
:
ÖÖ 
Results
ÖÖ 
.
ÖÖ 

BadRequest
ÖÖ  
(
ÖÖ  !
new
ÖÖ! $
{
ÖÖ% &
errors
ÖÖ' -
=
ÖÖ. /
result
ÖÖ0 6
.
ÖÖ6 7
Errors
ÖÖ7 =
}
ÖÖ> ?
)
ÖÖ? @
;
ÖÖ@ A
}
×× 
)
×× 
.
ØØ 
WithName
ØØ 
(
ØØ 
$str
ØØ 
)
ØØ 
.
ÙÙ "
RequireAuthorization
ÙÙ 
(
ÙÙ 
)
ÙÙ 
.
ÚÚ 
Produces
ÚÚ 
<
ÚÚ 

PaymentDto
ÚÚ 
>
ÚÚ 
(
ÚÚ 
StatusCodes
ÚÚ %
.
ÚÚ% &
Status200OK
ÚÚ& 1
)
ÚÚ1 2
.
ÛÛ 
Produces
ÛÛ 
<
ÛÛ 
object
ÛÛ 
>
ÛÛ 
(
ÛÛ 
StatusCodes
ÛÛ !
.
ÛÛ! "!
Status400BadRequest
ÛÛ" 5
)
ÛÛ5 6
;
ÛÛ6 7
paymentsGroupİİ 
.
İİ 
MapGet
İİ 
(
İİ 
$str
İİ 2
,
İİ2 3
async
İİ4 9
(
İİ: ;
Guid
İİ; ?
userId
İİ@ F
,
İİF G
int
İİH K
?
İİK L
page
İİM Q
,
İİQ R
int
İİS V
?
İİV W
pageSize
İİX `
,
İİ` a
string
İİb h
?
İİh i
status
İİj p
,
İİp q
string
İİr x
?
İİx y
methodİİz €
,İİ€ 
ISenderİİ‚ ‰
senderİİŠ 
,İİ ‘
ClaimsPrincipalİİ’ ¡
userİİ¢ ¦
)İİ¦ §
=>İİ¨ ª
{
ŞŞ 
var
ßß 
userIdClaim
ßß 
=
ßß 
user
ßß 
.
ßß 
	FindFirst
ßß (
(
ßß( )

ClaimTypes
ßß) 3
.
ßß3 4
NameIdentifier
ßß4 B
)
ßßB C
?
ßßC D
.
ßßD E
Value
ßßE J
??
ßßK M
user
ßßN R
.
ßßR S
	FindFirst
ßßS \
(
ßß\ ]
$str
ßß] b
)
ßßb c
?
ßßc d
.
ßßd e
Value
ßße j
;
ßßj k
var
àà 
userRole
àà 
=
àà 
user
àà 
.
àà 
	FindFirst
àà %
(
àà% &

ClaimTypes
àà& 0
.
àà0 1
Role
àà1 5
)
àà5 6
?
àà6 7
.
àà7 8
Value
àà8 =
;
àà= >
if
áá 

(
áá 
string
áá 
.
áá 
IsNullOrEmpty
áá  
(
áá  !
userIdClaim
áá! ,
)
áá, -
||
áá. 0
!
áá1 2
Guid
áá2 6
.
áá6 7
TryParse
áá7 ?
(
áá? @
userIdClaim
áá@ K
,
ááK L
out
ááM P
var
ááQ T
currentUserId
ááU b
)
ááb c
)
áác d
return
ââ 
Results
ââ 
.
ââ 
Unauthorized
ââ '
(
ââ' (
)
ââ( )
;
ââ) *
if
ãã 

(
ãã 
userId
ãã 
!=
ãã 
currentUserId
ãã #
&&
ãã$ &
userRole
ãã' /
!=
ãã0 2
$str
ãã3 :
&&
ãã; =
userRole
ãã> F
!=
ããG I
$str
ããJ Q
)
ããQ R
return
ää 
Results
ää 
.
ää 
Forbid
ää !
(
ää! "
)
ää" #
;
ää# $
if
ææ 

(
ææ 
page
ææ 
.
ææ 
HasValue
ææ 
&&
ææ 
pageSize
ææ %
.
ææ% &
HasValue
ææ& .
)
ææ. /
{
çç 	
var
èè 
result
èè 
=
èè 
await
èè 
sender
èè %
.
èè% &
Send
èè& *
(
èè* +
new
èè+ .
GetUserPayments
èè/ >
.
èè> ?
Query
èè? D
(
èèD E
userId
èèE K
,
èèK L
page
èèM Q
.
èèQ R
Value
èèR W
,
èèW X
pageSize
èèY a
.
èèa b
Value
èèb g
,
èèg h
status
èèi o
,
èèo p
method
èèq w
)
èèw x
)
èèx y
;
èèy z
return
éé 
result
éé 
.
éé 
	IsSuccess
éé #
?
éé$ %
Results
éé& -
.
éé- .
Ok
éé. 0
(
éé0 1
result
éé1 7
.
éé7 8
Value
éé8 =
)
éé= >
:
éé? @
Results
ééA H
.
ééH I

BadRequest
ééI S
(
ééS T
new
ééT W
{
ééX Y
errors
ééZ `
=
ééa b
result
ééc i
.
ééi j
Errors
ééj p
}
ééq r
)
éér s
;
éés t
}
êê 	
else
ëë 
{
ìì 	
var
íí 
payments
íí 
=
íí 
await
íí  
sender
íí! '
.
íí' (
Send
íí( ,
(
íí, -
new
íí- 0
GetUserPayments
íí1 @
.
íí@ A
Query
ííA F
(
ííF G
userId
ííG M
)
ííM N
)
ííN O
;
ííO P
return
îî 
Results
îî 
.
îî 
Ok
îî 
(
îî 
payments
îî &
)
îî& '
;
îî' (
}
ïï 	
}
ğğ 
)
ğğ 
.
ññ 
WithName
ññ 
(
ññ 
$str
ññ %
)
ññ% &
.
òò "
RequireAuthorization
òò 
(
òò 
)
òò 
.
óó 
Produces
óó 
(
óó 
StatusCodes
óó 
.
óó 
Status200OK
óó %
)
óó% &
.
ôô 
Produces
ôô 
(
ôô 
StatusCodes
ôô 
.
ôô #
Status401Unauthorized
ôô /
)
ôô/ 0
.
õõ 
Produces
õõ 
(
õõ 
StatusCodes
õõ 
.
õõ  
Status403Forbidden
õõ ,
)
õõ, -
;
õõ- .
paymentsGroup÷÷ 
.
÷÷ 
MapGet
÷÷ 
(
÷÷ 
$str
÷÷ ,
,
÷÷, -
async
÷÷. 3
(
÷÷4 5
Guid
÷÷5 9
orderId
÷÷: A
,
÷÷A B
ISender
÷÷C J
sender
÷÷K Q
,
÷÷Q R
ClaimsPrincipal
÷÷S b
user
÷÷c g
)
÷÷g h
=>
÷÷i k
{
øø 
var
ùù 
payments
ùù 
=
ùù 
await
ùù 
sender
ùù #
.
ùù# $
Send
ùù$ (
(
ùù( )
new
ùù) ,
GetOrderPayments
ùù- =
.
ùù= >
Query
ùù> C
(
ùùC D
orderId
ùùD K
)
ùùK L
)
ùùL M
;
ùùM N
return
úú 
Results
úú 
.
úú 
Ok
úú 
(
úú 
payments
úú "
)
úú" #
;
úú# $
}
ûû 
)
ûû 
.
üü 
WithName
üü 
(
üü 
$str
üü  
)
üü  !
.
ıı "
RequireAuthorization
ıı 
(
ıı 
)
ıı 
.
şş 
Produces
şş 
<
şş 
List
şş 
<
şş 

PaymentDto
şş 
>
şş 
>
şş 
(
şş  
StatusCodes
şş  +
.
şş+ ,
Status200OK
şş, 7
)
şş7 8
.
ÿÿ 
Produces
ÿÿ 
(
ÿÿ 
StatusCodes
ÿÿ 
.
ÿÿ #
Status401Unauthorized
ÿÿ /
)
ÿÿ/ 0
;
ÿÿ0 1
app‚‚ 
.
‚‚ 
MapPost
‚‚ 
(
‚‚ 
$str
‚‚ *
,
‚‚* +
async
‚‚, 1
(
‚‚2 3
HttpRequest
‚‚3 >
req
‚‚? B
,
‚‚B C
AppDbContext
‚‚D P
db
‚‚Q S
,
‚‚S T
IConfiguration
‚‚U c
config
‚‚d j
)
‚‚j k
=>
‚‚l n
{ƒƒ 
string
„„ 

json
„„ 
=
„„ 
await
„„ 
new
„„ 
StreamReader
„„ (
(
„„( )
req
„„) ,
.
„„, -
Body
„„- 1
)
„„1 2
.
„„2 3
ReadToEndAsync
„„3 A
(
„„A B
)
„„B C
;
„„C D
var
†† 
webhookSecret
†† 
=
†† 
Environment
†† #
.
††# $$
GetEnvironmentVariable
††$ :
(
††: ;
$str
††; R
)
††R S
??
‡‡ 

config
‡‡ 
[
‡‡ 
$str
‡‡ (
]
‡‡( )
;
‡‡) *
try
‰‰ 
{
ŠŠ 
var
‹‹ 
stripeEvent
‹‹ 
=
‹‹ 
Stripe
‹‹  
.
‹‹  !
EventUtility
‹‹! -
.
‹‹- .
ConstructEvent
‹‹. <
(
‹‹< =
json
ŒŒ 
,
ŒŒ 
req
 
.
 
Headers
 
[
 
$str
 *
]
* +
,
+ ,
webhookSecret
 
)
 	
;
	 

if
‘‘ 

(
‘‘ 
stripeEvent
‘‘ 
.
‘‘ 
Type
‘‘ 
==
‘‘ 
$str
‘‘  <
)
‘‘< =
{
’’ 	
var
““ 
session
““ 
=
““ 
stripeEvent
““ %
.
““% &
Data
““& *
.
““* +
Object
““+ 1
as
““2 4
Stripe
““5 ;
.
““; <
Checkout
““< D
.
““D E
Session
““E L
;
““L M
if
”” 
(
”” 
session
”” 
!=
”” 
null
”” 
&&
””  "
session
””# *
.
””* +
Metadata
””+ 3
.
””3 4
TryGetValue
””4 ?
(
””? @
$str
””@ I
,
””I J
out
””K N
var
””O R

orderIdStr
””S ]
)
””] ^
&&
””_ a
Guid
””b f
.
””f g
TryParse
””g o
(
””o p

orderIdStr
””p z
,
””z {
out
””| 
var””€ ƒ
orderId””„ ‹
)””‹ Œ
)””Œ 
{
•• 
var
–– 
payment
–– 
=
–– 
await
–– #
db
––$ &
.
––& '
Payments
––' /
.
––/ 0!
FirstOrDefaultAsync
––0 C
(
––C D
p
––D E
=>
––F H
p
––I J
.
––J K
StripeSessionId
––K Z
==
––[ ]
session
––^ e
.
––e f
Id
––f h
)
––h i
;
––i j
var
—— 
order
—— 
=
—— 
await
—— !
db
——" $
.
——$ %
Orders
——% +
.
——+ ,!
FirstOrDefaultAsync
——, ?
(
——? @
o
——@ A
=>
——B D
o
——E F
.
——F G
Id
——G I
==
——J L
orderId
——M T
)
——T U
;
——U V
if
™™ 
(
™™ 
payment
™™ 
!=
™™ 
null
™™ #
&&
™™$ &
order
™™' ,
!=
™™- /
null
™™0 4
)
™™4 5
{
šš 
payment
›› 
.
›› 
Status
›› "
=
››# $
PaymentStatus
››% 2
.
››2 3
	Completed
››3 <
;
››< =
payment
œœ 
.
œœ 
PaidAt
œœ "
=
œœ# $
DateTime
œœ% -
.
œœ- .
UtcNow
œœ. 4
;
œœ4 5
order
 
.
 
PaymentStatus
 '
=
( )
$str
* 0
;
0 1
await
 
db
 
.
 
SaveChangesAsync
 -
(
- .
)
. /
;
/ 0
Console
   
.
   
	WriteLine
   %
(
  % &
$"
  & (
$str
  ( F
{
  F G
orderId
  G N
}
  N O
"
  O P
)
  P Q
;
  Q R
}
¡¡ 
}
¢¢ 
}
££ 	
else
¤¤ 
if
¤¤ 
(
¤¤ 
stripeEvent
¤¤ 
.
¤¤ 
Type
¤¤ !
==
¤¤" $
$str
¤¤% ?
)
¤¤? @
{
¥¥ 	
var
¦¦ 
session
¦¦ 
=
¦¦ 
stripeEvent
¦¦ %
.
¦¦% &
Data
¦¦& *
.
¦¦* +
Object
¦¦+ 1
as
¦¦2 4
Stripe
¦¦5 ;
.
¦¦; <
Checkout
¦¦< D
.
¦¦D E
Session
¦¦E L
;
¦¦L M
if
§§ 
(
§§ 
session
§§ 
!=
§§ 
null
§§ 
)
§§  
{
¨¨ 
var
©© 
payment
©© 
=
©© 
await
©© #
db
©©$ &
.
©©& '
Payments
©©' /
.
©©/ 0!
FirstOrDefaultAsync
©©0 C
(
©©C D
p
©©D E
=>
©©F H
p
©©I J
.
©©J K
StripeSessionId
©©K Z
==
©©[ ]
session
©©^ e
.
©©e f
Id
©©f h
)
©©h i
;
©©i j
if
ªª 
(
ªª 
payment
ªª 
!=
ªª 
null
ªª #
)
ªª# $
{
«« 
payment
¬¬ 
.
¬¬ 
Status
¬¬ "
=
¬¬# $
PaymentStatus
¬¬% 2
.
¬¬2 3
Failed
¬¬3 9
;
¬¬9 :
payment
­­ 
.
­­ 
FailureReason
­­ )
=
­­* +
$str
­­, =
;
­­= >
payment
®® 
.
®® 
FailedAt
®® $
=
®®% &
DateTime
®®' /
.
®®/ 0
UtcNow
®®0 6
;
®®6 7
await
¯¯ 
db
¯¯ 
.
¯¯ 
SaveChangesAsync
¯¯ -
(
¯¯- .
)
¯¯. /
;
¯¯/ 0
Console
±± 
.
±± 
	WriteLine
±± %
(
±±% &
$"
±±& (
$str
±±( F
{
±±F G
session
±±G N
.
±±N O
Id
±±O Q
}
±±Q R
"
±±R S
)
±±S T
;
±±T U
}
²² 
}
³³ 
}
´´ 	
return
¶¶ 
Results
¶¶ 
.
¶¶ 
Ok
¶¶ 
(
¶¶ 
)
¶¶ 
;
¶¶ 
}
·· 
catch
¸¸ 	
(
¸¸
 
StripeException
¸¸ 
ex
¸¸ 
)
¸¸ 
{
¹¹ 
Console
ºº 
.
ºº 
	WriteLine
ºº 
(
ºº 
$"
ºº 
$str
ºº 4
{
ºº4 5
ex
ºº5 7
.
ºº7 8
Message
ºº8 ?
}
ºº? @
"
ºº@ A
)
ººA B
;
ººB C
return
»» 
Results
»» 
.
»» 

BadRequest
»» !
(
»»! "
new
»»" %
{
»»& '
error
»»( -
=
»». /
ex
»»0 2
.
»»2 3
Message
»»3 :
}
»»; <
)
»»< =
;
»»= >
}
¼¼ 
}½½ 
)
½½ 
.¾¾ 
AllowAnonymous
¾¾ 
(
¾¾ 
)
¾¾ 
;
¾¾ 
paymentsGroupÀÀ 
.
ÀÀ 
MapPatch
ÀÀ 
(
ÀÀ 
$str
ÀÀ 1
,
ÀÀ1 2
async
ÀÀ3 8
(
ÀÀ9 :
Guid
ÀÀ: >
	paymentId
ÀÀ? H
,
ÀÀH I
string
ÀÀJ P
?
ÀÀP Q
reason
ÀÀR X
,
ÀÀX Y
ClaimsPrincipal
ÀÀZ i
user
ÀÀj n
,
ÀÀn o
ISender
ÀÀp w
sender
ÀÀx ~
)
ÀÀ~ 
=>ÀÀ€ ‚
{
ÁÁ 
var
ÂÂ 
userRole
ÂÂ 
=
ÂÂ 
user
ÂÂ 
.
ÂÂ 
	FindFirst
ÂÂ %
(
ÂÂ% &

ClaimTypes
ÂÂ& 0
.
ÂÂ0 1
Role
ÂÂ1 5
)
ÂÂ5 6
?
ÂÂ6 7
.
ÂÂ7 8
Value
ÂÂ8 =
;
ÂÂ= >
if
ÃÃ 

(
ÃÃ 
userRole
ÃÃ 
!=
ÃÃ 
$str
ÃÃ 
&&
ÃÃ  "
userRole
ÃÃ# +
!=
ÃÃ, .
$str
ÃÃ/ 6
)
ÃÃ6 7
return
ÄÄ 
Results
ÄÄ 
.
ÄÄ 
Forbid
ÄÄ !
(
ÄÄ! "
)
ÄÄ" #
;
ÄÄ# $
var
ÆÆ 
result
ÆÆ 
=
ÆÆ 
await
ÆÆ 
sender
ÆÆ !
.
ÆÆ! "
Send
ÆÆ" &
(
ÆÆ& '
new
ÆÆ' *
RefundPayment
ÆÆ+ 8
.
ÆÆ8 9
Command
ÆÆ9 @
(
ÆÆ@ A
	paymentId
ÆÆA J
,
ÆÆJ K
reason
ÆÆL R
)
ÆÆR S
)
ÆÆS T
;
ÆÆT U
return
ÇÇ 
result
ÇÇ 
.
ÇÇ 
	IsSuccess
ÇÇ 
?
ÇÇ  !
Results
ÇÇ" )
.
ÇÇ) *
Ok
ÇÇ* ,
(
ÇÇ, -
result
ÇÇ- 3
.
ÇÇ3 4
Value
ÇÇ4 9
)
ÇÇ9 :
:
ÇÇ; <
Results
ÇÇ= D
.
ÇÇD E

BadRequest
ÇÇE O
(
ÇÇO P
new
ÇÇP S
{
ÇÇT U
errors
ÇÇV \
=
ÇÇ] ^
result
ÇÇ_ e
.
ÇÇe f
Errors
ÇÇf l
}
ÇÇm n
)
ÇÇn o
;
ÇÇo p
}
ÈÈ 
)
ÈÈ 
.
ÉÉ 
WithName
ÉÉ 
(
ÉÉ 
$str
ÉÉ 
)
ÉÉ 
.
ÊÊ "
RequireAuthorization
ÊÊ 
(
ÊÊ 
policy
ÊÊ  
=>
ÊÊ! #
policy
ÊÊ$ *
.
ÊÊ* +
RequireRole
ÊÊ+ 6
(
ÊÊ6 7
$str
ÊÊ7 >
,
ÊÊ> ?
$str
ÊÊ@ G
)
ÊÊG H
)
ÊÊH I
.
ËË 
Produces
ËË 
<
ËË 

PaymentDto
ËË 
>
ËË 
(
ËË 
StatusCodes
ËË %
.
ËË% &
Status200OK
ËË& 1
)
ËË1 2
.
ÌÌ 
Produces
ÌÌ 
<
ÌÌ 
object
ÌÌ 
>
ÌÌ 
(
ÌÌ 
StatusCodes
ÌÌ !
.
ÌÌ! "!
Status400BadRequest
ÌÌ" 5
)
ÌÌ5 6
.
ÍÍ 
Produces
ÍÍ 
(
ÍÍ 
StatusCodes
ÍÍ 
.
ÍÍ  
Status403Forbidden
ÍÍ ,
)
ÍÍ, -
;
ÍÍ- .
paymentsGroupÏÏ 
.
ÏÏ 
MapGet
ÏÏ 
(
ÏÏ 
$str
ÏÏ 
,
ÏÏ 
async
ÏÏ 
(
ÏÏ  !
int
ÏÏ! $
page
ÏÏ% )
,
ÏÏ) *
int
ÏÏ+ .
pageSize
ÏÏ/ 7
,
ÏÏ7 8
string
ÏÏ9 ?
?
ÏÏ? @
status
ÏÏA G
,
ÏÏG H
string
ÏÏI O
?
ÏÏO P
method
ÏÏQ W
,
ÏÏW X
ISender
ÏÏY `
sender
ÏÏa g
,
ÏÏg h
ClaimsPrincipal
ÏÏi x
user
ÏÏy }
)
ÏÏ} ~
=>ÏÏ 
{
ĞĞ 
var
ÑÑ 
userRole
ÑÑ 
=
ÑÑ 
user
ÑÑ 
.
ÑÑ 
	FindFirst
ÑÑ %
(
ÑÑ% &
System
ÑÑ& ,
.
ÑÑ, -
Security
ÑÑ- 5
.
ÑÑ5 6
Claims
ÑÑ6 <
.
ÑÑ< =

ClaimTypes
ÑÑ= G
.
ÑÑG H
Role
ÑÑH L
)
ÑÑL M
?
ÑÑM N
.
ÑÑN O
Value
ÑÑO T
;
ÑÑT U
if
ÒÒ 

(
ÒÒ 
userRole
ÒÒ 
!=
ÒÒ 
$str
ÒÒ 
&&
ÒÒ  "
userRole
ÒÒ# +
!=
ÒÒ, .
$str
ÒÒ/ 6
)
ÒÒ6 7
return
ÓÓ 
Results
ÓÓ 
.
ÓÓ 
Forbid
ÓÓ !
(
ÓÓ! "
)
ÓÓ" #
;
ÓÓ# $
var
ÕÕ 
result
ÕÕ 
=
ÕÕ 
await
ÕÕ 
sender
ÕÕ !
.
ÕÕ! "
Send
ÕÕ" &
(
ÕÕ& '
new
ÕÕ' *
GetAllPayments
ÕÕ+ 9
.
ÕÕ9 :
Query
ÕÕ: ?
(
ÕÕ? @
page
ÕÕ@ D
,
ÕÕD E
pageSize
ÕÕF N
,
ÕÕN O
status
ÕÕP V
,
ÕÕV W
method
ÕÕX ^
)
ÕÕ^ _
)
ÕÕ_ `
;
ÕÕ` a
return
ÖÖ 
result
ÖÖ 
.
ÖÖ 
	IsSuccess
ÖÖ 
?
×× 
Results
×× 
.
×× 
Ok
×× 
(
×× 
result
×× 
.
××  
Value
××  %
)
××% &
:
ØØ 
Results
ØØ 
.
ØØ 

BadRequest
ØØ  
(
ØØ  !
new
ØØ! $
{
ØØ% &
errors
ØØ' -
=
ØØ. /
result
ØØ0 6
.
ØØ6 7
Errors
ØØ7 =
}
ØØ> ?
)
ØØ? @
;
ØØ@ A
}
ÙÙ 
)
ÙÙ 
.
ÚÚ 
WithName
ÚÚ 
(
ÚÚ 
$str
ÚÚ 
)
ÚÚ 
.
ÛÛ "
RequireAuthorization
ÛÛ 
(
ÛÛ 
policy
ÛÛ  
=>
ÛÛ! #
policy
ÛÛ$ *
.
ÛÛ* +
RequireRole
ÛÛ+ 6
(
ÛÛ6 7
$str
ÛÛ7 >
,
ÛÛ> ?
$str
ÛÛ@ G
)
ÛÛG H
)
ÛÛH I
.
ÜÜ 
Produces
ÜÜ 
<
ÜÜ 
PagedResult
ÜÜ 
<
ÜÜ 

PaymentDto
ÜÜ $
>
ÜÜ$ %
>
ÜÜ% &
(
ÜÜ& '
StatusCodes
ÜÜ' 2
.
ÜÜ2 3
Status200OK
ÜÜ3 >
)
ÜÜ> ?
.
İİ 
Produces
İİ 
(
İİ 
StatusCodes
İİ 
.
İİ  
Status403Forbidden
İİ ,
)
İİ, -
;
İİ- .
varàà 
loyaltyGroup
àà 
=
àà 
app
àà 
.
àà 
MapGroup
àà 
(
àà  
$str
àà  -
)
àà- .
.
àà. /
WithTags
àà/ 7
(
àà7 8
$str
àà8 A
)
ààA B
;
ààB C
loyaltyGroupââ 
.
ââ 
MapGet
ââ 
(
ââ 
$str
ââ 
,
ââ 
async
ââ $
(
ââ% &
ClaimsPrincipal
ââ& 5
user
ââ6 :
,
ââ: ;
ISender
ââ< C
sender
ââD J
)
ââJ K
=>
ââL N
{ãã 
var
ää 
userIdClaim
ää 
=
ää 
user
ää 
.
ää 
	FindFirst
ää $
(
ää$ %

ClaimTypes
ää% /
.
ää/ 0
NameIdentifier
ää0 >
)
ää> ?
?
ää? @
.
ää@ A
Value
ääA F
??
ääG I
user
ääJ N
.
ääN O
	FindFirst
ääO X
(
ääX Y
$str
ääY ^
)
ää^ _
?
ää_ `
.
ää` a
Value
ääa f
;
ääf g
if
åå 
(
åå 
string
åå 
.
åå 
IsNullOrEmpty
åå 
(
åå 
userIdClaim
åå (
)
åå( )
||
åå* ,
!
åå- .
Guid
åå. 2
.
åå2 3
TryParse
åå3 ;
(
åå; <
userIdClaim
åå< G
,
ååG H
out
ååI L
var
ååM P
userId
ååQ W
)
ååW X
)
ååX Y
return
ææ 
Results
ææ 
.
ææ 
Unauthorized
ææ #
(
ææ# $
)
ææ$ %
;
ææ% &
var
èè 
result
èè 
=
èè 
await
èè 
sender
èè 
.
èè 
Send
èè "
(
èè" #
new
èè# &
GetLoyaltyPoints
èè' 7
.
èè7 8
Query
èè8 =
(
èè= >
userId
èè> D
)
èèD E
)
èèE F
;
èèF G
return
éé 

result
éé 
.
éé 
	IsSuccess
éé 
?
éé 
Results
éé %
.
éé% &
Ok
éé& (
(
éé( )
result
éé) /
.
éé/ 0
Value
éé0 5
)
éé5 6
:
éé7 8
Results
éé9 @
.
éé@ A

BadRequest
ééA K
(
ééK L
new
ééL O
{
ééP Q
errors
ééR X
=
ééY Z
result
éé[ a
.
ééa b
Errors
ééb h
}
ééi j
)
ééj k
;
éék l
}êê 
)
êê 
.ëë 
WithName
ëë 	
(
ëë	 

$str
ëë
 
)
ëë 
.ìì "
RequireAuthorization
ìì 
(
ìì 
)
ìì 
.íí 
Produces
íí 	
<
íí	 

LoyaltyPointsDto
íí
 
>
íí 
(
íí 
StatusCodes
íí '
.
íí' (
Status200OK
íí( 3
)
íí3 4
.îî 
Produces
îî 	
(
îî	 

StatusCodes
îî
 
.
îî #
Status401Unauthorized
îî +
)
îî+ ,
.ïï 
Produces
ïï 	
<
ïï	 

object
ïï
 
>
ïï 
(
ïï 
StatusCodes
ïï 
.
ïï !
Status400BadRequest
ïï 1
)
ïï1 2
;
ïï2 3
loyaltyGroupññ 
.
ññ 
MapGet
ññ 
(
ññ 
$str
ññ #
,
ññ# $
async
ññ% *
(
ññ+ ,
ClaimsPrincipal
ññ, ;
user
ññ< @
,
ññ@ A
int
ññB E
page
ññF J
,
ññJ K
int
ññL O
pageSize
ññP X
,
ññX Y
ISender
ññZ a
sender
ññb h
)
ññh i
=>
ññj l
{òò 
var
óó 
userIdClaim
óó 
=
óó 
user
óó 
.
óó 
	FindFirst
óó $
(
óó$ %

ClaimTypes
óó% /
.
óó/ 0
NameIdentifier
óó0 >
)
óó> ?
?
óó? @
.
óó@ A
Value
óóA F
??
óóG I
user
óóJ N
.
óóN O
	FindFirst
óóO X
(
óóX Y
$str
óóY ^
)
óó^ _
?
óó_ `
.
óó` a
Value
óóa f
;
óóf g
if
ôô 
(
ôô 
string
ôô 
.
ôô 
IsNullOrEmpty
ôô 
(
ôô 
userIdClaim
ôô (
)
ôô( )
||
ôô* ,
!
ôô- .
Guid
ôô. 2
.
ôô2 3
TryParse
ôô3 ;
(
ôô; <
userIdClaim
ôô< G
,
ôôG H
out
ôôI L
var
ôôM P
userId
ôôQ W
)
ôôW X
)
ôôX Y
return
õõ 
Results
õõ 
.
õõ 
Unauthorized
õõ #
(
õõ# $
)
õõ$ %
;
õõ% &
var
÷÷ 
result
÷÷ 
=
÷÷ 
await
÷÷ 
sender
÷÷ 
.
÷÷ 
Send
÷÷ "
(
÷÷" #
new
÷÷# &$
GetLoyaltyTransactions
÷÷' =
.
÷÷= >
Query
÷÷> C
(
÷÷C D
userId
÷÷D J
,
÷÷J K
page
÷÷L P
,
÷÷P Q
pageSize
÷÷R Z
)
÷÷Z [
)
÷÷[ \
;
÷÷\ ]
return
øø 

result
øø 
.
øø 
	IsSuccess
øø 
?
øø 
Results
øø %
.
øø% &
Ok
øø& (
(
øø( )
result
øø) /
.
øø/ 0
Value
øø0 5
)
øø5 6
:
øø7 8
Results
øø9 @
.
øø@ A

BadRequest
øøA K
(
øøK L
new
øøL O
{
øøP Q
errors
øøR X
=
øøY Z
result
øø[ a
.
øøa b
Errors
øøb h
}
øøi j
)
øøj k
;
øøk l
}ùù 
)
ùù 
.úú 
WithName
úú 	
(
úú	 

$str
úú
 "
)
úú" #
.ûû "
RequireAuthorization
ûû 
(
ûû 
)
ûû 
.üü 
Produces
üü 	
<
üü	 

List
üü
 
<
üü #
LoyaltyTransactionDto
üü $
>
üü$ %
>
üü% &
(
üü& '
StatusCodes
üü' 2
.
üü2 3
Status200OK
üü3 >
)
üü> ?
.ıı 
Produces
ıı 	
(
ıı	 

StatusCodes
ıı
 
.
ıı #
Status401Unauthorized
ıı +
)
ıı+ ,
.şş 
Produces
şş 	
<
şş	 

object
şş
 
>
şş 
(
şş 
StatusCodes
şş 
.
şş !
Status400BadRequest
şş 1
)
şş1 2
;
şş2 3
loyaltyGroup€€ 
.
€€ 
MapPost
€€ 
(
€€ 
$str
€€ 
,
€€ 
async
€€  %
(
€€& '!
RedeemLoyaltyPoints
€€' :
.
€€: ;
Command
€€; B
command
€€C J
,
€€J K
ClaimsPrincipal
€€L [
user
€€\ `
,
€€` a
ISender
€€b i
sender
€€j p
)
€€p q
=>
€€r t
{ 
var
‚‚ 
userIdClaim
‚‚ 
=
‚‚ 
user
‚‚ 
.
‚‚ 
	FindFirst
‚‚ $
(
‚‚$ %

ClaimTypes
‚‚% /
.
‚‚/ 0
NameIdentifier
‚‚0 >
)
‚‚> ?
?
‚‚? @
.
‚‚@ A
Value
‚‚A F
??
‚‚G I
user
‚‚J N
.
‚‚N O
	FindFirst
‚‚O X
(
‚‚X Y
$str
‚‚Y ^
)
‚‚^ _
?
‚‚_ `
.
‚‚` a
Value
‚‚a f
;
‚‚f g
if
ƒƒ 
(
ƒƒ 
string
ƒƒ 
.
ƒƒ 
IsNullOrEmpty
ƒƒ 
(
ƒƒ 
userIdClaim
ƒƒ (
)
ƒƒ( )
||
ƒƒ* ,
!
ƒƒ- .
Guid
ƒƒ. 2
.
ƒƒ2 3
TryParse
ƒƒ3 ;
(
ƒƒ; <
userIdClaim
ƒƒ< G
,
ƒƒG H
out
ƒƒI L
var
ƒƒM P!
authenticatedUserId
ƒƒQ d
)
ƒƒd e
)
ƒƒe f
return
„„ 
Results
„„ 
.
„„ 
Unauthorized
„„ #
(
„„# $
)
„„$ %
;
„„% &
if
†† 
(
†† 
command
†† 
.
†† 
UserId
†† 
!=
†† !
authenticatedUserId
†† -
)
††- .
return
‡‡ 
Results
‡‡ 
.
‡‡ 
Forbid
‡‡ 
(
‡‡ 
)
‡‡ 
;
‡‡  
var
‰‰ 
result
‰‰ 
=
‰‰ 
await
‰‰ 
sender
‰‰ 
.
‰‰ 
Send
‰‰ "
(
‰‰" #
command
‰‰# *
)
‰‰* +
;
‰‰+ ,
return
ŠŠ 

result
ŠŠ 
.
ŠŠ 
	IsSuccess
ŠŠ 
?
ŠŠ 
Results
ŠŠ %
.
ŠŠ% &
Ok
ŠŠ& (
(
ŠŠ( )
result
ŠŠ) /
.
ŠŠ/ 0
Value
ŠŠ0 5
)
ŠŠ5 6
:
ŠŠ7 8
Results
ŠŠ9 @
.
ŠŠ@ A

BadRequest
ŠŠA K
(
ŠŠK L
new
ŠŠL O
{
ŠŠP Q
errors
ŠŠR X
=
ŠŠY Z
result
ŠŠ[ a
.
ŠŠa b
Errors
ŠŠb h
}
ŠŠi j
)
ŠŠj k
;
ŠŠk l
}‹‹ 
)
‹‹ 
.ŒŒ 
WithName
ŒŒ 	
(
ŒŒ	 

$str
ŒŒ
 
)
ŒŒ  
. "
RequireAuthorization
 
(
 
)
 
. 
Produces
 	
<
	 
#
RedeemPointsResultDto

 
>
  
(
  !
StatusCodes
! ,
.
, -
Status200OK
- 8
)
8 9
. 
Produces
 	
(
	 

StatusCodes

 
.
 #
Status401Unauthorized
 +
)
+ ,
. 
Produces
 	
(
	 

StatusCodes

 
.
  
Status403Forbidden
 (
)
( )
.‘‘ 
Produces
‘‘ 	
<
‘‘	 

object
‘‘
 
>
‘‘ 
(
‘‘ 
StatusCodes
‘‘ 
.
‘‘ !
Status400BadRequest
‘‘ 1
)
‘‘1 2
;
‘‘2 3
loyaltyGroup““ 
.
““ 
MapPost
““ 
(
““ 
$str
““ 
,
““ 
async
““ $
(
““% & 
AwardLoyaltyPoints
““& 8
.
““8 9
Command
““9 @
command
““A H
,
““H I
ClaimsPrincipal
““J Y
user
““Z ^
,
““^ _
ISender
““` g
sender
““h n
)
““n o
=>
““p r
{”” 
var
•• 
userRole
•• 
=
•• 
user
•• 
.
•• 
	FindFirst
•• !
(
••! "

ClaimTypes
••" ,
.
••, -
Role
••- 1
)
••1 2
?
••2 3
.
••3 4
Value
••4 9
;
••9 :
if
–– 
(
–– 
userRole
–– 
!=
–– 
$str
–– 
&&
–– 
userRole
–– '
!=
––( *
$str
––+ 2
)
––2 3
return
—— 
Results
—— 
.
—— 
Forbid
—— 
(
—— 
)
—— 
;
——  
var
™™ 
result
™™ 
=
™™ 
await
™™ 
sender
™™ 
.
™™ 
Send
™™ "
(
™™" #
command
™™# *
)
™™* +
;
™™+ ,
return
šš 

result
šš 
.
šš 
	IsSuccess
šš 
?
šš 
Results
šš %
.
šš% &
Ok
šš& (
(
šš( )
new
šš) ,
{
šš- .
message
šš/ 6
=
šš7 8
$str
šš9 V
}
ššW X
)
ššX Y
:
ššZ [
Results
šš\ c
.
ššc d

BadRequest
ššd n
(
ššn o
new
ššo r
{
ššs t
errors
ššu {
=
šš| }
resultšš~ „
.šš„ …
Errorsšš… ‹
}ššŒ 
)šš 
;šš 
}›› 
)
›› 
.œœ 
WithName
œœ 	
(
œœ	 

$str
œœ
 
)
œœ 
. "
RequireAuthorization
 
(
 
policy
 
=>
 
policy
  &
.
& '
RequireRole
' 2
(
2 3
$str
3 :
,
: ;
$str
< C
)
C D
)
D E
. 
Produces
 	
<
	 

object

 
>
 
(
 
StatusCodes
 
.
 
Status200OK
 )
)
) *
.ŸŸ 
Produces
ŸŸ 	
(
ŸŸ	 

StatusCodes
ŸŸ
 
.
ŸŸ  
Status403Forbidden
ŸŸ (
)
ŸŸ( )
.   
Produces
   	
<
  	 

object
  
 
>
   
(
   
StatusCodes
   
.
   !
Status400BadRequest
   1
)
  1 2
;
  2 3
app¢¢ 
.
¢¢ 
Run
¢¢ 
(
¢¢ 
)
¢¢ 	
;
¢¢	 
æï
YC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Persistence\DatabaseSeeder.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Persistence (
;( )
public 
static 
class 
DatabaseSeeder "
{ 
public 

static 
async 
Task 
	SeedAsync &
(& '
AppDbContext' 3
context4 ;
); <
{		 
if 

( 
await 
context 
. 
Orders  
.  !
AnyAsync! )
() *
)* +
)+ ,
{ 	
return 
; 
} 	
if 

( 
! 
await 
context 
. 
Users  
.  !
AnyAsync! )
() *
)* +
)+ ,
{ 	
var 
users 
= 
new 
List  
<  !
User! %
>% &
{ 
new 
( 
) 
{ 
Id 
= 
Guid 
. 
Parse #
(# $
$str$ J
)J K
,K L
Email 
= 
$str 0
,0 1
PasswordHash  
=! "
BCrypt# )
.) *
Net* -
.- .
BCrypt. 4
.4 5
HashPassword5 A
(A B
$strB O
)O P
,P Q
FullName 
= 
$str -
,- .
Role 
= 
$str $
,$ %
PhoneNumber 
=  !
$str" 0
,0 1
LoyaltyPoints !
=" #
$num$ '
,' (
IsActive 
= 
true #
,# $
	CreatedAt 
= 
DateTime  (
.( )
UtcNow) /
}   
,   
new!! 
(!! 
)!! 
{"" 
Id## 
=## 
Guid## 
.## 
Parse## #
(### $
$str##$ J
)##J K
,##K L
Email$$ 
=$$ 
$str$$ 0
,$$0 1
PasswordHash%%  
=%%! "
BCrypt%%# )
.%%) *
Net%%* -
.%%- .
BCrypt%%. 4
.%%4 5
HashPassword%%5 A
(%%A B
$str%%B O
)%%O P
,%%P Q
FullName&& 
=&& 
$str&& .
,&&. /
Role'' 
='' 
$str'' $
,''$ %
PhoneNumber(( 
=((  !
$str((" 0
,((0 1
LoyaltyPoints)) !
=))" #
$num))$ '
,))' (
IsActive** 
=** 
true** #
,**# $
	CreatedAt++ 
=++ 
DateTime++  (
.++( )
UtcNow++) /
},, 
,,, 
new-- 
(-- 
)-- 
{.. 
Id// 
=// 
Guid// 
.// 
Parse// #
(//# $
$str//$ J
)//J K
,//K L
Email00 
=00 
$str00 .
,00. /
PasswordHash11  
=11! "
BCrypt11# )
.11) *
Net11* -
.11- .
BCrypt11. 4
.114 5
HashPassword115 A
(11A B
$str11B M
)11M N
,11N O
FullName22 
=22 
$str22 .
,22. /
Role33 
=33 
$str33 "
,33" #
PhoneNumber44 
=44  !
$str44" 0
,440 1
LoyaltyPoints55 !
=55" #
$num55$ %
,55% &
IsActive66 
=66 
true66 #
,66# $
	CreatedAt77 
=77 
DateTime77  (
.77( )
UtcNow77) /
}88 
,88 
new99 
(99 
)99 
{:: 
Id;; 
=;; 
Guid;; 
.;; 
Parse;; #
(;;# $
$str;;$ J
);;J K
,;;K L
Email<< 
=<< 
$str<< -
,<<- .
PasswordHash==  
===! "
BCrypt==# )
.==) *
Net==* -
.==- .
BCrypt==. 4
.==4 5
HashPassword==5 A
(==A B
$str==B M
)==M N
,==N O
FullName>> 
=>> 
$str>> +
,>>+ ,
Role?? 
=?? 
$str?? "
,??" #
PhoneNumber@@ 
=@@  !
$str@@" 0
,@@0 1
LoyaltyPointsAA !
=AA" #
$numAA$ %
,AA% &
IsActiveBB 
=BB 
trueBB #
,BB# $
	CreatedAtCC 
=CC 
DateTimeCC  (
.CC( )
UtcNowCC) /
}DD 
}EE 
;EE 
awaitGG 
contextGG 
.GG 
UsersGG 
.GG  
AddRangeAsyncGG  -
(GG- .
usersGG. 3
)GG3 4
;GG4 5
awaitHH 
contextHH 
.HH 
SaveChangesAsyncHH *
(HH* +
)HH+ ,
;HH, -
}II 	
ifLL 

(LL 
!LL 
awaitLL 
contextLL 
.LL 
ProductsLL #
.LL# $
AnyAsyncLL$ ,
(LL, -
)LL- .
)LL. /
{MM 	
varNN 
productsNN 
=NN 
newNN 
ListNN #
<NN# $
ProductNN$ +
>NN+ ,
{OO 
newQQ 
(QQ 
)QQ 
{RR 
IdSS 
=SS 
GuidSS 
.SS 
ParseSS #
(SS# $
$strSS$ J
)SSJ K
,SSK L
NameTT 
=TT 
$strTT +
,TT+ ,
DescriptionUU 
=UU  !
$strUU" l
,UUl m
PriceVV 
=VV 
$numVV "
,VV" #
CategoryWW 
=WW 
$strWW %
,WW% &
ImageUrlXX 
=XX 
$strXX ]
,XX] ^
	AllergensYY 
=YY 
newYY  #
ListYY$ (
<YY( )
stringYY) /
>YY/ 0
{YY1 2
$strYY3 ;
,YY; <
$strYY= F
}YYG H
,YYH I
DietaryRestrictionsZZ '
=ZZ( )
nullZZ* .
,ZZ. /
IsAvailable[[ 
=[[  !
true[[" &
,[[& '
	CreatedAt\\ 
=\\ 
DateTime\\  (
.\\( )
UtcNow\\) /
}]] 
,]] 
new^^ 
(^^ 
)^^ 
{__ 
Id`` 
=`` 
Guid`` 
.`` 
Parse`` #
(``# $
$str``$ J
)``J K
,``K L
Nameaa 
=aa 
$straa -
,aa- .
Descriptionbb 
=bb  !
$strbb" a
,bba b
Pricecc 
=cc 
$numcc "
,cc" #
Categorydd 
=dd 
$strdd %
,dd% &
ImageUrlee 
=ee 
$stree ]
,ee] ^
	Allergensff 
=ff 
newff  #
Listff$ (
<ff( )
stringff) /
>ff/ 0
{ff1 2
$strff3 ;
,ff; <
$strff= F
}ffG H
,ffH I
DietaryRestrictionsgg '
=gg( )
$strgg* 6
,gg6 7
IsAvailablehh 
=hh  !
truehh" &
,hh& '
	CreatedAtii 
=ii 
DateTimeii  (
.ii( )
UtcNowii) /
}jj 
,jj 
newkk 
(kk 
)kk 
{ll 
Idmm 
=mm 
Guidmm 
.mm 
Parsemm #
(mm# $
$strmm$ J
)mmJ K
,mmK L
Namenn 
=nn 
$strnn *
,nn* +
Descriptionoo 
=oo  !
$stroo" q
,ooq r
Pricepp 
=pp 
$numpp "
,pp" #
Categoryqq 
=qq 
$strqq %
,qq% &
ImageUrlrr 
=rr 
$strrr Z
,rrZ [
	Allergensss 
=ss 
newss  #
Listss$ (
<ss( )
stringss) /
>ss/ 0
{ss1 2
$strss3 ;
,ss; <
$strss= C
,ssC D
$strssE K
}ssL M
,ssM N
DietaryRestrictionstt '
=tt( )
nulltt* .
,tt. /
IsAvailableuu 
=uu  !
trueuu" &
,uu& '
	CreatedAtvv 
=vv 
DateTimevv  (
.vv( )
UtcNowvv) /
}ww 
,ww 
newxx 
(xx 
)xx 
{yy 
Idzz 
=zz 
Guidzz 
.zz 
Parsezz #
(zz# $
$strzz$ J
)zzJ K
,zzK L
Name{{ 
={{ 
$str{{ ,
,{{, -
Description|| 
=||  !
$str||" O
,||O P
Price}} 
=}} 
$num}} "
,}}" #
Category~~ 
=~~ 
$str~~ %
,~~% &
ImageUrl 
= 
$str ]
,] ^
	Allergens
€€ 
=
€€ 
new
€€  #
List
€€$ (
<
€€( )
string
€€) /
>
€€/ 0
{
€€1 2
$str
€€3 ;
,
€€; <
$str
€€= C
,
€€C D
$str
€€E N
}
€€O P
,
€€P Q!
DietaryRestrictions
 '
=
( )
null
* .
,
. /
IsAvailable
‚‚ 
=
‚‚  !
true
‚‚" &
,
‚‚& '
	CreatedAt
ƒƒ 
=
ƒƒ 
DateTime
ƒƒ  (
.
ƒƒ( )
UtcNow
ƒƒ) /
}
„„ 
,
„„ 
new
…… 
(
…… 
)
…… 
{
†† 
Id
‡‡ 
=
‡‡ 
Guid
‡‡ 
.
‡‡ 
Parse
‡‡ #
(
‡‡# $
$str
‡‡$ J
)
‡‡J K
,
‡‡K L
Name
ˆˆ 
=
ˆˆ 
$str
ˆˆ '
,
ˆˆ' (
Description
‰‰ 
=
‰‰  !
$str
‰‰" l
,
‰‰l m
Price
ŠŠ 
=
ŠŠ 
$num
ŠŠ "
,
ŠŠ" #
Category
‹‹ 
=
‹‹ 
$str
‹‹ %
,
‹‹% &
ImageUrl
ŒŒ 
=
ŒŒ 
$str
ŒŒ ]
,
ŒŒ] ^
	Allergens
 
=
 
new
  #
List
$ (
<
( )
string
) /
>
/ 0
{
1 2
$str
3 ;
,
; <
$str
= E
}
F G
,
G H!
DietaryRestrictions
 '
=
( )
$str
* 1
,
1 2
IsAvailable
 
=
  !
true
" &
,
& '
	CreatedAt
 
=
 
DateTime
  (
.
( )
UtcNow
) /
}
‘‘ 
,
‘‘ 
new
”” 
(
”” 
)
”” 
{
•• 
Id
–– 
=
–– 
Guid
–– 
.
–– 
Parse
–– #
(
––# $
$str
––$ J
)
––J K
,
––K L
Name
—— 
=
—— 
$str
—— '
,
——' (
Description
˜˜ 
=
˜˜  !
$str
˜˜" N
,
˜˜N O
Price
™™ 
=
™™ 
$num
™™ "
,
™™" #
Category
šš 
=
šš 
$str
šš &
,
šš& '
ImageUrl
›› 
=
›› 
$str
›› ]
,
››] ^
	Allergens
œœ 
=
œœ 
new
œœ  #
List
œœ$ (
<
œœ( )
string
œœ) /
>
œœ/ 0
{
œœ1 2
$str
œœ3 <
}
œœ= >
,
œœ> ?!
DietaryRestrictions
 '
=
( )
$str
* 6
,
6 7
IsAvailable
 
=
  !
true
" &
,
& '
	CreatedAt
ŸŸ 
=
ŸŸ 
DateTime
ŸŸ  (
.
ŸŸ( )
UtcNow
ŸŸ) /
}
   
,
   
new
¡¡ 
(
¡¡ 
)
¡¡ 
{
¢¢ 
Id
££ 
=
££ 
Guid
££ 
.
££ 
Parse
££ #
(
££# $
$str
££$ J
)
££J K
,
££K L
Name
¤¤ 
=
¤¤ 
$str
¤¤ .
,
¤¤. /
Description
¥¥ 
=
¥¥  !
$str
¥¥" P
,
¥¥P Q
Price
¦¦ 
=
¦¦ 
$num
¦¦ "
,
¦¦" #
Category
§§ 
=
§§ 
$str
§§ &
,
§§& '
ImageUrl
¨¨ 
=
¨¨ 
$str
¨¨ ]
,
¨¨] ^
	Allergens
©© 
=
©© 
new
©©  #
List
©©$ (
<
©©( )
string
©©) /
>
©©/ 0
(
©©0 1
)
©©1 2
,
©©2 3!
DietaryRestrictions
ªª '
=
ªª( )
$str
ªª* 1
,
ªª1 2
IsAvailable
«« 
=
««  !
true
««" &
,
««& '
	CreatedAt
¬¬ 
=
¬¬ 
DateTime
¬¬  (
.
¬¬( )
UtcNow
¬¬) /
}
­­ 
,
­­ 
new
®® 
(
®® 
)
®® 
{
¯¯ 
Id
°° 
=
°° 
Guid
°° 
.
°° 
Parse
°° #
(
°°# $
$str
°°$ J
)
°°J K
,
°°K L
Name
±± 
=
±± 
$str
±± 9
,
±±9 :
Description
²² 
=
²²  !
$str
²²" N
,
²²N O
Price
³³ 
=
³³ 
$num
³³ "
,
³³" #
Category
´´ 
=
´´ 
$str
´´ &
,
´´& '
ImageUrl
µµ 
=
µµ 
$str
µµ ]
,
µµ] ^
	Allergens
¶¶ 
=
¶¶ 
new
¶¶  #
List
¶¶$ (
<
¶¶( )
string
¶¶) /
>
¶¶/ 0
(
¶¶0 1
)
¶¶1 2
,
¶¶2 3!
DietaryRestrictions
·· '
=
··( )
$str
··* 1
,
··1 2
IsAvailable
¸¸ 
=
¸¸  !
true
¸¸" &
,
¸¸& '
	CreatedAt
¹¹ 
=
¹¹ 
DateTime
¹¹  (
.
¹¹( )
UtcNow
¹¹) /
}
ºº 
,
ºº 
new
½½ 
(
½½ 
)
½½ 
{
¾¾ 
Id
¿¿ 
=
¿¿ 
Guid
¿¿ 
.
¿¿ 
Parse
¿¿ #
(
¿¿# $
$str
¿¿$ J
)
¿¿J K
,
¿¿K L
Name
ÀÀ 
=
ÀÀ 
$str
ÀÀ ;
,
ÀÀ; <
Description
ÁÁ 
=
ÁÁ  !
$str
ÁÁ" T
,
ÁÁT U
Price
ÂÂ 
=
ÂÂ 
$num
ÂÂ "
,
ÂÂ" #
Category
ÃÃ 
=
ÃÃ 
$str
ÃÃ (
,
ÃÃ( )
ImageUrl
ÄÄ 
=
ÄÄ 
$str
ÄÄ ]
,
ÄÄ] ^
	Allergens
ÅÅ 
=
ÅÅ 
new
ÅÅ  #
List
ÅÅ$ (
<
ÅÅ( )
string
ÅÅ) /
>
ÅÅ/ 0
{
ÅÅ1 2
$str
ÅÅ3 ;
,
ÅÅ; <
$str
ÅÅ= C
,
ÅÅC D
$str
ÅÅE N
}
ÅÅO P
,
ÅÅP Q!
DietaryRestrictions
ÆÆ '
=
ÆÆ( )
$str
ÆÆ* 6
,
ÆÆ6 7
IsAvailable
ÇÇ 
=
ÇÇ  !
true
ÇÇ" &
,
ÇÇ& '
	CreatedAt
ÈÈ 
=
ÈÈ 
DateTime
ÈÈ  (
.
ÈÈ( )
UtcNow
ÈÈ) /
}
ÉÉ 
,
ÉÉ 
new
ÊÊ 
(
ÊÊ 
)
ÊÊ 
{
ËË 
Id
ÌÌ 
=
ÌÌ 
Guid
ÌÌ 
.
ÌÌ 
Parse
ÌÌ #
(
ÌÌ# $
$str
ÌÌ$ J
)
ÌÌJ K
,
ÌÌK L
Name
ÍÍ 
=
ÍÍ 
$str
ÍÍ 3
,
ÍÍ3 4
Description
ÎÎ 
=
ÎÎ  !
$str
ÎÎ" R
,
ÎÎR S
Price
ÏÏ 
=
ÏÏ 
$num
ÏÏ !
,
ÏÏ! "
Category
ĞĞ 
=
ĞĞ 
$str
ĞĞ &
,
ĞĞ& '
ImageUrl
ÑÑ 
=
ÑÑ 
$str
ÑÑ Z
,
ÑÑZ [
	Allergens
ÒÒ 
=
ÒÒ 
new
ÒÒ  #
List
ÒÒ$ (
<
ÒÒ( )
string
ÒÒ) /
>
ÒÒ/ 0
{
ÒÒ1 2
$str
ÒÒ3 ;
,
ÒÒ; <
$str
ÒÒ= C
,
ÒÒC D
$str
ÒÒE N
}
ÒÒO P
,
ÒÒP Q!
DietaryRestrictions
ÓÓ '
=
ÓÓ( )
$str
ÓÓ* 6
,
ÓÓ6 7
IsAvailable
ÔÔ 
=
ÔÔ  !
true
ÔÔ" &
,
ÔÔ& '
	CreatedAt
ÕÕ 
=
ÕÕ 
DateTime
ÕÕ  (
.
ÕÕ( )
UtcNow
ÕÕ) /
}
ÖÖ 
}
×× 
;
×× 
await
ÙÙ 
context
ÙÙ 
.
ÙÙ 
Products
ÙÙ "
.
ÙÙ" #
AddRangeAsync
ÙÙ# 0
(
ÙÙ0 1
products
ÙÙ1 9
)
ÙÙ9 :
;
ÙÙ: ;
await
ÚÚ 
context
ÚÚ 
.
ÚÚ 
SaveChangesAsync
ÚÚ *
(
ÚÚ* +
)
ÚÚ+ ,
;
ÚÚ, -
}
ÛÛ 	
var
ŞŞ 
existingUsers
ŞŞ 
=
ŞŞ 
await
ŞŞ !
context
ŞŞ" )
.
ŞŞ) *
Users
ŞŞ* /
.
ŞŞ/ 0
ToListAsync
ŞŞ0 ;
(
ŞŞ; <
)
ŞŞ< =
;
ŞŞ= >
var
ßß 
existingProducts
ßß 
=
ßß 
await
ßß $
context
ßß% ,
.
ßß, -
Products
ßß- 5
.
ßß5 6
ToListAsync
ßß6 A
(
ßßA B
)
ßßB C
;
ßßC D
var
ââ 
baseDate
ââ 
=
ââ 
DateTime
ââ 
.
ââ  
UtcNow
ââ  &
;
ââ& '
var
ãã 
orders
ãã 
=
ãã 
new
ãã 
List
ãã 
<
ãã 
Order
ãã #
>
ãã# $
{
ää 	
new
ææ 
(
ææ 
)
ææ 
{
çç 
Id
èè 
=
èè 
Guid
èè 
.
èè 
NewGuid
èè !
(
èè! "
)
èè" #
,
èè# $
OrderNumber
éé 
=
éé 
$str
éé 1
,
éé1 2
UserId
êê 
=
êê 
existingUsers
êê &
[
êê& '
$num
êê' (
]
êê( )
.
êê) *
Id
êê* ,
,
êê, -
TotalAmount
ëë 
=
ëë 
$num
ëë $
,
ëë$ %
Status
ìì 
=
ìì 
$str
ìì "
,
ìì" #
PaymentStatus
íí 
=
íí 
$str
íí  &
,
íí& '
PaymentMethod
îî 
=
îî 
$str
îî  &
,
îî& '
Notes
ïï 
=
ïï 
$str
ïï 6
,
ïï6 7
	CreatedAt
ğğ 
=
ğğ 
baseDate
ğğ $
.
ğğ$ %

AddMinutes
ğğ% /
(
ğğ/ 0
-
ğğ0 1
$num
ğğ1 3
)
ğğ3 4
,
ğğ4 5
	UpdatedAt
ññ 
=
ññ 
baseDate
ññ $
.
ññ$ %

AddMinutes
ññ% /
(
ññ/ 0
-
ññ0 1
$num
ññ1 3
)
ññ3 4
}
òò 
,
òò 
new
óó 
(
óó 
)
óó 
{
ôô 
Id
õõ 
=
õõ 
Guid
õõ 
.
õõ 
NewGuid
õõ !
(
õõ! "
)
õõ" #
,
õõ# $
OrderNumber
öö 
=
öö 
$str
öö 1
,
öö1 2
UserId
÷÷ 
=
÷÷ 
existingUsers
÷÷ &
[
÷÷& '
$num
÷÷' (
]
÷÷( )
.
÷÷) *
Id
÷÷* ,
,
÷÷, -
TotalAmount
øø 
=
øø 
$num
øø $
,
øø$ %
Status
ùù 
=
ùù 
$str
ùù "
,
ùù" #
PaymentStatus
úú 
=
úú 
$str
úú  &
,
úú& '
PaymentMethod
ûû 
=
ûû 
$str
ûû  &
,
ûû& '
Notes
üü 
=
üü 
null
üü 
,
üü 
	CreatedAt
ıı 
=
ıı 
baseDate
ıı $
.
ıı$ %

AddMinutes
ıı% /
(
ıı/ 0
-
ıı0 1
$num
ıı1 3
)
ıı3 4
,
ıı4 5
	UpdatedAt
şş 
=
şş 
baseDate
şş $
.
şş$ %

AddMinutes
şş% /
(
şş/ 0
-
şş0 1
$num
şş1 3
)
şş3 4
}
ÿÿ 
,
ÿÿ 
new
€€ 
(
€€ 
)
€€ 
{
 
Id
‚‚ 
=
‚‚ 
Guid
‚‚ 
.
‚‚ 
NewGuid
‚‚ !
(
‚‚! "
)
‚‚" #
,
‚‚# $
OrderNumber
ƒƒ 
=
ƒƒ 
$str
ƒƒ 1
,
ƒƒ1 2
UserId
„„ 
=
„„ 
existingUsers
„„ &
[
„„& '
$num
„„' (
]
„„( )
.
„„) *
Id
„„* ,
,
„„, -
TotalAmount
…… 
=
…… 
$num
…… $
,
……$ %
Status
†† 
=
†† 
$str
†† $
,
††$ %
PaymentStatus
‡‡ 
=
‡‡ 
$str
‡‡  &
,
‡‡& '
PaymentMethod
ˆˆ 
=
ˆˆ 
$str
ˆˆ  &
,
ˆˆ& '
Notes
‰‰ 
=
‰‰ 
$str
‰‰ /
,
‰‰/ 0
	CreatedAt
ŠŠ 
=
ŠŠ 
baseDate
ŠŠ $
.
ŠŠ$ %

AddMinutes
ŠŠ% /
(
ŠŠ/ 0
-
ŠŠ0 1
$num
ŠŠ1 3
)
ŠŠ3 4
,
ŠŠ4 5
	UpdatedAt
‹‹ 
=
‹‹ 
baseDate
‹‹ $
.
‹‹$ %

AddMinutes
‹‹% /
(
‹‹/ 0
-
‹‹0 1
$num
‹‹1 2
)
‹‹2 3
}
ŒŒ 
,
ŒŒ 
new
 
(
 
)
 
{
 
Id
‘‘ 
=
‘‘ 
Guid
‘‘ 
.
‘‘ 
NewGuid
‘‘ !
(
‘‘! "
)
‘‘" #
,
‘‘# $
OrderNumber
’’ 
=
’’ 
$str
’’ 1
,
’’1 2
UserId
““ 
=
““ 
existingUsers
““ &
[
““& '
$num
““' (
]
““( )
.
““) *
Id
““* ,
,
““, -
TotalAmount
”” 
=
”” 
$num
”” $
,
””$ %
Status
•• 
=
•• 
$str
•• $
,
••$ %
PaymentStatus
–– 
=
–– 
$str
––  &
,
––& '
PaymentMethod
—— 
=
—— 
$str
——  &
,
——& '
Notes
˜˜ 
=
˜˜ 
null
˜˜ 
,
˜˜ 
	CreatedAt
™™ 
=
™™ 
baseDate
™™ $
.
™™$ %
AddHours
™™% -
(
™™- .
-
™™. /
$num
™™/ 0
)
™™0 1
,
™™1 2
	UpdatedAt
šš 
=
šš 
baseDate
šš $
.
šš$ %
AddHours
šš% -
(
šš- .
-
šš. /
$num
šš/ 2
)
šš2 3
,
šš3 4
CompletedAt
›› 
=
›› 
baseDate
›› &
.
››& '
AddHours
››' /
(
››/ 0
-
››0 1
$num
››1 4
)
››4 5
}
œœ 
,
œœ 
new
 
(
 
)
 
{
 
Id
ŸŸ 
=
ŸŸ 
Guid
ŸŸ 
.
ŸŸ 
NewGuid
ŸŸ !
(
ŸŸ! "
)
ŸŸ" #
,
ŸŸ# $
OrderNumber
   
=
   
$str
   1
,
  1 2
UserId
¡¡ 
=
¡¡ 
existingUsers
¡¡ &
[
¡¡& '
$num
¡¡' (
]
¡¡( )
.
¡¡) *
Id
¡¡* ,
,
¡¡, -
TotalAmount
¢¢ 
=
¢¢ 
$num
¢¢ $
,
¢¢$ %
Status
££ 
=
££ 
$str
££ $
,
££$ %
PaymentStatus
¤¤ 
=
¤¤ 
$str
¤¤  &
,
¤¤& '
PaymentMethod
¥¥ 
=
¥¥ 
$str
¥¥  &
,
¥¥& '
Notes
¦¦ 
=
¦¦ 
null
¦¦ 
,
¦¦ 
	CreatedAt
§§ 
=
§§ 
baseDate
§§ $
.
§§$ %
AddHours
§§% -
(
§§- .
-
§§. /
$num
§§/ 0
)
§§0 1
,
§§1 2
	UpdatedAt
¨¨ 
=
¨¨ 
baseDate
¨¨ $
.
¨¨$ %

AddMinutes
¨¨% /
(
¨¨/ 0
-
¨¨0 1
$num
¨¨1 3
)
¨¨3 4
,
¨¨4 5
CompletedAt
©© 
=
©© 
baseDate
©© &
.
©©& '

AddMinutes
©©' 1
(
©©1 2
-
©©2 3
$num
©©3 5
)
©©5 6
}
ªª 
,
ªª 
new
­­ 
(
­­ 
)
­­ 
{
®® 
Id
¯¯ 
=
¯¯ 
Guid
¯¯ 
.
¯¯ 
NewGuid
¯¯ !
(
¯¯! "
)
¯¯" #
,
¯¯# $
OrderNumber
°° 
=
°° 
$str
°° 1
,
°°1 2
UserId
±± 
=
±± 
existingUsers
±± &
[
±±& '
$num
±±' (
]
±±( )
.
±±) *
Id
±±* ,
,
±±, -
TotalAmount
²² 
=
²² 
$num
²² $
,
²²$ %
Status
³³ 
=
³³ 
$str
³³  
,
³³  !
PaymentStatus
´´ 
=
´´ 
$str
´´  &
,
´´& '
PaymentMethod
µµ 
=
µµ 
$str
µµ  &
,
µµ& '
Notes
¶¶ 
=
¶¶ 
$str
¶¶ 8
,
¶¶8 9
	CreatedAt
·· 
=
·· 
baseDate
·· $
.
··$ %

AddMinutes
··% /
(
··/ 0
-
··0 1
$num
··1 3
)
··3 4
,
··4 5
	UpdatedAt
¸¸ 
=
¸¸ 
baseDate
¸¸ $
.
¸¸$ %

AddMinutes
¸¸% /
(
¸¸/ 0
-
¸¸0 1
$num
¸¸1 2
)
¸¸2 3
}
¹¹ 
}
ºº 	
;
ºº	 

await
¼¼ 
context
¼¼ 
.
¼¼ 
Orders
¼¼ 
.
¼¼ 
AddRangeAsync
¼¼ *
(
¼¼* +
orders
¼¼+ 1
)
¼¼1 2
;
¼¼2 3
await
½½ 
context
½½ 
.
½½ 
SaveChangesAsync
½½ &
(
½½& '
)
½½' (
;
½½( )
var
ÀÀ 

orderItems
ÀÀ 
=
ÀÀ 
new
ÀÀ 
List
ÀÀ !
<
ÀÀ! "
	OrderItem
ÀÀ" +
>
ÀÀ+ ,
{
ÁÁ 	
new
ÃÃ 
(
ÃÃ 
)
ÃÃ 
{
ÃÃ 
Id
ÃÃ 
=
ÃÃ 
Guid
ÃÃ 
.
ÃÃ 
NewGuid
ÃÃ %
(
ÃÃ% &
)
ÃÃ& '
,
ÃÃ' (
OrderId
ÃÃ) 0
=
ÃÃ1 2
orders
ÃÃ3 9
[
ÃÃ9 :
$num
ÃÃ: ;
]
ÃÃ; <
.
ÃÃ< =
Id
ÃÃ= ?
,
ÃÃ? @
	ProductId
ÃÃA J
=
ÃÃK L
existingProducts
ÃÃM ]
[
ÃÃ] ^
$num
ÃÃ^ _
]
ÃÃ_ `
.
ÃÃ` a
Id
ÃÃa c
,
ÃÃc d
Quantity
ÃÃe m
=
ÃÃn o
$num
ÃÃp q
,
ÃÃq r
	UnitPrice
ÃÃs |
=
ÃÃ} ~
$numÃÃ …
,ÃÃ… †
SubtotalÃÃ‡ 
=ÃÃ ‘
$numÃÃ’ ˜
,ÃÃ˜ ™#
SpecialInstructionsÃÃš ­
=ÃÃ® ¯
$strÃÃ° ¼
}ÃÃ½ ¾
,ÃÃ¾ ¿
new
ÄÄ 
(
ÄÄ 
)
ÄÄ 
{
ÄÄ 
Id
ÄÄ 
=
ÄÄ 
Guid
ÄÄ 
.
ÄÄ 
NewGuid
ÄÄ %
(
ÄÄ% &
)
ÄÄ& '
,
ÄÄ' (
OrderId
ÄÄ) 0
=
ÄÄ1 2
orders
ÄÄ3 9
[
ÄÄ9 :
$num
ÄÄ: ;
]
ÄÄ; <
.
ÄÄ< =
Id
ÄÄ= ?
,
ÄÄ? @
	ProductId
ÄÄA J
=
ÄÄK L
existingProducts
ÄÄM ]
[
ÄÄ] ^
$num
ÄÄ^ _
]
ÄÄ_ `
.
ÄÄ` a
Id
ÄÄa c
,
ÄÄc d
Quantity
ÄÄe m
=
ÄÄn o
$num
ÄÄp q
,
ÄÄq r
	UnitPrice
ÄÄs |
=
ÄÄ} ~
$numÄÄ …
,ÄÄ… †
SubtotalÄÄ‡ 
=ÄÄ ‘
$numÄÄ’ ˜
}ÄÄ™ š
,ÄÄš ›
new
ÅÅ 
(
ÅÅ 
)
ÅÅ 
{
ÅÅ 
Id
ÅÅ 
=
ÅÅ 
Guid
ÅÅ 
.
ÅÅ 
NewGuid
ÅÅ %
(
ÅÅ% &
)
ÅÅ& '
,
ÅÅ' (
OrderId
ÅÅ) 0
=
ÅÅ1 2
orders
ÅÅ3 9
[
ÅÅ9 :
$num
ÅÅ: ;
]
ÅÅ; <
.
ÅÅ< =
Id
ÅÅ= ?
,
ÅÅ? @
	ProductId
ÅÅA J
=
ÅÅK L
existingProducts
ÅÅM ]
[
ÅÅ] ^
$num
ÅÅ^ _
]
ÅÅ_ `
.
ÅÅ` a
Id
ÅÅa c
,
ÅÅc d
Quantity
ÅÅe m
=
ÅÅn o
$num
ÅÅp q
,
ÅÅq r
	UnitPrice
ÅÅs |
=
ÅÅ} ~
$numÅÅ …
,ÅÅ… †
SubtotalÅÅ‡ 
=ÅÅ ‘
$numÅÅ’ ˜
}ÅÅ™ š
,ÅÅš ›
new
ÈÈ 
(
ÈÈ 
)
ÈÈ 
{
ÈÈ 
Id
ÈÈ 
=
ÈÈ 
Guid
ÈÈ 
.
ÈÈ 
NewGuid
ÈÈ %
(
ÈÈ% &
)
ÈÈ& '
,
ÈÈ' (
OrderId
ÈÈ) 0
=
ÈÈ1 2
orders
ÈÈ3 9
[
ÈÈ9 :
$num
ÈÈ: ;
]
ÈÈ; <
.
ÈÈ< =
Id
ÈÈ= ?
,
ÈÈ? @
	ProductId
ÈÈA J
=
ÈÈK L
existingProducts
ÈÈM ]
[
ÈÈ] ^
$num
ÈÈ^ _
]
ÈÈ_ `
.
ÈÈ` a
Id
ÈÈa c
,
ÈÈc d
Quantity
ÈÈe m
=
ÈÈn o
$num
ÈÈp q
,
ÈÈq r
	UnitPrice
ÈÈs |
=
ÈÈ} ~
$numÈÈ …
,ÈÈ… †
SubtotalÈÈ‡ 
=ÈÈ ‘
$numÈÈ’ ˜
}ÈÈ™ š
,ÈÈš ›
new
ÉÉ 
(
ÉÉ 
)
ÉÉ 
{
ÉÉ 
Id
ÉÉ 
=
ÉÉ 
Guid
ÉÉ 
.
ÉÉ 
NewGuid
ÉÉ %
(
ÉÉ% &
)
ÉÉ& '
,
ÉÉ' (
OrderId
ÉÉ) 0
=
ÉÉ1 2
orders
ÉÉ3 9
[
ÉÉ9 :
$num
ÉÉ: ;
]
ÉÉ; <
.
ÉÉ< =
Id
ÉÉ= ?
,
ÉÉ? @
	ProductId
ÉÉA J
=
ÉÉK L
existingProducts
ÉÉM ]
[
ÉÉ] ^
$num
ÉÉ^ _
]
ÉÉ_ `
.
ÉÉ` a
Id
ÉÉa c
,
ÉÉc d
Quantity
ÉÉe m
=
ÉÉn o
$num
ÉÉp q
,
ÉÉq r
	UnitPrice
ÉÉs |
=
ÉÉ} ~
$numÉÉ …
,ÉÉ… †
SubtotalÉÉ‡ 
=ÉÉ ‘
$numÉÉ’ ˜
}ÉÉ™ š
,ÉÉš ›
new
ÌÌ 
(
ÌÌ 
)
ÌÌ 
{
ÌÌ 
Id
ÌÌ 
=
ÌÌ 
Guid
ÌÌ 
.
ÌÌ 
NewGuid
ÌÌ %
(
ÌÌ% &
)
ÌÌ& '
,
ÌÌ' (
OrderId
ÌÌ) 0
=
ÌÌ1 2
orders
ÌÌ3 9
[
ÌÌ9 :
$num
ÌÌ: ;
]
ÌÌ; <
.
ÌÌ< =
Id
ÌÌ= ?
,
ÌÌ? @
	ProductId
ÌÌA J
=
ÌÌK L
existingProducts
ÌÌM ]
[
ÌÌ] ^
$num
ÌÌ^ _
]
ÌÌ_ `
.
ÌÌ` a
Id
ÌÌa c
,
ÌÌc d
Quantity
ÌÌe m
=
ÌÌn o
$num
ÌÌp q
,
ÌÌq r
	UnitPrice
ÌÌs |
=
ÌÌ} ~
$numÌÌ …
,ÌÌ… †
SubtotalÌÌ‡ 
=ÌÌ ‘
$numÌÌ’ ˜
,ÌÌ˜ ™#
SpecialInstructionsÌÌš ­
=ÌÌ® ¯
$strÌÌ° ½
}ÌÌ¾ ¿
,ÌÌ¿ À
new
ÍÍ 
(
ÍÍ 
)
ÍÍ 
{
ÍÍ 
Id
ÍÍ 
=
ÍÍ 
Guid
ÍÍ 
.
ÍÍ 
NewGuid
ÍÍ %
(
ÍÍ% &
)
ÍÍ& '
,
ÍÍ' (
OrderId
ÍÍ) 0
=
ÍÍ1 2
orders
ÍÍ3 9
[
ÍÍ9 :
$num
ÍÍ: ;
]
ÍÍ; <
.
ÍÍ< =
Id
ÍÍ= ?
,
ÍÍ? @
	ProductId
ÍÍA J
=
ÍÍK L
existingProducts
ÍÍM ]
[
ÍÍ] ^
$num
ÍÍ^ _
]
ÍÍ_ `
.
ÍÍ` a
Id
ÍÍa c
,
ÍÍc d
Quantity
ÍÍe m
=
ÍÍn o
$num
ÍÍp q
,
ÍÍq r
	UnitPrice
ÍÍs |
=
ÍÍ} ~
$numÍÍ …
,ÍÍ… †
SubtotalÍÍ‡ 
=ÍÍ ‘
$numÍÍ’ ˜
}ÍÍ™ š
,ÍÍš ›
new
ĞĞ 
(
ĞĞ 
)
ĞĞ 
{
ĞĞ 
Id
ĞĞ 
=
ĞĞ 
Guid
ĞĞ 
.
ĞĞ 
NewGuid
ĞĞ %
(
ĞĞ% &
)
ĞĞ& '
,
ĞĞ' (
OrderId
ĞĞ) 0
=
ĞĞ1 2
orders
ĞĞ3 9
[
ĞĞ9 :
$num
ĞĞ: ;
]
ĞĞ; <
.
ĞĞ< =
Id
ĞĞ= ?
,
ĞĞ? @
	ProductId
ĞĞA J
=
ĞĞK L
existingProducts
ĞĞM ]
[
ĞĞ] ^
$num
ĞĞ^ _
]
ĞĞ_ `
.
ĞĞ` a
Id
ĞĞa c
,
ĞĞc d
Quantity
ĞĞe m
=
ĞĞn o
$num
ĞĞp q
,
ĞĞq r
	UnitPrice
ĞĞs |
=
ĞĞ} ~
$numĞĞ …
,ĞĞ… †
SubtotalĞĞ‡ 
=ĞĞ ‘
$numĞĞ’ ˜
}ĞĞ™ š
,ĞĞš ›
new
ÑÑ 
(
ÑÑ 
)
ÑÑ 
{
ÑÑ 
Id
ÑÑ 
=
ÑÑ 
Guid
ÑÑ 
.
ÑÑ 
NewGuid
ÑÑ %
(
ÑÑ% &
)
ÑÑ& '
,
ÑÑ' (
OrderId
ÑÑ) 0
=
ÑÑ1 2
orders
ÑÑ3 9
[
ÑÑ9 :
$num
ÑÑ: ;
]
ÑÑ; <
.
ÑÑ< =
Id
ÑÑ= ?
,
ÑÑ? @
	ProductId
ÑÑA J
=
ÑÑK L
existingProducts
ÑÑM ]
[
ÑÑ] ^
$num
ÑÑ^ _
]
ÑÑ_ `
.
ÑÑ` a
Id
ÑÑa c
,
ÑÑc d
Quantity
ÑÑe m
=
ÑÑn o
$num
ÑÑp q
,
ÑÑq r
	UnitPrice
ÑÑs |
=
ÑÑ} ~
$numÑÑ …
,ÑÑ… †
SubtotalÑÑ‡ 
=ÑÑ ‘
$numÑÑ’ ˜
}ÑÑ™ š
,ÑÑš ›
new
ÒÒ 
(
ÒÒ 
)
ÒÒ 
{
ÒÒ 
Id
ÒÒ 
=
ÒÒ 
Guid
ÒÒ 
.
ÒÒ 
NewGuid
ÒÒ %
(
ÒÒ% &
)
ÒÒ& '
,
ÒÒ' (
OrderId
ÒÒ) 0
=
ÒÒ1 2
orders
ÒÒ3 9
[
ÒÒ9 :
$num
ÒÒ: ;
]
ÒÒ; <
.
ÒÒ< =
Id
ÒÒ= ?
,
ÒÒ? @
	ProductId
ÒÒA J
=
ÒÒK L
existingProducts
ÒÒM ]
[
ÒÒ] ^
$num
ÒÒ^ _
]
ÒÒ_ `
.
ÒÒ` a
Id
ÒÒa c
,
ÒÒc d
Quantity
ÒÒe m
=
ÒÒn o
$num
ÒÒp q
,
ÒÒq r
	UnitPrice
ÒÒs |
=
ÒÒ} ~
$numÒÒ „
,ÒÒ„ …
SubtotalÒÒ† 
=ÒÒ 
$numÒÒ‘ –
}ÒÒ— ˜
,ÒÒ˜ ™
new
ÕÕ 
(
ÕÕ 
)
ÕÕ 
{
ÕÕ 
Id
ÕÕ 
=
ÕÕ 
Guid
ÕÕ 
.
ÕÕ 
NewGuid
ÕÕ %
(
ÕÕ% &
)
ÕÕ& '
,
ÕÕ' (
OrderId
ÕÕ) 0
=
ÕÕ1 2
orders
ÕÕ3 9
[
ÕÕ9 :
$num
ÕÕ: ;
]
ÕÕ; <
.
ÕÕ< =
Id
ÕÕ= ?
,
ÕÕ? @
	ProductId
ÕÕA J
=
ÕÕK L
existingProducts
ÕÕM ]
[
ÕÕ] ^
$num
ÕÕ^ _
]
ÕÕ_ `
.
ÕÕ` a
Id
ÕÕa c
,
ÕÕc d
Quantity
ÕÕe m
=
ÕÕn o
$num
ÕÕp q
,
ÕÕq r
	UnitPrice
ÕÕs |
=
ÕÕ} ~
$numÕÕ …
,ÕÕ… †
SubtotalÕÕ‡ 
=ÕÕ ‘
$numÕÕ’ ˜
}ÕÕ™ š
,ÕÕš ›
new
ÖÖ 
(
ÖÖ 
)
ÖÖ 
{
ÖÖ 
Id
ÖÖ 
=
ÖÖ 
Guid
ÖÖ 
.
ÖÖ 
NewGuid
ÖÖ %
(
ÖÖ% &
)
ÖÖ& '
,
ÖÖ' (
OrderId
ÖÖ) 0
=
ÖÖ1 2
orders
ÖÖ3 9
[
ÖÖ9 :
$num
ÖÖ: ;
]
ÖÖ; <
.
ÖÖ< =
Id
ÖÖ= ?
,
ÖÖ? @
	ProductId
ÖÖA J
=
ÖÖK L
existingProducts
ÖÖM ]
[
ÖÖ] ^
$num
ÖÖ^ _
]
ÖÖ_ `
.
ÖÖ` a
Id
ÖÖa c
,
ÖÖc d
Quantity
ÖÖe m
=
ÖÖn o
$num
ÖÖp q
,
ÖÖq r
	UnitPrice
ÖÖs |
=
ÖÖ} ~
$numÖÖ …
,ÖÖ… †
SubtotalÖÖ‡ 
=ÖÖ ‘
$numÖÖ’ ˜
}ÖÖ™ š
,ÖÖš ›
new
ÙÙ 
(
ÙÙ 
)
ÙÙ 
{
ÙÙ 
Id
ÙÙ 
=
ÙÙ 
Guid
ÙÙ 
.
ÙÙ 
NewGuid
ÙÙ %
(
ÙÙ% &
)
ÙÙ& '
,
ÙÙ' (
OrderId
ÙÙ) 0
=
ÙÙ1 2
orders
ÙÙ3 9
[
ÙÙ9 :
$num
ÙÙ: ;
]
ÙÙ; <
.
ÙÙ< =
Id
ÙÙ= ?
,
ÙÙ? @
	ProductId
ÙÙA J
=
ÙÙK L
existingProducts
ÙÙM ]
[
ÙÙ] ^
$num
ÙÙ^ _
]
ÙÙ_ `
.
ÙÙ` a
Id
ÙÙa c
,
ÙÙc d
Quantity
ÙÙe m
=
ÙÙn o
$num
ÙÙp q
,
ÙÙq r
	UnitPrice
ÙÙs |
=
ÙÙ} ~
$numÙÙ …
,ÙÙ… †
SubtotalÙÙ‡ 
=ÙÙ ‘
$numÙÙ’ ˜
,ÙÙ˜ ™#
SpecialInstructionsÙÙš ­
=ÙÙ® ¯
$strÙÙ° Â
}ÙÙÃ Ä
}
ÚÚ 	
;
ÚÚ	 

var
ÜÜ 
payments
ÜÜ 
=
ÜÜ 
new
ÜÜ 
List
ÜÜ 
<
ÜÜ  
Payment
ÜÜ  '
>
ÜÜ' (
{
İİ 
new
ŞŞ 
(
ŞŞ 
)
ŞŞ 
{
ßß 	
Id
àà 
=
àà 
Guid
àà 
.
àà 
NewGuid
àà 
(
àà 
)
àà 
,
àà  
OrderId
áá 
=
áá 
orders
áá 
[
áá 
$num
áá 
]
áá 
.
áá  
Id
áá  "
,
áá" #
Amount
ââ 
=
ââ 
orders
ââ 
[
ââ 
$num
ââ 
]
ââ 
.
ââ 
TotalAmount
ââ *
,
ââ* +
Status
ãã 
=
ãã 
PaymentStatus
ãã "
.
ãã" #
	Completed
ãã# ,
,
ãã, -
Method
ää 
=
ää 
PaymentMethod
ää "
.
ää" #
Card
ää# '
,
ää' (#
StripePaymentIntentId
åå !
=
åå" #
$str
åå$ 3
,
åå3 4
	CreatedAt
ææ 
=
ææ 
orders
ææ 
[
ææ 
$num
ææ  
]
ææ  !
.
ææ! "
	CreatedAt
ææ" +
,
ææ+ ,
PaidAt
çç 
=
çç 
orders
çç 
[
çç 
$num
çç 
]
çç 
.
çç 
	CreatedAt
çç (
.
çç( )

AddMinutes
çç) 3
(
çç3 4
$num
çç4 5
)
çç5 6
,
çç6 7
LoyaltyPointsUsed
èè 
=
èè 
null
èè  $
}
éé 	
,
éé	 

new
êê 
(
êê 
)
êê 
{
ëë 	
Id
ìì 
=
ìì 
Guid
ìì 
.
ìì 
NewGuid
ìì 
(
ìì 
)
ìì 
,
ìì  
OrderId
íí 
=
íí 
orders
íí 
[
íí 
$num
íí 
]
íí 
.
íí  
Id
íí  "
,
íí" #
Amount
îî 
=
îî 
orders
îî 
[
îî 
$num
îî 
]
îî 
.
îî 
TotalAmount
îî *
,
îî* +
Status
ïï 
=
ïï 
PaymentStatus
ïï "
.
ïï" #
	Completed
ïï# ,
,
ïï, -
Method
ğğ 
=
ğğ 
PaymentMethod
ğğ "
.
ğğ" #
Cash
ğğ# '
,
ğğ' (
	CreatedAt
ññ 
=
ññ 
orders
ññ 
[
ññ 
$num
ññ  
]
ññ  !
.
ññ! "
	CreatedAt
ññ" +
,
ññ+ ,
PaidAt
òò 
=
òò 
orders
òò 
[
òò 
$num
òò 
]
òò 
.
òò 
	CreatedAt
òò (
.
òò( )

AddMinutes
òò) 3
(
òò3 4
$num
òò4 5
)
òò5 6
,
òò6 7
LoyaltyPointsUsed
óó 
=
óó 
null
óó  $
}
ôô 	
,
ôô	 

new
õõ 
(
õõ 
)
õõ 
{
öö 	
Id
÷÷ 
=
÷÷ 
Guid
÷÷ 
.
÷÷ 
NewGuid
÷÷ 
(
÷÷ 
)
÷÷ 
,
÷÷  
OrderId
øø 
=
øø 
orders
øø 
[
øø 
$num
øø 
]
øø 
.
øø  
Id
øø  "
,
øø" #
Amount
ùù 
=
ùù 
orders
ùù 
[
ùù 
$num
ùù 
]
ùù 
.
ùù 
TotalAmount
ùù *
,
ùù* +
Status
úú 
=
úú 
PaymentStatus
úú "
.
úú" #
	Completed
úú# ,
,
úú, -
Method
ûû 
=
ûû 
PaymentMethod
ûû "
.
ûû" #
Card
ûû# '
,
ûû' (#
StripePaymentIntentId
üü !
=
üü" #
$str
üü$ 3
,
üü3 4
	CreatedAt
ıı 
=
ıı 
orders
ıı 
[
ıı 
$num
ıı  
]
ıı  !
.
ıı! "
	CreatedAt
ıı" +
,
ıı+ ,
PaidAt
şş 
=
şş 
orders
şş 
[
şş 
$num
şş 
]
şş 
.
şş 
	CreatedAt
şş (
.
şş( )

AddMinutes
şş) 3
(
şş3 4
$num
şş4 5
)
şş5 6
,
şş6 7
LoyaltyPointsUsed
ÿÿ 
=
ÿÿ 
null
ÿÿ  $
}
€€ 	
,
€€	 

new
 
(
 
)
 
{
‚‚ 	
Id
ƒƒ 
=
ƒƒ 
Guid
ƒƒ 
.
ƒƒ 
NewGuid
ƒƒ 
(
ƒƒ 
)
ƒƒ 
,
ƒƒ  
OrderId
„„ 
=
„„ 
orders
„„ 
[
„„ 
$num
„„ 
]
„„ 
.
„„  
Id
„„  "
,
„„" #
Amount
…… 
=
…… 
orders
…… 
[
…… 
$num
…… 
]
…… 
.
…… 
TotalAmount
…… *
,
……* +
Status
†† 
=
†† 
PaymentStatus
†† "
.
††" #
	Completed
††# ,
,
††, -
Method
‡‡ 
=
‡‡ 
PaymentMethod
‡‡ "
.
‡‡" #
Card
‡‡# '
,
‡‡' (#
StripePaymentIntentId
ˆˆ !
=
ˆˆ" #
$str
ˆˆ$ 3
,
ˆˆ3 4
	CreatedAt
‰‰ 
=
‰‰ 
orders
‰‰ 
[
‰‰ 
$num
‰‰  
]
‰‰  !
.
‰‰! "
	CreatedAt
‰‰" +
,
‰‰+ ,
PaidAt
ŠŠ 
=
ŠŠ 
orders
ŠŠ 
[
ŠŠ 
$num
ŠŠ 
]
ŠŠ 
.
ŠŠ 
	CreatedAt
ŠŠ (
.
ŠŠ( )

AddMinutes
ŠŠ) 3
(
ŠŠ3 4
$num
ŠŠ4 5
)
ŠŠ5 6
,
ŠŠ6 7
LoyaltyPointsUsed
‹‹ 
=
‹‹ 
null
‹‹  $
}
ŒŒ 	
,
ŒŒ	 

new
 
(
 
)
 
{
 	
Id
 
=
 
Guid
 
.
 
NewGuid
 
(
 
)
 
,
  
OrderId
 
=
 
orders
 
[
 
$num
 
]
 
.
  
Id
  "
,
" #
Amount
‘‘ 
=
‘‘ 
orders
‘‘ 
[
‘‘ 
$num
‘‘ 
]
‘‘ 
.
‘‘ 
TotalAmount
‘‘ *
,
‘‘* +
Status
’’ 
=
’’ 
PaymentStatus
’’ "
.
’’" #
	Completed
’’# ,
,
’’, -
Method
““ 
=
““ 
PaymentMethod
““ "
.
““" #
Cash
““# '
,
““' (
	CreatedAt
”” 
=
”” 
orders
”” 
[
”” 
$num
””  
]
””  !
.
””! "
	CreatedAt
””" +
,
””+ ,
PaidAt
•• 
=
•• 
orders
•• 
[
•• 
$num
•• 
]
•• 
.
•• 
	CreatedAt
•• (
.
••( )

AddMinutes
••) 3
(
••3 4
$num
••4 5
)
••5 6
,
••6 7
LoyaltyPointsUsed
–– 
=
–– 
null
––  $
}
—— 	
,
——	 

new
˜˜ 
(
˜˜ 
)
˜˜ 
{
™™ 	
Id
šš 
=
šš 
Guid
šš 
.
šš 
NewGuid
šš 
(
šš 
)
šš 
,
šš  
OrderId
›› 
=
›› 
orders
›› 
[
›› 
$num
›› 
]
›› 
.
››  
Id
››  "
,
››" #
Amount
œœ 
=
œœ 
orders
œœ 
[
œœ 
$num
œœ 
]
œœ 
.
œœ 
TotalAmount
œœ *
,
œœ* +
Status
 
=
 
PaymentStatus
 "
.
" #
	Completed
# ,
,
, -
Method
 
=
 
PaymentMethod
 "
.
" #
Card
# '
,
' (#
StripePaymentIntentId
ŸŸ !
=
ŸŸ" #
$str
ŸŸ$ 3
,
ŸŸ3 4
	CreatedAt
   
=
   
orders
   
[
   
$num
    
]
    !
.
  ! "
	CreatedAt
  " +
,
  + ,
PaidAt
¡¡ 
=
¡¡ 
orders
¡¡ 
[
¡¡ 
$num
¡¡ 
]
¡¡ 
.
¡¡ 
	CreatedAt
¡¡ (
.
¡¡( )

AddMinutes
¡¡) 3
(
¡¡3 4
$num
¡¡4 5
)
¡¡5 6
,
¡¡6 7
LoyaltyPointsUsed
¢¢ 
=
¢¢ 
null
¢¢  $
}
££ 	
}
¤¤ 
;
¤¤ 
await
¦¦ 
context
¦¦ 
.
¦¦ 

OrderItems
¦¦  
.
¦¦  !
AddRangeAsync
¦¦! .
(
¦¦. /

orderItems
¦¦/ 9
)
¦¦9 :
;
¦¦: ;
await
§§ 
context
§§ 
.
§§ 
SaveChangesAsync
§§ &
(
§§& '
)
§§' (
;
§§( )
}
¨¨ 
}©© ” 
WC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Persistence\AppDbContext.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Persistence (
;( )
public 
class 
AppDbContext 
( 
DbContextOptions *
<* +
AppDbContext+ 7
>7 8
options9 @
)@ A
:B C
	DbContextD M
(M N
optionsN U
)U V
{ 
public 

DbSet 
< 
User 
> 
Users 
{ 
get "
;" #
set$ '
;' (
}) *
public		 

DbSet		 
<		 
Product		 
>		 
Products		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
public

 

DbSet

 
<

 
Order

 
>

 
Orders

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
public 

DbSet 
< 
	OrderItem 
> 

OrderItems &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 

DbSet 
< 
Payment 
> 
Payments "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

DbSet 
< 
LoyaltyTransaction #
># $
LoyaltyTransactions% 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
	protected 
override 
void 
OnModelCreating +
(+ ,
ModelBuilder, 8
modelBuilder9 E
)E F
{ 
base 
. 
OnModelCreating 
( 
modelBuilder )
)) *
;* +
modelBuilder 
. 
Entity 
< 
User  
>  !
(! "
entity" (
=>) +
{ 	
entity 
. 
HasKey 
( 
u 
=> 
u  
.  !
Id! #
)# $
;$ %
entity 
. 
Property 
( 
u 
=>  
u! "
." #
Email# (
)( )
. 

IsRequired 
( 
) 
. 
HasMaxLength 
( 
$num !
)! "
;" #
entity 
. 
HasIndex 
( 
u 
=>  
u! "
." #
Email# (
)( )
. 
IsUnique 
( 
) 
; 
entity 
. 
Property 
( 
u 
=>  
u! "
." #
FullName# +
)+ ,
.   

IsRequired   
(   
)   
.!! 
HasMaxLength!! 
(!! 
$num!! !
)!!! "
;!!" #
entity## 
.## 
Property## 
(## 
u## 
=>##  
u##! "
.##" #
PhoneNumber### .
)##. /
.$$ 

IsRequired$$ 
($$ 
)$$ 
.%% 
HasMaxLength%% 
(%% 
$num%%  
)%%  !
;%%! "
entity'' 
.'' 
Property'' 
('' 
u'' 
=>''  
u''! "
.''" #
	StudentId''# ,
)'', -
.(( 
HasMaxLength(( 
((( 
$num((  
)((  !
;((! "
entity** 
.** 
Property** 
(** 
u** 
=>**  
u**! "
.**" #
LoyaltyPoints**# 0
)**0 1
.++ 
HasDefaultValue++  
(++  !
$num++! "
)++" #
;++# $
entity.. 
... 
Property.. 
(.. 
u.. 
=>..  
u..! "
..." #
	CreatedAt..# ,
).., -
.// 
HasDefaultValueSql// #
(//# $
$str//$ +
)//+ ,
;//, -
}00 	
)00	 

;00
 
modelBuilder33 
.33 
Entity33 
<33 
Product33 #
>33# $
(33$ %
entity33% +
=>33, .
{44 	
entity55 
.55 
HasKey55 
(55 
p55 
=>55 
p55  
.55  !
Id55! #
)55# $
;55$ %
entity77 
.77 
Property77 
(77 
p77 
=>77  
p77! "
.77" #
Name77# '
)77' (
.88 

IsRequired88 
(88 
)88 
.99 
HasMaxLength99 
(99 
$num99 !
)99! "
;99" #
entity;; 
.;; 
Property;; 
(;; 
p;; 
=>;;  
p;;! "
.;;" #
Description;;# .
);;. /
.<< 
HasMaxLength<< 
(<< 
$num<< !
)<<! "
;<<" #
entity>> 
.>> 
Property>> 
(>> 
p>> 
=>>>  
p>>! "
.>>" #
Price>># (
)>>( )
.?? 
HasColumnType?? 
(?? 
$str?? .
)??. /
.@@ 

IsRequired@@ 
(@@ 
)@@ 
;@@ 
entityBB 
.BB 
PropertyBB 
(BB 
pBB 
=>BB  
pBB! "
.BB" #
CategoryBB# +
)BB+ ,
.CC 

IsRequiredCC 
(CC 
)CC 
.DD 
HasMaxLengthDD 
(DD 
$numDD  
)DD  !
;DD! "
entityFF 
.FF 
PropertyFF 
(FF 
pFF 
=>FF  
pFF! "
.FF" #
ImageUrlFF# +
)FF+ ,
.GG 
HasMaxLengthGG 
(GG 
$numGG !
)GG! "
;GG" #
entityII 
.II 
PropertyII 
(II 
pII 
=>II  
pII! "
.II" #
DietaryRestrictionsII# 6
)II6 7
.JJ 
HasMaxLengthJJ 
(JJ 
$numJJ !
)JJ! "
;JJ" #
entityLL 
.LL 
PropertyLL 
(LL 
pLL 
=>LL  
pLL! "
.LL" #
IsAvailableLL# .
)LL. /
.MM 
HasDefaultValueMM  
(MM  !
trueMM! %
)MM% &
;MM& '
entityOO 
.OO 
PropertyOO 
(OO 
pOO 
=>OO  
pOO! "
.OO" #
	AllergensOO# ,
)OO, -
.PP 
HasColumnTypePP 
(PP 
$strPP &
)PP& '
.QQ 
HasDefaultValueSqlQQ #
(QQ# $
$strQQ$ 1
)QQ1 2
;QQ2 3
entitySS 
.SS 
PropertySS 
(SS 
pSS 
=>SS  
pSS! "
.SS" #
	CreatedAtSS# ,
)SS, -
.TT 
HasDefaultValueSqlTT #
(TT# $
$strTT$ +
)TT+ ,
;TT, -
entityVV 
.VV 
HasIndexVV 
(VV 
pVV 
=>VV  
pVV! "
.VV" #
CategoryVV# +
)VV+ ,
;VV, -
entityWW 
.WW 
HasIndexWW 
(WW 
pWW 
=>WW  
pWW! "
.WW" #
IsAvailableWW# .
)WW. /
;WW/ 0
}XX 	
)XX	 

;XX
 
modelBuilder[[ 
.[[ 
Entity[[ 
<[[ 
Order[[ !
>[[! "
([[" #
entity[[# )
=>[[* ,
{\\ 	
entity]] 
.]] 
HasKey]] 
(]] 
o]] 
=>]] 
o]]  
.]]  !
Id]]! #
)]]# $
;]]$ %
entity__ 
.__ 
Property__ 
(__ 
o__ 
=>__  
o__! "
.__" #
OrderNumber__# .
)__. /
.`` 

IsRequired`` 
(`` 
)`` 
.aa 
HasMaxLengthaa 
(aa 
$numaa  
)aa  !
;aa! "
entitycc 
.cc 
HasIndexcc 
(cc 
occ 
=>cc  
occ! "
.cc" #
OrderNumbercc# .
)cc. /
.dd 
IsUniquedd 
(dd 
)dd 
;dd 
entityff 
.ff 
Propertyff 
(ff 
off 
=>ff  
off! "
.ff" #
Statusff# )
)ff) *
.gg 

IsRequiredgg 
(gg 
)gg 
.hh 
HasMaxLengthhh 
(hh 
$numhh  
)hh  !
;hh! "
entityjj 
.jj 
Propertyjj 
(jj 
ojj 
=>jj  
ojj! "
.jj" #
PaymentStatusjj# 0
)jj0 1
.kk 

IsRequiredkk 
(kk 
)kk 
.ll 
HasMaxLengthll 
(ll 
$numll  
)ll  !
;ll! "
entitynn 
.nn 
Propertynn 
(nn 
onn 
=>nn  
onn! "
.nn" #
PaymentMethodnn# 0
)nn0 1
.oo 
HasMaxLengthoo 
(oo 
$numoo  
)oo  !
;oo! "
entityqq 
.qq 
Propertyqq 
(qq 
oqq 
=>qq  
oqq! "
.qq" #
Notesqq# (
)qq( )
.rr 
HasMaxLengthrr 
(rr 
$numrr !
)rr! "
;rr" #
entitytt 
.tt 
Propertytt 
(tt 
ott 
=>tt  
ott! "
.tt" #
TotalAmounttt# .
)tt. /
.uu 
HasColumnTypeuu 
(uu 
$struu .
)uu. /
;uu/ 0
entityww 
.ww 
HasOneww 
(ww 
oww 
=>ww 
oww  
.ww  !
Userww! %
)ww% &
.xx 
WithManyxx 
(xx 
)xx 
.yy 
HasForeignKeyyy 
(yy 
oyy  
=>yy! #
oyy$ %
.yy% &
UserIdyy& ,
)yy, -
.zz 
OnDeletezz 
(zz 
DeleteBehaviorzz (
.zz( )
Restrictzz) 1
)zz1 2
;zz2 3
entity|| 
.|| 
HasMany|| 
(|| 
o|| 
=>|| 
o||  !
.||! "

OrderItems||" ,
)||, -
.}} 
WithOne}} 
(}} 
oi}} 
=>}} 
oi}} !
.}}! "
Order}}" '
)}}' (
.~~ 
HasForeignKey~~ 
(~~ 
oi~~ !
=>~~" $
oi~~% '
.~~' (
OrderId~~( /
)~~/ 0
. 
OnDelete 
( 
DeleteBehavior (
.( )
Cascade) 0
)0 1
;1 2
}
€€ 	
)
€€	 

;
€€
 
modelBuilder
ƒƒ 
.
ƒƒ 
Entity
ƒƒ 
<
ƒƒ 
	OrderItem
ƒƒ %
>
ƒƒ% &
(
ƒƒ& '
entity
ƒƒ' -
=>
ƒƒ. 0
{
„„ 	
entity
…… 
.
…… 
HasKey
…… 
(
…… 
oi
…… 
=>
…… 
oi
……  "
.
……" #
Id
……# %
)
……% &
;
……& '
entity
‡‡ 
.
‡‡ 
Property
‡‡ 
(
‡‡ 
oi
‡‡ 
=>
‡‡ !
oi
‡‡" $
.
‡‡$ %
Quantity
‡‡% -
)
‡‡- .
.
ˆˆ 

IsRequired
ˆˆ 
(
ˆˆ 
)
ˆˆ 
;
ˆˆ 
entity
ŠŠ 
.
ŠŠ 
Property
ŠŠ 
(
ŠŠ 
oi
ŠŠ 
=>
ŠŠ !
oi
ŠŠ" $
.
ŠŠ$ %
	UnitPrice
ŠŠ% .
)
ŠŠ. /
.
‹‹ 
HasColumnType
‹‹ 
(
‹‹ 
$str
‹‹ .
)
‹‹. /
;
‹‹/ 0
entity
 
.
 
Property
 
(
 
oi
 
=>
 !
oi
" $
.
$ %
Subtotal
% -
)
- .
.
 
HasColumnType
 
(
 
$str
 .
)
. /
;
/ 0
entity
 
.
 
Property
 
(
 
oi
 
=>
 !
oi
" $
.
$ %!
SpecialInstructions
% 8
)
8 9
.
‘‘ 
HasMaxLength
‘‘ 
(
‘‘ 
$num
‘‘ !
)
‘‘! "
;
‘‘" #
entity
““ 
.
““ 
HasOne
““ 
(
““ 
oi
““ 
=>
““ 
oi
““  "
.
““" #
Product
““# *
)
““* +
.
”” 
WithMany
”” 
(
”” 
)
”” 
.
•• 
HasForeignKey
•• 
(
•• 
oi
•• !
=>
••" $
oi
••% '
.
••' (
	ProductId
••( 1
)
••1 2
.
–– 
OnDelete
–– 
(
–– 
DeleteBehavior
–– (
.
––( )
Restrict
––) 1
)
––1 2
;
––2 3
}
—— 	
)
——	 

;
——
 
modelBuilder
šš 
.
šš 
Entity
šš 
<
šš 
Payment
šš #
>
šš# $
(
šš$ %
entity
šš% +
=>
šš, .
{
›› 	
entity
œœ 
.
œœ 
HasKey
œœ 
(
œœ 
p
œœ 
=>
œœ 
p
œœ  
.
œœ  !
Id
œœ! #
)
œœ# $
;
œœ$ %
entity
 
.
 
Property
 
(
 
p
 
=>
  
p
! "
.
" #
Amount
# )
)
) *
.
ŸŸ 
HasColumnType
ŸŸ 
(
ŸŸ 
$str
ŸŸ .
)
ŸŸ. /
.
   

IsRequired
   
(
   
)
   
;
   
entity
¢¢ 
.
¢¢ 
Property
¢¢ 
(
¢¢ 
p
¢¢ 
=>
¢¢  
p
¢¢! "
.
¢¢" #
Status
¢¢# )
)
¢¢) *
.
££ 

IsRequired
££ 
(
££ 
)
££ 
.
¤¤ 
HasConversion
¤¤ 
<
¤¤ 
string
¤¤ %
>
¤¤% &
(
¤¤& '
)
¤¤' (
;
¤¤( )
entity
¦¦ 
.
¦¦ 
Property
¦¦ 
(
¦¦ 
p
¦¦ 
=>
¦¦  
p
¦¦! "
.
¦¦" #
Method
¦¦# )
)
¦¦) *
.
§§ 

IsRequired
§§ 
(
§§ 
)
§§ 
.
¨¨ 
HasConversion
¨¨ 
<
¨¨ 
string
¨¨ %
>
¨¨% &
(
¨¨& '
)
¨¨' (
;
¨¨( )
entity
ªª 
.
ªª 
Property
ªª 
(
ªª 
p
ªª 
=>
ªª  
p
ªª! "
.
ªª" ##
StripePaymentIntentId
ªª# 8
)
ªª8 9
.
«« 
HasMaxLength
«« 
(
«« 
$num
«« !
)
««! "
;
««" #
entity
­­ 
.
­­ 
Property
­­ 
(
­­ 
p
­­ 
=>
­­  
p
­­! "
.
­­" #
StripeSessionId
­­# 2
)
­­2 3
.
®® 
HasMaxLength
®® 
(
®® 
$num
®® !
)
®®! "
;
®®" #
entity
°° 
.
°° 
Property
°° 
(
°° 
p
°° 
=>
°°  
p
°°! "
.
°°" #
FailureReason
°°# 0
)
°°0 1
.
±± 
HasMaxLength
±± 
(
±± 
$num
±± !
)
±±! "
;
±±" #
entity
´´ 
.
´´ 
Property
´´ 
(
´´ 
p
´´ 
=>
´´  
p
´´! "
.
´´" #
	CreatedAt
´´# ,
)
´´, -
.
µµ  
HasDefaultValueSql
µµ #
(
µµ# $
$str
µµ$ +
)
µµ+ ,
;
µµ, -
entity
·· 
.
·· 
HasIndex
·· 
(
·· 
p
·· 
=>
··  
p
··! "
.
··" #
Status
··# )
)
··) *
;
··* +
entity
¸¸ 
.
¸¸ 
HasIndex
¸¸ 
(
¸¸ 
p
¸¸ 
=>
¸¸  
p
¸¸! "
.
¸¸" ##
StripePaymentIntentId
¸¸# 8
)
¸¸8 9
;
¸¸9 :
}
¹¹ 	
)
¹¹	 

;
¹¹
 
modelBuilder
¼¼ 
.
¼¼ 
Entity
¼¼ 
<
¼¼  
LoyaltyTransaction
¼¼ .
>
¼¼. /
(
¼¼/ 0
entity
¼¼0 6
=>
¼¼7 9
{
½½ 	
entity
¾¾ 
.
¾¾ 
HasKey
¾¾ 
(
¾¾ 
lt
¾¾ 
=>
¾¾ 
lt
¾¾  "
.
¾¾" #
Id
¾¾# %
)
¾¾% &
;
¾¾& '
entity
ÀÀ 
.
ÀÀ 
Property
ÀÀ 
(
ÀÀ 
lt
ÀÀ 
=>
ÀÀ !
lt
ÀÀ" $
.
ÀÀ$ %
PointsChange
ÀÀ% 1
)
ÀÀ1 2
.
ÁÁ 

IsRequired
ÁÁ 
(
ÁÁ 
)
ÁÁ 
;
ÁÁ 
entity
ÃÃ 
.
ÃÃ 
Property
ÃÃ 
(
ÃÃ 
lt
ÃÃ 
=>
ÃÃ !
lt
ÃÃ" $
.
ÃÃ$ %
Type
ÃÃ% )
)
ÃÃ) *
.
ÄÄ 

IsRequired
ÄÄ 
(
ÄÄ 
)
ÄÄ 
.
ÅÅ 
HasConversion
ÅÅ 
<
ÅÅ 
string
ÅÅ %
>
ÅÅ% &
(
ÅÅ& '
)
ÅÅ' (
;
ÅÅ( )
entity
ÇÇ 
.
ÇÇ 
Property
ÇÇ 
(
ÇÇ 
lt
ÇÇ 
=>
ÇÇ !
lt
ÇÇ" $
.
ÇÇ$ %
Description
ÇÇ% 0
)
ÇÇ0 1
.
ÈÈ 

IsRequired
ÈÈ 
(
ÈÈ 
)
ÈÈ 
.
ÉÉ 
HasMaxLength
ÉÉ 
(
ÉÉ 
$num
ÉÉ !
)
ÉÉ! "
;
ÉÉ" #
entity
ÌÌ 
.
ÌÌ 
Property
ÌÌ 
(
ÌÌ 
lt
ÌÌ 
=>
ÌÌ !
lt
ÌÌ" $
.
ÌÌ$ %
	CreatedAt
ÌÌ% .
)
ÌÌ. /
.
ÍÍ  
HasDefaultValueSql
ÍÍ #
(
ÍÍ# $
$str
ÍÍ$ +
)
ÍÍ+ ,
;
ÍÍ, -
entity
ÏÏ 
.
ÏÏ 
HasOne
ÏÏ 
(
ÏÏ 
lt
ÏÏ 
=>
ÏÏ 
lt
ÏÏ  "
.
ÏÏ" #
User
ÏÏ# '
)
ÏÏ' (
.
ĞĞ 
WithMany
ĞĞ 
(
ĞĞ 
u
ĞĞ 
=>
ĞĞ 
u
ĞĞ  
.
ĞĞ  !!
LoyaltyTransactions
ĞĞ! 4
)
ĞĞ4 5
.
ÑÑ 
HasForeignKey
ÑÑ 
(
ÑÑ 
lt
ÑÑ !
=>
ÑÑ" $
lt
ÑÑ% '
.
ÑÑ' (
UserId
ÑÑ( .
)
ÑÑ. /
.
ÒÒ 
OnDelete
ÒÒ 
(
ÒÒ 
DeleteBehavior
ÒÒ (
.
ÒÒ( )
Restrict
ÒÒ) 1
)
ÒÒ1 2
;
ÒÒ2 3
entity
ÚÚ 
.
ÚÚ 
HasIndex
ÚÚ 
(
ÚÚ 
lt
ÚÚ 
=>
ÚÚ !
lt
ÚÚ" $
.
ÚÚ$ %
UserId
ÚÚ% +
)
ÚÚ+ ,
;
ÚÚ, -
entity
ÛÛ 
.
ÛÛ 
HasIndex
ÛÛ 
(
ÛÛ 
lt
ÛÛ 
=>
ÛÛ !
lt
ÛÛ" $
.
ÛÛ$ %
	CreatedAt
ÛÛ% .
)
ÛÛ. /
;
ÛÛ/ 0
}
ÜÜ 	
)
ÜÜ	 

;
ÜÜ
 
}
İİ 
}ŞŞ Ç&
oC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Migrations\20251210143339_UpdateLoyaltyToDecimal.cs
	namespace 	

CampusEats
 
. 
Backend 
. 

Migrations '
{ 
public 

partial 
class "
UpdateLoyaltyToDecimal /
:0 1
	Migration2 ;
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
AlterColumn (
<( )
decimal) 0
>0 1
(1 2
name 
: 
$str %
,% &
table 
: 
$str 
, 
type 
: 
$str 
,  
nullable 
: 
false 
,  
defaultValue 
: 
$num  
,  !

oldClrType 
: 
typeof "
(" #
int# &
)& '
,' (
oldType 
: 
$str "
," #
oldDefaultValue 
:  
$num! "
)" #
;# $
migrationBuilder 
. 
AlterColumn (
<( )
decimal) 0
>0 1
(1 2
name 
: 
$str )
,) *
table 
: 
$str !
,! "
type 
: 
$str 
,  
nullable 
: 
true 
, 

oldClrType 
: 
typeof "
(" #
int# &
)& '
,' (
oldType 
: 
$str "
," #
oldNullable 
: 
true !
)! "
;" #
migrationBuilder   
.   
AlterColumn   (
<  ( )
decimal  ) 0
>  0 1
(  1 2
name!! 
:!! 
$str!! $
,!!$ %
table"" 
:"" 
$str"" ,
,"", -
type## 
:## 
$str## 
,##  
nullable$$ 
:$$ 
false$$ 
,$$  

oldClrType%% 
:%% 
typeof%% "
(%%" #
int%%# &
)%%& '
,%%' (
oldType&& 
:&& 
$str&& "
)&&" #
;&&# $
}'' 	
	protected** 
override** 
void** 
Down**  $
(**$ %
MigrationBuilder**% 5
migrationBuilder**6 F
)**F G
{++ 	
migrationBuilder,, 
.,, 
AlterColumn,, (
<,,( )
int,,) ,
>,,, -
(,,- .
name-- 
:-- 
$str-- %
,--% &
table.. 
:.. 
$str.. 
,.. 
type// 
:// 
$str// 
,//  
nullable00 
:00 
false00 
,00  
defaultValue11 
:11 
$num11 
,11  

oldClrType22 
:22 
typeof22 "
(22" #
decimal22# *
)22* +
,22+ ,
oldType33 
:33 
$str33 "
,33" #
oldDefaultValue44 
:44  
$num44! #
)44# $
;44$ %
migrationBuilder66 
.66 
AlterColumn66 (
<66( )
int66) ,
>66, -
(66- .
name77 
:77 
$str77 )
,77) *
table88 
:88 
$str88 !
,88! "
type99 
:99 
$str99 
,99  
nullable:: 
::: 
true:: 
,:: 

oldClrType;; 
:;; 
typeof;; "
(;;" #
decimal;;# *
);;* +
,;;+ ,
oldType<< 
:<< 
$str<< "
,<<" #
oldNullable== 
:== 
true== !
)==! "
;==" #
migrationBuilder?? 
.?? 
AlterColumn?? (
<??( )
int??) ,
>??, -
(??- .
name@@ 
:@@ 
$str@@ $
,@@$ %
tableAA 
:AA 
$strAA ,
,AA, -
typeBB 
:BB 
$strBB 
,BB  
nullableCC 
:CC 
falseCC 
,CC  

oldClrTypeDD 
:DD 
typeofDD "
(DD" #
decimalDD# *
)DD* +
,DD+ ,
oldTypeEE 
:EE 
$strEE "
)EE" #
;EE# $
}FF 	
}GG 
}HH ¯
hC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Migrations\20251125064841_AddPaymentTable.cs
	namespace 	

CampusEats
 
. 
Backend 
. 

Migrations '
{ 
public 

partial 
class 
AddPaymentTable (
:) *
	Migration+ 4
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
	AddColumn &
<& '
int' *
>* +
(+ ,
name 
: 
$str )
,) *
table 
: 
$str !
,! "
type 
: 
$str 
,  
nullable 
: 
true 
) 
;  
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str )
,) *
table 
: 
$str !
)! "
;" #
} 	
} 
} Ê
{C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Migrations\20251112110150_AddUserPasswordHashRoleAndIsActive.cs
	namespace 	

CampusEats
 
. 
Backend 
. 

Migrations '
{ 
public 

partial 
class .
"AddUserPasswordHashRoleAndIsActive ;
:< =
	Migration> G
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
	AddColumn &
<& '
bool' +
>+ ,
(, -
name 
: 
$str  
,  !
table 
: 
$str 
, 
type 
: 
$str 
,  
nullable 
: 
false 
,  
defaultValue 
: 
false #
)# $
;$ %
migrationBuilder 
. 
	AddColumn &
<& '
string' -
>- .
(. /
name 
: 
$str $
,$ %
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue 
: 
$str  
)  !
;! "
migrationBuilder 
. 
	AddColumn &
<& '
string' -
>- .
(. /
name 
: 
$str 
, 
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue   
:   
$str    
)    !
;  ! "
}!! 	
	protected$$ 
override$$ 
void$$ 
Down$$  $
($$$ %
MigrationBuilder$$% 5
migrationBuilder$$6 F
)$$F G
{%% 	
migrationBuilder&& 
.&& 

DropColumn&& '
(&&' (
name'' 
:'' 
$str''  
,''  !
table(( 
:(( 
$str(( 
)(( 
;((  
migrationBuilder** 
.** 

DropColumn** '
(**' (
name++ 
:++ 
$str++ $
,++$ %
table,, 
:,, 
$str,, 
),, 
;,,  
migrationBuilder.. 
... 

DropColumn.. '
(..' (
name// 
:// 
$str// 
,// 
table00 
:00 
$str00 
)00 
;00  
}11 	
}22 
}33 À©
nC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Migrations\20251112104908_FixOrderRelationships.cs
	namespace 	

CampusEats
 
. 
Backend 
. 

Migrations '
{ 
public		 

partial		 
class		 !
FixOrderRelationships		 .
:		/ 0
	Migration		1 :
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
DropForeignKey +
(+ ,
name 
: 
$str =
,= >
table 
: 
$str ,
), -
;- .
migrationBuilder 
. 
	DropIndex &
(& '
name 
: 
$str +
,+ ,
table 
: 
$str !
)! "
;" #
migrationBuilder 
. 
	DropIndex &
(& '
name 
: 
$str +
,+ ,
table 
: 
$str 
)  
;  !
migrationBuilder 
. 
	DropIndex &
(& '
name 
: 
$str (
,( )
table 
: 
$str 
)  
;  !
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str #
,# $
table   
:   
$str   
)    
;    !
migrationBuilder"" 
."" 

DropColumn"" '
(""' (
name## 
:## 
$str## "
,##" #
table$$ 
:$$ 
$str$$ 
)$$  
;$$  !
migrationBuilder&& 
.&& 
RenameColumn&& )
(&&) *
name'' 
:'' 
$str'' 
,''  
table(( 
:(( 
$str(( 
,((  
newName)) 
:)) 
$str)) $
)))$ %
;))% &
migrationBuilder++ 
.++ 
RenameColumn++ )
(++) *
name,, 
:,, 
$str,, !
,,,! "
table-- 
:-- 
$str-- 
,--  
newName.. 
:.. 
$str.. "
).." #
;..# $
migrationBuilder00 
.00 
RenameColumn00 )
(00) *
name11 
:11 
$str11 *
,11* +
table22 
:22 
$str22 
,22  
newName33 
:33 
$str33  
)33  !
;33! "
migrationBuilder55 
.55 
AlterColumn55 (
<55( )
decimal55) 0
>550 1
(551 2
name66 
:66 
$str66 #
,66# $
table77 
:77 
$str77 
,77  
type88 
:88 
$str88 %
,88% &
nullable99 
:99 
false99 
,99  

oldClrType:: 
::: 
typeof:: "
(::" #
decimal::# *
)::* +
,::+ ,
oldType;; 
:;; 
$str;; (
);;( )
;;;) *
migrationBuilder== 
.== 
AlterColumn== (
<==( )
string==) /
>==/ 0
(==0 1
name>> 
:>> 
$str>> 
,>> 
table?? 
:?? 
$str?? 
,??  
type@@ 
:@@ 
$str@@ -
,@@- .
	maxLengthAA 
:AA 
$numAA 
,AA 
nullableBB 
:BB 
falseBB 
,BB  

oldClrTypeCC 
:CC 
typeofCC "
(CC" #
stringCC# )
)CC) *
,CC* +
oldTypeDD 
:DD 
$strDD 
)DD  
;DD  !
migrationBuilderFF 
.FF 
AlterColumnFF (
<FF( )
DateTimeFF) 1
>FF1 2
(FF2 3
nameGG 
:GG 
$strGG !
,GG! "
tableHH 
:HH 
$strHH 
,HH  
typeII 
:II 
$strII 0
,II0 1
nullableJJ 
:JJ 
falseJJ 
,JJ  

oldClrTypeKK 
:KK 
typeofKK "
(KK" #
DateTimeKK# +
)KK+ ,
,KK, -
oldTypeLL 
:LL 
$strLL 3
,LL3 4
oldDefaultValueSqlMM "
:MM" #
$strMM$ +
)MM+ ,
;MM, -
migrationBuilderOO 
.OO 
	AddColumnOO &
<OO& '
stringOO' -
>OO- .
(OO. /
namePP 
:PP 
$strPP %
,PP% &
tableQQ 
:QQ 
$strQQ 
,QQ  
typeRR 
:RR 
$strRR -
,RR- .
	maxLengthSS 
:SS 
$numSS 
,SS 
nullableTT 
:TT 
trueTT 
)TT 
;TT  
migrationBuilderVV 
.VV 
	AddColumnVV &
<VV& '
stringVV' -
>VV- .
(VV. /
nameWW 
:WW 
$strWW %
,WW% &
tableXX 
:XX 
$strXX 
,XX  
typeYY 
:YY 
$strYY -
,YY- .
	maxLengthZZ 
:ZZ 
$numZZ 
,ZZ 
nullable[[ 
:[[ 
false[[ 
,[[  
defaultValue\\ 
:\\ 
$str\\  
)\\  !
;\\! "
migrationBuilder^^ 
.^^ 
AlterColumn^^ (
<^^( )
decimal^^) 0
>^^0 1
(^^1 2
name__ 
:__ 
$str__ !
,__! "
table`` 
:`` 
$str`` #
,``# $
typeaa 
:aa 
$straa %
,aa% &
nullablebb 
:bb 
falsebb 
,bb  

oldClrTypecc 
:cc 
typeofcc "
(cc" #
decimalcc# *
)cc* +
,cc+ ,
oldTypedd 
:dd 
$strdd (
)dd( )
;dd) *
migrationBuilderff 
.ff 
AlterColumnff (
<ff( )
decimalff) 0
>ff0 1
(ff1 2
namegg 
:gg 
$strgg  
,gg  !
tablehh 
:hh 
$strhh #
,hh# $
typeii 
:ii 
$strii %
,ii% &
nullablejj 
:jj 
falsejj 
,jj  

oldClrTypekk 
:kk 
typeofkk "
(kk" #
decimalkk# *
)kk* +
,kk+ ,
oldTypell 
:ll 
$strll (
)ll( )
;ll) *
migrationBuildernn 
.nn 
AlterColumnnn (
<nn( )
stringnn) /
>nn/ 0
(nn0 1
nameoo 
:oo 
$stroo +
,oo+ ,
tablepp 
:pp 
$strpp #
,pp# $
typeqq 
:qq 
$strqq .
,qq. /
	maxLengthrr 
:rr 
$numrr 
,rr 
nullabless 
:ss 
truess 
,ss 

oldClrTypett 
:tt 
typeoftt "
(tt" #
stringtt# )
)tt) *
,tt* +
oldTypeuu 
:uu 
$struu 1
,uu1 2
oldMaxLengthvv 
:vv 
$numvv !
,vv! "
oldNullableww 
:ww 
trueww !
)ww! "
;ww" #
migrationBuilderyy 
.yy 
	AddColumnyy &
<yy& '
Guidyy' +
>yy+ ,
(yy, -
namezz 
:zz 
$strzz "
,zz" #
table{{ 
:{{ 
$str{{ #
,{{# $
type|| 
:|| 
$str|| 
,|| 
nullable}} 
:}} 
true}} 
)}} 
;}}  
migrationBuilder 
. 
CreateIndex (
(( )
name
€€ 
:
€€ 
$str
€€ +
,
€€+ ,
table
 
:
 
$str
 !
,
! "
column
‚‚ 
:
‚‚ 
$str
‚‚ !
)
‚‚! "
;
‚‚" #
migrationBuilder
„„ 
.
„„ 
CreateIndex
„„ (
(
„„( )
name
…… 
:
…… 
$str
…… )
,
……) *
table
†† 
:
†† 
$str
†† 
,
††  
column
‡‡ 
:
‡‡ 
$str
‡‡ !
)
‡‡! "
;
‡‡" #
migrationBuilder
‰‰ 
.
‰‰ 
CreateIndex
‰‰ (
(
‰‰( )
name
ŠŠ 
:
ŠŠ 
$str
ŠŠ 0
,
ŠŠ0 1
table
‹‹ 
:
‹‹ 
$str
‹‹ #
,
‹‹# $
column
ŒŒ 
:
ŒŒ 
$str
ŒŒ $
)
ŒŒ$ %
;
ŒŒ% &
migrationBuilder
 
.
 
AddForeignKey
 *
(
* +
name
 
:
 
$str
 =
,
= >
table
 
:
 
$str
 ,
,
, -
column
‘‘ 
:
‘‘ 
$str
‘‘ !
,
‘‘! "
principalTable
’’ 
:
’’ 
$str
’’  (
,
’’( )
principalColumn
““ 
:
““  
$str
““! %
)
““% &
;
““& '
migrationBuilder
•• 
.
•• 
AddForeignKey
•• *
(
••* +
name
–– 
:
–– 
$str
–– 9
,
––9 :
table
—— 
:
—— 
$str
—— #
,
——# $
column
˜˜ 
:
˜˜ 
$str
˜˜ $
,
˜˜$ %
principalTable
™™ 
:
™™ 
$str
™™  *
,
™™* +
principalColumn
šš 
:
šš  
$str
šš! %
)
šš% &
;
šš& '
migrationBuilder
œœ 
.
œœ 
AddForeignKey
œœ *
(
œœ* +
name
 
:
 
$str
 /
,
/ 0
table
 
:
 
$str
 
,
  
column
ŸŸ 
:
ŸŸ 
$str
ŸŸ !
,
ŸŸ! "
principalTable
   
:
   
$str
    '
,
  ' (
principalColumn
¡¡ 
:
¡¡  
$str
¡¡! %
)
¡¡% &
;
¡¡& '
}
¢¢ 	
	protected
¥¥ 
override
¥¥ 
void
¥¥ 
Down
¥¥  $
(
¥¥$ %
MigrationBuilder
¥¥% 5
migrationBuilder
¥¥6 F
)
¥¥F G
{
¦¦ 	
migrationBuilder
§§ 
.
§§ 
DropForeignKey
§§ +
(
§§+ ,
name
¨¨ 
:
¨¨ 
$str
¨¨ =
,
¨¨= >
table
©© 
:
©© 
$str
©© ,
)
©©, -
;
©©- .
migrationBuilder
«« 
.
«« 
DropForeignKey
«« +
(
««+ ,
name
¬¬ 
:
¬¬ 
$str
¬¬ 9
,
¬¬9 :
table
­­ 
:
­­ 
$str
­­ #
)
­­# $
;
­­$ %
migrationBuilder
¯¯ 
.
¯¯ 
DropForeignKey
¯¯ +
(
¯¯+ ,
name
°° 
:
°° 
$str
°° /
,
°°/ 0
table
±± 
:
±± 
$str
±± 
)
±±  
;
±±  !
migrationBuilder
³³ 
.
³³ 
	DropIndex
³³ &
(
³³& '
name
´´ 
:
´´ 
$str
´´ +
,
´´+ ,
table
µµ 
:
µµ 
$str
µµ !
)
µµ! "
;
µµ" #
migrationBuilder
·· 
.
·· 
	DropIndex
·· &
(
··& '
name
¸¸ 
:
¸¸ 
$str
¸¸ )
,
¸¸) *
table
¹¹ 
:
¹¹ 
$str
¹¹ 
)
¹¹  
;
¹¹  !
migrationBuilder
»» 
.
»» 
	DropIndex
»» &
(
»»& '
name
¼¼ 
:
¼¼ 
$str
¼¼ 0
,
¼¼0 1
table
½½ 
:
½½ 
$str
½½ #
)
½½# $
;
½½$ %
migrationBuilder
¿¿ 
.
¿¿ 

DropColumn
¿¿ '
(
¿¿' (
name
ÀÀ 
:
ÀÀ 
$str
ÀÀ %
,
ÀÀ% &
table
ÁÁ 
:
ÁÁ 
$str
ÁÁ 
)
ÁÁ  
;
ÁÁ  !
migrationBuilder
ÃÃ 
.
ÃÃ 

DropColumn
ÃÃ '
(
ÃÃ' (
name
ÄÄ 
:
ÄÄ 
$str
ÄÄ %
,
ÄÄ% &
table
ÅÅ 
:
ÅÅ 
$str
ÅÅ 
)
ÅÅ  
;
ÅÅ  !
migrationBuilder
ÇÇ 
.
ÇÇ 

DropColumn
ÇÇ '
(
ÇÇ' (
name
ÈÈ 
:
ÈÈ 
$str
ÈÈ "
,
ÈÈ" #
table
ÉÉ 
:
ÉÉ 
$str
ÉÉ #
)
ÉÉ# $
;
ÉÉ$ %
migrationBuilder
ËË 
.
ËË 
RenameColumn
ËË )
(
ËË) *
name
ÌÌ 
:
ÌÌ 
$str
ÌÌ 
,
ÌÌ  
table
ÍÍ 
:
ÍÍ 
$str
ÍÍ 
,
ÍÍ  
newName
ÎÎ 
:
ÎÎ 
$str
ÎÎ $
)
ÎÎ$ %
;
ÎÎ% &
migrationBuilder
ĞĞ 
.
ĞĞ 
RenameColumn
ĞĞ )
(
ĞĞ) *
name
ÑÑ 
:
ÑÑ 
$str
ÑÑ !
,
ÑÑ! "
table
ÒÒ 
:
ÒÒ 
$str
ÒÒ 
,
ÒÒ  
newName
ÓÓ 
:
ÓÓ 
$str
ÓÓ "
)
ÓÓ" #
;
ÓÓ# $
migrationBuilder
ÕÕ 
.
ÕÕ 
RenameColumn
ÕÕ )
(
ÕÕ) *
name
ÖÖ 
:
ÖÖ 
$str
ÖÖ 
,
ÖÖ 
table
×× 
:
×× 
$str
×× 
,
××  
newName
ØØ 
:
ØØ 
$str
ØØ -
)
ØØ- .
;
ØØ. /
migrationBuilder
ÚÚ 
.
ÚÚ 
AlterColumn
ÚÚ (
<
ÚÚ( )
decimal
ÚÚ) 0
>
ÚÚ0 1
(
ÚÚ1 2
name
ÛÛ 
:
ÛÛ 
$str
ÛÛ #
,
ÛÛ# $
table
ÜÜ 
:
ÜÜ 
$str
ÜÜ 
,
ÜÜ  
type
İİ 
:
İİ 
$str
İİ %
,
İİ% &
nullable
ŞŞ 
:
ŞŞ 
false
ŞŞ 
,
ŞŞ  

oldClrType
ßß 
:
ßß 
typeof
ßß "
(
ßß" #
decimal
ßß# *
)
ßß* +
,
ßß+ ,
oldType
àà 
:
àà 
$str
àà (
)
àà( )
;
àà) *
migrationBuilder
ââ 
.
ââ 
AlterColumn
ââ (
<
ââ( )
string
ââ) /
>
ââ/ 0
(
ââ0 1
name
ãã 
:
ãã 
$str
ãã 
,
ãã 
table
ää 
:
ää 
$str
ää 
,
ää  
type
åå 
:
åå 
$str
åå 
,
åå 
nullable
ææ 
:
ææ 
false
ææ 
,
ææ  

oldClrType
çç 
:
çç 
typeof
çç "
(
çç" #
string
çç# )
)
çç) *
,
çç* +
oldType
èè 
:
èè 
$str
èè 0
,
èè0 1
oldMaxLength
éé 
:
éé 
$num
éé  
)
éé  !
;
éé! "
migrationBuilder
ëë 
.
ëë 
AlterColumn
ëë (
<
ëë( )
DateTime
ëë) 1
>
ëë1 2
(
ëë2 3
name
ìì 
:
ìì 
$str
ìì !
,
ìì! "
table
íí 
:
íí 
$str
íí 
,
íí  
type
îî 
:
îî 
$str
îî 0
,
îî0 1
nullable
ïï 
:
ïï 
false
ïï 
,
ïï  
defaultValueSql
ğğ 
:
ğğ  
$str
ğğ! (
,
ğğ( )

oldClrType
ññ 
:
ññ 
typeof
ññ "
(
ññ" #
DateTime
ññ# +
)
ññ+ ,
,
ññ, -
oldType
òò 
:
òò 
$str
òò 3
)
òò3 4
;
òò4 5
migrationBuilder
ôô 
.
ôô 
	AddColumn
ôô &
<
ôô& '
DateTime
ôô' /
>
ôô/ 0
(
ôô0 1
name
õõ 
:
õõ 
$str
õõ #
,
õõ# $
table
öö 
:
öö 
$str
öö 
,
öö  
type
÷÷ 
:
÷÷ 
$str
÷÷ 0
,
÷÷0 1
nullable
øø 
:
øø 
true
øø 
)
øø 
;
øø  
migrationBuilder
úú 
.
úú 
	AddColumn
úú &
<
úú& '
DateTime
úú' /
>
úú/ 0
(
úú0 1
name
ûû 
:
ûû 
$str
ûû "
,
ûû" #
table
üü 
:
üü 
$str
üü 
,
üü  
type
ıı 
:
ıı 
$str
ıı 0
,
ıı0 1
nullable
şş 
:
şş 
true
şş 
)
şş 
;
şş  
migrationBuilder
€€ 
.
€€ 
AlterColumn
€€ (
<
€€( )
decimal
€€) 0
>
€€0 1
(
€€1 2
name
 
:
 
$str
 !
,
! "
table
‚‚ 
:
‚‚ 
$str
‚‚ #
,
‚‚# $
type
ƒƒ 
:
ƒƒ 
$str
ƒƒ %
,
ƒƒ% &
nullable
„„ 
:
„„ 
false
„„ 
,
„„  

oldClrType
…… 
:
…… 
typeof
…… "
(
……" #
decimal
……# *
)
……* +
,
……+ ,
oldType
†† 
:
†† 
$str
†† (
)
††( )
;
††) *
migrationBuilder
ˆˆ 
.
ˆˆ 
AlterColumn
ˆˆ (
<
ˆˆ( )
decimal
ˆˆ) 0
>
ˆˆ0 1
(
ˆˆ1 2
name
‰‰ 
:
‰‰ 
$str
‰‰  
,
‰‰  !
table
ŠŠ 
:
ŠŠ 
$str
ŠŠ #
,
ŠŠ# $
type
‹‹ 
:
‹‹ 
$str
‹‹ %
,
‹‹% &
nullable
ŒŒ 
:
ŒŒ 
false
ŒŒ 
,
ŒŒ  

oldClrType
 
:
 
typeof
 "
(
" #
decimal
# *
)
* +
,
+ ,
oldType
 
:
 
$str
 (
)
( )
;
) *
migrationBuilder
 
.
 
AlterColumn
 (
<
( )
string
) /
>
/ 0
(
0 1
name
‘‘ 
:
‘‘ 
$str
‘‘ +
,
‘‘+ ,
table
’’ 
:
’’ 
$str
’’ #
,
’’# $
type
““ 
:
““ 
$str
““ .
,
““. /
	maxLength
”” 
:
”” 
$num
”” 
,
”” 
nullable
•• 
:
•• 
true
•• 
,
•• 

oldClrType
–– 
:
–– 
typeof
–– "
(
––" #
string
––# )
)
––) *
,
––* +
oldType
—— 
:
—— 
$str
—— 1
,
——1 2
oldMaxLength
˜˜ 
:
˜˜ 
$num
˜˜ !
,
˜˜! "
oldNullable
™™ 
:
™™ 
true
™™ !
)
™™! "
;
™™" #
migrationBuilder
›› 
.
›› 
CreateIndex
›› (
(
››( )
name
œœ 
:
œœ 
$str
œœ +
,
œœ+ ,
table
 
:
 
$str
 !
,
! "
column
 
:
 
$str
 !
,
! "
unique
ŸŸ 
:
ŸŸ 
true
ŸŸ 
)
ŸŸ 
;
ŸŸ 
migrationBuilder
¡¡ 
.
¡¡ 
CreateIndex
¡¡ (
(
¡¡( )
name
¢¢ 
:
¢¢ 
$str
¢¢ +
,
¢¢+ ,
table
££ 
:
££ 
$str
££ 
,
££  
column
¤¤ 
:
¤¤ 
$str
¤¤ #
)
¤¤# $
;
¤¤$ %
migrationBuilder
¦¦ 
.
¦¦ 
CreateIndex
¦¦ (
(
¦¦( )
name
§§ 
:
§§ 
$str
§§ (
,
§§( )
table
¨¨ 
:
¨¨ 
$str
¨¨ 
,
¨¨  
column
©© 
:
©© 
$str
©©  
)
©©  !
;
©©! "
migrationBuilder
«« 
.
«« 
AddForeignKey
«« *
(
««* +
name
¬¬ 
:
¬¬ 
$str
¬¬ =
,
¬¬= >
table
­­ 
:
­­ 
$str
­­ ,
,
­­, -
column
®® 
:
®® 
$str
®® !
,
®®! "
principalTable
¯¯ 
:
¯¯ 
$str
¯¯  (
,
¯¯( )
principalColumn
°° 
:
°°  
$str
°°! %
,
°°% &
onDelete
±± 
:
±± 
ReferentialAction
±± +
.
±±+ ,
SetNull
±±, 3
)
±±3 4
;
±±4 5
}
²² 	
}
³³ 
}´´ Á‰
fC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Migrations\20251106214039_InitialCreate.cs
	namespace 	

CampusEats
 
. 
Backend 
. 

Migrations '
{ 
public

 

partial

 
class

 
InitialCreate

 &
:

' (
	Migration

) 2
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str  
,  !
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
Guid& *
>* +
(+ ,
type, 0
:0 1
$str2 8
,8 9
nullable: B
:B C
falseD I
)I J
,J K
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 N
,N O
	maxLengthP Y
:Y Z
$num[ ^
,^ _
nullable` h
:h i
falsej o
)o p
,p q
Description 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= U
,U V
	maxLengthW `
:` a
$numb e
,e f
nullableg o
:o p
falseq v
)v w
,w x
Price 
= 
table !
.! "
Column" (
<( )
decimal) 0
>0 1
(1 2
type2 6
:6 7
$str8 G
,G H
nullableI Q
:Q R
falseS X
)X Y
,Y Z
Category 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: Q
,Q R
	maxLengthS \
:\ ]
$num^ `
,` a
nullableb j
:j k
falsel q
)q r
,r s
ImageUrl 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: R
,R S
	maxLengthT ]
:] ^
$num_ b
,b c
nullabled l
:l m
truen r
)r s
,s t
	Allergens 
= 
table  %
.% &
Column& ,
<, -
List- 1
<1 2
string2 8
>8 9
>9 :
(: ;
type; ?
:? @
$strA H
,H I
nullableJ R
:R S
falseT Y
,Y Z
defaultValueSql[ j
:j k
$strl y
)y z
,z {
DietaryRestrictions '
=( )
table* /
./ 0
Column0 6
<6 7
string7 =
>= >
(> ?
type? C
:C D
$strE ]
,] ^
	maxLength_ h
:h i
$numj m
,m n
nullableo w
:w x
truey }
)} ~
,~ 
IsAvailable 
=  !
table" '
.' (
Column( .
<. /
bool/ 3
>3 4
(4 5
type5 9
:9 :
$str; D
,D E
nullableF N
:N O
falseP U
,U V
defaultValueW c
:c d
truee i
)i j
,j k
	CreatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= W
,W X
nullableY a
:a b
falsec h
,h i
defaultValueSqlj y
:y z
$str	{ ‚
)
‚ ƒ
,
ƒ „
	UpdatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= W
,W X
nullableY a
:a b
truec g
)g h
} 
, 
constraints 
: 
table "
=># %
{   
table!! 
.!! 

PrimaryKey!! $
(!!$ %
$str!!% 2
,!!2 3
x!!4 5
=>!!6 8
x!!9 :
.!!: ;
Id!!; =
)!!= >
;!!> ?
}"" 
)"" 
;"" 
migrationBuilder$$ 
.$$ 
CreateTable$$ (
($$( )
name%% 
:%% 
$str%% 
,%% 
columns&& 
:&& 
table&& 
=>&& !
new&&" %
{'' 
Id(( 
=(( 
table(( 
.(( 
Column(( %
<((% &
Guid((& *
>((* +
(((+ ,
type((, 0
:((0 1
$str((2 8
,((8 9
nullable((: B
:((B C
false((D I
)((I J
,((J K
Email)) 
=)) 
table)) !
.))! "
Column))" (
<))( )
string))) /
>))/ 0
())0 1
type))1 5
:))5 6
$str))7 O
,))O P
	maxLength))Q Z
:))Z [
$num))\ _
,))_ `
nullable))a i
:))i j
false))k p
)))p q
,))q r
FullName** 
=** 
table** $
.**$ %
Column**% +
<**+ ,
string**, 2
>**2 3
(**3 4
type**4 8
:**8 9
$str**: R
,**R S
	maxLength**T ]
:**] ^
$num**_ b
,**b c
nullable**d l
:**l m
false**n s
)**s t
,**t u
PhoneNumber++ 
=++  !
table++" '
.++' (
Column++( .
<++. /
string++/ 5
>++5 6
(++6 7
type++7 ;
:++; <
$str++= T
,++T U
	maxLength++V _
:++_ `
$num++a c
,++c d
nullable++e m
:++m n
false++o t
)++t u
,++u v
	StudentId,, 
=,, 
table,,  %
.,,% &
Column,,& ,
<,,, -
string,,- 3
>,,3 4
(,,4 5
type,,5 9
:,,9 :
$str,,; R
,,,R S
	maxLength,,T ]
:,,] ^
$num,,_ a
,,,a b
nullable,,c k
:,,k l
true,,m q
),,q r
,,,r s
LoyaltyPoints-- !
=--" #
table--$ )
.--) *
Column--* 0
<--0 1
int--1 4
>--4 5
(--5 6
type--6 :
:--: ;
$str--< E
,--E F
nullable--G O
:--O P
false--Q V
,--V W
defaultValue--X d
:--d e
$num--f g
)--g h
,--h i
	CreatedAt.. 
=.. 
table..  %
...% &
Column..& ,
<.., -
DateTime..- 5
>..5 6
(..6 7
type..7 ;
:..; <
$str..= W
,..W X
nullable..Y a
:..a b
false..c h
,..h i
defaultValueSql..j y
:..y z
$str	..{ ‚
)
..‚ ƒ
,
..ƒ „
	UpdatedAt// 
=// 
table//  %
.//% &
Column//& ,
<//, -
DateTime//- 5
>//5 6
(//6 7
type//7 ;
://; <
$str//= W
,//W X
nullable//Y a
://a b
true//c g
)//g h
}00 
,00 
constraints11 
:11 
table11 "
=>11# %
{22 
table33 
.33 

PrimaryKey33 $
(33$ %
$str33% /
,33/ 0
x331 2
=>333 5
x336 7
.337 8
Id338 :
)33: ;
;33; <
}44 
)44 
;44 
migrationBuilder66 
.66 
CreateTable66 (
(66( )
name77 
:77 
$str77 
,77 
columns88 
:88 
table88 
=>88 !
new88" %
{99 
Id:: 
=:: 
table:: 
.:: 
Column:: %
<::% &
Guid::& *
>::* +
(::+ ,
type::, 0
:::0 1
$str::2 8
,::8 9
nullable::: B
:::B C
false::D I
)::I J
,::J K
OrderNumber;; 
=;;  !
table;;" '
.;;' (
Column;;( .
<;;. /
string;;/ 5
>;;5 6
(;;6 7
type;;7 ;
:;;; <
$str;;= T
,;;T U
	maxLength;;V _
:;;_ `
$num;;a c
,;;c d
nullable;;e m
:;;m n
false;;o t
);;t u
,;;u v
UserId<< 
=<< 
table<< "
.<<" #
Column<<# )
<<<) *
Guid<<* .
><<. /
(<</ 0
type<<0 4
:<<4 5
$str<<6 <
,<<< =
nullable<<> F
:<<F G
false<<H M
)<<M N
,<<N O
TotalAmount== 
===  !
table==" '
.==' (
Column==( .
<==. /
decimal==/ 6
>==6 7
(==7 8
type==8 <
:==< =
$str==> M
,==M N
nullable==O W
:==W X
false==Y ^
)==^ _
,==_ `
Status>> 
=>> 
table>> "
.>>" #
Column>># )
<>>) *
string>>* 0
>>>0 1
(>>1 2
type>>2 6
:>>6 7
$str>>8 >
,>>> ?
nullable>>@ H
:>>H I
false>>J O
)>>O P
,>>P Q

PreparedAt?? 
=??  
table??! &
.??& '
Column??' -
<??- .
DateTime??. 6
>??6 7
(??7 8
type??8 <
:??< =
$str??> X
,??X Y
nullable??Z b
:??b c
true??d h
)??h i
,??i j
ReadyAt@@ 
=@@ 
table@@ #
.@@# $
Column@@$ *
<@@* +
DateTime@@+ 3
>@@3 4
(@@4 5
type@@5 9
:@@9 :
$str@@; U
,@@U V
nullable@@W _
:@@_ `
true@@a e
)@@e f
,@@f g
CompletedAtAA 
=AA  !
tableAA" '
.AA' (
ColumnAA( .
<AA. /
DateTimeAA/ 7
>AA7 8
(AA8 9
typeAA9 =
:AA= >
$strAA? Y
,AAY Z
nullableAA[ c
:AAc d
trueAAe i
)AAi j
,AAj k
	CreatedAtBB 
=BB 
tableBB  %
.BB% &
ColumnBB& ,
<BB, -
DateTimeBB- 5
>BB5 6
(BB6 7
typeBB7 ;
:BB; <
$strBB= W
,BBW X
nullableBBY a
:BBa b
falseBBc h
,BBh i
defaultValueSqlBBj y
:BBy z
$str	BB{ ‚
)
BB‚ ƒ
,
BBƒ „
CancelledAtCC 
=CC  !
tableCC" '
.CC' (
ColumnCC( .
<CC. /
DateTimeCC/ 7
>CC7 8
(CC8 9
typeCC9 =
:CC= >
$strCC? Y
,CCY Z
nullableCC[ c
:CCc d
trueCCe i
)CCi j
,CCj k
CancellationReasonDD &
=DD' (
tableDD) .
.DD. /
ColumnDD/ 5
<DD5 6
stringDD6 <
>DD< =
(DD= >
typeDD> B
:DDB C
$strDDD \
,DD\ ]
	maxLengthDD^ g
:DDg h
$numDDi l
,DDl m
nullableDDn v
:DDv w
trueDDx |
)DD| }
,DD} ~
	PaymentIdEE 
=EE 
tableEE  %
.EE% &
ColumnEE& ,
<EE, -
GuidEE- 1
>EE1 2
(EE2 3
typeEE3 7
:EE7 8
$strEE9 ?
,EE? @
nullableEEA I
:EEI J
trueEEK O
)EEO P
}FF 
,FF 
constraintsGG 
:GG 
tableGG "
=>GG# %
{HH 
tableII 
.II 

PrimaryKeyII $
(II$ %
$strII% 0
,II0 1
xII2 3
=>II4 6
xII7 8
.II8 9
IdII9 ;
)II; <
;II< =
tableJJ 
.JJ 

ForeignKeyJJ $
(JJ$ %
nameKK 
:KK 
$strKK 6
,KK6 7
columnLL 
:LL 
xLL  !
=>LL" $
xLL% &
.LL& '
UserIdLL' -
,LL- .
principalTableMM &
:MM& '
$strMM( /
,MM/ 0
principalColumnNN '
:NN' (
$strNN) -
,NN- .
onDeleteOO  
:OO  !
ReferentialActionOO" 3
.OO3 4
RestrictOO4 <
)OO< =
;OO= >
}PP 
)PP 
;PP 
migrationBuilderRR 
.RR 
CreateTableRR (
(RR( )
nameSS 
:SS 
$strSS +
,SS+ ,
columnsTT 
:TT 
tableTT 
=>TT !
newTT" %
{UU 
IdVV 
=VV 
tableVV 
.VV 
ColumnVV %
<VV% &
GuidVV& *
>VV* +
(VV+ ,
typeVV, 0
:VV0 1
$strVV2 8
,VV8 9
nullableVV: B
:VVB C
falseVVD I
)VVI J
,VVJ K
UserIdWW 
=WW 
tableWW "
.WW" #
ColumnWW# )
<WW) *
GuidWW* .
>WW. /
(WW/ 0
typeWW0 4
:WW4 5
$strWW6 <
,WW< =
nullableWW> F
:WWF G
falseWWH M
)WWM N
,WWN O
PointsChangeXX  
=XX! "
tableXX# (
.XX( )
ColumnXX) /
<XX/ 0
intXX0 3
>XX3 4
(XX4 5
typeXX5 9
:XX9 :
$strXX; D
,XXD E
nullableXXF N
:XXN O
falseXXP U
)XXU V
,XXV W
TypeYY 
=YY 
tableYY  
.YY  !
ColumnYY! '
<YY' (
stringYY( .
>YY. /
(YY/ 0
typeYY0 4
:YY4 5
$strYY6 <
,YY< =
nullableYY> F
:YYF G
falseYYH M
)YYM N
,YYN O
DescriptionZZ 
=ZZ  !
tableZZ" '
.ZZ' (
ColumnZZ( .
<ZZ. /
stringZZ/ 5
>ZZ5 6
(ZZ6 7
typeZZ7 ;
:ZZ; <
$strZZ= U
,ZZU V
	maxLengthZZW `
:ZZ` a
$numZZb e
,ZZe f
nullableZZg o
:ZZo p
falseZZq v
)ZZv w
,ZZw x
OrderId[[ 
=[[ 
table[[ #
.[[# $
Column[[$ *
<[[* +
Guid[[+ /
>[[/ 0
([[0 1
type[[1 5
:[[5 6
$str[[7 =
,[[= >
nullable[[? G
:[[G H
true[[I M
)[[M N
,[[N O
	CreatedAt\\ 
=\\ 
table\\  %
.\\% &
Column\\& ,
<\\, -
DateTime\\- 5
>\\5 6
(\\6 7
type\\7 ;
:\\; <
$str\\= W
,\\W X
nullable\\Y a
:\\a b
false\\c h
,\\h i
defaultValueSql\\j y
:\\y z
$str	\\{ ‚
)
\\‚ ƒ
}]] 
,]] 
constraints^^ 
:^^ 
table^^ "
=>^^# %
{__ 
table`` 
.`` 

PrimaryKey`` $
(``$ %
$str``% =
,``= >
x``? @
=>``A C
x``D E
.``E F
Id``F H
)``H I
;``I J
tableaa 
.aa 

ForeignKeyaa $
(aa$ %
namebb 
:bb 
$strbb E
,bbE F
columncc 
:cc 
xcc  !
=>cc" $
xcc% &
.cc& '
OrderIdcc' .
,cc. /
principalTabledd &
:dd& '
$strdd( 0
,dd0 1
principalColumnee '
:ee' (
$stree) -
,ee- .
onDeleteff  
:ff  !
ReferentialActionff" 3
.ff3 4
SetNullff4 ;
)ff; <
;ff< =
tablegg 
.gg 

ForeignKeygg $
(gg$ %
namehh 
:hh 
$strhh C
,hhC D
columnii 
:ii 
xii  !
=>ii" $
xii% &
.ii& '
UserIdii' -
,ii- .
principalTablejj &
:jj& '
$strjj( /
,jj/ 0
principalColumnkk '
:kk' (
$strkk) -
,kk- .
onDeletell  
:ll  !
ReferentialActionll" 3
.ll3 4
Restrictll4 <
)ll< =
;ll= >
}mm 
)mm 
;mm 
migrationBuilderoo 
.oo 
CreateTableoo (
(oo( )
namepp 
:pp 
$strpp "
,pp" #
columnsqq 
:qq 
tableqq 
=>qq !
newqq" %
{rr 
Idss 
=ss 
tabless 
.ss 
Columnss %
<ss% &
Guidss& *
>ss* +
(ss+ ,
typess, 0
:ss0 1
$strss2 8
,ss8 9
nullabless: B
:ssB C
falsessD I
)ssI J
,ssJ K
OrderIdtt 
=tt 
tablett #
.tt# $
Columntt$ *
<tt* +
Guidtt+ /
>tt/ 0
(tt0 1
typett1 5
:tt5 6
$strtt7 =
,tt= >
nullablett? G
:ttG H
falsettI N
)ttN O
,ttO P
	ProductIduu 
=uu 
tableuu  %
.uu% &
Columnuu& ,
<uu, -
Guiduu- 1
>uu1 2
(uu2 3
typeuu3 7
:uu7 8
$struu9 ?
,uu? @
nullableuuA I
:uuI J
falseuuK P
)uuP Q
,uuQ R
Quantityvv 
=vv 
tablevv $
.vv$ %
Columnvv% +
<vv+ ,
intvv, /
>vv/ 0
(vv0 1
typevv1 5
:vv5 6
$strvv7 @
,vv@ A
nullablevvB J
:vvJ K
falsevvL Q
)vvQ R
,vvR S
	UnitPriceww 
=ww 
tableww  %
.ww% &
Columnww& ,
<ww, -
decimalww- 4
>ww4 5
(ww5 6
typeww6 :
:ww: ;
$strww< K
,wwK L
nullablewwM U
:wwU V
falsewwW \
)ww\ ]
,ww] ^
Subtotalxx 
=xx 
tablexx $
.xx$ %
Columnxx% +
<xx+ ,
decimalxx, 3
>xx3 4
(xx4 5
typexx5 9
:xx9 :
$strxx; J
,xxJ K
nullablexxL T
:xxT U
falsexxV [
)xx[ \
,xx\ ]
SpecialInstructionsyy '
=yy( )
tableyy* /
.yy/ 0
Columnyy0 6
<yy6 7
stringyy7 =
>yy= >
(yy> ?
typeyy? C
:yyC D
$stryyE ]
,yy] ^
	maxLengthyy_ h
:yyh i
$numyyj m
,yym n
nullableyyo w
:yyw x
trueyyy }
)yy} ~
}zz 
,zz 
constraints{{ 
:{{ 
table{{ "
=>{{# %
{|| 
table}} 
.}} 

PrimaryKey}} $
(}}$ %
$str}}% 4
,}}4 5
x}}6 7
=>}}8 :
x}}; <
.}}< =
Id}}= ?
)}}? @
;}}@ A
table~~ 
.~~ 

ForeignKey~~ $
(~~$ %
name 
: 
$str <
,< =
column
€€ 
:
€€ 
x
€€  !
=>
€€" $
x
€€% &
.
€€& '
OrderId
€€' .
,
€€. /
principalTable
 &
:
& '
$str
( 0
,
0 1
principalColumn
‚‚ '
:
‚‚' (
$str
‚‚) -
,
‚‚- .
onDelete
ƒƒ  
:
ƒƒ  !
ReferentialAction
ƒƒ" 3
.
ƒƒ3 4
Cascade
ƒƒ4 ;
)
ƒƒ; <
;
ƒƒ< =
table
„„ 
.
„„ 

ForeignKey
„„ $
(
„„$ %
name
…… 
:
…… 
$str
…… @
,
……@ A
column
†† 
:
†† 
x
††  !
=>
††" $
x
††% &
.
††& '
	ProductId
††' 0
,
††0 1
principalTable
‡‡ &
:
‡‡& '
$str
‡‡( 2
,
‡‡2 3
principalColumn
ˆˆ '
:
ˆˆ' (
$str
ˆˆ) -
,
ˆˆ- .
onDelete
‰‰  
:
‰‰  !
ReferentialAction
‰‰" 3
.
‰‰3 4
Restrict
‰‰4 <
)
‰‰< =
;
‰‰= >
}
ŠŠ 
)
ŠŠ 
;
ŠŠ 
migrationBuilder
ŒŒ 
.
ŒŒ 
CreateTable
ŒŒ (
(
ŒŒ( )
name
 
:
 
$str
  
,
  !
columns
 
:
 
table
 
=>
 !
new
" %
{
 
Id
 
=
 
table
 
.
 
Column
 %
<
% &
Guid
& *
>
* +
(
+ ,
type
, 0
:
0 1
$str
2 8
,
8 9
nullable
: B
:
B C
false
D I
)
I J
,
J K
OrderId
‘‘ 
=
‘‘ 
table
‘‘ #
.
‘‘# $
Column
‘‘$ *
<
‘‘* +
Guid
‘‘+ /
>
‘‘/ 0
(
‘‘0 1
type
‘‘1 5
:
‘‘5 6
$str
‘‘7 =
,
‘‘= >
nullable
‘‘? G
:
‘‘G H
false
‘‘I N
)
‘‘N O
,
‘‘O P
Amount
’’ 
=
’’ 
table
’’ "
.
’’" #
Column
’’# )
<
’’) *
decimal
’’* 1
>
’’1 2
(
’’2 3
type
’’3 7
:
’’7 8
$str
’’9 H
,
’’H I
nullable
’’J R
:
’’R S
false
’’T Y
)
’’Y Z
,
’’Z [
Status
““ 
=
““ 
table
““ "
.
““" #
Column
““# )
<
““) *
string
““* 0
>
““0 1
(
““1 2
type
““2 6
:
““6 7
$str
““8 >
,
““> ?
nullable
““@ H
:
““H I
false
““J O
)
““O P
,
““P Q
Method
”” 
=
”” 
table
”” "
.
””" #
Column
””# )
<
””) *
string
””* 0
>
””0 1
(
””1 2
type
””2 6
:
””6 7
$str
””8 >
,
””> ?
nullable
””@ H
:
””H I
false
””J O
)
””O P
,
””P Q#
StripePaymentIntentId
•• )
=
••* +
table
••, 1
.
••1 2
Column
••2 8
<
••8 9
string
••9 ?
>
••? @
(
••@ A
type
••A E
:
••E F
$str
••G _
,
••_ `
	maxLength
••a j
:
••j k
$num
••l o
,
••o p
nullable
••q y
:
••y z
true
••{ 
)•• €
,••€ 
StripeSessionId
–– #
=
––$ %
table
––& +
.
––+ ,
Column
––, 2
<
––2 3
string
––3 9
>
––9 :
(
––: ;
type
––; ?
:
––? @
$str
––A Y
,
––Y Z
	maxLength
––[ d
:
––d e
$num
––f i
,
––i j
nullable
––k s
:
––s t
true
––u y
)
––y z
,
––z {
	CreatedAt
—— 
=
—— 
table
——  %
.
——% &
Column
——& ,
<
——, -
DateTime
——- 5
>
——5 6
(
——6 7
type
——7 ;
:
——; <
$str
——= W
,
——W X
nullable
——Y a
:
——a b
false
——c h
,
——h i
defaultValueSql
——j y
:
——y z
$str——{ ‚
)——‚ ƒ
,——ƒ „
PaidAt
˜˜ 
=
˜˜ 
table
˜˜ "
.
˜˜" #
Column
˜˜# )
<
˜˜) *
DateTime
˜˜* 2
>
˜˜2 3
(
˜˜3 4
type
˜˜4 8
:
˜˜8 9
$str
˜˜: T
,
˜˜T U
nullable
˜˜V ^
:
˜˜^ _
true
˜˜` d
)
˜˜d e
,
˜˜e f
FailedAt
™™ 
=
™™ 
table
™™ $
.
™™$ %
Column
™™% +
<
™™+ ,
DateTime
™™, 4
>
™™4 5
(
™™5 6
type
™™6 :
:
™™: ;
$str
™™< V
,
™™V W
nullable
™™X `
:
™™` a
true
™™b f
)
™™f g
,
™™g h
FailureReason
šš !
=
šš" #
table
šš$ )
.
šš) *
Column
šš* 0
<
šš0 1
string
šš1 7
>
šš7 8
(
šš8 9
type
šš9 =
:
šš= >
$str
šš? W
,
ššW X
	maxLength
ššY b
:
ššb c
$num
ššd g
,
ššg h
nullable
šši q
:
ššq r
true
ššs w
)
ššw x
}
›› 
,
›› 
constraints
œœ 
:
œœ 
table
œœ "
=>
œœ# %
{
 
table
 
.
 

PrimaryKey
 $
(
$ %
$str
% 2
,
2 3
x
4 5
=>
6 8
x
9 :
.
: ;
Id
; =
)
= >
;
> ?
table
ŸŸ 
.
ŸŸ 

ForeignKey
ŸŸ $
(
ŸŸ$ %
name
   
:
   
$str
   :
,
  : ;
column
¡¡ 
:
¡¡ 
x
¡¡  !
=>
¡¡" $
x
¡¡% &
.
¡¡& '
OrderId
¡¡' .
,
¡¡. /
principalTable
¢¢ &
:
¢¢& '
$str
¢¢( 0
,
¢¢0 1
principalColumn
££ '
:
££' (
$str
££) -
,
££- .
onDelete
¤¤  
:
¤¤  !
ReferentialAction
¤¤" 3
.
¤¤3 4
Cascade
¤¤4 ;
)
¤¤; <
;
¤¤< =
}
¥¥ 
)
¥¥ 
;
¥¥ 
migrationBuilder
§§ 
.
§§ 
CreateIndex
§§ (
(
§§( )
name
¨¨ 
:
¨¨ 
$str
¨¨ 8
,
¨¨8 9
table
©© 
:
©© 
$str
©© ,
,
©©, -
column
ªª 
:
ªª 
$str
ªª #
)
ªª# $
;
ªª$ %
migrationBuilder
¬¬ 
.
¬¬ 
CreateIndex
¬¬ (
(
¬¬( )
name
­­ 
:
­­ 
$str
­­ 6
,
­­6 7
table
®® 
:
®® 
$str
®® ,
,
®®, -
column
¯¯ 
:
¯¯ 
$str
¯¯ !
)
¯¯! "
;
¯¯" #
migrationBuilder
±± 
.
±± 
CreateIndex
±± (
(
±±( )
name
²² 
:
²² 
$str
²² 5
,
²²5 6
table
³³ 
:
³³ 
$str
³³ ,
,
³³, -
column
´´ 
:
´´ 
$str
´´  
)
´´  !
;
´´! "
migrationBuilder
¶¶ 
.
¶¶ 
CreateIndex
¶¶ (
(
¶¶( )
name
·· 
:
·· 
$str
·· -
,
··- .
table
¸¸ 
:
¸¸ 
$str
¸¸ #
,
¸¸# $
column
¹¹ 
:
¹¹ 
$str
¹¹ !
)
¹¹! "
;
¹¹" #
migrationBuilder
»» 
.
»» 
CreateIndex
»» (
(
»»( )
name
¼¼ 
:
¼¼ 
$str
¼¼ /
,
¼¼/ 0
table
½½ 
:
½½ 
$str
½½ #
,
½½# $
column
¾¾ 
:
¾¾ 
$str
¾¾ #
)
¾¾# $
;
¾¾$ %
migrationBuilder
ÀÀ 
.
ÀÀ 
CreateIndex
ÀÀ (
(
ÀÀ( )
name
ÁÁ 
:
ÁÁ 
$str
ÁÁ +
,
ÁÁ+ ,
table
ÂÂ 
:
ÂÂ 
$str
ÂÂ 
,
ÂÂ  
column
ÃÃ 
:
ÃÃ 
$str
ÃÃ #
)
ÃÃ# $
;
ÃÃ$ %
migrationBuilder
ÅÅ 
.
ÅÅ 
CreateIndex
ÅÅ (
(
ÅÅ( )
name
ÆÆ 
:
ÆÆ 
$str
ÆÆ -
,
ÆÆ- .
table
ÇÇ 
:
ÇÇ 
$str
ÇÇ 
,
ÇÇ  
column
ÈÈ 
:
ÈÈ 
$str
ÈÈ %
,
ÈÈ% &
unique
ÉÉ 
:
ÉÉ 
true
ÉÉ 
)
ÉÉ 
;
ÉÉ 
migrationBuilder
ËË 
.
ËË 
CreateIndex
ËË (
(
ËË( )
name
ÌÌ 
:
ÌÌ 
$str
ÌÌ (
,
ÌÌ( )
table
ÍÍ 
:
ÍÍ 
$str
ÍÍ 
,
ÍÍ  
column
ÎÎ 
:
ÎÎ 
$str
ÎÎ  
)
ÎÎ  !
;
ÎÎ! "
migrationBuilder
ĞĞ 
.
ĞĞ 
CreateIndex
ĞĞ (
(
ĞĞ( )
name
ÑÑ 
:
ÑÑ 
$str
ÑÑ (
,
ÑÑ( )
table
ÒÒ 
:
ÒÒ 
$str
ÒÒ 
,
ÒÒ  
column
ÓÓ 
:
ÓÓ 
$str
ÓÓ  
)
ÓÓ  !
;
ÓÓ! "
migrationBuilder
ÕÕ 
.
ÕÕ 
CreateIndex
ÕÕ (
(
ÕÕ( )
name
ÖÖ 
:
ÖÖ 
$str
ÖÖ +
,
ÖÖ+ ,
table
×× 
:
×× 
$str
×× !
,
××! "
column
ØØ 
:
ØØ 
$str
ØØ !
,
ØØ! "
unique
ÙÙ 
:
ÙÙ 
true
ÙÙ 
)
ÙÙ 
;
ÙÙ 
migrationBuilder
ÛÛ 
.
ÛÛ 
CreateIndex
ÛÛ (
(
ÛÛ( )
name
ÜÜ 
:
ÜÜ 
$str
ÜÜ *
,
ÜÜ* +
table
İİ 
:
İİ 
$str
İİ !
,
İİ! "
column
ŞŞ 
:
ŞŞ 
$str
ŞŞ  
)
ŞŞ  !
;
ŞŞ! "
migrationBuilder
àà 
.
àà 
CreateIndex
àà (
(
àà( )
name
áá 
:
áá 
$str
áá 9
,
áá9 :
table
ââ 
:
ââ 
$str
ââ !
,
ââ! "
column
ãã 
:
ãã 
$str
ãã /
)
ãã/ 0
;
ãã0 1
migrationBuilder
åå 
.
åå 
CreateIndex
åå (
(
åå( )
name
ææ 
:
ææ 
$str
ææ ,
,
ææ, -
table
çç 
:
çç 
$str
çç !
,
çç! "
column
èè 
:
èè 
$str
èè "
)
èè" #
;
èè# $
migrationBuilder
êê 
.
êê 
CreateIndex
êê (
(
êê( )
name
ëë 
:
ëë 
$str
ëë /
,
ëë/ 0
table
ìì 
:
ìì 
$str
ìì !
,
ìì! "
column
íí 
:
íí 
$str
íí %
)
íí% &
;
íí& '
migrationBuilder
ïï 
.
ïï 
CreateIndex
ïï (
(
ïï( )
name
ğğ 
:
ğğ 
$str
ğğ &
,
ğğ& '
table
ññ 
:
ññ 
$str
ññ 
,
ññ 
column
òò 
:
òò 
$str
òò 
,
òò  
unique
óó 
:
óó 
true
óó 
)
óó 
;
óó 
}
ôô 	
	protected
÷÷ 
override
÷÷ 
void
÷÷ 
Down
÷÷  $
(
÷÷$ %
MigrationBuilder
÷÷% 5
migrationBuilder
÷÷6 F
)
÷÷F G
{
øø 	
migrationBuilder
ùù 
.
ùù 
	DropTable
ùù &
(
ùù& '
name
úú 
:
úú 
$str
úú +
)
úú+ ,
;
úú, -
migrationBuilder
üü 
.
üü 
	DropTable
üü &
(
üü& '
name
ıı 
:
ıı 
$str
ıı "
)
ıı" #
;
ıı# $
migrationBuilder
ÿÿ 
.
ÿÿ 
	DropTable
ÿÿ &
(
ÿÿ& '
name
€€ 
:
€€ 
$str
€€  
)
€€  !
;
€€! "
migrationBuilder
‚‚ 
.
‚‚ 
	DropTable
‚‚ &
(
‚‚& '
name
ƒƒ 
:
ƒƒ 
$str
ƒƒ  
)
ƒƒ  !
;
ƒƒ! "
migrationBuilder
…… 
.
…… 
	DropTable
…… &
(
……& '
name
†† 
:
†† 
$str
†† 
)
†† 
;
††  
migrationBuilder
ˆˆ 
.
ˆˆ 
	DropTable
ˆˆ &
(
ˆˆ& '
name
‰‰ 
:
‰‰ 
$str
‰‰ 
)
‰‰ 
;
‰‰ 
}
ŠŠ 	
}
‹‹ 
}ŒŒ ¡=
^C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Payments\RefundPayment.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Payments& .
;. /
public

 
static

 
class

 
RefundPayment

 !
{ 
public 

record 
Command 
( 
Guid 
	PaymentId (
,( )
string* 0
?0 1
Reason2 8
)8 9
:: ;
IRequest< D
<D E
ResultE K
<K L

PaymentDtoL V
>V W
>W X
;X Y
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
	PaymentId $
)$ %
.% &
NotEmpty& .
(. /
)/ 0
;0 1
} 	
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Command4 ;
,; <
Result= C
<C D

PaymentDtoD N
>N O
>O P
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
private 
readonly 
StripeClient %
_stripeClient& 3
;3 4
public 
Handler 
( 
AppDbContext #
context$ +
,+ ,
StripeClient- 9
stripeClient: F
)F G
{ 	
_context 
= 
context 
; 
_stripeClient 
= 
stripeClient (
;( )
} 	
public!! 
async!! 
Task!! 
<!! 
Result!!  
<!!  !

PaymentDto!!! +
>!!+ ,
>!!, -
Handle!!. 4
(!!4 5
Command!!5 <
request!!= D
,!!D E
CancellationToken!!F W
cancellationToken!!X i
)!!i j
{"" 	
var## 
payment## 
=## 
await## 
_context##  (
.##( )
Payments##) 1
.$$ 
Include$$ 
($$ 
p$$ 
=>$$ 
p$$ 
.$$  
Order$$  %
)$$% &
.%% 
FirstOrDefaultAsync%% $
(%%$ %
p%%% &
=>%%' )
p%%* +
.%%+ ,
Id%%, .
==%%/ 1
request%%2 9
.%%9 :
	PaymentId%%: C
,%%C D
cancellationToken%%E V
)%%V W
;%%W X
if'' 
('' 
payment'' 
=='' 
null'' 
)''  
return(( 
Result(( 
<(( 

PaymentDto(( (
>((( )
.(() *
Failure((* 1
(((1 2
$str((2 E
)((E F
;((F G
if)) 
()) 
payment)) 
.)) 
Status)) 
!=)) !
PaymentStatus))" /
.))/ 0
	Completed))0 9
)))9 :
return** 
Result** 
<** 

PaymentDto** (
>**( )
.**) *
Failure*** 1
(**1 2
$str**2 _
)**_ `
;**` a
if++ 
(++ 
payment++ 
.++ 
Method++ 
!=++ !
PaymentMethod++" /
.++/ 0
Card++0 4
)++4 5
return,, 
Result,, 
<,, 

PaymentDto,, (
>,,( )
.,,) *
Failure,,* 1
(,,1 2
$str,,2 ]
),,] ^
;,,^ _
try// 
{00 
var11 
refundOptions11 !
=11" #
new11$ '
Stripe11( .
.11. /
RefundCreateOptions11/ B
{22 
PaymentIntent33 !
=33" #
payment33$ +
.33+ ,!
StripePaymentIntentId33, A
,33A B
Reason44 
=44 
string44 #
.44# $
IsNullOrWhiteSpace44$ 6
(446 7
request447 >
.44> ?
Reason44? E
)44E F
?44G H
null44I M
:44N O
$str44P g
}55 
;55 
var66 
refundService66 !
=66" #
new66$ '
Stripe66( .
.66. /
RefundService66/ <
(66< =
_stripeClient66= J
)66J K
;66K L
var77 
refund77 
=77 
await77 "
refundService77# 0
.770 1
CreateAsync771 <
(77< =
refundOptions77= J
,77J K
cancellationToken77L ]
:77] ^
cancellationToken77_ p
)77p q
;77q r
payment:: 
.:: 
Status:: 
=::  
PaymentStatus::! .
.::. /
Refunded::/ 7
;::7 8
payment;; 
.;; 
FailedAt;;  
=;;! "
DateTime;;# +
.;;+ ,
UtcNow;;, 2
;;;2 3
payment<< 
.<< 
FailureReason<< %
=<<& '
request<<( /
.<</ 0
Reason<<0 6
??<<7 9
$str<<: L
;<<L M
await>> 
_context>> 
.>> 
SaveChangesAsync>> /
(>>/ 0
cancellationToken>>0 A
)>>A B
;>>B C
return@@ 
Result@@ 
<@@ 

PaymentDto@@ (
>@@( )
.@@) *
Success@@* 1
(@@1 2
new@@2 5

PaymentDto@@6 @
{AA 
IdBB 
=BB 
paymentBB  
.BB  !
IdBB! #
,BB# $
OrderIdCC 
=CC 
paymentCC %
.CC% &
OrderIdCC& -
,CC- .
AmountDD 
=DD 
paymentDD $
.DD$ %
AmountDD% +
,DD+ ,
StatusEE 
=EE 
paymentEE $
.EE$ %
StatusEE% +
,EE+ ,
MethodFF 
=FF 
paymentFF $
.FF$ %
MethodFF% +
,FF+ ,!
StripePaymentIntentIdGG )
=GG* +
paymentGG, 3
.GG3 4!
StripePaymentIntentIdGG4 I
,GGI J
StripeSessionIdHH #
=HH$ %
paymentHH& -
.HH- .
StripeSessionIdHH. =
,HH= >
	CreatedAtII 
=II 
paymentII  '
.II' (
	CreatedAtII( 1
,II1 2
PaidAtJJ 
=JJ 
paymentJJ $
.JJ$ %
PaidAtJJ% +
,JJ+ ,
FailedAtKK 
=KK 
paymentKK &
.KK& '
FailedAtKK' /
,KK/ 0
FailureReasonLL !
=LL" #
paymentLL$ +
.LL+ ,
FailureReasonLL, 9
,LL9 :
LoyaltyPointsUsedMM %
=MM& '
paymentMM( /
.MM/ 0
LoyaltyPointsUsedMM0 A
}NN 
)NN 
;NN 
}OO 
catchPP 
(PP 
StripeExceptionPP "
exPP# %
)PP% &
{QQ 
returnRR 
ResultRR 
<RR 

PaymentDtoRR (
>RR( )
.RR) *
FailureRR* 1
(RR1 2
$strRR2 J
+RRK L
exRRM O
.RRO P
MessageRRP W
)RRW X
;RRX Y
}SS 
}TT 	
}UU 
}VV °­
_C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Payments\ProcessPayment.cs
	namespace

 	

CampusEats


 
.

 
Backend

 
.

 
Features

 %
.

% &
Payments

& .
;

. /
public 
static 
class 
ProcessPayment "
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,

PaymentDto, 6
>6 7
>7 8
{ 
public 
Guid 
OrderId 
{ 
get !
;! "
init# '
;' (
}) *
public 
string 
PaymentMethod #
{$ %
get& )
;) *
init+ /
;/ 0
}1 2
=3 4
string5 ;
.; <
Empty< A
;A B
public 
decimal 
Amount 
{ 
get  #
;# $
init% )
;) *
}+ ,
public 
decimal 
? 
LoyaltyPointsUsed )
{* +
get, /
;/ 0
init1 5
;5 6
}7 8
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
OrderId "
)" #
.# $
NotEmpty$ ,
(, -
)- .
;. /
RuleFor 
( 
x 
=> 
x 
. 
PaymentMethod (
)( )
.) *
NotEmpty* 2
(2 3
)3 4
.4 5
Must5 9
(9 :
m: ;
=>< >
PaymentMethodExists? R
(R S
mS T
)T U
)U V
. 
WithMessage 
( 
$str X
)X Y
;Y Z
RuleFor 
( 
x 
=> 
x 
. 
Amount !
)! "
." #
GreaterThan# .
(. /
$num/ 1
)1 2
;2 3
} 	
private   
bool   
PaymentMethodExists   (
(  ( )
string  ) /
value  0 5
)  5 6
=>  7 9
Enum!! 
.!! 
TryParse!! 
<!! 
PaymentMethod!! '
>!!' (
(!!( )
value!!) .
,!!. /
true!!0 4
,!!4 5
out!!6 9
var!!: =
_!!> ?
)!!? @
;!!@ A
}"" 
internal$$ 
sealed$$ 
class$$ 
Handler$$ !
:$$" #
IRequestHandler$$$ 3
<$$3 4
Command$$4 ;
,$$; <
Result$$= C
<$$C D

PaymentDto$$D N
>$$N O
>$$O P
{%% 
private&& 
readonly&& 
AppDbContext&& %
_context&&& .
;&&. /
private'' 
readonly'' 
StripeClient'' %
_stripeClient''& 3
;''3 4
public)) 
Handler)) 
()) 
AppDbContext)) #
context))$ +
,))+ ,
StripeClient))- 9
stripeClient)): F
)))F G
{** 	
_context++ 
=++ 
context++ 
;++ 
_stripeClient,, 
=,, 
stripeClient,, (
;,,( )
}-- 	
public// 
async// 
Task// 
<// 
Result//  
<//  !

PaymentDto//! +
>//+ ,
>//, -
Handle//. 4
(//4 5
Command//5 <
request//= D
,//D E
CancellationToken//F W
cancellationToken//X i
)//i j
{00 	
var11 
order11 
=11 
await11 
_context11 &
.11& '
Orders11' -
.11- .
Include11. 5
(115 6
o116 7
=>118 :
o11; <
.11< =
User11= A
)11A B
.22 
FirstOrDefaultAsync22 $
(22$ %
o22% &
=>22' )
o22* +
.22+ ,
Id22, .
==22/ 1
request222 9
.229 :
OrderId22: A
,22A B
cancellationToken22C T
)22T U
;22U V
if44 
(44 
order44 
is44 
null44 
)44 
return55 
Result55 
<55 

PaymentDto55 (
>55( )
.55) *
Failure55* 1
(551 2
$str552 C
)55C D
;55D E
if66 
(66 
order66 
.66 
PaymentStatus66 #
==66$ &
$str66' -
)66- .
return77 
Result77 
<77 

PaymentDto77 (
>77( )
.77) *
Failure77* 1
(771 2
$str772 I
)77I J
;77J K
var:: 
existingPayments::  
=::! "
await::# (
_context::) 1
.::1 2
Payments::2 :
.;; 
Where;; 
(;; 
p;; 
=>;; 
p;; 
.;; 
OrderId;; %
==;;& (
order;;) .
.;;. /
Id;;/ 1
&&;;2 4
(;;5 6
p;;6 7
.;;7 8
Status;;8 >
==;;? A
PaymentStatus;;B O
.;;O P
	Completed;;P Y
||;;Z \
p;;] ^
.;;^ _
Status;;_ e
==;;f h
PaymentStatus;;i v
.;;v w
Pending;;w ~
);;~ 
)	;; €
.<< 
Where<< 
(<< 
p<< 
=><< 
p<< 
.<< 
Status<< $
==<<% '
PaymentStatus<<( 5
.<<5 6
	Completed<<6 ?
)<<? @
.== 
SumAsync== 
(== 
p== 
=>== 
p==  
.==  !
Amount==! '
,==' (
cancellationToken==) :
)==: ;
;==; <
var?? 
remainingAmount?? 
=??  !
order??" '
.??' (
TotalAmount??( 3
-??4 5
existingPayments??6 F
;??F G
ifBB 
(BB 
requestBB 
.BB 
AmountBB 
<=BB !
$numBB" #
)BB# $
returnCC 
ResultCC 
<CC 

PaymentDtoCC (
>CC( )
.CC) *
FailureCC* 1
(CC1 2
$strCC2 Q
)CCQ R
;CCR S
ifEE 
(EE 
MathEE 
.EE 
AbsEE 
(EE 
requestEE  
.EE  !
AmountEE! '
-EE( )
remainingAmountEE* 9
)EE9 :
>EE; <
$numEE= B
)EEB C
returnFF 
ResultFF 
<FF 

PaymentDtoFF (
>FF( )
.FF) *
FailureFF* 1
(FF1 2
$"FF2 4
$strFF4 D
{FFD E
requestFFE L
.FFL M
AmountFFM S
}FFS T
$strFFT w
{FFw x
remainingAmount	FFx ‡
}
FF‡ ˆ
$str
FFˆ ‰
"
FF‰ Š
)
FFŠ ‹
;
FF‹ Œ
ifHH 
(HH 
!HH 
EnumHH 
.HH 
TryParseHH 
<HH 
PaymentMethodHH ,
>HH, -
(HH- .
requestHH. 5
.HH5 6
PaymentMethodHH6 C
,HHC D
trueHHE I
,HHI J
outHHK N
varHHO R
methodHHS Y
)HHY Z
)HHZ [
returnII 
ResultII 
<II 

PaymentDtoII (
>II( )
.II) *
FailureII* 1
(II1 2
$strII2 J
)IIJ K
;IIK L
varKK 
paymentKK 
=KK 
newKK 
PaymentKK %
{LL 
IdMM 
=MM 
GuidMM 
.MM 
NewGuidMM !
(MM! "
)MM" #
,MM# $
OrderIdNN 
=NN 
orderNN 
.NN  
IdNN  "
,NN" #
AmountOO 
=OO 
requestOO  
.OO  !
AmountOO! '
,OO' (
MethodPP 
=PP 
methodPP 
,PP  
	CreatedAtQQ 
=QQ 
DateTimeQQ $
.QQ$ %
UtcNowQQ% +
,QQ+ ,
StatusRR 
=RR 
PaymentStatusRR &
.RR& '
PendingRR' .
}SS 
;SS 
ifUU 
(UU 
methodUU 
==UU 
PaymentMethodUU '
.UU' (
CardUU( ,
)UU, -
{VV 
varXX 
frontendUrlXX 
=XX  !
EnvironmentXX" -
.XX- ."
GetEnvironmentVariableXX. D
(XXD E
$strXXE S
)XXS T
??XXU W
$strXXX o
;XXo p
var[[ 
sessionOptions[[ "
=[[# $
new[[% (
Stripe[[) /
.[[/ 0
Checkout[[0 8
.[[8 9 
SessionCreateOptions[[9 M
{\\ 
PaymentMethodTypes]] &
=]]' (
new]]) ,
List]]- 1
<]]1 2
string]]2 8
>]]8 9
{]]: ;
$str]]< B
}]]C D
,]]D E
Mode^^ 
=^^ 
$str^^ $
,^^$ %
	LineItems__ 
=__ 
new__  #
List__$ (
<__( )
Stripe__) /
.__/ 0
Checkout__0 8
.__8 9"
SessionLineItemOptions__9 O
>__O P
{`` 
newaa 
Stripeaa "
.aa" #
Checkoutaa# +
.aa+ ,"
SessionLineItemOptionsaa, B
{bb 
	PriceDatacc %
=cc& '
newcc( +
Stripecc, 2
.cc2 3
Checkoutcc3 ;
.cc; <+
SessionLineItemPriceDataOptionscc< [
{dd 
Currencyee  (
=ee) *
$stree+ 0
,ee0 1
ProductDataff  +
=ff, -
newff. 1
Stripeff2 8
.ff8 9
Checkoutff9 A
.ffA B6
*SessionLineItemPriceDataProductDataOptionsffB l
{gg  !
Namehh$ (
=hh) *
$"hh+ -
$strhh- ?
{hh? @
orderhh@ E
.hhE F
OrderNumberhhF Q
}hhQ R
"hhR S
,hhS T
Descriptionii$ /
=ii0 1
$"ii2 4
$strii4 >
{ii> ?
orderii? D
.iiD E
IdiiE G
}iiG H
$striiH _
"ii_ `
}jj  !
,jj! "

UnitAmountkk  *
=kk+ ,
(kk- .
longkk. 2
)kk2 3
(kk3 4
requestkk4 ;
.kk; <
Amountkk< B
*kkC D
$numkkE H
)kkH I
}ll 
,ll 
Quantitymm $
=mm% &
$nummm' (
}nn 
}oo 
,oo 

SuccessUrlqq 
=qq  
$"qq! #
{qq# $
frontendUrlqq$ /
}qq/ 0
$strqq0 n
{qqn o
orderqqo t
.qqt u
Idqqu w
}qqw x
"qqx y
,qqy z
	CancelUrlrr 
=rr 
$"rr  "
{rr" #
frontendUrlrr# .
}rr. /
$strrr/ I
{rrI J
orderrrJ O
.rrO P
IdrrP R
}rrR S
"rrS T
,rrT U
Metadatass 
=ss 
newss "

Dictionaryss# -
<ss- .
stringss. 4
,ss4 5
stringss6 <
>ss< =
{tt 
[uu 
$struu "
]uu" #
=uu$ %
orderuu& +
.uu+ ,
Iduu, .
.uu. /
ToStringuu/ 7
(uu7 8
)uu8 9
,uu9 :
[vv 
$strvv !
]vv! "
=vv# $
ordervv% *
.vv* +
UserIdvv+ 1
.vv1 2
ToStringvv2 :
(vv: ;
)vv; <
}ww 
}xx 
;xx 
varzz 
sessionServicezz "
=zz# $
newzz% (
Stripezz) /
.zz/ 0
Checkoutzz0 8
.zz8 9
SessionServicezz9 G
(zzG H
_stripeClientzzH U
)zzU V
;zzV W
try|| 
{}} 
var~~ 
session~~ 
=~~  !
await~~" '
sessionService~~( 6
.~~6 7
CreateAsync~~7 B
(~~B C
sessionOptions~~C Q
,~~Q R
cancellationToken~~S d
:~~d e
cancellationToken~~f w
)~~w x
;~~x y
payment
€€ 
.
€€ 
StripeSessionId
€€ +
=
€€, -
session
€€. 5
.
€€5 6
Id
€€6 8
;
€€8 9
payment
 
.
 
Status
 "
=
# $
PaymentStatus
% 2
.
2 3
Pending
3 :
;
: ;
_context
ƒƒ 
.
ƒƒ 
Payments
ƒƒ %
.
ƒƒ% &
Add
ƒƒ& )
(
ƒƒ) *
payment
ƒƒ* 1
)
ƒƒ1 2
;
ƒƒ2 3
await
„„ 
_context
„„ "
.
„„" #
SaveChangesAsync
„„# 3
(
„„3 4
cancellationToken
„„4 E
)
„„E F
;
„„F G
return
†† 
Result
†† !
<
††! "

PaymentDto
††" ,
>
††, -
.
††- .
Success
††. 5
(
††5 6
new
††6 9

PaymentDto
††: D
{
‡‡ 
Id
ˆˆ 
=
ˆˆ 
payment
ˆˆ $
.
ˆˆ$ %
Id
ˆˆ% '
,
ˆˆ' (
OrderId
‰‰ 
=
‰‰  !
payment
‰‰" )
.
‰‰) *
OrderId
‰‰* 1
,
‰‰1 2
Amount
ŠŠ 
=
ŠŠ  
payment
ŠŠ! (
.
ŠŠ( )
Amount
ŠŠ) /
,
ŠŠ/ 0
Status
‹‹ 
=
‹‹  
payment
‹‹! (
.
‹‹( )
Status
‹‹) /
,
‹‹/ 0
Method
ŒŒ 
=
ŒŒ  
payment
ŒŒ! (
.
ŒŒ( )
Method
ŒŒ) /
,
ŒŒ/ 0
StripeSessionId
 '
=
( )
payment
* 1
.
1 2
StripeSessionId
2 A
,
A B 
StripeClientSecret
 *
=
+ ,
session
- 4
.
4 5
Url
5 8
,
8 9
	CreatedAt
 !
=
" #
payment
$ +
.
+ ,
	CreatedAt
, 5
}
 
)
 
;
 
}
‘‘ 
catch
’’ 
(
’’ 
StripeException
’’ &
ex
’’' )
)
’’) *
{
““ 
payment
”” 
.
”” 
Status
”” "
=
””# $
PaymentStatus
””% 2
.
””2 3
Failed
””3 9
;
””9 :
payment
•• 
.
•• 
FailureReason
•• )
=
••* +
ex
••, .
.
••. /
StripeError
••/ :
?
••: ;
.
••; <
Message
••< C
??
••D F
ex
••G I
.
••I J
Message
••J Q
;
••Q R
payment
–– 
.
–– 
FailedAt
–– $
=
––% &
DateTime
––' /
.
––/ 0
UtcNow
––0 6
;
––6 7
_context
˜˜ 
.
˜˜ 
Payments
˜˜ %
.
˜˜% &
Add
˜˜& )
(
˜˜) *
payment
˜˜* 1
)
˜˜1 2
;
˜˜2 3
await
™™ 
_context
™™ "
.
™™" #
SaveChangesAsync
™™# 3
(
™™3 4
cancellationToken
™™4 E
)
™™E F
;
™™F G
return
šš 
Result
šš !
<
šš! "

PaymentDto
šš" ,
>
šš, -
.
šš- .
Failure
šš. 5
(
šš5 6
$str
šš6 O
+
ššP Q
payment
ššR Y
.
ššY Z
FailureReason
ššZ g
)
ššg h
;
ššh i
}
›› 
}
œœ 
else
 
if
 
(
 
method
 
==
 
PaymentMethod
 ,
.
, -
Cash
- 1
)
1 2
{
 
payment
ŸŸ 
.
ŸŸ 
Status
ŸŸ 
=
ŸŸ  
PaymentStatus
ŸŸ! .
.
ŸŸ. /
Pending
ŸŸ/ 6
;
ŸŸ6 7
}
   
else
¡¡ 
if
¡¡ 
(
¡¡ 
method
¡¡ 
==
¡¡ 
PaymentMethod
¡¡ ,
.
¡¡, -
LoyaltyPoints
¡¡- :
)
¡¡: ;
{
¢¢ 
var
££ 
pointsNeeded
££  
=
££! "
request
££# *
.
££* +
LoyaltyPointsUsed
££+ <
??
££= ?
$num
££@ B
;
££B C
if
¤¤ 
(
¤¤ 
order
¤¤ 
.
¤¤ 
User
¤¤ 
.
¤¤ 
LoyaltyPoints
¤¤ ,
<
¤¤- .
pointsNeeded
¤¤/ ;
)
¤¤; <
return
¥¥ 
Result
¥¥ !
<
¥¥! "

PaymentDto
¥¥" ,
>
¥¥, -
.
¥¥- .
Failure
¥¥. 5
(
¥¥5 6
$str
¥¥6 S
)
¥¥S T
;
¥¥T U
order
§§ 
.
§§ 
User
§§ 
.
§§ 
LoyaltyPoints
§§ (
-=
§§) +
pointsNeeded
§§, 8
;
§§8 9
payment
¨¨ 
.
¨¨ 
Status
¨¨ 
=
¨¨  
PaymentStatus
¨¨! .
.
¨¨. /
	Completed
¨¨/ 8
;
¨¨8 9
payment
©© 
.
©© 
PaidAt
©© 
=
©©  
DateTime
©©! )
.
©©) *
UtcNow
©©* 0
;
©©0 1
payment
ªª 
.
ªª 
LoyaltyPointsUsed
ªª )
=
ªª* +
pointsNeeded
ªª, 8
;
ªª8 9
}
«« 
else
¬¬ 
{
­­ 
return
®® 
Result
®® 
<
®® 

PaymentDto
®® (
>
®®( )
.
®®) *
Failure
®®* 1
(
®®1 2
$str
®®2 J
)
®®J K
;
®®K L
}
¯¯ 
_context
±± 
.
±± 
Payments
±± 
.
±± 
Add
±± !
(
±±! "
payment
±±" )
)
±±) *
;
±±* +
await
²² 
_context
²² 
.
²² 
SaveChangesAsync
²² +
(
²²+ ,
cancellationToken
²², =
)
²²= >
;
²²> ?
var
µµ 
amountCovered
µµ 
=
µµ 
existingPayments
µµ  0
;
µµ0 1
if
¶¶ 
(
¶¶ 
payment
¶¶ 
.
¶¶ 
Status
¶¶ 
==
¶¶ !
PaymentStatus
¶¶" /
.
¶¶/ 0
	Completed
¶¶0 9
)
¶¶9 :
amountCovered
¶¶; H
+=
¶¶I K
payment
¶¶L S
.
¶¶S T
Amount
¶¶T Z
;
¶¶Z [
if
¹¹ 
(
¹¹ 
amountCovered
¹¹ 
>=
¹¹  
order
¹¹! &
.
¹¹& '
TotalAmount
¹¹' 2
-
¹¹3 4
$num
¹¹5 :
)
¹¹: ;
{
ºº 
order
»» 
.
»» 
PaymentStatus
»» #
=
»»$ %
$str
»»& ,
;
»», -
}
¼¼ 
else
½½ 
{
¾¾ 
if
¿¿ 
(
¿¿ 
existingPayments
¿¿ $
>
¿¿% &
$num
¿¿' (
)
¿¿( )
order
ÀÀ 
.
ÀÀ 
PaymentStatus
ÀÀ '
=
ÀÀ( )
$str
ÀÀ* 3
;
ÀÀ3 4
else
ÁÁ 
order
ÂÂ 
.
ÂÂ 
PaymentStatus
ÂÂ '
=
ÂÂ( )
$str
ÂÂ* 3
;
ÂÂ3 4
}
ÃÃ 
await
ÅÅ 
_context
ÅÅ 
.
ÅÅ 
SaveChangesAsync
ÅÅ +
(
ÅÅ+ ,
cancellationToken
ÅÅ, =
)
ÅÅ= >
;
ÅÅ> ?
return
ÇÇ 
Result
ÇÇ 
<
ÇÇ 

PaymentDto
ÇÇ $
>
ÇÇ$ %
.
ÇÇ% &
Success
ÇÇ& -
(
ÇÇ- .
new
ÇÇ. 1

PaymentDto
ÇÇ2 <
{
ÈÈ 
Id
ÉÉ 
=
ÉÉ 
payment
ÉÉ 
.
ÉÉ 
Id
ÉÉ 
,
ÉÉ  
OrderId
ÊÊ 
=
ÊÊ 
payment
ÊÊ !
.
ÊÊ! "
OrderId
ÊÊ" )
,
ÊÊ) *
Amount
ËË 
=
ËË 
payment
ËË  
.
ËË  !
Amount
ËË! '
,
ËË' (
Status
ÌÌ 
=
ÌÌ 
payment
ÌÌ  
.
ÌÌ  !
Status
ÌÌ! '
,
ÌÌ' (
Method
ÍÍ 
=
ÍÍ 
payment
ÍÍ  
.
ÍÍ  !
Method
ÍÍ! '
,
ÍÍ' (#
StripePaymentIntentId
ÎÎ %
=
ÎÎ& '
payment
ÎÎ( /
.
ÎÎ/ 0#
StripePaymentIntentId
ÎÎ0 E
,
ÎÎE F
StripeSessionId
ÏÏ 
=
ÏÏ  !
payment
ÏÏ" )
.
ÏÏ) *
StripeSessionId
ÏÏ* 9
,
ÏÏ9 : 
StripeClientSecret
ĞĞ "
=
ĞĞ# $
null
ĞĞ% )
,
ĞĞ) *
	CreatedAt
ÑÑ 
=
ÑÑ 
payment
ÑÑ #
.
ÑÑ# $
	CreatedAt
ÑÑ$ -
,
ÑÑ- .
PaidAt
ÒÒ 
=
ÒÒ 
payment
ÒÒ  
.
ÒÒ  !
PaidAt
ÒÒ! '
,
ÒÒ' (
FailedAt
ÓÓ 
=
ÓÓ 
payment
ÓÓ "
.
ÓÓ" #
FailedAt
ÓÓ# +
,
ÓÓ+ ,
FailureReason
ÔÔ 
=
ÔÔ 
payment
ÔÔ  '
.
ÔÔ' (
FailureReason
ÔÔ( 5
,
ÔÔ5 6
LoyaltyPointsUsed
ÕÕ !
=
ÕÕ" #
payment
ÕÕ$ +
.
ÕÕ+ ,
LoyaltyPointsUsed
ÕÕ, =
}
ÖÖ 
)
ÖÖ 
;
ÖÖ 
}
×× 	
}
ØØ 
}ÙÙ ã8
`C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Payments\GetUserPayments.cs
public 
static 
class 
GetUserPayments #
{ 
public 

record 
Query 
( 
Guid		 
UserId		 
,		 
int

 
Page

 
=

 
$num

 
,

 
int 
PageSize 
= 
$num 
, 
string 
? 
Status 
= 
null 
, 
string 
? 
Method 
= 
null 
) 
: 
IRequest 
< 
Result 
< 
PagedResult #
<# $

PaymentDto$ .
>. /
>/ 0
>0 1
;1 2
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
PagedResultB M
<M N

PaymentDtoN X
>X Y
>Y Z
>Z [
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
PagedResult! ,
<, -

PaymentDto- 7
>7 8
>8 9
>9 :
Handle; A
(A B
QueryB G
requestH O
,O P
CancellationTokenQ b
cancellationTokenc t
)t u
{ 	
var 
query 
= 
_context  
.  !
Payments! )
. 
Include 
( 
p 
=> 
p 
.  
Order  %
)% &
. 
Where 
( 
p 
=> 
p 
. 
Order #
.# $
UserId$ *
==+ -
request. 5
.5 6
UserId6 <
)< =
;= >
if 
( 
! 
string 
. 
IsNullOrWhiteSpace *
(* +
request+ 2
.2 3
Status3 9
)9 :
&&; =
Enum   
.   
TryParse   
<   
PaymentStatus   +
>  + ,
(  , -
request  - 4
.  4 5
Status  5 ;
,  ; <
true  = A
,  A B
out  C F
var  G J
status  K Q
)  Q R
)  R S
query!! 
=!! 
query!! 
.!! 
Where!! #
(!!# $
p!!$ %
=>!!& (
p!!) *
.!!* +
Status!!+ 1
==!!2 4
status!!5 ;
)!!; <
;!!< =
if## 
(## 
!## 
string## 
.## 
IsNullOrWhiteSpace## *
(##* +
request##+ 2
.##2 3
Method##3 9
)##9 :
&&##; =
Enum$$ 
.$$ 
TryParse$$ 
<$$ 
PaymentMethod$$ +
>$$+ ,
($$, -
request$$- 4
.$$4 5
Method$$5 ;
,$$; <
true$$= A
,$$A B
out$$C F
var$$G J
method$$K Q
)$$Q R
)$$R S
query%% 
=%% 
query%% 
.%% 
Where%% #
(%%# $
p%%$ %
=>%%& (
p%%) *
.%%* +
Method%%+ 1
==%%2 4
method%%5 ;
)%%; <
;%%< =
var'' 

totalCount'' 
='' 
await'' "
query''# (
.''( )

CountAsync'') 3
(''3 4
cancellationToken''4 E
)''E F
;''F G
var)) 
items)) 
=)) 
await)) 
query)) #
.** 
OrderByDescending** "
(**" #
p**# $
=>**% '
p**( )
.**) *
	CreatedAt*** 3
)**3 4
.++ 
Skip++ 
(++ 
(++ 
request++ 
.++ 
Page++ #
-++$ %
$num++& '
)++' (
*++) *
request+++ 2
.++2 3
PageSize++3 ;
)++; <
.,, 
Take,, 
(,, 
request,, 
.,, 
PageSize,, &
),,& '
.-- 
Select-- 
(-- 
p-- 
=>-- 
new--  

PaymentDto--! +
{.. 
Id// 
=// 
p// 
.// 
Id// 
,// 
OrderId00 
=00 
p00 
.00  
OrderId00  '
,00' (
Amount11 
=11 
p11 
.11 
Amount11 %
,11% &
Status22 
=22 
p22 
.22 
Status22 %
,22% &
Method33 
=33 
p33 
.33 
Method33 %
,33% &!
StripePaymentIntentId44 )
=44* +
p44, -
.44- .!
StripePaymentIntentId44. C
,44C D
StripeSessionId55 #
=55$ %
p55& '
.55' (
StripeSessionId55( 7
,557 8
StripeClientSecret66 &
=66' (
null66) -
,66- .
	CreatedAt77 
=77 
p77  !
.77! "
	CreatedAt77" +
,77+ ,
PaidAt88 
=88 
p88 
.88 
PaidAt88 %
,88% &
FailedAt99 
=99 
p99  
.99  !
FailedAt99! )
,99) *
FailureReason:: !
=::" #
p::$ %
.::% &
FailureReason::& 3
,::3 4
LoyaltyPointsUsed;; %
=;;& '
p;;( )
.;;) *
LoyaltyPointsUsed;;* ;
}<< 
)<< 
.== 
ToListAsync== 
(== 
cancellationToken== .
)==. /
;==/ 0
return?? 
Result?? 
<?? 
PagedResult?? %
<??% &

PaymentDto??& 0
>??0 1
>??1 2
.??2 3
Success??3 :
(??: ;
new??; >
PagedResult??? J
<??J K

PaymentDto??K U
>??U V
{@@ 
CurrentPageAA 
=AA 
requestAA %
.AA% &
PageAA& *
,AA* +
PageSizeBB 
=BB 
requestBB "
.BB" #
PageSizeBB# +
,BB+ ,

TotalCountCC 
=CC 

totalCountCC '
,CC' (
ItemsDD 
=DD 
itemsDD 
}EE 
)EE 
;EE 
}FF 	
}GG 
}HH ¥
aC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Payments\GetOrderPayments.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Payments& .
;. /
public 
static 
class 
GetOrderPayments $
{ 
public		 

record		 
Query		 
(		 
Guid		 
OrderId		 $
)		$ %
:		& '
IRequest		( 0
<		0 1
List		1 5
<		5 6

PaymentDto		6 @
>		@ A
>		A B
;		B C
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
List; ?
<? @

PaymentDto@ J
>J K
>K L
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
=>- /
_context0 8
=9 :
context; B
;B C
public 
async 
Task 
< 
List 
< 

PaymentDto )
>) *
>* +
Handle, 2
(2 3
Query3 8
request9 @
,@ A
CancellationTokenB S
cancellationTokenT e
)e f
{ 	
var 
payments 
= 
await  
_context! )
.) *
Payments* 2
. 
Where 
( 
x 
=> 
x 
. 
OrderId %
==& (
request) 0
.0 1
OrderId1 8
)8 9
. 
OrderByDescending "
(" #
x# $
=>% '
x( )
.) *
	CreatedAt* 3
)3 4
. 
Select 
( 
p 
=> 
new  

PaymentDto! +
{ 
Id 
= 
p 
. 
Id 
, 
OrderId 
= 
p 
.  
OrderId  '
,' (
Amount 
= 
p 
. 
Amount %
,% &
Status 
= 
p 
. 
Status %
,% &
Method 
= 
p 
. 
Method %
,% &!
StripePaymentIntentId )
=* +
p, -
.- .!
StripePaymentIntentId. C
,C D
StripeSessionId #
=$ %
p& '
.' (
StripeSessionId( 7
,7 8
	CreatedAt 
= 
p  !
.! "
	CreatedAt" +
,+ ,
PaidAt 
= 
p 
. 
PaidAt %
,% &
FailedAt   
=   
p    
.    !
FailedAt  ! )
,  ) *
FailureReason!! !
=!!" #
p!!$ %
.!!% &
FailureReason!!& 3
,!!3 4
LoyaltyPointsUsed"" %
=""& '
p""( )
."") *
LoyaltyPointsUsed""* ;
}## 
)## 
.$$ 
ToListAsync$$ 
($$ 
cancellationToken$$ .
)$$. /
;$$/ 0
return&& 
payments&& 
;&& 
}'' 	
}(( 
})) 7
_C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Payments\GetAllPayments.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Payments& .
;. /
public 
static 
class 
GetAllPayments "
{		 
public

 

record

 
Query

 
(

 
int 
Page 
= 
$num 
, 
int 
PageSize 
= 
$num 
, 
string 
? 
Status 
= 
null 
, 
string 
? 
Method 
= 
null 
) 
: 
IRequest 
< 
Result 
< 
PagedResult #
<# $

PaymentDto$ .
>. /
>/ 0
>0 1
;1 2
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
PagedResultB M
<M N

PaymentDtoN X
>X Y
>Y Z
>Z [
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
=>- /
_context0 8
=9 :
context; B
;B C
public 
async 
Task 
< 
Result  
<  !
PagedResult! ,
<, -

PaymentDto- 7
>7 8
>8 9
>9 :
Handle; A
(A B
QueryB G
requestH O
,O P
CancellationTokenQ b
cancellationTokenc t
)t u
{ 	
var 
query 
= 
_context  
.  !
Payments! )
.) *
AsQueryable* 5
(5 6
)6 7
;7 8
if 
( 
! 
string 
. 
IsNullOrWhiteSpace *
(* +
request+ 2
.2 3
Status3 9
)9 :
&&; =
Enum 
. 
TryParse 
< 
PaymentStatus +
>+ ,
(, -
request- 4
.4 5
Status5 ;
,; <
true= A
,A B
outC F
varG J
statusK Q
)Q R
)R S
query 
= 
query 
. 
Where #
(# $
p$ %
=>& (
p) *
.* +
Status+ 1
==2 4
status5 ;
); <
;< =
if 
( 
! 
string 
. 
IsNullOrWhiteSpace *
(* +
request+ 2
.2 3
Method3 9
)9 :
&&; =
Enum 
. 
TryParse 
< 
PaymentMethod +
>+ ,
(, -
request- 4
.4 5
Method5 ;
,; <
true= A
,A B
outC F
varG J
methodK Q
)Q R
)R S
query   
=   
query   
.   
Where   #
(  # $
p  $ %
=>  & (
p  ) *
.  * +
Method  + 1
==  2 4
method  5 ;
)  ; <
;  < =
var"" 

totalCount"" 
="" 
await"" "
query""# (
.""( )

CountAsync"") 3
(""3 4
cancellationToken""4 E
)""E F
;""F G
var$$ 
items$$ 
=$$ 
await$$ 
query$$ #
.$$# $
OrderByDescending$$$ 5
($$5 6
p$$6 7
=>$$8 :
p$$; <
.$$< =
	CreatedAt$$= F
)$$F G
.%%# $
Skip%%$ (
(%%( )
(%%) *
request%%* 1
.%%1 2
Page%%2 6
-%%7 8
$num%%9 :
)%%: ;
*%%< =
request%%> E
.%%E F
PageSize%%F N
)%%N O
.&&# $
Take&&$ (
(&&( )
request&&) 0
.&&0 1
PageSize&&1 9
)&&9 :
.''# $
Select''$ *
(''* +
p''+ ,
=>''- /
new''0 3

PaymentDto''4 >
{((# $
Id))' )
=))* +
p)), -
.))- .
Id)). 0
,))0 1
OrderId**' .
=**/ 0
p**1 2
.**2 3
OrderId**3 :
,**: ;
Amount++' -
=++. /
p++0 1
.++1 2
Amount++2 8
,++8 9
Status,,' -
=,,. /
p,,0 1
.,,1 2
Status,,2 8
,,,8 9
Method--' -
=--. /
p--0 1
.--1 2
Method--2 8
,--8 9!
StripePaymentIntentId..' <
=..= >
p..? @
...@ A!
StripePaymentIntentId..A V
,..V W
StripeSessionId//' 6
=//7 8
p//9 :
.//: ;
StripeSessionId//; J
,//J K
StripeClientSecret00' 9
=00: ;
null00< @
,00@ A
	CreatedAt11' 0
=111 2
p113 4
.114 5
	CreatedAt115 >
,11> ?
PaidAt22' -
=22. /
p220 1
.221 2
PaidAt222 8
,228 9
FailedAt33' /
=330 1
p332 3
.333 4
FailedAt334 <
,33< =
FailureReason44' 4
=445 6
p447 8
.448 9
FailureReason449 F
,44F G
LoyaltyPointsUsed55' 8
=559 :
p55; <
.55< =
LoyaltyPointsUsed55= N
}66# $
)66$ %
.77# $
ToListAsync77$ /
(77/ 0
cancellationToken770 A
)77A B
;77B C
return99 
Result99 
<99 
PagedResult99 %
<99% &

PaymentDto99& 0
>990 1
>991 2
.992 3
Success993 :
(99: ;
new99; >
PagedResult99? J
<99J K

PaymentDto99K U
>99U V
{:: 
CurrentPage;; 
=;; 
request;; %
.;;% &
Page;;& *
,;;* +
PageSize<< 
=<< 
request<< "
.<<" #
PageSize<<# +
,<<+ ,

TotalCount== 
=== 

totalCount== '
,==' (
Items>> 
=>> 
items>> 
}?? 
)?? 
;?? 
}@@ 	
}AA 
}BB ï3
\C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Orders\GetUserOrders.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Orders& ,
;, -
public		 
static		 
class		 
GetUserOrders		 !
{

 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
List* .
<. /
OrderDto/ 7
>7 8
>8 9
>9 :
{ 
public 
Guid 
UserId 
{ 
get  
;  !
init" &
;& '
}( )
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
ListB F
<F G
OrderDtoG O
>O P
>P Q
>Q R
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
List! %
<% &
OrderDto& .
>. /
>/ 0
>0 1
Handle2 8
(8 9
Query9 >
request? F
,F G
CancellationTokenH Y
cancellationTokenZ k
)k l
{ 	
var 

userExists 
= 
await "
_context# +
.+ ,
Users, 1
.1 2
AnyAsync2 :
(: ;
u; <
=>= ?
u@ A
.A B
IdB D
==E G
requestH O
.O P
UserIdP V
,V W
cancellationTokenX i
)i j
;j k
if 
( 
! 

userExists 
) 
{   
return!! 
Result!! 
<!! 
List!! "
<!!" #
OrderDto!!# +
>!!+ ,
>!!, -
.!!- .
Failure!!. 5
(!!5 6
$"!!6 8
$str!!8 E
{!!E F
request!!F M
.!!M N
UserId!!N T
}!!T U
$str!!U _
"!!_ `
)!!` a
;!!a b
}"" 
var%% 
orders%% 
=%% 
await%% 
_context%% '
.%%' (
Orders%%( .
.&& 
AsNoTracking&& 
(&& 
)&& 
.'' 
Where'' 
('' 
o'' 
=>'' 
o'' 
.'' 
UserId'' $
==''% '
request''( /
.''/ 0
UserId''0 6
)''6 7
.(( 
Include(( 
((( 
o(( 
=>(( 
o(( 
.((  

OrderItems((  *
)((* +
.)) 
ThenInclude))  
())  !
oi))! #
=>))$ &
oi))' )
.))) *
Product))* 1
)))1 2
.** 
OrderByDescending** "
(**" #
o**# $
=>**% '
o**( )
.**) *
	CreatedAt*** 3
)**3 4
.++ 
ToListAsync++ 
(++ 
cancellationToken++ .
)++. /
;++/ 0
var.. 
	orderDtos.. 
=.. 
orders.. "
..." #
Select..# )
(..) *
order..* /
=>..0 2
new..3 6
OrderDto..7 ?
{// 
Id00 
=00 
order00 
.00 
Id00 
,00 
OrderNumber11 
=11 
order11 #
.11# $
OrderNumber11$ /
,11/ 0
UserId22 
=22 
order22 
.22 
UserId22 %
,22% &
TotalAmount33 
=33 
order33 #
.33# $
TotalAmount33$ /
,33/ 0
Status44 
=44 
order44 
.44 
Status44 %
,44% &
PaymentStatus55 
=55 
order55  %
.55% &
PaymentStatus55& 3
,553 4
PaymentMethod66 
=66 
order66  %
.66% &
PaymentMethod66& 3
,663 4
Notes77 
=77 
order77 
.77 
Notes77 #
,77# $
	CreatedAt88 
=88 
order88 !
.88! "
	CreatedAt88" +
,88+ ,
	UpdatedAt99 
=99 
order99 !
.99! "
	UpdatedAt99" +
,99+ ,
CompletedAt:: 
=:: 
order:: #
.::# $
CompletedAt::$ /
,::/ 0

OrderItems;; 
=;; 
order;; "
.;;" #

OrderItems;;# -
.;;- .
Select;;. 4
(;;4 5
oi;;5 7
=>;;8 :
new;;; >
OrderItemDto;;? K
{<< 
Id== 
=== 
oi== 
.== 
Id== 
,== 
	ProductId>> 
=>> 
oi>>  "
.>>" #
	ProductId>># ,
,>>, -
ProductName?? 
=??  !
oi??" $
.??$ %
Product??% ,
.??, -
Name??- 1
,??1 2
Quantity@@ 
=@@ 
oi@@ !
.@@! "
Quantity@@" *
,@@* +
	UnitPriceAA 
=AA 
oiAA  "
.AA" #
	UnitPriceAA# ,
,AA, -
SubtotalBB 
=BB 
oiBB !
.BB! "
SubtotalBB" *
,BB* +
SpecialInstructionsCC '
=CC( )
oiCC* ,
.CC, -
SpecialInstructionsCC- @
}DD 
)DD 
.DD 
ToListDD 
(DD 
)DD 
}EE 
)EE 
.EE 
ToListEE 
(EE 
)EE 
;EE 
returnGG 
ResultGG 
<GG 
ListGG 
<GG 
OrderDtoGG '
>GG' (
>GG( )
.GG) *
SuccessGG* 1
(GG1 2
	orderDtosGG2 ;
)GG; <
;GG< =
}HH 	
}II 
}JJ 0
[C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Orders\GetOrderById.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Orders& ,
;, -
public		 
static		 
class		 
GetOrderById		  
{

 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
OrderDto* 2
>2 3
>3 4
{ 
public 
Guid 
OrderId 
{ 
get !
;! "
init# '
;' (
}) *
public 
Guid 
UserId 
{ 
get  
;  !
init" &
;& '
}( )
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
OrderDtoB J
>J K
>K L
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
OrderDto! )
>) *
>* +
Handle, 2
(2 3
Query3 8
request9 @
,@ A
CancellationTokenB S
cancellationTokenT e
)e f
{ 	
var 
order 
= 
await 
_context &
.& '
Orders' -
.   
AsNoTracking   
(   
)   
.!! 
Include!! 
(!! 
o!! 
=>!! 
o!! 
.!!  

OrderItems!!  *
)!!* +
."" 
ThenInclude""  
(""  !
oi""! #
=>""$ &
oi""' )
."") *
Product""* 1
)""1 2
.## 
FirstOrDefaultAsync## $
(##$ %
o##% &
=>##' )
o##* +
.##+ ,
Id##, .
==##/ 1
request##2 9
.##9 :
OrderId##: A
,##A B
cancellationToken##C T
)##T U
;##U V
if&& 
(&& 
order&& 
is&& 
null&& 
)&& 
{'' 
return(( 
Result(( 
<(( 
OrderDto(( &
>((& '
.((' (
Failure((( /
(((/ 0
$"((0 2
$str((2 @
{((@ A
request((A H
.((H I
OrderId((I P
}((P Q
$str((Q [
"(([ \
)((\ ]
;((] ^
})) 
if,, 
(,, 
order,, 
.,, 
UserId,, 
!=,, 
request,,  '
.,,' (
UserId,,( .
),,. /
{-- 
return.. 
Result.. 
<.. 
OrderDto.. &
>..& '
...' (
Failure..( /
(../ 0
$str..0 [
)..[ \
;..\ ]
}// 
var22 
orderDto22 
=22 
new22 
OrderDto22 '
{33 
Id44 
=44 
order44 
.44 
Id44 
,44 
OrderNumber55 
=55 
order55 #
.55# $
OrderNumber55$ /
,55/ 0
UserId66 
=66 
order66 
.66 
UserId66 %
,66% &
TotalAmount77 
=77 
order77 #
.77# $
TotalAmount77$ /
,77/ 0
Status88 
=88 
order88 
.88 
Status88 %
,88% &
PaymentStatus99 
=99 
order99  %
.99% &
PaymentStatus99& 3
,993 4
PaymentMethod:: 
=:: 
order::  %
.::% &
PaymentMethod::& 3
,::3 4
Notes;; 
=;; 
order;; 
.;; 
Notes;; #
,;;# $
	CreatedAt<< 
=<< 
order<< !
.<<! "
	CreatedAt<<" +
,<<+ ,
	UpdatedAt== 
=== 
order== !
.==! "
	UpdatedAt==" +
,==+ ,
CompletedAt>> 
=>> 
order>> #
.>># $
CompletedAt>>$ /
,>>/ 0

OrderItems?? 
=?? 
order?? "
.??" #

OrderItems??# -
.??- .
Select??. 4
(??4 5
oi??5 7
=>??8 :
new??; >
OrderItemDto??? K
{@@ 
IdAA 
=AA 
oiAA 
.AA 
IdAA 
,AA 
	ProductIdBB 
=BB 
oiBB  "
.BB" #
	ProductIdBB# ,
,BB, -
ProductNameCC 
=CC  !
oiCC" $
.CC$ %
ProductCC% ,
.CC, -
NameCC- 1
,CC1 2
QuantityDD 
=DD 
oiDD !
.DD! "
QuantityDD" *
,DD* +
	UnitPriceEE 
=EE 
oiEE  "
.EE" #
	UnitPriceEE# ,
,EE, -
SubtotalFF 
=FF 
oiFF !
.FF! "
SubtotalFF" *
,FF* +
SpecialInstructionsGG '
=GG( )
oiGG* ,
.GG, -
SpecialInstructionsGG- @
}HH 
)HH 
.HH 
ToListHH 
(HH 
)HH 
}II 
;II 
returnKK 
ResultKK 
<KK 
OrderDtoKK "
>KK" #
.KK# $
SuccessKK$ +
(KK+ ,
orderDtoKK, 4
)KK4 5
;KK5 6
}LL 	
}MM 
}NN “‹
ZC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Orders\CreateOrder.cs
	namespace		 	

CampusEats		
 
.		 
Backend		 
.		 
Features		 %
.		% &
Orders		& ,
;		, -
public 
static 
class 
CreateOrder 
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,
OrderDto, 4
>4 5
>5 6
{ 
public 
Guid 
UserId 
{ 
get  
;  !
init" &
;& '
}( )
public 
string 
? 
PaymentMethod $
{% &
get' *
;* +
init, 0
;0 1
}2 3
public 
string 
? 
Notes 
{ 
get "
;" #
init$ (
;( )
}* +
public 
List 
< 
OrderItemRequest $
>$ %
Items& +
{, -
get. 1
;1 2
init3 7
;7 8
}9 :
=; <
new= @
(@ A
)A B
;B C
} 
public 

record 
OrderItemRequest "
{ 
public 
Guid 
	ProductId 
{ 
get  #
;# $
init% )
;) *
}+ ,
public 
int 
Quantity 
{ 
get !
;! "
init# '
;' (
}) *
public 
string 
? 
SpecialInstructions *
{+ ,
get- 0
;0 1
init2 6
;6 7
}8 9
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public   
	Validator   
(   
)   
{!! 	
RuleFor"" 
("" 
x"" 
=>"" 
x"" 
."" 
UserId"" !
)""! "
.## 
NotEmpty## 
(## 
)## 
.## 
WithMessage## '
(##' (
$str##( =
)##= >
;##> ?
RuleFor%% 
(%% 
x%% 
=>%% 
x%% 
.%% 
Items%%  
)%%  !
.&& 
NotEmpty&& 
(&& 
)&& 
.&& 
WithMessage&& '
(&&' (
$str&&( N
)&&N O
.'' 
Must'' 
('' 
items'' 
=>'' 
items'' $
.''$ %
Count''% *
>''+ ,
$num''- .
)''. /
.''/ 0
WithMessage''0 ;
(''; <
$str''< b
)''b c
;''c d
RuleForEach)) 
()) 
x)) 
=>)) 
x)) 
.)) 
Items)) $
)))$ %
.))% &

ChildRules))& 0
())0 1
item))1 5
=>))6 8
{** 
item++ 
.++ 
RuleFor++ 
(++ 
x++ 
=>++ !
x++" #
.++# $
	ProductId++$ -
)++- .
.,, 
NotEmpty,, 
(,, 
),, 
.,,  
WithMessage,,  +
(,,+ ,
$str,,, D
),,D E
;,,E F
item.. 
... 
RuleFor.. 
(.. 
x.. 
=>.. !
x.." #
...# $
Quantity..$ ,
).., -
.// 
GreaterThan//  
(//  !
$num//! "
)//" #
.//# $
WithMessage//$ /
(/// 0
$str//0 Q
)//Q R
.00 
LessThanOrEqualTo00 &
(00& '
$num00' )
)00) *
.00* +
WithMessage00+ 6
(006 7
$str007 X
)00X Y
;00Y Z
}11 
)11 
;11 
RuleFor33 
(33 
x33 
=>33 
x33 
.33 
PaymentMethod33 (
)33( )
.44 
Must44 
(44 
pm44 
=>44 
string44 "
.44" #
IsNullOrEmpty44# 0
(440 1
pm441 3
)443 4
||445 7
new448 ;
[44; <
]44< =
{44> ?
$str44@ F
,44F G
$str44H N
,44N O
$str44P Y
}44Z [
.44[ \
Contains44\ d
(44d e
pm44e g
)44g h
)44h i
.55 
When55 
(55 
x55 
=>55 
!55 
string55 "
.55" #
IsNullOrEmpty55# 0
(550 1
x551 2
.552 3
PaymentMethod553 @
)55@ A
)55A B
.66 
WithMessage66 
(66 
$str66 Q
)66Q R
;66R S
}77 	
}88 
internal;; 
sealed;; 
class;; 
Handler;; !
:;;" #
IRequestHandler;;$ 3
<;;3 4
Command;;4 ;
,;;; <
Result;;= C
<;;C D
OrderDto;;D L
>;;L M
>;;M N
{<< 
private== 
readonly== 
AppDbContext== %
_context==& .
;==. /
public?? 
Handler?? 
(?? 
AppDbContext?? #
context??$ +
)??+ ,
{@@ 	
_contextAA 
=AA 
contextAA 
;AA 
}BB 	
publicDD 
asyncDD 
TaskDD 
<DD 
ResultDD  
<DD  !
OrderDtoDD! )
>DD) *
>DD* +
HandleDD, 2
(DD2 3
CommandDD3 :
requestDD; B
,DDB C
CancellationTokenDDD U
cancellationTokenDDV g
)DDg h
{EE 	
varGG 

userExistsGG 
=GG 
awaitGG "
_contextGG# +
.GG+ ,
UsersGG, 1
.GG1 2
AnyAsyncGG2 :
(GG: ;
uGG; <
=>GG= ?
uGG@ A
.GGA B
IdGGB D
==GGE G
requestGGH O
.GGO P
UserIdGGP V
,GGV W
cancellationTokenGGX i
)GGi j
;GGj k
ifHH 
(HH 
!HH 

userExistsHH 
)HH 
{II 
returnJJ 
ResultJJ 
<JJ 
OrderDtoJJ &
>JJ& '
.JJ' (
FailureJJ( /
(JJ/ 0
$"JJ0 2
$strJJ2 ?
{JJ? @
requestJJ@ G
.JJG H
UserIdJJH N
}JJN O
$strJJO Y
"JJY Z
)JJZ [
;JJ[ \
}KK 
varNN 

productIdsNN 
=NN 
requestNN $
.NN$ %
ItemsNN% *
.NN* +
SelectNN+ 1
(NN1 2
iNN2 3
=>NN4 6
iNN7 8
.NN8 9
	ProductIdNN9 B
)NNB C
.NNC D
DistinctNND L
(NNL M
)NNM N
.NNN O
ToListNNO U
(NNU V
)NNV W
;NNW X
varQQ 
productsQQ 
=QQ 
awaitQQ  
_contextQQ! )
.QQ) *
ProductsQQ* 2
.RR 
WhereRR 
(RR 
pRR 
=>RR 

productIdsRR &
.RR& '
ContainsRR' /
(RR/ 0
pRR0 1
.RR1 2
IdRR2 4
)RR4 5
)RR5 6
.SS 
ToListAsyncSS 
(SS 
cancellationTokenSS .
)SS. /
;SS/ 0
ifVV 
(VV 
productsVV 
.VV 
CountVV 
!=VV !

productIdsVV" ,
.VV, -
CountVV- 2
)VV2 3
{WW 
varXX 

missingIdsXX 
=XX  

productIdsXX! +
.XX+ ,
ExceptXX, 2
(XX2 3
productsXX3 ;
.XX; <
SelectXX< B
(XXB C
pXXC D
=>XXE G
pXXH I
.XXI J
IdXXJ L
)XXL M
)XXM N
.XXN O
ToListXXO U
(XXU V
)XXV W
;XXW X
returnYY 
ResultYY 
<YY 
OrderDtoYY &
>YY& '
.YY' (
FailureYY( /
(YY/ 0
$"YY0 2
$strYY2 F
{YYF G
stringYYG M
.YYM N
JoinYYN R
(YYR S
$strYYS W
,YYW X

missingIdsYYY c
)YYc d
}YYd e
"YYe f
)YYf g
;YYg h
}ZZ 
var]] 
unavailableProducts]] #
=]]$ %
products]]& .
.]]. /
Where]]/ 4
(]]4 5
p]]5 6
=>]]7 9
!]]: ;
p]]; <
.]]< =
IsAvailable]]= H
)]]H I
.]]I J
ToList]]J P
(]]P Q
)]]Q R
;]]R S
if^^ 
(^^ 
unavailableProducts^^ #
.^^# $
Any^^$ '
(^^' (
)^^( )
)^^) *
{__ 
var`` 
unavailableNames`` $
=``% &
string``' -
.``- .
Join``. 2
(``2 3
$str``3 7
,``7 8
unavailableProducts``9 L
.``L M
Select``M S
(``S T
p``T U
=>``V X
p``Y Z
.``Z [
Name``[ _
)``_ `
)``` a
;``a b
returnaa 
Resultaa 
<aa 
OrderDtoaa &
>aa& '
.aa' (
Failureaa( /
(aa/ 0
$"aa0 2
$straa2 J
{aaJ K
unavailableNamesaaK [
}aa[ \
"aa\ ]
)aa] ^
;aa^ _
}bb 
varee 
orderee 
=ee 
newee 
Orderee !
{ff 
Idgg 
=gg 
Guidgg 
.gg 
NewGuidgg !
(gg! "
)gg" #
,gg# $
OrderNumberhh 
=hh 
GenerateOrderNumberhh 1
(hh1 2
)hh2 3
,hh3 4
UserIdii 
=ii 
requestii  
.ii  !
UserIdii! '
,ii' (
Statusjj 
=jj 
$strjj "
,jj" #
PaymentStatuskk 
=kk 
$strkk  )
,kk) *
PaymentMethodll 
=ll 
requestll  '
.ll' (
PaymentMethodll( 5
,ll5 6
Notesmm 
=mm 
requestmm 
.mm  
Notesmm  %
,mm% &
	CreatedAtnn 
=nn 
DateTimenn $
.nn$ %
UtcNownn% +
}oo 
;oo 
varrr 

orderItemsrr 
=rr 
newrr  
Listrr! %
<rr% &
	OrderItemrr& /
>rr/ 0
(rr0 1
)rr1 2
;rr2 3
decimalss 
totalAmountss 
=ss  !
$numss" #
;ss# $
foreachuu 
(uu 
varuu 
itemRequestuu $
inuu% '
requestuu( /
.uu/ 0
Itemsuu0 5
)uu5 6
{vv 
varww 
productww 
=ww 
productsww &
.ww& '
Firstww' ,
(ww, -
pww- .
=>ww/ 1
pww2 3
.ww3 4
Idww4 6
==ww7 9
itemRequestww: E
.wwE F
	ProductIdwwF O
)wwO P
;wwP Q
varxx 
subtotalxx 
=xx 
productxx &
.xx& '
Pricexx' ,
*xx- .
itemRequestxx/ :
.xx: ;
Quantityxx; C
;xxC D
varzz 
	orderItemzz 
=zz 
newzz  #
	OrderItemzz$ -
{{{ 
Id|| 
=|| 
Guid|| 
.|| 
NewGuid|| %
(||% &
)||& '
,||' (
OrderId}} 
=}} 
order}} #
.}}# $
Id}}$ &
,}}& '
	ProductId~~ 
=~~ 
product~~  '
.~~' (
Id~~( *
,~~* +
Quantity 
= 
itemRequest *
.* +
Quantity+ 3
,3 4
	UnitPrice
€€ 
=
€€ 
product
€€  '
.
€€' (
Price
€€( -
,
€€- .
Subtotal
 
=
 
subtotal
 '
,
' (!
SpecialInstructions
‚‚ '
=
‚‚( )
itemRequest
‚‚* 5
.
‚‚5 6!
SpecialInstructions
‚‚6 I
}
ƒƒ 
;
ƒƒ 

orderItems
…… 
.
…… 
Add
…… 
(
…… 
	orderItem
…… (
)
……( )
;
……) *
totalAmount
†† 
+=
†† 
subtotal
†† '
;
††' (
}
‡‡ 
order
‰‰ 
.
‰‰ 
TotalAmount
‰‰ 
=
‰‰ 
totalAmount
‰‰  +
;
‰‰+ ,
order
ŠŠ 
.
ŠŠ 

OrderItems
ŠŠ 
=
ŠŠ 

orderItems
ŠŠ )
;
ŠŠ) *
_context
 
.
 
Orders
 
.
 
Add
 
(
  
order
  %
)
% &
;
& '
await
 
_context
 
.
 
SaveChangesAsync
 +
(
+ ,
cancellationToken
, =
)
= >
;
> ?
var
‘‘ 
dto
‘‘ 
=
‘‘ 
new
‘‘ 
OrderDto
‘‘ "
{
’’ 
Id
““ 
=
““ 
order
““ 
.
““ 
Id
““ 
,
““ 
OrderNumber
”” 
=
”” 
order
”” #
.
””# $
OrderNumber
””$ /
,
””/ 0
UserId
•• 
=
•• 
order
•• 
.
•• 
UserId
•• %
,
••% &
TotalAmount
–– 
=
–– 
order
–– #
.
––# $
TotalAmount
––$ /
,
––/ 0
Status
—— 
=
—— 
order
—— 
.
—— 
Status
—— %
,
——% &
PaymentStatus
˜˜ 
=
˜˜ 
order
˜˜  %
.
˜˜% &
PaymentStatus
˜˜& 3
,
˜˜3 4
PaymentMethod
™™ 
=
™™ 
order
™™  %
.
™™% &
PaymentMethod
™™& 3
,
™™3 4
Notes
šš 
=
šš 
order
šš 
.
šš 
Notes
šš #
,
šš# $
	CreatedAt
›› 
=
›› 
order
›› !
.
››! "
	CreatedAt
››" +
,
››+ ,
	UpdatedAt
œœ 
=
œœ 
order
œœ !
.
œœ! "
	UpdatedAt
œœ" +
,
œœ+ ,
CompletedAt
 
=
 
order
 #
.
# $
CompletedAt
$ /
,
/ 0

OrderItems
 
=
 

orderItems
 '
.
' (
Select
( .
(
. /
oi
/ 1
=>
2 4
new
5 8
OrderItemDto
9 E
{
ŸŸ 
Id
   
=
   
oi
   
.
   
Id
   
,
   
	ProductId
¡¡ 
=
¡¡ 
oi
¡¡  "
.
¡¡" #
	ProductId
¡¡# ,
,
¡¡, -
ProductName
¢¢ 
=
¢¢  !
products
¢¢" *
.
¢¢* +
First
¢¢+ 0
(
¢¢0 1
p
¢¢1 2
=>
¢¢3 5
p
¢¢6 7
.
¢¢7 8
Id
¢¢8 :
==
¢¢; =
oi
¢¢> @
.
¢¢@ A
	ProductId
¢¢A J
)
¢¢J K
.
¢¢K L
Name
¢¢L P
,
¢¢P Q
Quantity
££ 
=
££ 
oi
££ !
.
££! "
Quantity
££" *
,
££* +
	UnitPrice
¤¤ 
=
¤¤ 
oi
¤¤  "
.
¤¤" #
	UnitPrice
¤¤# ,
,
¤¤, -
Subtotal
¥¥ 
=
¥¥ 
oi
¥¥ !
.
¥¥! "
Subtotal
¥¥" *
,
¥¥* +!
SpecialInstructions
¦¦ '
=
¦¦( )
oi
¦¦* ,
.
¦¦, -!
SpecialInstructions
¦¦- @
}
§§ 
)
§§ 
.
§§ 
ToList
§§ 
(
§§ 
)
§§ 
}
¨¨ 
;
¨¨ 
return
ªª 
Result
ªª 
<
ªª 
OrderDto
ªª "
>
ªª" #
.
ªª# $
Success
ªª$ +
(
ªª+ ,
dto
ªª, /
)
ªª/ 0
;
ªª0 1
}
«« 	
private
®® 
static
®® 
string
®® !
GenerateOrderNumber
®® 1
(
®®1 2
)
®®2 3
{
¯¯ 	
var
°° 
date
°° 
=
°° 
DateTime
°° 
.
°°  
UtcNow
°°  &
.
°°& '
ToString
°°' /
(
°°/ 0
$str
°°0 :
)
°°: ;
;
°°; <
var
±± 
random
±± 
=
±± 
new
±± 
Random
±± #
(
±±# $
)
±±$ %
.
±±% &
Next
±±& *
(
±±* +
$num
±±+ /
,
±±/ 0
$num
±±1 5
)
±±5 6
;
±±6 7
return
²² 
$"
²² 
$str
²² 
{
²² 
date
²² 
}
²² 
$str
²²  
{
²²  !
random
²²! '
}
²²' (
"
²²( )
;
²²) *
}
³³ 	
}
´´ 
}µµ ıR
ZC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Orders\CancelOrder.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Orders& ,
;, -
public

 
static

 
class

 
CancelOrder

 
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,
OrderDto, 4
>4 5
>5 6
{ 
public 
Guid 
OrderId 
{ 
get !
;! "
init# '
;' (
}) *
public 
Guid 
UserId 
{ 
get  
;  !
init" &
;& '
}( )
public 
string 
? 
CancellationReason )
{* +
get, /
;/ 0
init1 5
;5 6
}7 8
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
OrderId "
)" #
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( >
)> ?
;? @
RuleFor 
( 
x 
=> 
x 
. 
UserId !
)! "
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( =
)= >
;> ?
RuleFor 
( 
x 
=> 
x 
. 
CancellationReason -
)- .
.   
MaximumLength   
(   
$num   "
)  " #
.  # $
WithMessage  $ /
(  / 0
$str  0 b
)  b c
.!! 
When!! 
(!! 
x!! 
=>!! 
!!! 
string!! "
.!!" #
IsNullOrEmpty!!# 0
(!!0 1
x!!1 2
.!!2 3
CancellationReason!!3 E
)!!E F
)!!F G
;!!G H
}"" 	
}## 
internal&& 
sealed&& 
class&& 
Handler&& !
:&&" #
IRequestHandler&&$ 3
<&&3 4
Command&&4 ;
,&&; <
Result&&= C
<&&C D
OrderDto&&D L
>&&L M
>&&M N
{'' 
private(( 
readonly(( 
AppDbContext(( %
_context((& .
;((. /
public** 
Handler** 
(** 
AppDbContext** #
context**$ +
)**+ ,
{++ 	
_context,, 
=,, 
context,, 
;,, 
}-- 	
public// 
async// 
Task// 
<// 
Result//  
<//  !
OrderDto//! )
>//) *
>//* +
Handle//, 2
(//2 3
Command//3 :
request//; B
,//B C
CancellationToken//D U
cancellationToken//V g
)//g h
{00 	
var22 
order22 
=22 
await22 
_context22 &
.22& '
Orders22' -
.33 
Include33 
(33 
o33 
=>33 
o33 
.33  

OrderItems33  *
)33* +
.44 
ThenInclude44  
(44  !
oi44! #
=>44$ &
oi44' )
.44) *
Product44* 1
)441 2
.55 
FirstOrDefaultAsync55 $
(55$ %
o55% &
=>55' )
o55* +
.55+ ,
Id55, .
==55/ 1
request552 9
.559 :
OrderId55: A
,55A B
cancellationToken55C T
)55T U
;55U V
if77 
(77 
order77 
is77 
null77 
)77 
{88 
return99 
Result99 
<99 
OrderDto99 &
>99& '
.99' (
Failure99( /
(99/ 0
$"990 2
$str992 @
{99@ A
request99A H
.99H I
OrderId99I P
}99P Q
$str99Q [
"99[ \
)99\ ]
;99] ^
}:: 
if== 
(== 
order== 
.== 
UserId== 
!=== 
request==  '
.==' (
UserId==( .
)==. /
{>> 
return?? 
Result?? 
<?? 
OrderDto?? &
>??& '
.??' (
Failure??( /
(??/ 0
$str??0 ]
)??] ^
;??^ _
}@@ 
ifCC 
(CC 
orderCC 
.CC 
StatusCC 
==CC 
$strCC  +
)CC+ ,
{DD 
returnEE 
ResultEE 
<EE 
OrderDtoEE &
>EE& '
.EE' (
FailureEE( /
(EE/ 0
$strEE0 O
)EEO P
;EEP Q
}FF 
ifHH 
(HH 
orderHH 
.HH 
StatusHH 
==HH 
$strHH  +
)HH+ ,
{II 
returnJJ 
ResultJJ 
<JJ 
OrderDtoJJ &
>JJ& '
.JJ' (
FailureJJ( /
(JJ/ 0
$strJJ0 L
)JJL M
;JJM N
}KK 
varNN 
timeSinceCreationNN !
=NN" #
DateTimeNN$ ,
.NN, -
UtcNowNN- 3
-NN4 5
orderNN6 ;
.NN; <
	CreatedAtNN< E
;NNE F
ifOO 
(OO 
orderOO 
.OO 
StatusOO 
==OO 
$strOO  +
&&OO, .
timeSinceCreationOO/ @
.OO@ A
TotalMinutesOOA M
>OON O
$numOOP Q
)OOQ R
{PP 
returnQQ 
ResultQQ 
<QQ 
OrderDtoQQ &
>QQ& '
.QQ' (
FailureQQ( /
(QQ/ 0
$strRR p
)RRp q
;RRq r
}SS 
orderVV 
.VV 
StatusVV 
=VV 
$strVV &
;VV& '
orderWW 
.WW 
PaymentStatusWW 
=WW  !
$strWW" ,
;WW, -
orderXX 
.XX 
	UpdatedAtXX 
=XX 
DateTimeXX &
.XX& '
UtcNowXX' -
;XX- .
if[[ 
([[ 
![[ 
string[[ 
.[[ 
IsNullOrEmpty[[ %
([[% &
request[[& -
.[[- .
CancellationReason[[. @
)[[@ A
)[[A B
{\\ 
order]] 
.]] 
Notes]] 
=]] 
string]] $
.]]$ %
IsNullOrEmpty]]% 2
(]]2 3
order]]3 8
.]]8 9
Notes]]9 >
)]]> ?
?^^ 
$"^^ 
$str^^ #
{^^# $
request^^$ +
.^^+ ,
CancellationReason^^, >
}^^> ?
"^^? @
:__ 
$"__ 
{__ 
order__ 
.__ 
Notes__ $
}__$ %
$str__% 2
{__2 3
request__3 :
.__: ;
CancellationReason__; M
}__M N
"__N O
;__O P
}`` 
awaithh 
_contexthh 
.hh 
SaveChangesAsynchh +
(hh+ ,
cancellationTokenhh, =
)hh= >
;hh> ?
varkk 
orderDtokk 
=kk 
newkk 
OrderDtokk '
{ll 
Idmm 
=mm 
ordermm 
.mm 
Idmm 
,mm 
OrderNumbernn 
=nn 
ordernn #
.nn# $
OrderNumbernn$ /
,nn/ 0
UserIdoo 
=oo 
orderoo 
.oo 
UserIdoo %
,oo% &
TotalAmountpp 
=pp 
orderpp #
.pp# $
TotalAmountpp$ /
,pp/ 0
Statusqq 
=qq 
orderqq 
.qq 
Statusqq %
,qq% &
PaymentStatusrr 
=rr 
orderrr  %
.rr% &
PaymentStatusrr& 3
,rr3 4
PaymentMethodss 
=ss 
orderss  %
.ss% &
PaymentMethodss& 3
,ss3 4
Notestt 
=tt 
ordertt 
.tt 
Notestt #
,tt# $
	CreatedAtuu 
=uu 
orderuu !
.uu! "
	CreatedAtuu" +
,uu+ ,
	UpdatedAtvv 
=vv 
ordervv !
.vv! "
	UpdatedAtvv" +
,vv+ ,
CompletedAtww 
=ww 
orderww #
.ww# $
CompletedAtww$ /
,ww/ 0

OrderItemsxx 
=xx 
orderxx "
.xx" #

OrderItemsxx# -
.xx- .
Selectxx. 4
(xx4 5
oixx5 7
=>xx8 :
newxx; >
OrderItemDtoxx? K
{yy 
Idzz 
=zz 
oizz 
.zz 
Idzz 
,zz 
	ProductId{{ 
={{ 
oi{{  "
.{{" #
	ProductId{{# ,
,{{, -
ProductName|| 
=||  !
oi||" $
.||$ %
Product||% ,
.||, -
Name||- 1
,||1 2
Quantity}} 
=}} 
oi}} !
.}}! "
Quantity}}" *
,}}* +
	UnitPrice~~ 
=~~ 
oi~~  "
.~~" #
	UnitPrice~~# ,
,~~, -
Subtotal 
= 
oi !
.! "
Subtotal" *
,* +!
SpecialInstructions
€€ '
=
€€( )
oi
€€* ,
.
€€, -!
SpecialInstructions
€€- @
}
 
)
 
.
 
ToList
 
(
 
)
 
}
‚‚ 
;
‚‚ 
return
„„ 
Result
„„ 
<
„„ 
OrderDto
„„ "
>
„„" #
.
„„# $
Success
„„$ +
(
„„+ ,
orderDto
„„, 4
)
„„4 5
;
„„5 6
}
…… 	
}
†† 
}‡‡ O
ZC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Menu\UpdateProduct.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Menu& *
;* +
public

 
static

 
class

 
UpdateProduct

 !
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,

ProductDto, 6
>6 7
>7 8
{ 
public 
Guid 
Id 
{ 
get 
; 
init "
;" #
}$ %
public 
string 
Name 
{ 
get  
;  !
init" &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 
string 
Description !
{" #
get$ '
;' (
init) -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 
decimal 
Price 
{ 
get "
;" #
init$ (
;( )
}* +
public 
string 
Category 
{  
get! $
;$ %
init& *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
? 
ImageUrl 
{  !
get" %
;% &
init' +
;+ ,
}- .
public 
List 
< 
string 
> 
	Allergens %
{& '
get( +
;+ ,
init- 1
;1 2
}3 4
=5 6
new7 :
(: ;
); <
;< =
public 
string 
? 
DietaryRestrictions *
{+ ,
get- 0
;0 1
init2 6
;6 7
}8 9
public 
bool 
IsAvailable 
{  !
get" %
;% &
init' +
;+ ,
}- .
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Id 
) 
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( @
)@ A
;A B
RuleFor   
(   
x   
=>   
x   
.   
Name   
)    
.!! 
NotEmpty!! 
(!! 
)!! 
.!! 
WithMessage!! '
(!!' (
$str!!( B
)!!B C
."" 
MaximumLength"" 
("" 
$num"" "
)""" #
.""# $
WithMessage""$ /
(""/ 0
$str""0 [
)""[ \
;""\ ]
RuleFor$$ 
($$ 
x$$ 
=>$$ 
x$$ 
.$$ 
Description$$ &
)$$& '
.%% 
NotEmpty%% 
(%% 
)%% 
.%% 
WithMessage%% '
(%%' (
$str%%( A
)%%A B
.&& 
MaximumLength&& 
(&& 
$num&& "
)&&" #
.&&# $
WithMessage&&$ /
(&&/ 0
$str&&0 Z
)&&Z [
;&&[ \
RuleFor(( 
((( 
x(( 
=>(( 
x(( 
.(( 
Price((  
)((  !
.)) 
GreaterThan)) 
()) 
$num)) 
))) 
.))  
WithMessage))  +
())+ ,
$str)), J
)))J K
.** 
LessThanOrEqualTo** "
(**" #
$num**# '
)**' (
.**( )
WithMessage**) 4
(**4 5
$str**5 S
)**S T
;**T U
RuleFor,, 
(,, 
x,, 
=>,, 
x,, 
.,, 
Category,, #
),,# $
.-- 
NotEmpty-- 
(-- 
)-- 
.-- 
WithMessage-- '
(--' (
$str--( >
)--> ?
... 
Must.. 
(.. 
category.. 
=>.. !
new.." %
[..% &
]..& '
{..( )
$str..* 0
,..0 1
$str..2 9
,..9 :
$str..; D
,..D E
$str..F M
}..N O
...O P
Contains..P X
(..X Y
category..Y a
)..a b
)..b c
.// 
WithMessage// 
(// 
$str// S
)//S T
;//T U
}00 	
}11 
internal33 
sealed33 
class33 
Handler33 !
:33" #
IRequestHandler33$ 3
<333 4
Command334 ;
,33; <
Result33= C
<33C D

ProductDto33D N
>33N O
>33O P
{44 
private55 
readonly55 
AppDbContext55 %
_context55& .
;55. /
public77 
Handler77 
(77 
AppDbContext77 #
context77$ +
)77+ ,
{88 	
_context99 
=99 
context99 
;99 
}:: 	
public<< 
async<< 
Task<< 
<<< 
Result<<  
<<<  !

ProductDto<<! +
><<+ ,
><<, -
Handle<<. 4
(<<4 5
Command<<5 <
request<<= D
,<<D E
CancellationToken<<F W
cancellationToken<<X i
)<<i j
{== 	
var>> 
product>> 
=>> 
await>> 
_context>>  (
.>>( )
Products>>) 1
.?? 
FirstOrDefaultAsync?? $
(??$ %
p??% &
=>??' )
p??* +
.??+ ,
Id??, .
==??/ 1
request??2 9
.??9 :
Id??: <
,??< =
cancellationToken??> O
)??O P
;??P Q
ifAA 
(AA 
productAA 
isAA 
nullAA 
)AA  
{BB 
returnCC 
ResultCC 
<CC 

ProductDtoCC (
>CC( )
.CC) *
FailureCC* 1
(CC1 2
$"CC2 4
$strCC4 D
{CCD E
requestCCE L
.CCL M
IdCCM O
}CCO P
$strCCP Z
"CCZ [
)CC[ \
;CC\ ]
}DD 
productFF 
.FF 
NameFF 
=FF 
requestFF "
.FF" #
NameFF# '
;FF' (
productGG 
.GG 
DescriptionGG 
=GG  !
requestGG" )
.GG) *
DescriptionGG* 5
;GG5 6
productHH 
.HH 
PriceHH 
=HH 
requestHH #
.HH# $
PriceHH$ )
;HH) *
productII 
.II 
CategoryII 
=II 
requestII &
.II& '
CategoryII' /
;II/ 0
productJJ 
.JJ 
ImageUrlJJ 
=JJ 
requestJJ &
.JJ& '
ImageUrlJJ' /
;JJ/ 0
productKK 
.KK 
	AllergensKK 
=KK 
requestKK  '
.KK' (
	AllergensKK( 1
;KK1 2
productLL 
.LL 
DietaryRestrictionsLL '
=LL( )
requestLL* 1
.LL1 2
DietaryRestrictionsLL2 E
;LLE F
productMM 
.MM 
IsAvailableMM 
=MM  !
requestMM" )
.MM) *
IsAvailableMM* 5
;MM5 6
productNN 
.NN 
	UpdatedAtNN 
=NN 
DateTimeNN  (
.NN( )
UtcNowNN) /
;NN/ 0
awaitPP 
_contextPP 
.PP 
SaveChangesAsyncPP +
(PP+ ,
cancellationTokenPP, =
)PP= >
;PP> ?
varRR 
dtoRR 
=RR 
newRR 

ProductDtoRR $
{SS 
IdTT 
=TT 
productTT 
.TT 
IdTT 
,TT  
NameUU 
=UU 
productUU 
.UU 
NameUU #
,UU# $
DescriptionVV 
=VV 
productVV %
.VV% &
DescriptionVV& 1
,VV1 2
PriceWW 
=WW 
productWW 
.WW  
PriceWW  %
,WW% &
CategoryXX 
=XX 
productXX "
.XX" #
CategoryXX# +
,XX+ ,
ImageUrlYY 
=YY 
productYY "
.YY" #
ImageUrlYY# +
,YY+ ,
	AllergensZZ 
=ZZ 
productZZ #
.ZZ# $
	AllergensZZ$ -
,ZZ- .
DietaryRestrictions[[ #
=[[$ %
product[[& -
.[[- .
DietaryRestrictions[[. A
,[[A B
IsAvailable\\ 
=\\ 
product\\ %
.\\% &
IsAvailable\\& 1
,\\1 2
	CreatedAt]] 
=]] 
product]] #
.]]# $
	CreatedAt]]$ -
,]]- .
	UpdatedAt^^ 
=^^ 
product^^ #
.^^# $
	UpdatedAt^^$ -
}__ 
;__ 
returnaa 
Resultaa 
<aa 

ProductDtoaa $
>aa$ %
.aa% &
Successaa& -
(aa- .
dtoaa. 1
)aa1 2
;aa2 3
}bb 	
}cc 
}dd Õ$
[C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Menu\GetProductById.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Menu& *
;* +
public

 
static

 
class

 
GetProductById

 "
{ 
public 

record 
Query 
( 
Guid 
Id 
)  
:! "
IRequest# +
<+ ,
Result, 2
<2 3

ProductDto3 =
>= >
>> ?
;? @
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Query/ 4
>4 5
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Id 
) 
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( @
)@ A
;A B
} 	
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B

ProductDtoB L
>L M
>M N
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public   
async   
Task   
<   
Result    
<    !

ProductDto  ! +
>  + ,
>  , -
Handle  . 4
(  4 5
Query  5 :
request  ; B
,  B C
CancellationToken  D U
cancellationToken  V g
)  g h
{!! 	
var"" 
product"" 
="" 
await"" 
_context""  (
.""( )
Products"") 1
.## 
AsNoTracking## 
(## 
)## 
.$$ 
FirstOrDefaultAsync$$ $
($$$ %
p$$% &
=>$$' )
p$$* +
.$$+ ,
Id$$, .
==$$/ 1
request$$2 9
.$$9 :
Id$$: <
,$$< =
cancellationToken$$> O
)$$O P
;$$P Q
if&& 
(&& 
product&& 
is&& 
null&& 
)&&  
{'' 
return(( 
Result(( 
<(( 

ProductDto(( (
>((( )
.(() *
Failure((* 1
(((1 2
$"((2 4
$str((4 D
{((D E
request((E L
.((L M
Id((M O
}((O P
$str((P Z
"((Z [
)(([ \
;((\ ]
})) 
var++ 
dto++ 
=++ 
new++ 

ProductDto++ $
{,, 
Id-- 
=-- 
product-- 
.-- 
Id-- 
,--  
Name.. 
=.. 
product.. 
... 
Name.. #
,..# $
Description// 
=// 
product// %
.//% &
Description//& 1
,//1 2
Price00 
=00 
product00 
.00  
Price00  %
,00% &
Category11 
=11 
product11 "
.11" #
Category11# +
,11+ ,
ImageUrl22 
=22 
product22 "
.22" #
ImageUrl22# +
,22+ ,
	Allergens33 
=33 
product33 #
.33# $
	Allergens33$ -
,33- .
DietaryRestrictions44 #
=44$ %
product44& -
.44- .
DietaryRestrictions44. A
,44A B
IsAvailable55 
=55 
product55 %
.55% &
IsAvailable55& 1
,551 2
	CreatedAt66 
=66 
product66 #
.66# $
	CreatedAt66$ -
,66- .
	UpdatedAt77 
=77 
product77 #
.77# $
	UpdatedAt77$ -
}88 
;88 
return:: 
Result:: 
<:: 

ProductDto:: $
>::$ %
.::% &
Success::& -
(::- .
dto::. 1
)::1 2
;::2 3
};; 	
}<< 
}== 
TC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Menu\GetMenu.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Menu& *
;* +
public		 
static		 
class		 
GetMenu		 
{

 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
List* .
<. /

ProductDto/ 9
>9 :
>: ;
>; <
;< =
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
ListB F
<F G

ProductDtoG Q
>Q R
>R S
>S T
{ 
private 
readonly 
AppDbContext %

_dbContext& 0
;0 1
public 
Handler 
( 
AppDbContext #
	dbContext$ -
)- .
{ 	

_dbContext 
= 
	dbContext "
;" #
} 	
public 
async 
Task 
< 
Result  
<  !
List! %
<% &

ProductDto& 0
>0 1
>1 2
>2 3
Handle4 :
(: ;
Query; @
requestA H
,H I
CancellationTokenJ [
cancellationToken\ m
)m n
{ 	
var 
products 
= 
await  

_dbContext! +
.+ ,
Products, 4
. 
AsNoTracking 
( 
) 
. 
Where 
( 
p 
=> 
p 
. 
IsAvailable )
)) *
. 
Select 
( 
p 
=> 
new  

ProductDto! +
{ 
Id 
= 
p 
. 
Id 
, 
Name 
= 
p 
. 
Name !
,! "
Description   
=    !
p  " #
.  # $
Description  $ /
,  / 0
Price!! 
=!! 
p!! 
.!! 
Price!! #
,!!# $
Category"" 
="" 
p""  
.""  !
Category""! )
,"") *
ImageUrl## 
=## 
p##  
.##  !
ImageUrl##! )
,##) *
	Allergens$$ 
=$$ 
p$$  !
.$$! "
	Allergens$$" +
,$$+ ,
DietaryRestrictions%% '
=%%( )
p%%* +
.%%+ ,
DietaryRestrictions%%, ?
,%%? @
IsAvailable&& 
=&&  !
p&&" #
.&&# $
IsAvailable&&$ /
,&&/ 0
	CreatedAt'' 
='' 
p''  !
.''! "
	CreatedAt''" +
,''+ ,
	UpdatedAt(( 
=(( 
p((  !
.((! "
	UpdatedAt((" +
})) 
))) 
.** 
ToListAsync** 
(** 
cancellationToken** .
)**. /
;**/ 0
return,, 
Result,, 
<,, 
List,, 
<,, 

ProductDto,, )
>,,) *
>,,* +
.,,+ ,
Success,,, 3
(,,3 4
products,,4 <
),,< =
;,,= >
}-- 	
}.. 
}// ‹
ZC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Menu\DeleteProduct.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Menu& *
;* +
public		 
static		 
class		 
DeleteProduct		 !
{

 
public 

record 
Command 
( 
Guid 
Id !
)! "
:# $
IRequest% -
<- .
Result. 4
>4 5
;5 6
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Id 
) 
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( @
)@ A
;A B
} 	
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Command4 ;
,; <
Result= C
>C D
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
}   	
public"" 
async"" 
Task"" 
<"" 
Result""  
>""  !
Handle""" (
(""( )
Command"") 0
request""1 8
,""8 9
CancellationToken"": K
cancellationToken""L ]
)""] ^
{## 	
var$$ 
product$$ 
=$$ 
await$$ 
_context$$  (
.$$( )
Products$$) 1
.%% 
FirstOrDefaultAsync%% $
(%%$ %
p%%% &
=>%%' )
p%%* +
.%%+ ,
Id%%, .
==%%/ 1
request%%2 9
.%%9 :
Id%%: <
,%%< =
cancellationToken%%> O
)%%O P
;%%P Q
if'' 
('' 
product'' 
is'' 
null'' 
)''  
{(( 
return)) 
Result)) 
.)) 
Failure)) %
())% &
$"))& (
$str))( 8
{))8 9
request))9 @
.))@ A
Id))A C
}))C D
$str))D N
"))N O
)))O P
;))P Q
}** 
var-- 
	hasOrders-- 
=-- 
await-- !
_context--" *
.--* +

OrderItems--+ 5
... 
AnyAsync.. 
(.. 
oi.. 
=>.. 
oi..  "
..." #
	ProductId..# ,
==..- /
request..0 7
...7 8
Id..8 :
,..: ;
cancellationToken..< M
)..M N
;..N O
if00 
(00 
	hasOrders00 
)00 
{11 
return22 
Result22 
.22 
Failure22 %
(22% &
$str	22& €
)
22€ 
;
22 ‚
}33 
_context55 
.55 
Products55 
.55 
Remove55 $
(55$ %
product55% ,
)55, -
;55- .
await66 
_context66 
.66 
SaveChangesAsync66 +
(66+ ,
cancellationToken66, =
)66= >
;66> ?
return88 
Result88 
.88 
Success88 !
(88! "
)88" #
;88# $
}99 	
}:: 
};; ¢M
ZC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Menu\CreateProduct.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Menu& *
;* +
public

 
static

 
class

 
CreateProduct

 !
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,

ProductDto, 6
>6 7
>7 8
{ 
public 
string 
Name 
{ 
get  
;  !
init" &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 
string 
Description !
{" #
get$ '
;' (
init) -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 
decimal 
Price 
{ 
get "
;" #
init$ (
;( )
}* +
public 
string 
Category 
{  
get! $
;$ %
init& *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
? 
ImageUrl 
{  !
get" %
;% &
init' +
;+ ,
}- .
public 
List 
< 
string 
> 
	Allergens %
{& '
get( +
;+ ,
init- 1
;1 2
}3 4
=5 6
new7 :
(: ;
); <
;< =
public 
string 
? 
DietaryRestrictions *
{+ ,
get- 0
;0 1
init2 6
;6 7
}8 9
public 
bool 
IsAvailable 
{  !
get" %
;% &
init' +
;+ ,
}- .
=/ 0
true1 5
;5 6
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Name 
)  
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( B
)B C
.   
MaximumLength   
(   
$num   "
)  " #
.  # $
WithMessage  $ /
(  / 0
$str  0 [
)  [ \
;  \ ]
RuleFor"" 
("" 
x"" 
=>"" 
x"" 
."" 
Description"" &
)""& '
.## 
NotEmpty## 
(## 
)## 
.## 
WithMessage## '
(##' (
$str##( A
)##A B
.$$ 
MaximumLength$$ 
($$ 
$num$$ "
)$$" #
.$$# $
WithMessage$$$ /
($$/ 0
$str$$0 Z
)$$Z [
;$$[ \
RuleFor&& 
(&& 
x&& 
=>&& 
x&& 
.&& 
Price&&  
)&&  !
.'' 
GreaterThan'' 
('' 
$num'' 
)'' 
.''  
WithMessage''  +
(''+ ,
$str'', J
)''J K
.(( 
LessThanOrEqualTo(( "
(((" #
$num((# '
)((' (
.((( )
WithMessage(() 4
(((4 5
$str((5 S
)((S T
;((T U
RuleFor** 
(** 
x** 
=>** 
x** 
.** 
Category** #
)**# $
.++ 
NotEmpty++ 
(++ 
)++ 
.++ 
WithMessage++ '
(++' (
$str++( >
)++> ?
.,, 
Must,, 
(,, 
category,, 
=>,, !
new,," %
[,,% &
],,& '
{,,( )
$str,,* 0
,,,0 1
$str,,2 9
,,,9 :
$str,,; D
,,,D E
$str,,F M
},,N O
.,,O P
Contains,,P X
(,,X Y
category,,Y a
),,a b
),,b c
.-- 
WithMessage-- 
(-- 
$str-- S
)--S T
;--T U
RuleFor// 
(// 
x// 
=>// 
x// 
.// 
ImageUrl// #
)//# $
.00 
Must00 
(00 
url00 
=>00 
string00 #
.00# $
IsNullOrEmpty00$ 1
(001 2
url002 5
)005 6
||007 9
Uri00: =
.00= >
	TryCreate00> G
(00G H
url00H K
,00K L
UriKind00M T
.00T U
Absolute00U ]
,00] ^
out00_ b
_00c d
)00d e
)00e f
.11 
When11 
(11 
x11 
=>11 
!11 
string11 "
.11" #
IsNullOrEmpty11# 0
(110 1
x111 2
.112 3
ImageUrl113 ;
)11; <
)11< =
.22 
WithMessage22 
(22 
$str22 7
)227 8
;228 9
}33 	
}44 
internal77 
sealed77 
class77 
Handler77 !
:77" #
IRequestHandler77$ 3
<773 4
Command774 ;
,77; <
Result77= C
<77C D

ProductDto77D N
>77N O
>77O P
{88 
private99 
readonly99 
AppDbContext99 %
_context99& .
;99. /
public;; 
Handler;; 
(;; 
AppDbContext;; #
context;;$ +
);;+ ,
{<< 	
_context== 
=== 
context== 
;== 
}>> 	
public@@ 
async@@ 
Task@@ 
<@@ 
Result@@  
<@@  !

ProductDto@@! +
>@@+ ,
>@@, -
Handle@@. 4
(@@4 5
Command@@5 <
request@@= D
,@@D E
CancellationToken@@F W
cancellationToken@@X i
)@@i j
{AA 	
varBB 
productBB 
=BB 
newBB 
ProductBB %
{CC 
IdDD 
=DD 
GuidDD 
.DD 
NewGuidDD !
(DD! "
)DD" #
,DD# $
NameEE 
=EE 
requestEE 
.EE 
NameEE #
,EE# $
DescriptionFF 
=FF 
requestFF %
.FF% &
DescriptionFF& 1
,FF1 2
PriceGG 
=GG 
requestGG 
.GG  
PriceGG  %
,GG% &
CategoryHH 
=HH 
requestHH "
.HH" #
CategoryHH# +
,HH+ ,
ImageUrlII 
=II 
requestII "
.II" #
ImageUrlII# +
,II+ ,
	AllergensJJ 
=JJ 
requestJJ #
.JJ# $
	AllergensJJ$ -
,JJ- .
DietaryRestrictionsKK #
=KK$ %
requestKK& -
.KK- .
DietaryRestrictionsKK. A
,KKA B
IsAvailableLL 
=LL 
requestLL %
.LL% &
IsAvailableLL& 1
,LL1 2
	CreatedAtMM 
=MM 
DateTimeMM $
.MM$ %
UtcNowMM% +
}NN 
;NN 
_contextPP 
.PP 
ProductsPP 
.PP 
AddPP !
(PP! "
productPP" )
)PP) *
;PP* +
awaitQQ 
_contextQQ 
.QQ 
SaveChangesAsyncQQ +
(QQ+ ,
cancellationTokenQQ, =
)QQ= >
;QQ> ?
varSS 
dtoSS 
=SS 
newSS 

ProductDtoSS $
{TT 
IdUU 
=UU 
productUU 
.UU 
IdUU 
,UU  
NameVV 
=VV 
productVV 
.VV 
NameVV #
,VV# $
DescriptionWW 
=WW 
productWW %
.WW% &
DescriptionWW& 1
,WW1 2
PriceXX 
=XX 
productXX 
.XX  
PriceXX  %
,XX% &
CategoryYY 
=YY 
productYY "
.YY" #
CategoryYY# +
,YY+ ,
ImageUrlZZ 
=ZZ 
productZZ "
.ZZ" #
ImageUrlZZ# +
,ZZ+ ,
	Allergens[[ 
=[[ 
product[[ #
.[[# $
	Allergens[[$ -
,[[- .
DietaryRestrictions\\ #
=\\$ %
product\\& -
.\\- .
DietaryRestrictions\\. A
,\\A B
IsAvailable]] 
=]] 
product]] %
.]]% &
IsAvailable]]& 1
,]]1 2
	CreatedAt^^ 
=^^ 
product^^ #
.^^# $
	CreatedAt^^$ -
,^^- .
	UpdatedAt__ 
=__ 
product__ #
.__# $
	UpdatedAt__$ -
}`` 
;`` 
returnbb 
Resultbb 
<bb 

ProductDtobb $
>bb$ %
.bb% &
Successbb& -
(bb- .
dtobb. 1
)bb1 2
;bb2 3
}cc 	
}dd 
}ee ÆD
cC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Loyalty\RedeemLoyaltyPoints.cs
	namespace		 	

CampusEats		
 
.		 
Backend		 
.		 
Features		 %
.		% &
Loyalty		& -
;		- .
public 
static 
class 
RedeemLoyaltyPoints '
{ 
public 

record 
Command 
( 
Guid 
UserId %
,% &
int' *
PointsToRedeem+ 9
,9 :
Guid; ?
?? @
OrderIdA H
=I J
nullK O
)O P
:Q R
IRequestS [
<[ \
Result\ b
<b c!
RedeemPointsResultDtoc x
>x y
>y z
;z {
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
UserId !
)! "
." #
NotEmpty# +
(+ ,
), -
.- .
WithMessage. 9
(9 :
$str: N
)N O
;O P
RuleFor 
( 
x 
=> 
x 
. 
PointsToRedeem )
)) *
. 
GreaterThan 
( 
$num 
) 
.  
WithMessage  +
(+ ,
$str, U
)U V
. 
LessThanOrEqualTo "
(" #
$num# (
)( )
.) *
WithMessage* 5
(5 6
$str6 d
)d e
;e f
} 	
} 
public 

class 
Handler 
: 
IRequestHandler *
<* +
Command+ 2
,2 3
Result4 :
<: ;!
RedeemPointsResultDto; P
>P Q
>Q R
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
private 
const 
decimal 
PointsToMoneyRatio 0
=1 2
$num3 7
;7 8
private 
const 
int !
MinimumPointsToRedeem /
=0 1
$num2 4
;4 5
public   
Handler   
(   
AppDbContext   #
context  $ +
)  + ,
{!! 	
_context"" 
="" 
context"" 
;"" 
}## 	
public%% 
async%% 
Task%% 
<%% 
Result%%  
<%%  !!
RedeemPointsResultDto%%! 6
>%%6 7
>%%7 8
Handle%%9 ?
(%%? @
Command%%@ G
request%%H O
,%%O P
CancellationToken%%Q b
cancellationToken%%c t
)%%t u
{&& 	
var'' 
user'' 
='' 
await'' 
_context'' %
.''% &
Users''& +
.(( 
FirstOrDefaultAsync(( $
((($ %
u((% &
=>((' )
u((* +
.((+ ,
Id((, .
==((/ 1
request((2 9
.((9 :
UserId((: @
,((@ A
cancellationToken((B S
)((S T
;((T U
if** 
(** 
user** 
==** 
null** 
)** 
return++ 
Result++ 
<++ !
RedeemPointsResultDto++ 3
>++3 4
.++4 5
Failure++5 <
(++< =
$str++= M
)++M N
;++N O
if-- 
(-- 
user-- 
.-- 
LoyaltyPoints-- "
<--# $!
MinimumPointsToRedeem--% :
)--: ;
return.. 
Result.. 
<.. !
RedeemPointsResultDto.. 3
>..3 4
...4 5
Failure..5 <
(..< =
$"..= ?
$str..? G
{..G H!
MinimumPointsToRedeem..H ]
}..] ^
$str..^ x
"..x y
)..y z
;..z {
if00 
(00 
request00 
.00 
PointsToRedeem00 &
<00' (!
MinimumPointsToRedeem00) >
)00> ?
return11 
Result11 
<11 !
RedeemPointsResultDto11 3
>113 4
.114 5
Failure115 <
(11< =
$"11= ?
$str11? G
{11G H!
MinimumPointsToRedeem11H ]
}11] ^
$str11^ x
"11x y
)11y z
;11z {
if33 
(33 
user33 
.33 
LoyaltyPoints33 "
<33# $
request33% ,
.33, -
PointsToRedeem33- ;
)33; <
return44 
Result44 
<44 !
RedeemPointsResultDto44 3
>443 4
.444 5
Failure445 <
(44< =
$"44= ?
$str44? ]
{44] ^
user44^ b
.44b c
LoyaltyPoints44c p
}44p q
$str44q y
"44y z
)44z {
;44{ |
var66 
discountAmount66 
=66  
request66! (
.66( )
PointsToRedeem66) 7
*668 9
PointsToMoneyRatio66: L
;66L M
user88 
.88 
LoyaltyPoints88 
-=88 !
request88" )
.88) *
PointsToRedeem88* 8
;888 9
user99 
.99 
	UpdatedAt99 
=99 
DateTime99 %
.99% &
UtcNow99& ,
;99, -
var;; 
transaction;; 
=;; 
new;; !
LoyaltyTransaction;;" 4
{<< 
Id== 
=== 
Guid== 
.== 
NewGuid== !
(==! "
)==" #
,==# $
UserId>> 
=>> 
user>> 
.>> 
Id>>  
,>>  !
PointsChange?? 
=?? 
-??  
request??  '
.??' (
PointsToRedeem??( 6
,??6 7
Type@@ 
=@@ "
LoyaltyTransactionType@@ -
.@@- .
Redeemed@@. 6
,@@6 7
DescriptionAA 
=AA 
requestAA %
.AA% &
OrderIdAA& -
.AA- .
HasValueAA. 6
?BB 
$"BB 
$strBB !
{BB! "
requestBB" )
.BB) *
PointsToRedeemBB* 8
}BB8 9
$strBB9 E
{BBE F
discountAmountBBF T
:BBT U
$strBBU W
}BBW X
$strBBX n
"BBn o
:CC 
$"CC 
$strCC !
{CC! "
requestCC" )
.CC) *
PointsToRedeemCC* 8
}CC8 9
$strCC9 E
{CCE F
discountAmountCCF T
:CCT U
$strCCU W
}CCW X
$strCCX e
"CCe f
,CCf g
OrderIdDD 
=DD 
requestDD !
.DD! "
OrderIdDD" )
,DD) *
	CreatedAtEE 
=EE 
DateTimeEE $
.EE$ %
UtcNowEE% +
}FF 
;FF 
_contextHH 
.HH 
LoyaltyTransactionsHH (
.HH( )
AddHH) ,
(HH, -
transactionHH- 8
)HH8 9
;HH9 :
awaitII 
_contextII 
.II 
SaveChangesAsyncII +
(II+ ,
cancellationTokenII, =
)II= >
;II> ?
varKK 
resultKK 
=KK 
newKK !
RedeemPointsResultDtoKK 2
{LL 
PointsRedeemedMM 
=MM  
requestMM! (
.MM( )
PointsToRedeemMM) 7
,MM7 8
DiscountAmountNN 
=NN  
discountAmountNN! /
,NN/ 0
RemainingPointsOO 
=OO  !
userOO" &
.OO& '
LoyaltyPointsOO' 4
,OO4 5
MessagePP 
=PP 
$"PP 
$strPP 2
{PP2 3
requestPP3 :
.PP: ;
PointsToRedeemPP; I
}PPI J
$strPPJ V
{PPV W
discountAmountPPW e
:PPe f
$strPPf h
}PPh i
$strPPi w
"PPw x
}QQ 
;QQ 
returnSS 
ResultSS 
<SS !
RedeemPointsResultDtoSS /
>SS/ 0
.SS0 1
SuccessSS1 8
(SS8 9
resultSS9 ?
)SS? @
;SS@ A
}TT 	
}UU 
}VV ä&
fC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Loyalty\GetLoyaltyTransactions.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Loyalty& -
;- .
public		 
static		 
class		 "
GetLoyaltyTransactions		 *
{

 
public 

record 
Query 
( 
Guid 
UserId #
,# $
int% (
Page) -
=. /
$num0 1
,1 2
int3 6
PageSize7 ?
=@ A
$numB D
)D E
:F G
IRequestH P
<P Q
ResultQ W
<W X
ListX \
<\ ]!
LoyaltyTransactionDto] r
>r s
>s t
>t u
;u v
public 

class 
Handler 
: 
IRequestHandler *
<* +
Query+ 0
,0 1
Result2 8
<8 9
List9 =
<= >!
LoyaltyTransactionDto> S
>S T
>T U
>U V
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
List! %
<% &!
LoyaltyTransactionDto& ;
>; <
>< =
>= >
Handle? E
(E F
QueryF K
requestL S
,S T
CancellationTokenU f
cancellationTokeng x
)x y
{ 	
var 
user 
= 
await 
_context %
.% &
Users& +
. 
FirstOrDefaultAsync $
($ %
u% &
=>' )
u* +
.+ ,
Id, .
==/ 1
request2 9
.9 :
UserId: @
,@ A
cancellationTokenB S
)S T
;T U
if 
( 
user 
== 
null 
) 
return 
Result 
< 
List "
<" #!
LoyaltyTransactionDto# 8
>8 9
>9 :
.: ;
Failure; B
(B C
$strC S
)S T
;T U
var 
transactions 
= 
await $
_context% -
.- .
LoyaltyTransactions. A
. 
Where 
( 
t 
=> 
t 
. 
UserId $
==% '
request( /
./ 0
UserId0 6
)6 7
.   
OrderByDescending   "
(  " #
t  # $
=>  % '
t  ( )
.  ) *
	CreatedAt  * 3
)  3 4
.!! 
Skip!! 
(!! 
(!! 
request!! 
.!! 
Page!! #
-!!$ %
$num!!& '
)!!' (
*!!) *
request!!+ 2
.!!2 3
PageSize!!3 ;
)!!; <
."" 
Take"" 
("" 
request"" 
."" 
PageSize"" &
)""& '
.## 
Select## 
(## 
t## 
=>## 
new##  !
LoyaltyTransactionDto##! 6
{$$ 
Id%% 
=%% 
t%% 
.%% 
Id%% 
,%% 
UserId&& 
=&& 
t&& 
.&& 
UserId&& %
,&&% &
PointsChange''  
=''! "
t''# $
.''$ %
PointsChange''% 1
,''1 2
Type(( 
=(( 
t(( 
.(( 
Type(( !
.((! "
ToString((" *
(((* +
)((+ ,
,((, -
Description)) 
=))  !
t))" #
.))# $
Description))$ /
,))/ 0
OrderId** 
=** 
t** 
.**  
OrderId**  '
,**' (
	CreatedAt++ 
=++ 
t++  !
.++! "
	CreatedAt++" +
},, 
),, 
.-- 
ToListAsync-- 
(-- 
cancellationToken-- .
)--. /
;--/ 0
return// 
Result// 
<// 
List// 
<// !
LoyaltyTransactionDto// 4
>//4 5
>//5 6
.//6 7
Success//7 >
(//> ?
transactions//? K
)//K L
;//L M
}00 	
}11 
}22 ß$
`C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Loyalty\GetLoyaltyPoints.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Loyalty& -
;- .
public		 
static		 
class		 
GetLoyaltyPoints		 $
{

 
public 

record 
Query 
( 
Guid 
UserId #
)# $
:% &
IRequest' /
</ 0
Result0 6
<6 7
LoyaltyPointsDto7 G
>G H
>H I
;I J
public 

class 
Handler 
: 
IRequestHandler *
<* +
Query+ 0
,0 1
Result2 8
<8 9
LoyaltyPointsDto9 I
>I J
>J K
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
private 
const 
decimal 
PointsToMoneyRatio 0
=1 2
$num3 7
;7 8
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
LoyaltyPointsDto! 1
>1 2
>2 3
Handle4 :
(: ;
Query; @
requestA H
,H I
CancellationTokenJ [
cancellationToken\ m
)m n
{ 	
var 
user 
= 
await 
_context %
.% &
Users& +
. 
Include 
( 
u 
=> 
u 
.  
LoyaltyTransactions  3
)3 4
. 
FirstOrDefaultAsync $
($ %
u% &
=>' )
u* +
.+ ,
Id, .
==/ 1
request2 9
.9 :
UserId: @
,@ A
cancellationTokenB S
)S T
;T U
if 
( 
user 
== 
null 
) 
return 
Result 
< 
LoyaltyPointsDto .
>. /
./ 0
Failure0 7
(7 8
$str8 H
)H I
;I J
var   
totalEarned   
=   
user   "
.  " #
LoyaltyTransactions  # 6
.!! 
Where!! 
(!! 
t!! 
=>!! 
t!! 
.!! 
Type!! "
==!!# %
Domain!!& ,
.!!, -"
LoyaltyTransactionType!!- C
.!!C D
Earned!!D J
)!!J K
."" 
Sum"" 
("" 
t"" 
=>"" 
t"" 
."" 
PointsChange"" (
)""( )
;"") *
var$$ 
totalRedeemed$$ 
=$$ 
Math$$  $
.$$$ %
Abs$$% (
($$( )
user$$) -
.$$- .
LoyaltyTransactions$$. A
.%% 
Where%% 
(%% 
t%% 
=>%% 
t%% 
.%% 
Type%% "
==%%# %
Domain%%& ,
.%%, -"
LoyaltyTransactionType%%- C
.%%C D
Redeemed%%D L
)%%L M
.&& 
Sum&& 
(&& 
t&& 
=>&& 
t&& 
.&& 
PointsChange&& (
)&&( )
)&&) *
;&&* +
var(( 
dto(( 
=(( 
new(( 
LoyaltyPointsDto(( *
{)) 
UserId** 
=** 
user** 
.** 
Id**  
,**  !
CurrentPoints++ 
=++ 
user++  $
.++$ %
LoyaltyPoints++% 2
,++2 3
TotalEarned,, 
=,, 
totalEarned,, )
,,,) *
TotalRedeemed-- 
=-- 
totalRedeemed--  -
,--- .
PointsValue.. 
=.. 
user.. "
..." #
LoyaltyPoints..# 0
*..1 2
PointsToMoneyRatio..3 E
}// 
;// 
return11 
Result11 
<11 
LoyaltyPointsDto11 *
>11* +
.11+ ,
Success11, 3
(113 4
dto114 7
)117 8
;118 9
}22 	
}33 
}44 ï(
bC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Loyalty\AwardLoyaltyPoints.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Loyalty& -
;- .
public

 
static

 
class

 
AwardLoyaltyPoints

 &
{ 
public 

record 
Command 
( 
Guid 
UserId %
,% &
int' *
Points+ 1
,1 2
string3 9
Description: E
,E F
GuidG K
?K L
OrderIdM T
=U V
nullW [
)[ \
:] ^
IRequest_ g
<g h
Resulth n
>n o
;o p
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
UserId !
)! "
." #
NotEmpty# +
(+ ,
), -
.- .
WithMessage. 9
(9 :
$str: N
)N O
;O P
RuleFor 
( 
x 
=> 
x 
. 
Points !
)! "
." #
GreaterThan# .
(. /
$num/ 0
)0 1
.1 2
WithMessage2 =
(= >
$str> ]
)] ^
;^ _
RuleFor 
( 
x 
=> 
x 
. 
Description &
)& '
.' (
NotEmpty( 0
(0 1
)1 2
.2 3
WithMessage3 >
(> ?
$str? X
)X Y
;Y Z
} 	
} 
public 

class 
Handler 
: 
IRequestHandler *
<* +
Command+ 2
,2 3
Result4 :
>: ;
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public!! 
async!! 
Task!! 
<!! 
Result!!  
>!!  !
Handle!!" (
(!!( )
Command!!) 0
request!!1 8
,!!8 9
CancellationToken!!: K
cancellationToken!!L ]
)!!] ^
{"" 	
var## 
user## 
=## 
await## 
_context## %
.##% &
Users##& +
.$$ 
FirstOrDefaultAsync$$ $
($$$ %
u$$% &
=>$$' )
u$$* +
.$$+ ,
Id$$, .
==$$/ 1
request$$2 9
.$$9 :
UserId$$: @
,$$@ A
cancellationToken$$B S
)$$S T
;$$T U
if&& 
(&& 
user&& 
==&& 
null&& 
)&& 
return'' 
Result'' 
.'' 
Failure'' %
(''% &
$str''& 6
)''6 7
;''7 8
user)) 
.)) 
LoyaltyPoints)) 
+=)) !
request))" )
.))) *
Points))* 0
;))0 1
user** 
.** 
	UpdatedAt** 
=** 
DateTime** %
.**% &
UtcNow**& ,
;**, -
var,, 
transaction,, 
=,, 
new,, !
LoyaltyTransaction,," 4
{-- 
Id.. 
=.. 
Guid.. 
... 
NewGuid.. !
(..! "
).." #
,..# $
UserId// 
=// 
user// 
.// 
Id//  
,//  !
PointsChange00 
=00 
request00 &
.00& '
Points00' -
,00- .
Type11 
=11 "
LoyaltyTransactionType11 -
.11- .
Earned11. 4
,114 5
Description22 
=22 
request22 %
.22% &
Description22& 1
,221 2
OrderId33 
=33 
request33 !
.33! "
OrderId33" )
,33) *
	CreatedAt44 
=44 
DateTime44 $
.44$ %
UtcNow44% +
}55 
;55 
_context77 
.77 
LoyaltyTransactions77 (
.77( )
Add77) ,
(77, -
transaction77- 8
)778 9
;779 :
await88 
_context88 
.88 
SaveChangesAsync88 +
(88+ ,
cancellationToken88, =
)88= >
;88> ?
return:: 
Result:: 
.:: 
Success:: !
(::! "
)::" #
;::# $
};; 	
}<< 
}== ´P
aC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Kitchen\UpdateOrderStatus.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Kitchen& -
;- .
public

 
static

 
class

 
UpdateOrderStatus

 %
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,
OrderDto, 4
>4 5
>5 6
{ 
public 
Guid 
OrderId 
{ 
get !
;! "
init# '
;' (
}) *
public 
string 
Status 
{ 
get "
;" #
init$ (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Command4 ;
,; <
Result= C
<C D
OrderDtoD L
>L M
>M N
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
OrderDto! )
>) *
>* +
Handle, 2
(2 3
Command3 :
request; B
,B C
CancellationTokenD U
cancellationTokenV g
)g h
{ 	
var 
order 
= 
await 
_context &
.& '
Orders' -
. 
Include 
( 
o 
=> 
o 
.  

OrderItems  *
)* +
. 
ThenInclude  
(  !
oi! #
=>$ &
oi' )
.) *
Product* 1
)1 2
.   
FirstOrDefaultAsync   $
(  $ %
o  % &
=>  ' )
o  * +
.  + ,
Id  , .
==  / 1
request  2 9
.  9 :
OrderId  : A
,  A B
cancellationToken  C T
)  T U
;  U V
if"" 
("" 
order"" 
is"" 
null"" 
)"" 
{## 
return$$ 
Result$$ 
<$$ 
OrderDto$$ &
>$$& '
.$$' (
Failure$$( /
($$/ 0
$"$$0 2
$str$$2 8
{$$8 9
request$$9 @
.$$@ A
OrderId$$A H
}$$H I
$str$$I S
"$$S T
)$$T U
;$$U V
}%% 
var(( 
wasCompleted(( 
=(( 
order(( $
.(($ %
Status((% +
==((, .
$str((/ :
;((: ;
order)) 
.)) 
Status)) 
=)) 
request)) "
.))" #
Status))# )
;))) *
order** 
.** 
	UpdatedAt** 
=** 
DateTime** &
.**& '
UtcNow**' -
;**- .
if,, 
(,, 
request,, 
.,, 
Status,, 
==,, !
$str,," -
),,- .
{-- 
order.. 
... 
CompletedAt.. !
=.." #
DateTime..$ ,
..., -
UtcNow..- 3
;..3 4
if// 
(// 
order// 
.// 
PaymentStatus// '
==//( *
$str//+ 4
)//4 5
order//6 ;
.//; <
PaymentStatus//< I
=//J K
$str//L R
;//R S
if22 
(22 
!22 
wasCompleted22 !
)22! "
{33 
var55 
loyaltyPayments55 '
=55( )
await55* /
_context550 8
.558 9
Payments559 A
.66 
Where66 
(66 
p66  
=>66! #
p66$ %
.66% &
OrderId66& -
==66. 0
order661 6
.666 7
Id667 9
&&66: <
p66= >
.66> ?
Method66? E
==66F H
PaymentMethod66I V
.66V W
LoyaltyPoints66W d
)66d e
.77 
SumAsync77 !
(77! "
p77" #
=>77$ &
p77' (
.77( )
Amount77) /
,77/ 0
cancellationToken771 B
)77B C
;77C D
var99 
	netAmount99 !
=99" #
order99$ )
.99) *
TotalAmount99* 5
-996 7
loyaltyPayments998 G
;99G H
var<< 
pointsToAward<< %
=<<& '
	netAmount<<( 1
*<<2 3
$num<<4 9
;<<9 :
var>> 
user>> 
=>> 
await>> $
_context>>% -
.>>- .
Users>>. 3
.>>3 4
	FindAsync>>4 =
(>>= >
new>>> A
object>>B H
[>>H I
]>>I J
{>>K L
order>>M R
.>>R S
UserId>>S Y
}>>Z [
,>>[ \
cancellationToken>>] n
)>>n o
;>>o p
if?? 
(?? 
user?? 
!=?? 
null??  $
)??$ %
{@@ 
userAA 
.AA 
LoyaltyPointsAA *
+=AA+ -
pointsToAwardAA. ;
;AA; <
userBB 
.BB 
	UpdatedAtBB &
=BB' (
DateTimeBB) 1
.BB1 2
UtcNowBB2 8
;BB8 9
varDD 
loyaltyTransactionDD .
=DD/ 0
newDD1 4
LoyaltyTransactionDD5 G
{EE 
IdFF 
=FF  
GuidFF! %
.FF% &
NewGuidFF& -
(FF- .
)FF. /
,FF/ 0
UserIdGG "
=GG# $
userGG% )
.GG) *
IdGG* ,
,GG, -
PointsChangeHH (
=HH) *
pointsToAwardHH+ 8
,HH8 9
TypeII  
=II! ""
LoyaltyTransactionTypeII# 9
.II9 :
EarnedII: @
,II@ A
DescriptionJJ '
=JJ( )
$"JJ* ,
$strJJ, 3
{JJ3 4
pointsToAwardJJ4 A
:JJA B
$strJJB D
}JJD E
$strJJE Y
{JJY Z
orderJJZ _
.JJ_ `
OrderNumberJJ` k
}JJk l
"JJl m
,JJm n
OrderIdKK #
=KK$ %
orderKK& +
.KK+ ,
IdKK, .
,KK. /
	CreatedAtLL %
=LL& '
DateTimeLL( 0
.LL0 1
UtcNowLL1 7
}MM 
;MM 
_contextNN  
.NN  !
LoyaltyTransactionsNN! 4
.NN4 5
AddNN5 8
(NN8 9
loyaltyTransactionNN9 K
)NNK L
;NNL M
}OO 
}PP 
}QQ 
awaitTT 
_contextTT 
.TT 
SaveChangesAsyncTT +
(TT+ ,
cancellationTokenTT, =
)TT= >
;TT> ?
varVV 
orderDtoVV 
=VV 
newVV 
OrderDtoVV '
{WW 
IdXX 
=XX 
orderXX 
.XX 
IdXX 
,XX 
OrderNumberYY 
=YY 
orderYY #
.YY# $
OrderNumberYY$ /
,YY/ 0
UserIdZZ 
=ZZ 
orderZZ 
.ZZ 
UserIdZZ %
,ZZ% &
TotalAmount[[ 
=[[ 
order[[ #
.[[# $
TotalAmount[[$ /
,[[/ 0
Status\\ 
=\\ 
order\\ 
.\\ 
Status\\ %
,\\% &
PaymentStatus]] 
=]] 
order]]  %
.]]% &
PaymentStatus]]& 3
,]]3 4
PaymentMethod^^ 
=^^ 
order^^  %
.^^% &
PaymentMethod^^& 3
,^^3 4
Notes__ 
=__ 
order__ 
.__ 
Notes__ #
,__# $
	CreatedAt`` 
=`` 
order`` !
.``! "
	CreatedAt``" +
,``+ ,
	UpdatedAtaa 
=aa 
orderaa !
.aa! "
	UpdatedAtaa" +
,aa+ ,
CompletedAtbb 
=bb 
orderbb #
.bb# $
CompletedAtbb$ /
,bb/ 0

OrderItemscc 
=cc 
ordercc "
.cc" #

OrderItemscc# -
.cc- .
Selectcc. 4
(cc4 5
oicc5 7
=>cc8 :
newcc; >
OrderItemDtocc? K
{dd 
Idee 
=ee 
oiee 
.ee 
Idee 
,ee 
	ProductIdff 
=ff 
oiff  "
.ff" #
	ProductIdff# ,
,ff, -
ProductNamehh 
=hh  !
oihh" $
.hh$ %
Producthh% ,
!=hh- /
nullhh0 4
?hh5 6
oihh7 9
.hh9 :
Producthh: A
.hhA B
NamehhB F
:hhG H
$strhhI \
,hh\ ]
Quantityii 
=ii 
oiii !
.ii! "
Quantityii" *
,ii* +
	UnitPricejj 
=jj 
oijj  "
.jj" #
	UnitPricejj# ,
,jj, -
Subtotalkk 
=kk 
oikk !
.kk! "
Subtotalkk" *
,kk* +
SpecialInstructionsll '
=ll( )
oill* ,
.ll, -
SpecialInstructionsll- @
}mm 
)mm 
.mm 
ToListmm 
(mm 
)mm 
}nn 
;nn 
returnpp 
Resultpp 
<pp 
OrderDtopp "
>pp" #
.pp# $
Successpp$ +
(pp+ ,
orderDtopp, 4
)pp4 5
;pp5 6
}qq 	
}rr 
}ss §,
`C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Kitchen\GetPendingOrders.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Kitchen& -
;- .
public		 
static		 
class		 
GetPendingOrders		 $
{

 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
List* .
<. /
OrderDto/ 7
>7 8
>8 9
>9 :
{ 
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
ListB F
<F G
OrderDtoG O
>O P
>P Q
>Q R
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
List! %
<% &
OrderDto& .
>. /
>/ 0
>0 1
Handle2 8
(8 9
Query9 >
request? F
,F G
CancellationTokenH Y
cancellationTokenZ k
)k l
{ 	
var 
orders 
= 
await 
_context '
.' (
Orders( .
. 
AsNoTracking 
( 
) 
. 
Where 
( 
o 
=> 
o 
. 
Status $
==% '
$str( 1
||2 4
o5 6
.6 7
Status7 =
==> @
$strA L
||M O
oP Q
.Q R
StatusR X
==Y [
$str\ c
)c d
.   
OrderBy   
(   
o   
=>   
o   
.    
	CreatedAt    )
)  ) *
.!! 
Include!! 
(!! 
o!! 
=>!! 
o!! 
.!!  

OrderItems!!  *
)!!* +
."" 
ThenInclude"" 
("" 
oi"" 
=>""  "
oi""# %
.""% &
Product""& -
)""- .
.## 
ToListAsync## 
(## 
cancellationToken## .
)##. /
;##/ 0
var%% 
	orderDtos%% 
=%% 
orders%% "
.%%" #
Select%%# )
(%%) *
order%%* /
=>%%0 2
new%%3 6
OrderDto%%7 ?
{&& 
Id'' 
='' 
order'' 
.'' 
Id'' 
,'' 
OrderNumber(( 
=(( 
order(( #
.((# $
OrderNumber(($ /
,((/ 0
UserId)) 
=)) 
order)) 
.)) 
UserId)) %
,))% &
TotalAmount** 
=** 
order** #
.**# $
TotalAmount**$ /
,**/ 0
Status++ 
=++ 
order++ 
.++ 
Status++ %
,++% &
PaymentStatus,, 
=,, 
order,,  %
.,,% &
PaymentStatus,,& 3
,,,3 4
PaymentMethod-- 
=-- 
order--  %
.--% &
PaymentMethod--& 3
,--3 4
Notes.. 
=.. 
order.. 
... 
Notes.. #
,..# $
	CreatedAt// 
=// 
order// !
.//! "
	CreatedAt//" +
,//+ ,
	UpdatedAt00 
=00 
order00 !
.00! "
	UpdatedAt00" +
,00+ ,
CompletedAt11 
=11 
order11 #
.11# $
CompletedAt11$ /
,11/ 0

OrderItems22 
=22 
order22 "
.22" #

OrderItems22# -
.22- .
Select22. 4
(224 5
oi225 7
=>228 :
new22; >
OrderItemDto22? K
{33 
Id44 
=44 
oi44 
.44 
Id44 
,44 
	ProductId55 
=55 
oi55  "
.55" #
	ProductId55# ,
,55, -
ProductName77 
=77  !
oi77" $
.77$ %
Product77% ,
!=77- /
null770 4
?775 6
oi777 9
.779 :
Product77: A
.77A B
Name77B F
:77G H
$str77I \
,77\ ]
Quantity88 
=88 
oi88 !
.88! "
Quantity88" *
,88* +
SpecialInstructions99 '
=99( )
oi99* ,
.99, -
SpecialInstructions99- @
}:: 
):: 
.:: 
ToList:: 
(:: 
):: 
};; 
);; 
.;; 
ToList;; 
(;; 
);; 
;;; 
return== 
Result== 
<== 
List== 
<== 
OrderDto== '
>==' (
>==( )
.==) *
Success==* 1
(==1 2
	orderDtos==2 ;
)==; <
;==< =
}>> 	
}?? 
}@@ äF
gC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Kitchen\GetDailyInventoryReport.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Kitchen& -
;- .
public

 
static

 
class

 #
GetDailyInventoryReport

 +
{ 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
InventoryReportDto* <
>< =
>= >
{ 
public 
DateTime 
? 

ReportDate #
{$ %
get& )
;) *
init+ /
;/ 0
}1 2
=3 4
null5 9
;9 :
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
InventoryReportDtoB T
>T U
>U V
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
InventoryReportDto! 3
>3 4
>4 5
Handle6 <
(< =
Query= B
requestC J
,J K
CancellationTokenL ]
cancellationToken^ o
)o p
{ 	
try 
{ 
var 

reportDate 
=  
(! "
request" )
.) *

ReportDate* 4
?4 5
.5 6
Date6 :
??; =
DateTime> F
.F G
UtcNowG M
.M N
DateN R
)R S
;S T

reportDate   
=   
DateTime   !
.  ! "
SpecifyKind  " -
(  - .

reportDate  . 8
,  8 9
DateTimeKind  : F
.  F G
Utc  G J
)  J K
;  K L
var"" 
nextDay"" 
="" 

reportDate"" $
.""$ %
AddDays""% ,
("", -
$num""- .
)"". /
;""/ 0
var'' 
dailyOrders'' 
='' 
await'' #
_context''$ ,
.'', -
Orders''- 3
.(( 
AsNoTracking(( 
((( 
)(( 
.)) 
Where)) 
()) 
o)) 
=>)) 
o)) 
.)) 
Status)) $
==))% '
$str))( 3
&&))4 6
o** 
.** 
CompletedAt** )
>=*** ,

reportDate**- 7
&&**8 :
o++ 
.++ 
CompletedAt++ )
<++* +
nextDay++, 3
)++3 4
.,, 
Include,, 
(,, 
o,, 
=>,, 
o,, 
.,,  

OrderItems,,  *
),,* +
.-- 
ThenInclude--  
(--  !
oi--! #
=>--$ &
oi--' )
.--) *
Product--* 1
)--1 2
... 
ToListAsync.. 
(.. 
cancellationToken.. .
)... /
;../ 0
var11 
allProducts11 
=11  !
await11" '
_context11( 0
.110 1
Products111 9
.22 
AsNoTracking22 !
(22! "
)22" #
.33 
ToListAsync33  
(33  !
cancellationToken33! 2
)332 3
;333 4
var55 
inventoryItems55 "
=55# $
allProducts55% 0
.550 1
Select551 7
(557 8
product558 ?
=>55@ B
{66 
var77 
productOrderItems77 )
=77* +
dailyOrders77, 7
.88 

SelectMany88 #
(88# $
o88$ %
=>88& (
o88) *
.88* +

OrderItems88+ 5
)885 6
.99 
Where99 
(99 
oi99 !
=>99" $
oi99% '
.99' (
	ProductId99( 1
==992 4
product995 <
.99< =
Id99= ?
)99? @
.:: 
ToList:: 
(::  
)::  !
;::! "
var<< 
quantitySold<< $
=<<% &
productOrderItems<<' 8
.<<8 9
Sum<<9 <
(<<< =
oi<<= ?
=><<@ B
oi<<C E
.<<E F
Quantity<<F N
)<<N O
;<<O P
var== 
revenue== 
===  !
productOrderItems==" 3
.==3 4
Sum==4 7
(==7 8
oi==8 :
=>==; =
oi==> @
.==@ A
Subtotal==A I
)==I J
;==J K
var>> 

orderCount>> "
=>># $
productOrderItems>>% 6
.>>6 7
Count>>7 <
;>>< =
var?? 
averageOrderValue?? )
=??* +

orderCount??, 6
>??7 8
$num??9 :
???; <
revenue??= D
/??E F

orderCount??G Q
:??R S
$num??T U
;??U V
ifBB 
(BB 
quantitySoldBB $
==BB% '
$numBB( )
)BB) *
returnBB+ 1
nullBB2 6
;BB6 7
returnDD 
newDD 
InventoryItemDtoDD /
{EE 
	ProductIdFF !
=FF" #
productFF$ +
.FF+ ,
IdFF, .
,FF. /
ProductNameGG #
=GG$ %
productGG& -
.GG- .
NameGG. 2
,GG2 3
QuantitySoldHH $
=HH% &
quantitySoldHH' 3
,HH3 4
	UnitPriceII !
=II" #
productII$ +
.II+ ,
PriceII, 1
,II1 2
SubtotalJJ  
=JJ! "
revenueJJ# *
,JJ* +
RevenueKK 
=KK  !
revenueKK" )
,KK) *

OrderCountLL "
=LL# $

orderCountLL% /
,LL/ 0
AverageOrderValueMM )
=MM* +
averageOrderValueMM, =
}NN 
;NN 
}OO 
)OO 
.PP 
WherePP 
(PP 
iPP 
=>PP 
iPP 
!=PP  
nullPP! %
)PP% &
.QQ 
CastQQ 
<QQ 
InventoryItemDtoQQ &
>QQ& '
(QQ' (
)QQ( )
.RR 
OrderByDescendingRR "
(RR" #
iRR# $
=>RR% '
iRR( )
.RR) *
QuantitySoldRR* 6
)RR6 7
.SS 
ToListSS 
(SS 
)SS 
;SS 
varUU 
totalRevenueUU  
=UU! "
dailyOrdersUU# .
.UU. /
SumUU/ 2
(UU2 3
oUU3 4
=>UU5 7
oUU8 9
.UU9 :
TotalAmountUU: E
)UUE F
;UUF G
varVV  
totalOrdersProcessedVV (
=VV) *
dailyOrdersVV+ 6
.VV6 7
CountVV7 <
;VV< =
varWW 
totalItemsSoldWW "
=WW# $
inventoryItemsWW% 3
.WW3 4
SumWW4 7
(WW7 8
iWW8 9
=>WW: <
iWW= >
.WW> ?
QuantitySoldWW? K
)WWK L
;WWL M
varYY 
inventoryReportYY #
=YY$ %
newYY& )
InventoryReportDtoYY* <
{ZZ 

ReportDate[[ 
=[[  

reportDate[[! +
,[[+ ,
InventoryItems\\ "
=\\# $
inventoryItems\\% 3
,\\3 4
TotalRevenue]]  
=]]! "
totalRevenue]]# /
,]]/ 0 
TotalOrdersProcessed^^ (
=^^) * 
totalOrdersProcessed^^+ ?
,^^? @
TotalItemsSold__ "
=__# $
totalItemsSold__% 3
}`` 
;`` 
returnbb 
Resultbb 
<bb 
InventoryReportDtobb 0
>bb0 1
.bb1 2
Successbb2 9
(bb9 :
inventoryReportbb: I
)bbI J
;bbJ K
}cc 
catchdd 
(dd 
	Exceptiondd 
exdd 
)dd  
{ee 
Consoleff 
.ff 
	WriteLineff !
(ff! "
$"ff" $
$strff$ 6
{ff6 7
exff7 9
.ff9 :
Messageff: A
}ffA B
"ffB C
)ffC D
;ffD E
Consolegg 
.gg 
	WriteLinegg !
(gg! "
exgg" $
.gg$ %

StackTracegg% /
)gg/ 0
;gg0 1
throwhh 
;hh 
}ii 
}jj 	
}kk 
}ll ¯L
_C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Authentication\Register.cs
	namespace		 	

CampusEats		
 
.		 
Backend		 
.		 
Features		 %
.		% &
Authentication		& 4
;		4 5
public 
static 
class 
Register 
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,
UserDto, 3
>3 4
>4 5
{ 
public 
string 
Email 
{ 
get !
;! "
init# '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public 
string 
Password 
{  
get! $
;$ %
init& *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
FullName 
{  
get! $
;$ %
init& *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
PhoneNumber !
{" #
get$ '
;' (
init) -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 
string 
? 
	StudentId  
{! "
get# &
;& '
init( ,
;, -
}. /
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Email  
)  !
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( ;
); <
. 
EmailAddress 
( 
) 
.  
WithMessage  +
(+ ,
$str, B
)B C
. 
MaximumLength 
( 
$num "
)" #
.# $
WithMessage$ /
(/ 0
$str0 T
)T U
;U V
RuleFor!! 
(!! 
x!! 
=>!! 
x!! 
.!! 
Password!! #
)!!# $
."" 
NotEmpty"" 
("" 
)"" 
."" 
WithMessage"" '
(""' (
$str""( >
)""> ?
.## 
MinimumLength## 
(## 
$num##  
)##  !
.##! "
WithMessage##" -
(##- .
$str##. V
)##V W
.$$ 
Matches$$ 
($$ 
$str$$ !
)$$! "
.$$" #
WithMessage$$# .
($$. /
$str$$/ d
)$$d e
.%% 
Matches%% 
(%% 
$str%% !
)%%! "
.%%" #
WithMessage%%# .
(%%. /
$str%%/ d
)%%d e
.&& 
Matches&& 
(&& 
$str&& !
)&&! "
.&&" #
WithMessage&&# .
(&&. /
$str&&/ Z
)&&Z [
.'' 
Matches'' 
('' 
$str'' 4
)''4 5
.''5 6
WithMessage''6 A
(''A B
$str''B x
)''x y
;''y z
RuleFor)) 
()) 
x)) 
=>)) 
x)) 
.)) 
FullName)) #
)))# $
.** 
NotEmpty** 
(** 
)** 
.** 
WithMessage** '
(**' (
$str**( ?
)**? @
.++ 
MaximumLength++ 
(++ 
$num++ "
)++" #
.++# $
WithMessage++$ /
(++/ 0
$str++0 X
)++X Y
;++Y Z
RuleFor-- 
(-- 
x-- 
=>-- 
x-- 
.-- 
PhoneNumber-- &
)--& '
... 
NotEmpty.. 
(.. 
).. 
... 
WithMessage.. '
(..' (
$str..( B
)..B C
.// 
Matches// 
(// 
$str// .
)//. /
./// 0
WithMessage//0 ;
(//; <
$str//< Y
)//Y Z
;//Z [
RuleFor11 
(11 
x11 
=>11 
x11 
.11 
	StudentId11 $
)11$ %
.22 
MaximumLength22 
(22 
$num22 !
)22! "
.22" #
WithMessage22# .
(22. /
$str22/ W
)22W X
;22X Y
}33 	
}44 
internal77 
sealed77 
class77 
Handler77 !
:77" #
IRequestHandler77$ 3
<773 4
Command774 ;
,77; <
Result77= C
<77C D
UserDto77D K
>77K L
>77L M
{88 
private99 
readonly99 
AppDbContext99 %
_context99& .
;99. /
public;; 
Handler;; 
(;; 
AppDbContext;; #
context;;$ +
);;+ ,
{<< 	
_context== 
=== 
context== 
;== 
}>> 	
public@@ 
async@@ 
Task@@ 
<@@ 
Result@@  
<@@  !
UserDto@@! (
>@@( )
>@@) *
Handle@@+ 1
(@@1 2
Command@@2 9
request@@: A
,@@A B
CancellationToken@@C T
cancellationToken@@U f
)@@f g
{AA 	
varCC 
emailExistsCC 
=CC 
awaitCC #
_contextCC$ ,
.CC, -
UsersCC- 2
.DD 
AnyAsyncDD 
(DD 
uDD 
=>DD 
uDD  
.DD  !
EmailDD! &
==DD' )
requestDD* 1
.DD1 2
EmailDD2 7
,DD7 8
cancellationTokenDD9 J
)DDJ K
;DDK L
ifFF 
(FF 
emailExistsFF 
)FF 
{GG 
returnHH 
ResultHH 
<HH 
UserDtoHH %
>HH% &
.HH& '
FailureHH' .
(HH. /
$strHH/ L
)HHL M
;HHM N
}II 
varLL 
passwordHashLL 
=LL 
BCryptLL %
.LL% &
NetLL& )
.LL) *
BCryptLL* 0
.LL0 1
HashPasswordLL1 =
(LL= >
requestLL> E
.LLE F
PasswordLLF N
)LLN O
;LLO P
varOO 
userOO 
=OO 
newOO 
UserOO 
{PP 
IdQQ 
=QQ 
GuidQQ 
.QQ 
NewGuidQQ !
(QQ! "
)QQ" #
,QQ# $
EmailRR 
=RR 
requestRR 
.RR  
EmailRR  %
,RR% &
PasswordHashSS 
=SS 
passwordHashSS +
,SS+ ,
FullNameTT 
=TT 
requestTT "
.TT" #
FullNameTT# +
,TT+ ,
RoleUU 
=UU 
$strUU  
,UU  !
PhoneNumberVV 
=VV 
requestVV %
.VV% &
PhoneNumberVV& 1
,VV1 2
	StudentIdWW 
=WW 
requestWW #
.WW# $
	StudentIdWW$ -
,WW- .
LoyaltyPointsXX 
=XX 
$numXX  !
,XX! "
IsActiveYY 
=YY 
trueYY 
,YY  
	CreatedAtZZ 
=ZZ 
DateTimeZZ $
.ZZ$ %
UtcNowZZ% +
}[[ 
;[[ 
_context]] 
.]] 
Users]] 
.]] 
Add]] 
(]] 
user]] #
)]]# $
;]]$ %
await^^ 
_context^^ 
.^^ 
SaveChangesAsync^^ +
(^^+ ,
cancellationToken^^, =
)^^= >
;^^> ?
varaa 
userDtoaa 
=aa 
newaa 
UserDtoaa %
{bb 
Idcc 
=cc 
usercc 
.cc 
Idcc 
,cc 
Emaildd 
=dd 
userdd 
.dd 
Emaildd "
,dd" #
FullNameee 
=ee 
useree 
.ee  
FullNameee  (
,ee( )
Roleff 
=ff 
userff 
.ff 
Roleff  
,ff  !
PhoneNumbergg 
=gg 
usergg "
.gg" #
PhoneNumbergg# .
,gg. /
	StudentIdhh 
=hh 
userhh  
.hh  !
	StudentIdhh! *
,hh* +
LoyaltyPointsii 
=ii 
userii  $
.ii$ %
LoyaltyPointsii% 2
,ii2 3
IsActivejj 
=jj 
userjj 
.jj  
IsActivejj  (
,jj( )
	CreatedAtkk 
=kk 
userkk  
.kk  !
	CreatedAtkk! *
}ll 
;ll 
returnnn 
Resultnn 
<nn 
UserDtonn !
>nn! "
.nn" #
Successnn# *
(nn* +
userDtonn+ 2
)nn2 3
;nn3 4
}oo 	
}pp 
}qq „8
\C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Authentication\Login.cs
	namespace		 	

CampusEats		
 
.		 
Backend		 
.		 
Features		 %
.		% &
Authentication		& 4
;		4 5
public 
static 
class 
Login 
{ 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
AuthResponseDto* 9
>9 :
>: ;
{ 
public 
string 
Email 
{ 
get !
;! "
init# '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public 
string 
Password 
{  
get! $
;$ %
init& *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Query/ 4
>4 5
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Email  
)  !
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( ;
); <
. 
EmailAddress 
( 
) 
.  
WithMessage  +
(+ ,
$str, B
)B C
;C D
RuleFor 
( 
x 
=> 
x 
. 
Password #
)# $
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( >
)> ?
;? @
} 	
}   
internal## 
sealed## 
class## 
Handler## !
:##" #
IRequestHandler##$ 3
<##3 4
Query##4 9
,##9 :
Result##; A
<##A B
AuthResponseDto##B Q
>##Q R
>##R S
{$$ 
private%% 
readonly%% 
AppDbContext%% %
_context%%& .
;%%. /
private&& 
readonly&& 
IJwtService&& $
_jwtService&&% 0
;&&0 1
public(( 
Handler(( 
((( 
AppDbContext(( #
context(($ +
,((+ ,
IJwtService((- 8

jwtService((9 C
)((C D
{)) 	
_context** 
=** 
context** 
;** 
_jwtService++ 
=++ 

jwtService++ $
;++$ %
},, 	
public.. 
async.. 
Task.. 
<.. 
Result..  
<..  !
AuthResponseDto..! 0
>..0 1
>..1 2
Handle..3 9
(..9 :
Query..: ?
request..@ G
,..G H
CancellationToken..I Z
cancellationToken..[ l
)..l m
{// 	
var11 
user11 
=11 
await11 
_context11 %
.11% &
Users11& +
.22 
AsNoTracking22 
(22 
)22 
.33 
FirstOrDefaultAsync33 $
(33$ %
u33% &
=>33' )
u33* +
.33+ ,
Email33, 1
==332 4
request335 <
.33< =
Email33= B
,33B C
cancellationToken33D U
)33U V
;33V W
if55 
(55 
user55 
is55 
null55 
)55 
{66 
return77 
Result77 
<77 
AuthResponseDto77 -
>77- .
.77. /
Failure77/ 6
(776 7
$str777 R
)77R S
;77S T
}88 
var;; 
passwordValid;; 
=;; 
BCrypt;;  &
.;;& '
Net;;' *
.;;* +
BCrypt;;+ 1
.;;1 2
Verify;;2 8
(;;8 9
request;;9 @
.;;@ A
Password;;A I
,;;I J
user;;K O
.;;O P
PasswordHash;;P \
);;\ ]
;;;] ^
if== 
(== 
!== 
passwordValid== 
)== 
{>> 
return?? 
Result?? 
<?? 
AuthResponseDto?? -
>??- .
.??. /
Failure??/ 6
(??6 7
$str??7 R
)??R S
;??S T
}@@ 
ifCC 
(CC 
!CC 
userCC 
.CC 
IsActiveCC 
)CC 
{DD 
returnEE 
ResultEE 
<EE 
AuthResponseDtoEE -
>EE- .
.EE. /
FailureEE/ 6
(EE6 7
$strEE7 h
)EEh i
;EEi j
}FF 
varII 
tokenII 
=II 
_jwtServiceII #
.II# $
GenerateTokenII$ 1
(II1 2
userII2 6
.II6 7
IdII7 9
,II9 :
userII; ?
.II? @
EmailII@ E
,IIE F
userIIG K
.IIK L
RoleIIL P
,IIP Q
userIIR V
.IIV W
FullNameIIW _
)II_ `
;II` a
varLL 
userDtoLL 
=LL 
newLL 
UserDtoLL %
{MM 
IdNN 
=NN 
userNN 
.NN 
IdNN 
,NN 
EmailOO 
=OO 
userOO 
.OO 
EmailOO "
,OO" #
FullNamePP 
=PP 
userPP 
.PP  
FullNamePP  (
,PP( )
RoleQQ 
=QQ 
userQQ 
.QQ 
RoleQQ  
,QQ  !
PhoneNumberRR 
=RR 
userRR "
.RR" #
PhoneNumberRR# .
,RR. /
	StudentIdSS 
=SS 
userSS  
.SS  !
	StudentIdSS! *
,SS* +
LoyaltyPointsTT 
=TT 
userTT  $
.TT$ %
LoyaltyPointsTT% 2
,TT2 3
IsActiveUU 
=UU 
userUU 
.UU  
IsActiveUU  (
,UU( )
	CreatedAtVV 
=VV 
userVV  
.VV  !
	CreatedAtVV! *
}WW 
;WW 
varYY 
responseYY 
=YY 
newYY 
AuthResponseDtoYY .
{ZZ 
Token[[ 
=[[ 
token[[ 
,[[ 
User\\ 
=\\ 
userDto\\ 
}]] 
;]] 
return__ 
Result__ 
<__ 
AuthResponseDto__ )
>__) *
.__* +
Success__+ 2
(__2 3
response__3 ;
)__; <
;__< =
}`` 	
}aa 
}bb è
eC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Authentication\GetCurrentUser.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Authentication& 4
;4 5
public

 
static

 
class

 
GetCurrentUser

 "
{ 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
UserDto* 1
>1 2
>2 3
{ 
public 
Guid 
UserId 
{ 
get  
;  !
init" &
;& '
}( )
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
UserDtoB I
>I J
>J K
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
UserDto! (
>( )
>) *
Handle+ 1
(1 2
Query2 7
request8 ?
,? @
CancellationTokenA R
cancellationTokenS d
)d e
{ 	
var 
user 
= 
await 
_context %
.% &
Users& +
. 
AsNoTracking 
( 
) 
.   
FirstOrDefaultAsync   $
(  $ %
u  % &
=>  ' )
u  * +
.  + ,
Id  , .
==  / 1
request  2 9
.  9 :
UserId  : @
,  @ A
cancellationToken  B S
)  S T
;  T U
if"" 
("" 
user"" 
is"" 
null"" 
)"" 
{## 
return$$ 
Result$$ 
<$$ 
UserDto$$ %
>$$% &
.$$& '
Failure$$' .
($$. /
$str$$/ ?
)$$? @
;$$@ A
}%% 
var'' 
userDto'' 
='' 
new'' 
UserDto'' %
{(( 
Id)) 
=)) 
user)) 
.)) 
Id)) 
,)) 
Email** 
=** 
user** 
.** 
Email** "
,**" #
FullName++ 
=++ 
user++ 
.++  
FullName++  (
,++( )
Role,, 
=,, 
user,, 
.,, 
Role,,  
,,,  !
PhoneNumber-- 
=-- 
user-- "
.--" #
PhoneNumber--# .
,--. /
	StudentId.. 
=.. 
user..  
...  !
	StudentId..! *
,..* +
LoyaltyPoints// 
=// 
user//  $
.//$ %
LoyaltyPoints//% 2
,//2 3
IsActive00 
=00 
user00 
.00  
IsActive00  (
,00( )
	CreatedAt11 
=11 
user11  
.11  !
	CreatedAt11! *
}22 
;22 
return44 
Result44 
<44 
UserDto44 !
>44! "
.44" #
Success44# *
(44* +
userDto44+ 2
)442 3
;443 4
}55 	
}66 
}77 à
JC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Domain\User.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Domain #
;# $
public 
class 
User 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
PasswordHash 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

string 
FullName 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public		 

string		 
Role		 
{		 
get		 
;		 
set		 !
;		! "
}		# $
=		% &
string		' -
.		- .
Empty		. 3
;		3 4
public

 

string

 
PhoneNumber

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
=

, -
string

. 4
.

4 5
Empty

5 :
;

: ;
public 

string 
? 
	StudentId 
{ 
get "
;" #
set$ '
;' (
}) *
public 

decimal 
LoyaltyPoints  
{! "
get# &
;& '
set( +
;+ ,
}- .
=/ 0
$num1 2
;2 3
public 

bool 
IsActive 
{ 
get 
; 
set  #
;# $
}% &
=' (
true) -
;- .
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
? 
	UpdatedAt 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

ICollection 
< 
Order 
> 
Orders $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
new5 8
List9 =
<= >
Order> C
>C D
(D E
)E F
;F G
public 

ICollection 
< 
LoyaltyTransaction )
>) *
LoyaltyTransactions+ >
{? @
getA D
;D E
setF I
;I J
}K L
=M N
newO R
ListS W
<W X
LoyaltyTransactionX j
>j k
(k l
)l m
;m n
} Ó
MC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Domain\Product.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Domain #
;# $
public 
class 
Product 
{ 
[ 
Key 
] 	
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
=% &
string' -
.- .
Empty. 3
;3 4
public		 

string		 
Description		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
=		, -
string		. 4
.		4 5
Empty		5 :
;		: ;
public

 

decimal

 
Price

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
public 

string 
Category 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
? 
ImageUrl 
{ 
get !
;! "
set# &
;& '
}( )
public 

List 
< 
string 
> 
	Allergens !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
new2 5
(5 6
)6 7
;7 8
public 

string 
? 
DietaryRestrictions &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 

bool 
IsAvailable 
{ 
get !
;! "
set# &
;& '
}( )
=* +
true, 0
;0 1
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
? 
	UpdatedAt 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

ICollection 
< 
	OrderItem  
>  !

OrderItems" ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
=; <
new= @
ListA E
<E F
	OrderItemF O
>O P
(P Q
)Q R
;R S
} «
MC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Domain\Payment.cs
public 
enum 
PaymentStatus 
{ 
Pending 
= 
$num 
, 

Processing 
= 
$num 
, 
	Completed 
= 
$num 
, 
Failed 

= 
$num 
, 
Refunded		 
=		 
$num		 
}

 
public 
enum 
PaymentMethod 
{ 
Card 
=	 

$num 
, 
Cash 
=	 

$num 
, 
LoyaltyPoints 
= 
$num 
, 
Mixed 	
=
 
$num 
} 
public 
class 
Payment 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

Guid 
OrderId 
{ 
get 
; 
set "
;" #
}$ %
public 

Order 
Order 
{ 
get 
; 
set !
;! "
}# $
=% &
null' +
!+ ,
;, -
public 

decimal 
Amount 
{ 
get 
;  
set! $
;$ %
}& '
public 

PaymentStatus 
Status 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
PaymentStatus0 =
.= >
Pending> E
;E F
public 

PaymentMethod 
Method 
{  !
get" %
;% &
set' *
;* +
}, -
public 

string 
? !
StripePaymentIntentId (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 

string 
? 
StripeSessionId "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
? 
PaidAt 
{ 
get !
;! "
set# &
;& '
}( )
public   

DateTime   
?   
FailedAt   
{   
get    #
;  # $
set  % (
;  ( )
}  * +
public!! 

string!! 
?!! 
FailureReason!!  
{!!! "
get!!# &
;!!& '
set!!( +
;!!+ ,
}!!- .
public"" 

decimal"" 
?"" 
LoyaltyPointsUsed"" %
{""& '
get""( +
;""+ ,
set""- 0
;""0 1
}""2 3
}## ®
OC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Domain\OrderItem.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Domain #
;# $
public 
class 
	OrderItem 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

Guid 
OrderId 
{ 
get 
; 
set "
;" #
}$ %
public 

Guid 
	ProductId 
{ 
get 
;  
set! $
;$ %
}& '
public 

int 
Quantity 
{ 
get 
; 
set "
;" #
}$ %
public		 

decimal		 
	UnitPrice		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
public

 

decimal

 
Subtotal

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 

string 
? 
SpecialInstructions &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 

Order 
Order 
{ 
get 
; 
set !
;! "
}# $
=% &
null' +
!+ ,
;, -
public 

Product 
Product 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
} ’
KC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Domain\Order.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Domain #
;# $
public 
class 
Order 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
OrderNumber 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 

Guid 
UserId 
{ 
get 
; 
set !
;! "
}# $
public		 

decimal		 
TotalAmount		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public

 

string

 
Status

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
=

' (
$str

) 2
;

2 3
public 

string 
PaymentStatus 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
$str0 9
;9 :
public 

string 
? 
PaymentMethod  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

string 
? 
Notes 
{ 
get 
; 
set  #
;# $
}% &
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
? 
	UpdatedAt 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

DateTime 
? 
CompletedAt  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

User 
User 
{ 
get 
; 
set 
;  
}! "
=# $
null% )
!) *
;* +
public 

ICollection 
< 
	OrderItem  
>  !

OrderItems" ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
=; <
new= @
ListA E
<E F
	OrderItemF O
>O P
(P Q
)Q R
;R S
} Ï
XC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Domain\LoyaltyTransaction.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Domain #
;# $
public 
class 
LoyaltyTransaction 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

Guid 
UserId 
{ 
get 
; 
set !
;! "
}# $
public 

User 
User 
{ 
get 
; 
set 
;  
}! "
=# $
null% )
!) *
;* +
public		 

decimal		 
PointsChange		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public

 
"
LoyaltyTransactionType

 !
Type

" &
{

' (
get

) ,
;

, -
set

. 1
;

1 2
}

3 4
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 

Guid 
? 
OrderId 
{ 
get 
; 
set  #
;# $
}% &
public 

Order 
? 
Order 
{ 
get 
; 
set "
;" #
}$ %
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
} 
public 
enum "
LoyaltyTransactionType "
{ 
Earned 

= 
$num 
, 
Redeemed 
= 
$num 
, 
Expired 
= 
$num 
, 
Adjusted 
= 
$num 
} Œ7
YC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\Services\JwtService.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
Services$ ,
;, -
public 
	interface 
IJwtService 
{		 
string

 

GenerateToken

 
(

 
Guid

 
userId

 $
,

$ %
string

& ,
email

- 2
,

2 3
string

4 :
role

; ?
,

? @
string

A G
fullName

H P
)

P Q
;

Q R
ClaimsPrincipal 
? 
ValidateToken "
(" #
string# )
token* /
)/ 0
;0 1
} 
public 
class 

JwtService 
: 
IJwtService %
{ 
private 
readonly 
IConfiguration #
_configuration$ 2
;2 3
public 


JwtService 
( 
IConfiguration $
configuration% 2
)2 3
{ 
_configuration 
= 
configuration &
;& '
} 
public 

string 
GenerateToken 
(  
Guid  $
userId% +
,+ ,
string- 3
email4 9
,9 :
string; A
roleB F
,F G
stringH N
fullNameO W
)W X
{ 
var 
securityKey 
= 
new  
SymmetricSecurityKey 2
(2 3
Encoding 
. 
UTF8 
. 
GetBytes "
(" #
_configuration# 1
[1 2
$str2 A
]A B
!B C
)C D
)D E
;E F
var 
credentials 
= 
new 
SigningCredentials 0
(0 1
securityKey1 <
,< =
SecurityAlgorithms> P
.P Q

HmacSha256Q [
)[ \
;\ ]
var 
claims 
= 
new 
[ 
] 
{ 	
new   
Claim   
(   #
JwtRegisteredClaimNames   -
.  - .
Sub  . 1
,  1 2
userId  3 9
.  9 :
ToString  : B
(  B C
)  C D
)  D E
,  E F
new!! 
Claim!! 
(!! #
JwtRegisteredClaimNames!! -
.!!- .
Email!!. 3
,!!3 4
email!!5 :
)!!: ;
,!!; <
new"" 
Claim"" 
("" 

ClaimTypes""  
.""  !
Role""! %
,""% &
role""' +
)""+ ,
,"", -
new## 
Claim## 
(## 

ClaimTypes##  
.##  !
Name##! %
,##% &
fullName##' /
)##/ 0
,##0 1
new$$ 
Claim$$ 
($$ #
JwtRegisteredClaimNames$$ -
.$$- .
Jti$$. 1
,$$1 2
Guid$$3 7
.$$7 8
NewGuid$$8 ?
($$? @
)$$@ A
.$$A B
ToString$$B J
($$J K
)$$K L
)$$L M
,$$M N
new%% 
Claim%% 
(%% #
JwtRegisteredClaimNames%% -
.%%- .
Iat%%. 1
,%%1 2
DateTimeOffset%%3 A
.%%A B
UtcNow%%B H
.%%H I
ToUnixTimeSeconds%%I Z
(%%Z [
)%%[ \
.%%\ ]
ToString%%] e
(%%e f
)%%f g
)%%g h
}&& 	
;&&	 

var(( 
expirationDays(( 
=(( 
int((  
.((  !
Parse((! &
(((& '
_configuration((' 5
[((5 6
$str((6 J
]((J K
!((K L
)((L M
;((M N
var** 
token** 
=** 
new** 
JwtSecurityToken** (
(**( )
issuer++ 
:++ 
_configuration++ "
[++" #
$str++# /
]++/ 0
,++0 1
audience,, 
:,, 
_configuration,, $
[,,$ %
$str,,% 3
],,3 4
,,,4 5
claims-- 
:-- 
claims-- 
,-- 
expires.. 
:.. 
DateTime.. 
... 
UtcNow.. $
...$ %
AddDays..% ,
(.., -
expirationDays..- ;
)..; <
,..< =
signingCredentials// 
:// 
credentials//  +
)00 	
;00	 

return22 
new22 #
JwtSecurityTokenHandler22 *
(22* +
)22+ ,
.22, -

WriteToken22- 7
(227 8
token228 =
)22= >
;22> ?
}33 
public55 

ClaimsPrincipal55 
?55 
ValidateToken55 )
(55) *
string55* 0
token551 6
)556 7
{66 
var77 
tokenHandler77 
=77 
new77 #
JwtSecurityTokenHandler77 6
(776 7
)777 8
;778 9
var88 
securityKey88 
=88 
new88  
SymmetricSecurityKey88 2
(882 3
Encoding99 
.99 
UTF899 
.99 
GetBytes99 "
(99" #
_configuration99# 1
[991 2
$str992 A
]99A B
!99B C
)99C D
)99D E
;99E F
try;; 
{<< 	
var== 
	principal== 
=== 
tokenHandler== (
.==( )
ValidateToken==) 6
(==6 7
token==7 <
,==< =
new==> A%
TokenValidationParameters==B [
{>> $
ValidateIssuerSigningKey?? (
=??) *
true??+ /
,??/ 0
IssuerSigningKey@@  
=@@! "
securityKey@@# .
,@@. /
ValidateIssuerAA 
=AA  
trueAA! %
,AA% &
ValidIssuerBB 
=BB 
_configurationBB ,
[BB, -
$strBB- 9
]BB9 :
,BB: ;
ValidateAudienceCC  
=CC! "
trueCC# '
,CC' (
ValidAudienceDD 
=DD 
_configurationDD  .
[DD. /
$strDD/ =
]DD= >
,DD> ?
ValidateLifetimeEE  
=EE! "
trueEE# '
,EE' (
	ClockSkewFF 
=FF 
TimeSpanFF $
.FF$ %
ZeroFF% )
}GG 
,GG 
outGG 
_GG 
)GG 
;GG 
returnII 
	principalII 
;II 
}JJ 	
catchKK 
{LL 	
returnMM 
nullMM 
;MM 
}NN 	
}OO 
}PP ß:
LC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\Result.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
;# $
public 
class 
Result 
< 
T 
> 
{ 
public 

bool 
	IsSuccess 
{ 
get 
;  
}! "
public 

T 
? 
Value 
{ 
get 
; 
} 
public 

string 
? 
Error 
{ 
get 
; 
}  !
public 

List 
< 
string 
> 
Errors 
{  
get! $
;$ %
}& '
private

 
Result

 
(

 
bool

 
	isSuccess

 !
,

! "
T

# $
?

$ %
value

& +
,

+ ,
string

- 3
?

3 4
error

5 :
,

: ;
List

< @
<

@ A
string

A G
>

G H
?

H I
errors

J P
=

Q R
null

S W
)

W X
{ 
	IsSuccess 
= 
	isSuccess 
; 
Value 
= 
value 
; 
Error 
= 
error 
; 
if 

( 
errors 
!= 
null 
&& 
errors $
.$ %
Count% *
>+ ,
$num- .
). /
{ 	
Errors 
= 
errors 
; 
} 	
else 
if 
( 
! 
string 
. 
IsNullOrEmpty &
(& '
error' ,
), -
)- .
{ 	
Errors 
= 
new 
List 
< 
string $
>$ %
{& '
error( -
}. /
;/ 0
} 	
else 
{ 	
Errors 
= 
new 
List 
< 
string $
>$ %
(% &
)& '
;' (
} 	
} 
public   

static   
Result   
<   
T   
>   
Success   #
(  # $
T  $ %
value  & +
)  + ,
=>  - /
new  0 3
(  3 4
true  4 8
,  8 9
value  : ?
,  ? @
null  A E
,  E F
null  G K
)  K L
;  L M
public## 

static## 
Result## 
<## 
T## 
>## 
Failure## #
(### $
string##$ *
error##+ 0
)##0 1
=>##2 4
new$$ 
($$ 
false$$ 
,$$ 
default$$ 
,$$ 
error$$ !
,$$! "
new$$# &
List$$' +
<$$+ ,
string$$, 2
>$$2 3
{$$4 5
error$$6 ;
}$$< =
)$$= >
;$$> ?
public'' 

static'' 
Result'' 
<'' 
T'' 
>'' 
Failure'' #
(''# $
List''$ (
<''( )
string'') /
>''/ 0
errors''1 7
)''7 8
=>''9 ;
new(( 
((( 
false(( 
,(( 
default(( 
,(( 
errors(( "
.((" #
FirstOrDefault((# 1
(((1 2
)((2 3
,((3 4
errors((5 ;
)((; <
;((< =
public++ 

static++ 
implicit++ 
operator++ #
bool++$ (
(++( )
Result++) /
<++/ 0
T++0 1
>++1 2
result++3 9
)++9 :
=>++; =
result++> D
.++D E
	IsSuccess++E N
;++N O
},, 
public// 
class// 
Result// 
{00 
public11 

bool11 
	IsSuccess11 
{11 
get11 
;11  
}11! "
public22 

string22 
?22 
Error22 
{22 
get22 
;22 
}22  !
public33 

List33 
<33 
string33 
>33 
Errors33 
{33  
get33! $
;33$ %
}33& '
private55 
Result55 
(55 
bool55 
	isSuccess55 !
,55! "
string55# )
?55) *
error55+ 0
,550 1
List552 6
<556 7
string557 =
>55= >
?55> ?
errors55@ F
=55G H
null55I M
)55M N
{66 
	IsSuccess77 
=77 
	isSuccess77 
;77 
Error88 
=88 
error88 
;88 
if;; 

(;; 
errors;; 
!=;; 
null;; 
&&;; 
errors;; $
.;;$ %
Count;;% *
>;;+ ,
$num;;- .
);;. /
{<< 	
Errors== 
=== 
errors== 
;== 
}>> 	
else?? 
if?? 
(?? 
!?? 
string?? 
.?? 
IsNullOrEmpty?? &
(??& '
error??' ,
)??, -
)??- .
{@@ 	
ErrorsAA 
=AA 
newAA 
ListAA 
<AA 
stringAA $
>AA$ %
{AA& '
errorAA( -
}AA. /
;AA/ 0
}BB 	
elseCC 
{DD 	
ErrorsEE 
=EE 
newEE 
ListEE 
<EE 
stringEE $
>EE$ %
(EE% &
)EE& '
;EE' (
}FF 	
}GG 
publicII 

staticII 
ResultII 
SuccessII  
(II  !
)II! "
=>II# %
newII& )
(II) *
trueII* .
,II. /
nullII0 4
,II4 5
nullII6 :
)II: ;
;II; <
publicKK 

staticKK 
ResultKK 
FailureKK  
(KK  !
stringKK! '
errorKK( -
)KK- .
=>KK/ 1
newLL 
(LL 
falseLL 
,LL 
errorLL 
,LL 
newLL 
ListLL "
<LL" #
stringLL# )
>LL) *
{LL+ ,
errorLL- 2
}LL3 4
)LL4 5
;LL5 6
publicNN 

staticNN 
ResultNN 
FailureNN  
(NN  !
ListNN! %
<NN% &
stringNN& ,
>NN, -
errorsNN. 4
)NN4 5
=>NN6 8
newOO 
(OO 
falseOO 
,OO 
errorsOO 
.OO 
FirstOrDefaultOO (
(OO( )
)OO) *
,OO* +
errorsOO, 2
)OO2 3
;OO3 4
publicQQ 

staticQQ 
implicitQQ 
operatorQQ #
boolQQ$ (
(QQ( )
ResultQQ) /
resultQQ0 6
)QQ6 7
=>QQ8 :
resultQQ; A
.QQA B
	IsSuccessQQB K
;QQK L
}RR ¼
QC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\PagedResult.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
;# $
public 
class 
PagedResult 
< 
T 
> 
{ 
public 

int 
CurrentPage 
{ 
get  
;  !
set" %
;% &
}' (
public 

int 
PageSize 
{ 
get 
; 
set "
;" #
}$ %
public 

int 

TotalCount 
{ 
get 
;  
set! $
;$ %
}& '
public 

List 
< 
T 
> 
Items 
{ 
get 
; 
set  #
;# $
}% &
=' (
new) ,
(, -
)- .
;. /
}		 ´
bC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\Exceptions\NotFoundException.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $

Exceptions$ .
;. /
public 
class 
NotFoundException 
:  
	Exception! *
{ 
public 

NotFoundException 
( 
string #
message$ +
)+ ,
:- .
base/ 3
(3 4
message4 ;
); <
{ 
} 
public		 

NotFoundException		 
(		 
string		 #

entityName		$ .
,		. /
object		0 6
key		7 :
)		: ;
:

 	
base


 
(

 
$"

 
{

 

entityName

 
}

 
$str

 '
{

' (
key

( +
}

+ ,
$str

, <
"

< =
)

= >
{ 
} 
} À
UC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\DTOs\ProductDto.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
DTOs$ (
;( )
public 
record 

ProductDto 
{ 
public 

Guid 
Id 
{ 
get 
; 
init 
; 
}  !
public 

string 
Name 
{ 
get 
; 
init "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Description 
{ 
get  #
;# $
init% )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

decimal 
Price 
{ 
get 
; 
init  $
;$ %
}& '
public		 

string		 
Category		 
{		 
get		  
;		  !
init		" &
;		& '
}		( )
=		* +
string		, 2
.		2 3
Empty		3 8
;		8 9
public

 

string

 
?

 
ImageUrl

 
{

 
get

 !
;

! "
init

# '
;

' (
}

) *
public 

List 
< 
string 
> 
	Allergens !
{" #
get$ '
;' (
init) -
;- .
}/ 0
=1 2
new3 6
(6 7
)7 8
;8 9
public 

string 
? 
DietaryRestrictions &
{' (
get) ,
;, -
init. 2
;2 3
}4 5
public 

bool 
IsAvailable 
{ 
get !
;! "
init# '
;' (
}) *
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
init% )
;) *
}+ ,
public 

DateTime 
? 
	UpdatedAt 
{  
get! $
;$ %
init& *
;* +
}, -
} 
UC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\DTOs\PaymentDto.cs
public 
class 

PaymentDto 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

Guid 
OrderId 
{ 
get 
; 
set "
;" #
}$ %
public 

decimal 
Amount 
{ 
get 
;  
set! $
;$ %
}& '
[		 
JsonConverter		 
(		 
typeof		 
(		 #
JsonStringEnumConverter		 1
)		1 2
)		2 3
]		3 4
public

 

PaymentStatus

 
Status

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
[ 
JsonConverter 
( 
typeof 
( #
JsonStringEnumConverter 1
)1 2
)2 3
]3 4
public 

PaymentMethod 
Method 
{  !
get" %
;% &
set' *
;* +
}, -
public 

string 
? !
StripePaymentIntentId (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 

string 
? 
StripeSessionId "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

string 
? 
StripeClientSecret %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
? 
PaidAt 
{ 
get !
;! "
set# &
;& '
}( )
public 

DateTime 
? 
FailedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
? 
FailureReason  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

decimal 
? 
LoyaltyPointsUsed %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} €
SC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\DTOs\OrderDto.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
DTOs$ (
;( )
public 
record 
OrderDto 
{ 
public 

Guid 
Id 
{ 
get 
; 
init 
; 
}  !
public 

string 
OrderNumber 
{ 
get  #
;# $
init% )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

Guid 
UserId 
{ 
get 
; 
init "
;" #
}$ %
public 

decimal 
TotalAmount 
{  
get! $
;$ %
init& *
;* +
}, -
public		 

string		 
Status		 
{		 
get		 
;		 
init		  $
;		$ %
}		& '
=		( )
string		* 0
.		0 1
Empty		1 6
;		6 7
public

 

string

 
PaymentStatus

 
{

  !
get

" %
;

% &
init

' +
;

+ ,
}

- .
=

/ 0
string

1 7
.

7 8
Empty

8 =
;

= >
public 

string 
? 
PaymentMethod  
{! "
get# &
;& '
init( ,
;, -
}. /
public 

string 
? 
Notes 
{ 
get 
; 
init  $
;$ %
}& '
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
init% )
;) *
}+ ,
public 

DateTime 
? 
	UpdatedAt 
{  
get! $
;$ %
init& *
;* +
}, -
public 

DateTime 
? 
CompletedAt  
{! "
get# &
;& '
init( ,
;, -
}. /
public 

List 
< 
OrderItemDto 
> 

OrderItems (
{) *
get+ .
;. /
init0 4
;4 5
}6 7
=8 9
new: =
(= >
)> ?
;? @
} 
public 
record 
OrderItemDto 
{ 
public 

Guid 
Id 
{ 
get 
; 
init 
; 
}  !
public 

Guid 
	ProductId 
{ 
get 
;  
init! %
;% &
}' (
public 

string 
ProductName 
{ 
get  #
;# $
init% )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

int 
Quantity 
{ 
get 
; 
init #
;# $
}% &
public 

decimal 
	UnitPrice 
{ 
get "
;" #
init$ (
;( )
}* +
public 

decimal 
Subtotal 
{ 
get !
;! "
init# '
;' (
}) *
public 

string 
? 
SpecialInstructions &
{' (
get) ,
;, -
init. 2
;2 3
}4 5
} —
UC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\DTOs\LoyaltyDto.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
DTOs$ (
;( )
public 
record 
LoyaltyPointsDto 
{ 
public 

Guid 
UserId 
{ 
get 
; 
init "
;" #
}$ %
public 

decimal 
CurrentPoints  
{! "
get# &
;& '
init( ,
;, -
}. /
public 

decimal 
TotalEarned 
{  
get! $
;$ %
init& *
;* +
}, -
public 

decimal 
TotalRedeemed  
{! "
get# &
;& '
init( ,
;, -
}. /
public		 

decimal		 
PointsValue		 
{		  
get		! $
;		$ %
init		& *
;		* +
}		, -
}

 
public 
record !
LoyaltyTransactionDto #
{ 
public 

Guid 
Id 
{ 
get 
; 
init 
; 
}  !
public 

Guid 
UserId 
{ 
get 
; 
init "
;" #
}$ %
public 

decimal 
PointsChange 
{  !
get" %
;% &
init' +
;+ ,
}- .
public 

string 
Type 
{ 
get 
; 
init "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Description 
{ 
get  #
;# $
init% )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

Guid 
? 
OrderId 
{ 
get 
; 
init  $
;$ %
}& '
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
init% )
;) *
}+ ,
} 
public 
record !
RedeemPointsResultDto #
{ 
public 

decimal 
PointsRedeemed !
{" #
get$ '
;' (
init) -
;- .
}/ 0
public 

decimal 
DiscountAmount !
{" #
get$ '
;' (
init) -
;- .
}/ 0
public 

decimal 
RemainingPoints "
{# $
get% (
;( )
init* .
;. /
}0 1
public 

string 
Message 
{ 
get 
;  
init! %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} ¿
]C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\DTOs\InventoryReportDto.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
DTOs$ (
;( )
public 
record 
InventoryReportDto  
{ 
public 

DateTime 
? 

ReportDate 
{  !
get" %
;% &
init' +
;+ ,
}- .
public 

List 
< 
InventoryItemDto  
>  !
InventoryItems" 0
{1 2
get3 6
;6 7
init8 <
;< =
}> ?
=@ A
newB E
(E F
)F G
;G H
public 

decimal 
TotalRevenue 
{  !
get" %
;% &
init' +
;+ ,
}- .
public 

int  
TotalOrdersProcessed #
{$ %
get& )
;) *
init+ /
;/ 0
}1 2
public		 

int		 
TotalItemsSold		 
{		 
get		  #
;		# $
init		% )
;		) *
}		+ ,
}

 
public 
record 
InventoryItemDto 
{ 
public 

Guid 
	ProductId 
{ 
get 
;  
init! %
;% &
}' (
public 

string 
ProductName 
{ 
get  #
;# $
init% )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

string 
Category 
{ 
get  
;  !
init" &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 

int 
QuantitySold 
{ 
get !
;! "
init# '
;' (
}) *
public 

decimal 
	UnitPrice 
{ 
get "
;" #
init$ (
;( )
}* +
public 

decimal 
Subtotal 
{ 
get !
;! "
init# '
;' (
}) *
public 

decimal 
Revenue 
{ 
get  
;  !
init" &
;& '
}( )
public 

int 

OrderCount 
{ 
get 
;  
init! %
;% &
}' (
public 

decimal 
AverageOrderValue $
{% &
get' *
;* +
init, 0
;0 1
}2 3
} º"
RC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\DTOs\AuthDto.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
DTOs$ (
;( )
public 
class 
RegisterDto 
{ 
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
FullName 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
PhoneNumber 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public		 

string		 
?		 
	StudentId		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
}

 
public 
class 
LoginDto 
{ 
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
public 
class 
AuthResponseDto 
{ 
public 

string 
Token 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

UserDto 
User 
{ 
get 
; 
set "
;" #
}$ %
=& '
null( ,
!, -
;- .
} 
public 
class 
UserDto 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
FullName 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
Role 
{ 
get 
; 
set !
;! "
}# $
=% &
string' -
.- .
Empty. 3
;3 4
public 

string 
PhoneNumber 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 

string 
? 
	StudentId 
{ 
get "
;" #
set$ '
;' (
}) *
public   

decimal   
LoyaltyPoints    
{  ! "
get  # &
;  & '
set  ( +
;  + ,
}  - .
public!! 

bool!! 
IsActive!! 
{!! 
get!! 
;!! 
set!!  #
;!!# $
}!!% &
public"" 

DateTime"" 
	CreatedAt"" 
{"" 
get""  #
;""# $
set""% (
;""( )
}""* +
}## É
[C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\Config\StripeSettings.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
Config$ *
;* +
public 
class 
StripeSettings 
{ 
public 

string 
	SecretKey 
{ 
get !
;! "
set# &
;& '
}( )
=* +
$str, .
;. /
public 

string 
	PublicKey 
{ 
get !
;! "
set# &
;& '
}( )
=* +
$str, .
;. /
public		 

string		 
WebhookSecret		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
=		. /
$str		0 2
;		2 3
}

 í/
bC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\Behaviors\ValidationBehavior.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
	Behaviors$ -
;- .
public 
class 
ValidationBehavior 
<  
TRequest  (
,( )
	TResponse* 3
>3 4
:5 6
IPipelineBehavior7 H
<H I
TRequestI Q
,Q R
	TResponseS \
>\ ]
where 	
TRequest
 
: 
IRequest 
< 
	TResponse '
>' (
{		 
private

 
readonly

 
IEnumerable

  
<

  !

IValidator

! +
<

+ ,
TRequest

, 4
>

4 5
>

5 6
_validators

7 B
;

B C
public 

ValidationBehavior 
( 
IEnumerable )
<) *

IValidator* 4
<4 5
TRequest5 =
>= >
>> ?

validators@ J
)J K
{ 
_validators 
= 

validators  
;  !
} 
public 

async 
Task 
< 
	TResponse 
>  
Handle! '
(' (
TRequest 
request 
, "
RequestHandlerDelegate 
< 
	TResponse (
>( )
next* .
,. /
CancellationToken 
cancellationToken +
)+ ,
{ 
if 

( 
! 
_validators 
. 
Any 
( 
) 
) 
{ 	
return 
await 
next 
( 
) 
;  
} 	
var 
context 
= 
new 
ValidationContext +
<+ ,
TRequest, 4
>4 5
(5 6
request6 =
)= >
;> ?
var 
validationResults 
= 
await  %
Task& *
.* +
WhenAll+ 2
(2 3
_validators   
.   
Select   
(   
v    
=>  ! #
v  $ %
.  % &
ValidateAsync  & 3
(  3 4
context  4 ;
,  ; <
cancellationToken  = N
)  N O
)  O P
)  P Q
;  Q R
var"" 
failures"" 
="" 
validationResults"" (
.## 

SelectMany## 
(## 
r## 
=>## 
r## 
.## 
Errors## %
)##% &
.$$ 
Where$$ 
($$ 
f$$ 
=>$$ 
f$$ 
!=$$ 
null$$ !
)$$! "
.%% 
ToList%% 
(%% 
)%% 
;%% 
if(( 

((( 
failures(( 
.(( 
Any(( 
((( 
)(( 
)(( 
{)) 	
var** 
errors** 
=** 
failures** !
.**! "
Select**" (
(**( )
f**) *
=>**+ -
f**. /
.**/ 0
ErrorMessage**0 <
)**< =
.**= >
ToList**> D
(**D E
)**E F
;**F G
if-- 
(-- 
typeof-- 
(-- 
	TResponse--  
)--  !
.--! "
IsGenericType--" /
&&--0 2
typeof.. 
(.. 
	TResponse..  
)..  !
...! "$
GetGenericTypeDefinition.." :
(..: ;
)..; <
==..= ?
typeof..@ F
(..F G
Result..G M
<..M N
>..N O
)..O P
)..P Q
{// 
var00 

resultType00 
=00  
typeof00! '
(00' (
	TResponse00( 1
)001 2
.002 3
GetGenericArguments003 F
(00F G
)00G H
[00H I
$num00I J
]00J K
;00K L
var11 
failureMethod11 !
=11" #
typeof11$ *
(11* +
Result11+ 1
<111 2
>112 3
)113 4
.22 
MakeGenericType22 $
(22$ %

resultType22% /
)22/ 0
.33 
	GetMethod33 
(33 
nameof33 %
(33% &
Result33& ,
<33, -
object33- 3
>333 4
.334 5
Failure335 <
)33< =
,33= >
new33? B
[33B C
]33C D
{33E F
typeof33G M
(33M N
List33N R
<33R S
string33S Y
>33Y Z
)33Z [
}33\ ]
)33] ^
;33^ _
return55 
(55 
	TResponse55 !
)55! "
failureMethod55" /
!55/ 0
.550 1
Invoke551 7
(557 8
null558 <
,55< =
new55> A
object55B H
[55H I
]55I J
{55K L
errors55M S
}55T U
)55U V
!55V W
;55W X
}66 
if99 
(99 
typeof99 
(99 
	TResponse99  
)99  !
==99" $
typeof99% +
(99+ ,
Result99, 2
)992 3
)993 4
{:: 
return;; 
(;; 
	TResponse;; !
);;! "
(;;" #
object;;# )
);;) *
Result;;* 0
.;;0 1
Failure;;1 8
(;;8 9
errors;;9 ?
);;? @
;;;@ A
}<< 
throw?? 
new?? 
ValidationException?? )
(??) *
failures??* 2
)??2 3
;??3 4
}@@ 	
returnCC 
awaitCC 
nextCC 
(CC 
)CC 
;CC 
}DD 
}EE 