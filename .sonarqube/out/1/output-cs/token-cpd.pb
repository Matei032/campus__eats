ζο
YC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Persistence\DatabaseSeeder.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Persistence (
;( )
public 
static 
class 
DatabaseSeeder "
{ 
public 

static 
async 
Task 
	SeedAsync &
(& '
AppDbContext' 3
context4 ;
); <
{		 
if 

( 
await 
context 
. 
Orders  
.  !
AnyAsync! )
() *
)* +
)+ ,
{ 	
return 
; 
} 	
if 

( 
! 
await 
context 
. 
Users  
.  !
AnyAsync! )
() *
)* +
)+ ,
{ 	
var 
users 
= 
new 
List  
<  !
User! %
>% &
{ 
new 
( 
) 
{ 
Id 
= 
Guid 
. 
Parse #
(# $
$str$ J
)J K
,K L
Email 
= 
$str 0
,0 1
PasswordHash  
=! "
BCrypt# )
.) *
Net* -
.- .
BCrypt. 4
.4 5
HashPassword5 A
(A B
$strB O
)O P
,P Q
FullName 
= 
$str -
,- .
Role 
= 
$str $
,$ %
PhoneNumber 
=  !
$str" 0
,0 1
LoyaltyPoints !
=" #
$num$ '
,' (
IsActive 
= 
true #
,# $
	CreatedAt 
= 
DateTime  (
.( )
UtcNow) /
}   
,   
new!! 
(!! 
)!! 
{"" 
Id## 
=## 
Guid## 
.## 
Parse## #
(### $
$str##$ J
)##J K
,##K L
Email$$ 
=$$ 
$str$$ 0
,$$0 1
PasswordHash%%  
=%%! "
BCrypt%%# )
.%%) *
Net%%* -
.%%- .
BCrypt%%. 4
.%%4 5
HashPassword%%5 A
(%%A B
$str%%B O
)%%O P
,%%P Q
FullName&& 
=&& 
$str&& .
,&&. /
Role'' 
='' 
$str'' $
,''$ %
PhoneNumber(( 
=((  !
$str((" 0
,((0 1
LoyaltyPoints)) !
=))" #
$num))$ '
,))' (
IsActive** 
=** 
true** #
,**# $
	CreatedAt++ 
=++ 
DateTime++  (
.++( )
UtcNow++) /
},, 
,,, 
new-- 
(-- 
)-- 
{.. 
Id// 
=// 
Guid// 
.// 
Parse// #
(//# $
$str//$ J
)//J K
,//K L
Email00 
=00 
$str00 .
,00. /
PasswordHash11  
=11! "
BCrypt11# )
.11) *
Net11* -
.11- .
BCrypt11. 4
.114 5
HashPassword115 A
(11A B
$str11B M
)11M N
,11N O
FullName22 
=22 
$str22 .
,22. /
Role33 
=33 
$str33 "
,33" #
PhoneNumber44 
=44  !
$str44" 0
,440 1
LoyaltyPoints55 !
=55" #
$num55$ %
,55% &
IsActive66 
=66 
true66 #
,66# $
	CreatedAt77 
=77 
DateTime77  (
.77( )
UtcNow77) /
}88 
,88 
new99 
(99 
)99 
{:: 
Id;; 
=;; 
Guid;; 
.;; 
Parse;; #
(;;# $
$str;;$ J
);;J K
,;;K L
Email<< 
=<< 
$str<< -
,<<- .
PasswordHash==  
===! "
BCrypt==# )
.==) *
Net==* -
.==- .
BCrypt==. 4
.==4 5
HashPassword==5 A
(==A B
$str==B M
)==M N
,==N O
FullName>> 
=>> 
$str>> +
,>>+ ,
Role?? 
=?? 
$str?? "
,??" #
PhoneNumber@@ 
=@@  !
$str@@" 0
,@@0 1
LoyaltyPointsAA !
=AA" #
$numAA$ %
,AA% &
IsActiveBB 
=BB 
trueBB #
,BB# $
	CreatedAtCC 
=CC 
DateTimeCC  (
.CC( )
UtcNowCC) /
}DD 
}EE 
;EE 
awaitGG 
contextGG 
.GG 
UsersGG 
.GG  
AddRangeAsyncGG  -
(GG- .
usersGG. 3
)GG3 4
;GG4 5
awaitHH 
contextHH 
.HH 
SaveChangesAsyncHH *
(HH* +
)HH+ ,
;HH, -
}II 	
ifLL 

(LL 
!LL 
awaitLL 
contextLL 
.LL 
ProductsLL #
.LL# $
AnyAsyncLL$ ,
(LL, -
)LL- .
)LL. /
{MM 	
varNN 
productsNN 
=NN 
newNN 
ListNN #
<NN# $
ProductNN$ +
>NN+ ,
{OO 
newQQ 
(QQ 
)QQ 
{RR 
IdSS 
=SS 
GuidSS 
.SS 
ParseSS #
(SS# $
$strSS$ J
)SSJ K
,SSK L
NameTT 
=TT 
$strTT +
,TT+ ,
DescriptionUU 
=UU  !
$strUU" l
,UUl m
PriceVV 
=VV 
$numVV "
,VV" #
CategoryWW 
=WW 
$strWW %
,WW% &
ImageUrlXX 
=XX 
$strXX ]
,XX] ^
	AllergensYY 
=YY 
newYY  #
ListYY$ (
<YY( )
stringYY) /
>YY/ 0
{YY1 2
$strYY3 ;
,YY; <
$strYY= F
}YYG H
,YYH I
DietaryRestrictionsZZ '
=ZZ( )
nullZZ* .
,ZZ. /
IsAvailable[[ 
=[[  !
true[[" &
,[[& '
	CreatedAt\\ 
=\\ 
DateTime\\  (
.\\( )
UtcNow\\) /
}]] 
,]] 
new^^ 
(^^ 
)^^ 
{__ 
Id`` 
=`` 
Guid`` 
.`` 
Parse`` #
(``# $
$str``$ J
)``J K
,``K L
Nameaa 
=aa 
$straa -
,aa- .
Descriptionbb 
=bb  !
$strbb" a
,bba b
Pricecc 
=cc 
$numcc "
,cc" #
Categorydd 
=dd 
$strdd %
,dd% &
ImageUrlee 
=ee 
$stree ]
,ee] ^
	Allergensff 
=ff 
newff  #
Listff$ (
<ff( )
stringff) /
>ff/ 0
{ff1 2
$strff3 ;
,ff; <
$strff= F
}ffG H
,ffH I
DietaryRestrictionsgg '
=gg( )
$strgg* 6
,gg6 7
IsAvailablehh 
=hh  !
truehh" &
,hh& '
	CreatedAtii 
=ii 
DateTimeii  (
.ii( )
UtcNowii) /
}jj 
,jj 
newkk 
(kk 
)kk 
{ll 
Idmm 
=mm 
Guidmm 
.mm 
Parsemm #
(mm# $
$strmm$ J
)mmJ K
,mmK L
Namenn 
=nn 
$strnn *
,nn* +
Descriptionoo 
=oo  !
$stroo" q
,ooq r
Pricepp 
=pp 
$numpp "
,pp" #
Categoryqq 
=qq 
$strqq %
,qq% &
ImageUrlrr 
=rr 
$strrr Z
,rrZ [
	Allergensss 
=ss 
newss  #
Listss$ (
<ss( )
stringss) /
>ss/ 0
{ss1 2
$strss3 ;
,ss; <
$strss= C
,ssC D
$strssE K
}ssL M
,ssM N
DietaryRestrictionstt '
=tt( )
nulltt* .
,tt. /
IsAvailableuu 
=uu  !
trueuu" &
,uu& '
	CreatedAtvv 
=vv 
DateTimevv  (
.vv( )
UtcNowvv) /
}ww 
,ww 
newxx 
(xx 
)xx 
{yy 
Idzz 
=zz 
Guidzz 
.zz 
Parsezz #
(zz# $
$strzz$ J
)zzJ K
,zzK L
Name{{ 
={{ 
$str{{ ,
,{{, -
Description|| 
=||  !
$str||" O
,||O P
Price}} 
=}} 
$num}} "
,}}" #
Category~~ 
=~~ 
$str~~ %
,~~% &
ImageUrl 
= 
$str ]
,] ^
	Allergens
€€ 
=
€€ 
new
€€  #
List
€€$ (
<
€€( )
string
€€) /
>
€€/ 0
{
€€1 2
$str
€€3 ;
,
€€; <
$str
€€= C
,
€€C D
$str
€€E N
}
€€O P
,
€€P Q!
DietaryRestrictions
 '
=
( )
null
* .
,
. /
IsAvailable
‚‚ 
=
‚‚  !
true
‚‚" &
,
‚‚& '
	CreatedAt
ƒƒ 
=
ƒƒ 
DateTime
ƒƒ  (
.
ƒƒ( )
UtcNow
ƒƒ) /
}
„„ 
,
„„ 
new
…… 
(
…… 
)
…… 
{
†† 
Id
‡‡ 
=
‡‡ 
Guid
‡‡ 
.
‡‡ 
Parse
‡‡ #
(
‡‡# $
$str
‡‡$ J
)
‡‡J K
,
‡‡K L
Name
 
=
 
$str
 '
,
' (
Description
‰‰ 
=
‰‰  !
$str
‰‰" l
,
‰‰l m
Price
 
=
 
$num
 "
,
" #
Category
‹‹ 
=
‹‹ 
$str
‹‹ %
,
‹‹% &
ImageUrl
 
=
 
$str
 ]
,
] ^
	Allergens
 
=
 
new
  #
List
$ (
<
( )
string
) /
>
/ 0
{
1 2
$str
3 ;
,
; <
$str
= E
}
F G
,
G H!
DietaryRestrictions
 '
=
( )
$str
* 1
,
1 2
IsAvailable
 
=
  !
true
" &
,
& '
	CreatedAt
 
=
 
DateTime
  (
.
( )
UtcNow
) /
}
‘‘ 
,
‘‘ 
new
”” 
(
”” 
)
”” 
{
•• 
Id
–– 
=
–– 
Guid
–– 
.
–– 
Parse
–– #
(
––# $
$str
––$ J
)
––J K
,
––K L
Name
—— 
=
—— 
$str
—— '
,
——' (
Description
 
=
  !
$str
" N
,
N O
Price
™™ 
=
™™ 
$num
™™ "
,
™™" #
Category
 
=
 
$str
 &
,
& '
ImageUrl
›› 
=
›› 
$str
›› ]
,
››] ^
	Allergens
 
=
 
new
  #
List
$ (
<
( )
string
) /
>
/ 0
{
1 2
$str
3 <
}
= >
,
> ?!
DietaryRestrictions
 '
=
( )
$str
* 6
,
6 7
IsAvailable
 
=
  !
true
" &
,
& '
	CreatedAt
 
=
 
DateTime
  (
.
( )
UtcNow
) /
}
   
,
   
new
΅΅ 
(
΅΅ 
)
΅΅ 
{
ΆΆ 
Id
££ 
=
££ 
Guid
££ 
.
££ 
Parse
££ #
(
££# $
$str
££$ J
)
££J K
,
££K L
Name
¤¤ 
=
¤¤ 
$str
¤¤ .
,
¤¤. /
Description
¥¥ 
=
¥¥  !
$str
¥¥" P
,
¥¥P Q
Price
¦¦ 
=
¦¦ 
$num
¦¦ "
,
¦¦" #
Category
§§ 
=
§§ 
$str
§§ &
,
§§& '
ImageUrl
¨¨ 
=
¨¨ 
$str
¨¨ ]
,
¨¨] ^
	Allergens
©© 
=
©© 
new
©©  #
List
©©$ (
<
©©( )
string
©©) /
>
©©/ 0
(
©©0 1
)
©©1 2
,
©©2 3!
DietaryRestrictions
 '
=
( )
$str
* 1
,
1 2
IsAvailable
«« 
=
««  !
true
««" &
,
««& '
	CreatedAt
¬¬ 
=
¬¬ 
DateTime
¬¬  (
.
¬¬( )
UtcNow
¬¬) /
}
­­ 
,
­­ 
new
®® 
(
®® 
)
®® 
{
―― 
Id
°° 
=
°° 
Guid
°° 
.
°° 
Parse
°° #
(
°°# $
$str
°°$ J
)
°°J K
,
°°K L
Name
±± 
=
±± 
$str
±± 9
,
±±9 :
Description
²² 
=
²²  !
$str
²²" N
,
²²N O
Price
³³ 
=
³³ 
$num
³³ "
,
³³" #
Category
΄΄ 
=
΄΄ 
$str
΄΄ &
,
΄΄& '
ImageUrl
µµ 
=
µµ 
$str
µµ ]
,
µµ] ^
	Allergens
¶¶ 
=
¶¶ 
new
¶¶  #
List
¶¶$ (
<
¶¶( )
string
¶¶) /
>
¶¶/ 0
(
¶¶0 1
)
¶¶1 2
,
¶¶2 3!
DietaryRestrictions
·· '
=
··( )
$str
··* 1
,
··1 2
IsAvailable
ΈΈ 
=
ΈΈ  !
true
ΈΈ" &
,
ΈΈ& '
	CreatedAt
ΉΉ 
=
ΉΉ 
DateTime
ΉΉ  (
.
ΉΉ( )
UtcNow
ΉΉ) /
}
ΊΊ 
,
ΊΊ 
new
½½ 
(
½½ 
)
½½ 
{
ΎΎ 
Id
ΏΏ 
=
ΏΏ 
Guid
ΏΏ 
.
ΏΏ 
Parse
ΏΏ #
(
ΏΏ# $
$str
ΏΏ$ J
)
ΏΏJ K
,
ΏΏK L
Name
ΐΐ 
=
ΐΐ 
$str
ΐΐ ;
,
ΐΐ; <
Description
ΑΑ 
=
ΑΑ  !
$str
ΑΑ" T
,
ΑΑT U
Price
ΒΒ 
=
ΒΒ 
$num
ΒΒ "
,
ΒΒ" #
Category
ΓΓ 
=
ΓΓ 
$str
ΓΓ (
,
ΓΓ( )
ImageUrl
ΔΔ 
=
ΔΔ 
$str
ΔΔ ]
,
ΔΔ] ^
	Allergens
ΕΕ 
=
ΕΕ 
new
ΕΕ  #
List
ΕΕ$ (
<
ΕΕ( )
string
ΕΕ) /
>
ΕΕ/ 0
{
ΕΕ1 2
$str
ΕΕ3 ;
,
ΕΕ; <
$str
ΕΕ= C
,
ΕΕC D
$str
ΕΕE N
}
ΕΕO P
,
ΕΕP Q!
DietaryRestrictions
ΖΖ '
=
ΖΖ( )
$str
ΖΖ* 6
,
ΖΖ6 7
IsAvailable
ΗΗ 
=
ΗΗ  !
true
ΗΗ" &
,
ΗΗ& '
	CreatedAt
ΘΘ 
=
ΘΘ 
DateTime
ΘΘ  (
.
ΘΘ( )
UtcNow
ΘΘ) /
}
ΙΙ 
,
ΙΙ 
new
ΚΚ 
(
ΚΚ 
)
ΚΚ 
{
ΛΛ 
Id
ΜΜ 
=
ΜΜ 
Guid
ΜΜ 
.
ΜΜ 
Parse
ΜΜ #
(
ΜΜ# $
$str
ΜΜ$ J
)
ΜΜJ K
,
ΜΜK L
Name
ΝΝ 
=
ΝΝ 
$str
ΝΝ 3
,
ΝΝ3 4
Description
ΞΞ 
=
ΞΞ  !
$str
ΞΞ" R
,
ΞΞR S
Price
ΟΟ 
=
ΟΟ 
$num
ΟΟ !
,
ΟΟ! "
Category
ΠΠ 
=
ΠΠ 
$str
ΠΠ &
,
ΠΠ& '
ImageUrl
ΡΡ 
=
ΡΡ 
$str
ΡΡ Z
,
ΡΡZ [
	Allergens
 
=
 
new
  #
List
$ (
<
( )
string
) /
>
/ 0
{
1 2
$str
3 ;
,
; <
$str
= C
,
C D
$str
E N
}
O P
,
P Q!
DietaryRestrictions
ΣΣ '
=
ΣΣ( )
$str
ΣΣ* 6
,
ΣΣ6 7
IsAvailable
ΤΤ 
=
ΤΤ  !
true
ΤΤ" &
,
ΤΤ& '
	CreatedAt
ΥΥ 
=
ΥΥ 
DateTime
ΥΥ  (
.
ΥΥ( )
UtcNow
ΥΥ) /
}
ΦΦ 
}
ΧΧ 
;
ΧΧ 
await
ΩΩ 
context
ΩΩ 
.
ΩΩ 
Products
ΩΩ "
.
ΩΩ" #
AddRangeAsync
ΩΩ# 0
(
ΩΩ0 1
products
ΩΩ1 9
)
ΩΩ9 :
;
ΩΩ: ;
await
ΪΪ 
context
ΪΪ 
.
ΪΪ 
SaveChangesAsync
ΪΪ *
(
ΪΪ* +
)
ΪΪ+ ,
;
ΪΪ, -
}
ΫΫ 	
var
ήή 
existingUsers
ήή 
=
ήή 
await
ήή !
context
ήή" )
.
ήή) *
Users
ήή* /
.
ήή/ 0
ToListAsync
ήή0 ;
(
ήή; <
)
ήή< =
;
ήή= >
var
ίί 
existingProducts
ίί 
=
ίί 
await
ίί $
context
ίί% ,
.
ίί, -
Products
ίί- 5
.
ίί5 6
ToListAsync
ίί6 A
(
ίίA B
)
ίίB C
;
ίίC D
var
ββ 
baseDate
ββ 
=
ββ 
DateTime
ββ 
.
ββ  
UtcNow
ββ  &
;
ββ& '
var
γγ 
orders
γγ 
=
γγ 
new
γγ 
List
γγ 
<
γγ 
Order
γγ #
>
γγ# $
{
δδ 	
new
ζζ 
(
ζζ 
)
ζζ 
{
ηη 
Id
θθ 
=
θθ 
Guid
θθ 
.
θθ 
NewGuid
θθ !
(
θθ! "
)
θθ" #
,
θθ# $
OrderNumber
ιι 
=
ιι 
$str
ιι 1
,
ιι1 2
UserId
κκ 
=
κκ 
existingUsers
κκ &
[
κκ& '
$num
κκ' (
]
κκ( )
.
κκ) *
Id
κκ* ,
,
κκ, -
TotalAmount
λλ 
=
λλ 
$num
λλ $
,
λλ$ %
Status
μμ 
=
μμ 
$str
μμ "
,
μμ" #
PaymentStatus
νν 
=
νν 
$str
νν  &
,
νν& '
PaymentMethod
ξξ 
=
ξξ 
$str
ξξ  &
,
ξξ& '
Notes
οο 
=
οο 
$str
οο 6
,
οο6 7
	CreatedAt
ππ 
=
ππ 
baseDate
ππ $
.
ππ$ %

AddMinutes
ππ% /
(
ππ/ 0
-
ππ0 1
$num
ππ1 3
)
ππ3 4
,
ππ4 5
	UpdatedAt
ρρ 
=
ρρ 
baseDate
ρρ $
.
ρρ$ %

AddMinutes
ρρ% /
(
ρρ/ 0
-
ρρ0 1
$num
ρρ1 3
)
ρρ3 4
}
ςς 
,
ςς 
new
σσ 
(
σσ 
)
σσ 
{
ττ 
Id
υυ 
=
υυ 
Guid
υυ 
.
υυ 
NewGuid
υυ !
(
υυ! "
)
υυ" #
,
υυ# $
OrderNumber
φφ 
=
φφ 
$str
φφ 1
,
φφ1 2
UserId
χχ 
=
χχ 
existingUsers
χχ &
[
χχ& '
$num
χχ' (
]
χχ( )
.
χχ) *
Id
χχ* ,
,
χχ, -
TotalAmount
ψψ 
=
ψψ 
$num
ψψ $
,
ψψ$ %
Status
ωω 
=
ωω 
$str
ωω "
,
ωω" #
PaymentStatus
ϊϊ 
=
ϊϊ 
$str
ϊϊ  &
,
ϊϊ& '
PaymentMethod
ϋϋ 
=
ϋϋ 
$str
ϋϋ  &
,
ϋϋ& '
Notes
όό 
=
όό 
null
όό 
,
όό 
	CreatedAt
ύύ 
=
ύύ 
baseDate
ύύ $
.
ύύ$ %

AddMinutes
ύύ% /
(
ύύ/ 0
-
ύύ0 1
$num
ύύ1 3
)
ύύ3 4
,
ύύ4 5
	UpdatedAt
ώώ 
=
ώώ 
baseDate
ώώ $
.
ώώ$ %

AddMinutes
ώώ% /
(
ώώ/ 0
-
ώώ0 1
$num
ώώ1 3
)
ώώ3 4
}
 
,
 
new
€€ 
(
€€ 
)
€€ 
{
 
Id
‚‚ 
=
‚‚ 
Guid
‚‚ 
.
‚‚ 
NewGuid
‚‚ !
(
‚‚! "
)
‚‚" #
,
‚‚# $
OrderNumber
ƒƒ 
=
ƒƒ 
$str
ƒƒ 1
,
ƒƒ1 2
UserId
„„ 
=
„„ 
existingUsers
„„ &
[
„„& '
$num
„„' (
]
„„( )
.
„„) *
Id
„„* ,
,
„„, -
TotalAmount
…… 
=
…… 
$num
…… $
,
……$ %
Status
†† 
=
†† 
$str
†† $
,
††$ %
PaymentStatus
‡‡ 
=
‡‡ 
$str
‡‡  &
,
‡‡& '
PaymentMethod
 
=
 
$str
  &
,
& '
Notes
‰‰ 
=
‰‰ 
$str
‰‰ /
,
‰‰/ 0
	CreatedAt
 
=
 
baseDate
 $
.
$ %

AddMinutes
% /
(
/ 0
-
0 1
$num
1 3
)
3 4
,
4 5
	UpdatedAt
‹‹ 
=
‹‹ 
baseDate
‹‹ $
.
‹‹$ %

AddMinutes
‹‹% /
(
‹‹/ 0
-
‹‹0 1
$num
‹‹1 2
)
‹‹2 3
}
 
,
 
new
 
(
 
)
 
{
 
Id
‘‘ 
=
‘‘ 
Guid
‘‘ 
.
‘‘ 
NewGuid
‘‘ !
(
‘‘! "
)
‘‘" #
,
‘‘# $
OrderNumber
’’ 
=
’’ 
$str
’’ 1
,
’’1 2
UserId
““ 
=
““ 
existingUsers
““ &
[
““& '
$num
““' (
]
““( )
.
““) *
Id
““* ,
,
““, -
TotalAmount
”” 
=
”” 
$num
”” $
,
””$ %
Status
•• 
=
•• 
$str
•• $
,
••$ %
PaymentStatus
–– 
=
–– 
$str
––  &
,
––& '
PaymentMethod
—— 
=
—— 
$str
——  &
,
——& '
Notes
 
=
 
null
 
,
 
	CreatedAt
™™ 
=
™™ 
baseDate
™™ $
.
™™$ %
AddHours
™™% -
(
™™- .
-
™™. /
$num
™™/ 0
)
™™0 1
,
™™1 2
	UpdatedAt
 
=
 
baseDate
 $
.
$ %
AddHours
% -
(
- .
-
. /
$num
/ 2
)
2 3
,
3 4
CompletedAt
›› 
=
›› 
baseDate
›› &
.
››& '
AddHours
››' /
(
››/ 0
-
››0 1
$num
››1 4
)
››4 5
}
 
,
 
new
 
(
 
)
 
{
 
Id
 
=
 
Guid
 
.
 
NewGuid
 !
(
! "
)
" #
,
# $
OrderNumber
   
=
   
$str
   1
,
  1 2
UserId
΅΅ 
=
΅΅ 
existingUsers
΅΅ &
[
΅΅& '
$num
΅΅' (
]
΅΅( )
.
΅΅) *
Id
΅΅* ,
,
΅΅, -
TotalAmount
ΆΆ 
=
ΆΆ 
$num
ΆΆ $
,
ΆΆ$ %
Status
££ 
=
££ 
$str
££ $
,
££$ %
PaymentStatus
¤¤ 
=
¤¤ 
$str
¤¤  &
,
¤¤& '
PaymentMethod
¥¥ 
=
¥¥ 
$str
¥¥  &
,
¥¥& '
Notes
¦¦ 
=
¦¦ 
null
¦¦ 
,
¦¦ 
	CreatedAt
§§ 
=
§§ 
baseDate
§§ $
.
§§$ %
AddHours
§§% -
(
§§- .
-
§§. /
$num
§§/ 0
)
§§0 1
,
§§1 2
	UpdatedAt
¨¨ 
=
¨¨ 
baseDate
¨¨ $
.
¨¨$ %

AddMinutes
¨¨% /
(
¨¨/ 0
-
¨¨0 1
$num
¨¨1 3
)
¨¨3 4
,
¨¨4 5
CompletedAt
©© 
=
©© 
baseDate
©© &
.
©©& '

AddMinutes
©©' 1
(
©©1 2
-
©©2 3
$num
©©3 5
)
©©5 6
}
 
,
 
new
­­ 
(
­­ 
)
­­ 
{
®® 
Id
―― 
=
―― 
Guid
―― 
.
―― 
NewGuid
―― !
(
――! "
)
――" #
,
――# $
OrderNumber
°° 
=
°° 
$str
°° 1
,
°°1 2
UserId
±± 
=
±± 
existingUsers
±± &
[
±±& '
$num
±±' (
]
±±( )
.
±±) *
Id
±±* ,
,
±±, -
TotalAmount
²² 
=
²² 
$num
²² $
,
²²$ %
Status
³³ 
=
³³ 
$str
³³  
,
³³  !
PaymentStatus
΄΄ 
=
΄΄ 
$str
΄΄  &
,
΄΄& '
PaymentMethod
µµ 
=
µµ 
$str
µµ  &
,
µµ& '
Notes
¶¶ 
=
¶¶ 
$str
¶¶ 8
,
¶¶8 9
	CreatedAt
·· 
=
·· 
baseDate
·· $
.
··$ %

AddMinutes
··% /
(
··/ 0
-
··0 1
$num
··1 3
)
··3 4
,
··4 5
	UpdatedAt
ΈΈ 
=
ΈΈ 
baseDate
ΈΈ $
.
ΈΈ$ %

AddMinutes
ΈΈ% /
(
ΈΈ/ 0
-
ΈΈ0 1
$num
ΈΈ1 2
)
ΈΈ2 3
}
ΉΉ 
}
ΊΊ 	
;
ΊΊ	 

await
ΌΌ 
context
ΌΌ 
.
ΌΌ 
Orders
ΌΌ 
.
ΌΌ 
AddRangeAsync
ΌΌ *
(
ΌΌ* +
orders
ΌΌ+ 1
)
ΌΌ1 2
;
ΌΌ2 3
await
½½ 
context
½½ 
.
½½ 
SaveChangesAsync
½½ &
(
½½& '
)
½½' (
;
½½( )
var
ΐΐ 

orderItems
ΐΐ 
=
ΐΐ 
new
ΐΐ 
List
ΐΐ !
<
ΐΐ! "
	OrderItem
ΐΐ" +
>
ΐΐ+ ,
{
ΑΑ 	
new
ΓΓ 
(
ΓΓ 
)
ΓΓ 
{
ΓΓ 
Id
ΓΓ 
=
ΓΓ 
Guid
ΓΓ 
.
ΓΓ 
NewGuid
ΓΓ %
(
ΓΓ% &
)
ΓΓ& '
,
ΓΓ' (
OrderId
ΓΓ) 0
=
ΓΓ1 2
orders
ΓΓ3 9
[
ΓΓ9 :
$num
ΓΓ: ;
]
ΓΓ; <
.
ΓΓ< =
Id
ΓΓ= ?
,
ΓΓ? @
	ProductId
ΓΓA J
=
ΓΓK L
existingProducts
ΓΓM ]
[
ΓΓ] ^
$num
ΓΓ^ _
]
ΓΓ_ `
.
ΓΓ` a
Id
ΓΓa c
,
ΓΓc d
Quantity
ΓΓe m
=
ΓΓn o
$num
ΓΓp q
,
ΓΓq r
	UnitPrice
ΓΓs |
=
ΓΓ} ~
$numΓΓ …
,ΓΓ… †
SubtotalΓΓ‡ 
=ΓΓ ‘
$numΓΓ’ 
,ΓΓ ™#
SpecialInstructionsΓΓ ­
=ΓΓ® ―
$strΓΓ° Ό
}ΓΓ½ Ύ
,ΓΓΎ Ώ
new
ΔΔ 
(
ΔΔ 
)
ΔΔ 
{
ΔΔ 
Id
ΔΔ 
=
ΔΔ 
Guid
ΔΔ 
.
ΔΔ 
NewGuid
ΔΔ %
(
ΔΔ% &
)
ΔΔ& '
,
ΔΔ' (
OrderId
ΔΔ) 0
=
ΔΔ1 2
orders
ΔΔ3 9
[
ΔΔ9 :
$num
ΔΔ: ;
]
ΔΔ; <
.
ΔΔ< =
Id
ΔΔ= ?
,
ΔΔ? @
	ProductId
ΔΔA J
=
ΔΔK L
existingProducts
ΔΔM ]
[
ΔΔ] ^
$num
ΔΔ^ _
]
ΔΔ_ `
.
ΔΔ` a
Id
ΔΔa c
,
ΔΔc d
Quantity
ΔΔe m
=
ΔΔn o
$num
ΔΔp q
,
ΔΔq r
	UnitPrice
ΔΔs |
=
ΔΔ} ~
$numΔΔ …
,ΔΔ… †
SubtotalΔΔ‡ 
=ΔΔ ‘
$numΔΔ’ 
}ΔΔ™ 
,ΔΔ ›
new
ΕΕ 
(
ΕΕ 
)
ΕΕ 
{
ΕΕ 
Id
ΕΕ 
=
ΕΕ 
Guid
ΕΕ 
.
ΕΕ 
NewGuid
ΕΕ %
(
ΕΕ% &
)
ΕΕ& '
,
ΕΕ' (
OrderId
ΕΕ) 0
=
ΕΕ1 2
orders
ΕΕ3 9
[
ΕΕ9 :
$num
ΕΕ: ;
]
ΕΕ; <
.
ΕΕ< =
Id
ΕΕ= ?
,
ΕΕ? @
	ProductId
ΕΕA J
=
ΕΕK L
existingProducts
ΕΕM ]
[
ΕΕ] ^
$num
ΕΕ^ _
]
ΕΕ_ `
.
ΕΕ` a
Id
ΕΕa c
,
ΕΕc d
Quantity
ΕΕe m
=
ΕΕn o
$num
ΕΕp q
,
ΕΕq r
	UnitPrice
ΕΕs |
=
ΕΕ} ~
$numΕΕ …
,ΕΕ… †
SubtotalΕΕ‡ 
=ΕΕ ‘
$numΕΕ’ 
}ΕΕ™ 
,ΕΕ ›
new
ΘΘ 
(
ΘΘ 
)
ΘΘ 
{
ΘΘ 
Id
ΘΘ 
=
ΘΘ 
Guid
ΘΘ 
.
ΘΘ 
NewGuid
ΘΘ %
(
ΘΘ% &
)
ΘΘ& '
,
ΘΘ' (
OrderId
ΘΘ) 0
=
ΘΘ1 2
orders
ΘΘ3 9
[
ΘΘ9 :
$num
ΘΘ: ;
]
ΘΘ; <
.
ΘΘ< =
Id
ΘΘ= ?
,
ΘΘ? @
	ProductId
ΘΘA J
=
ΘΘK L
existingProducts
ΘΘM ]
[
ΘΘ] ^
$num
ΘΘ^ _
]
ΘΘ_ `
.
ΘΘ` a
Id
ΘΘa c
,
ΘΘc d
Quantity
ΘΘe m
=
ΘΘn o
$num
ΘΘp q
,
ΘΘq r
	UnitPrice
ΘΘs |
=
ΘΘ} ~
$numΘΘ …
,ΘΘ… †
SubtotalΘΘ‡ 
=ΘΘ ‘
$numΘΘ’ 
}ΘΘ™ 
,ΘΘ ›
new
ΙΙ 
(
ΙΙ 
)
ΙΙ 
{
ΙΙ 
Id
ΙΙ 
=
ΙΙ 
Guid
ΙΙ 
.
ΙΙ 
NewGuid
ΙΙ %
(
ΙΙ% &
)
ΙΙ& '
,
ΙΙ' (
OrderId
ΙΙ) 0
=
ΙΙ1 2
orders
ΙΙ3 9
[
ΙΙ9 :
$num
ΙΙ: ;
]
ΙΙ; <
.
ΙΙ< =
Id
ΙΙ= ?
,
ΙΙ? @
	ProductId
ΙΙA J
=
ΙΙK L
existingProducts
ΙΙM ]
[
ΙΙ] ^
$num
ΙΙ^ _
]
ΙΙ_ `
.
ΙΙ` a
Id
ΙΙa c
,
ΙΙc d
Quantity
ΙΙe m
=
ΙΙn o
$num
ΙΙp q
,
ΙΙq r
	UnitPrice
ΙΙs |
=
ΙΙ} ~
$numΙΙ …
,ΙΙ… †
SubtotalΙΙ‡ 
=ΙΙ ‘
$numΙΙ’ 
}ΙΙ™ 
,ΙΙ ›
new
ΜΜ 
(
ΜΜ 
)
ΜΜ 
{
ΜΜ 
Id
ΜΜ 
=
ΜΜ 
Guid
ΜΜ 
.
ΜΜ 
NewGuid
ΜΜ %
(
ΜΜ% &
)
ΜΜ& '
,
ΜΜ' (
OrderId
ΜΜ) 0
=
ΜΜ1 2
orders
ΜΜ3 9
[
ΜΜ9 :
$num
ΜΜ: ;
]
ΜΜ; <
.
ΜΜ< =
Id
ΜΜ= ?
,
ΜΜ? @
	ProductId
ΜΜA J
=
ΜΜK L
existingProducts
ΜΜM ]
[
ΜΜ] ^
$num
ΜΜ^ _
]
ΜΜ_ `
.
ΜΜ` a
Id
ΜΜa c
,
ΜΜc d
Quantity
ΜΜe m
=
ΜΜn o
$num
ΜΜp q
,
ΜΜq r
	UnitPrice
ΜΜs |
=
ΜΜ} ~
$numΜΜ …
,ΜΜ… †
SubtotalΜΜ‡ 
=ΜΜ ‘
$numΜΜ’ 
,ΜΜ ™#
SpecialInstructionsΜΜ ­
=ΜΜ® ―
$strΜΜ° ½
}ΜΜΎ Ώ
,ΜΜΏ ΐ
new
ΝΝ 
(
ΝΝ 
)
ΝΝ 
{
ΝΝ 
Id
ΝΝ 
=
ΝΝ 
Guid
ΝΝ 
.
ΝΝ 
NewGuid
ΝΝ %
(
ΝΝ% &
)
ΝΝ& '
,
ΝΝ' (
OrderId
ΝΝ) 0
=
ΝΝ1 2
orders
ΝΝ3 9
[
ΝΝ9 :
$num
ΝΝ: ;
]
ΝΝ; <
.
ΝΝ< =
Id
ΝΝ= ?
,
ΝΝ? @
	ProductId
ΝΝA J
=
ΝΝK L
existingProducts
ΝΝM ]
[
ΝΝ] ^
$num
ΝΝ^ _
]
ΝΝ_ `
.
ΝΝ` a
Id
ΝΝa c
,
ΝΝc d
Quantity
ΝΝe m
=
ΝΝn o
$num
ΝΝp q
,
ΝΝq r
	UnitPrice
ΝΝs |
=
ΝΝ} ~
$numΝΝ …
,ΝΝ… †
SubtotalΝΝ‡ 
=ΝΝ ‘
$numΝΝ’ 
}ΝΝ™ 
,ΝΝ ›
new
ΠΠ 
(
ΠΠ 
)
ΠΠ 
{
ΠΠ 
Id
ΠΠ 
=
ΠΠ 
Guid
ΠΠ 
.
ΠΠ 
NewGuid
ΠΠ %
(
ΠΠ% &
)
ΠΠ& '
,
ΠΠ' (
OrderId
ΠΠ) 0
=
ΠΠ1 2
orders
ΠΠ3 9
[
ΠΠ9 :
$num
ΠΠ: ;
]
ΠΠ; <
.
ΠΠ< =
Id
ΠΠ= ?
,
ΠΠ? @
	ProductId
ΠΠA J
=
ΠΠK L
existingProducts
ΠΠM ]
[
ΠΠ] ^
$num
ΠΠ^ _
]
ΠΠ_ `
.
ΠΠ` a
Id
ΠΠa c
,
ΠΠc d
Quantity
ΠΠe m
=
ΠΠn o
$num
ΠΠp q
,
ΠΠq r
	UnitPrice
ΠΠs |
=
ΠΠ} ~
$numΠΠ …
,ΠΠ… †
SubtotalΠΠ‡ 
=ΠΠ ‘
$numΠΠ’ 
}ΠΠ™ 
,ΠΠ ›
new
ΡΡ 
(
ΡΡ 
)
ΡΡ 
{
ΡΡ 
Id
ΡΡ 
=
ΡΡ 
Guid
ΡΡ 
.
ΡΡ 
NewGuid
ΡΡ %
(
ΡΡ% &
)
ΡΡ& '
,
ΡΡ' (
OrderId
ΡΡ) 0
=
ΡΡ1 2
orders
ΡΡ3 9
[
ΡΡ9 :
$num
ΡΡ: ;
]
ΡΡ; <
.
ΡΡ< =
Id
ΡΡ= ?
,
ΡΡ? @
	ProductId
ΡΡA J
=
ΡΡK L
existingProducts
ΡΡM ]
[
ΡΡ] ^
$num
ΡΡ^ _
]
ΡΡ_ `
.
ΡΡ` a
Id
ΡΡa c
,
ΡΡc d
Quantity
ΡΡe m
=
ΡΡn o
$num
ΡΡp q
,
ΡΡq r
	UnitPrice
ΡΡs |
=
ΡΡ} ~
$numΡΡ …
,ΡΡ… †
SubtotalΡΡ‡ 
=ΡΡ ‘
$numΡΡ’ 
}ΡΡ™ 
,ΡΡ ›
new
 
(
 
)
 
{
 
Id
 
=
 
Guid
 
.
 
NewGuid
 %
(
% &
)
& '
,
' (
OrderId
) 0
=
1 2
orders
3 9
[
9 :
$num
: ;
]
; <
.
< =
Id
= ?
,
? @
	ProductId
A J
=
K L
existingProducts
M ]
[
] ^
$num
^ _
]
_ `
.
` a
Id
a c
,
c d
Quantity
e m
=
n o
$num
p q
,
q r
	UnitPrice
s |
=
} ~
$num „
,„ …
Subtotal† 
= 
$num‘ –
}— 
, ™
new
ΥΥ 
(
ΥΥ 
)
ΥΥ 
{
ΥΥ 
Id
ΥΥ 
=
ΥΥ 
Guid
ΥΥ 
.
ΥΥ 
NewGuid
ΥΥ %
(
ΥΥ% &
)
ΥΥ& '
,
ΥΥ' (
OrderId
ΥΥ) 0
=
ΥΥ1 2
orders
ΥΥ3 9
[
ΥΥ9 :
$num
ΥΥ: ;
]
ΥΥ; <
.
ΥΥ< =
Id
ΥΥ= ?
,
ΥΥ? @
	ProductId
ΥΥA J
=
ΥΥK L
existingProducts
ΥΥM ]
[
ΥΥ] ^
$num
ΥΥ^ _
]
ΥΥ_ `
.
ΥΥ` a
Id
ΥΥa c
,
ΥΥc d
Quantity
ΥΥe m
=
ΥΥn o
$num
ΥΥp q
,
ΥΥq r
	UnitPrice
ΥΥs |
=
ΥΥ} ~
$numΥΥ …
,ΥΥ… †
SubtotalΥΥ‡ 
=ΥΥ ‘
$numΥΥ’ 
}ΥΥ™ 
,ΥΥ ›
new
ΦΦ 
(
ΦΦ 
)
ΦΦ 
{
ΦΦ 
Id
ΦΦ 
=
ΦΦ 
Guid
ΦΦ 
.
ΦΦ 
NewGuid
ΦΦ %
(
ΦΦ% &
)
ΦΦ& '
,
ΦΦ' (
OrderId
ΦΦ) 0
=
ΦΦ1 2
orders
ΦΦ3 9
[
ΦΦ9 :
$num
ΦΦ: ;
]
ΦΦ; <
.
ΦΦ< =
Id
ΦΦ= ?
,
ΦΦ? @
	ProductId
ΦΦA J
=
ΦΦK L
existingProducts
ΦΦM ]
[
ΦΦ] ^
$num
ΦΦ^ _
]
ΦΦ_ `
.
ΦΦ` a
Id
ΦΦa c
,
ΦΦc d
Quantity
ΦΦe m
=
ΦΦn o
$num
ΦΦp q
,
ΦΦq r
	UnitPrice
ΦΦs |
=
ΦΦ} ~
$numΦΦ …
,ΦΦ… †
SubtotalΦΦ‡ 
=ΦΦ ‘
$numΦΦ’ 
}ΦΦ™ 
,ΦΦ ›
new
ΩΩ 
(
ΩΩ 
)
ΩΩ 
{
ΩΩ 
Id
ΩΩ 
=
ΩΩ 
Guid
ΩΩ 
.
ΩΩ 
NewGuid
ΩΩ %
(
ΩΩ% &
)
ΩΩ& '
,
ΩΩ' (
OrderId
ΩΩ) 0
=
ΩΩ1 2
orders
ΩΩ3 9
[
ΩΩ9 :
$num
ΩΩ: ;
]
ΩΩ; <
.
ΩΩ< =
Id
ΩΩ= ?
,
ΩΩ? @
	ProductId
ΩΩA J
=
ΩΩK L
existingProducts
ΩΩM ]
[
ΩΩ] ^
$num
ΩΩ^ _
]
ΩΩ_ `
.
ΩΩ` a
Id
ΩΩa c
,
ΩΩc d
Quantity
ΩΩe m
=
ΩΩn o
$num
ΩΩp q
,
ΩΩq r
	UnitPrice
ΩΩs |
=
ΩΩ} ~
$numΩΩ …
,ΩΩ… †
SubtotalΩΩ‡ 
=ΩΩ ‘
$numΩΩ’ 
,ΩΩ ™#
SpecialInstructionsΩΩ ­
=ΩΩ® ―
$strΩΩ° Β
}ΩΩΓ Δ
}
ΪΪ 	
;
ΪΪ	 

var
άά 
payments
άά 
=
άά 
new
άά 
List
άά 
<
άά  
Payment
άά  '
>
άά' (
{
έέ 
new
ήή 
(
ήή 
)
ήή 
{
ίί 	
Id
ΰΰ 
=
ΰΰ 
Guid
ΰΰ 
.
ΰΰ 
NewGuid
ΰΰ 
(
ΰΰ 
)
ΰΰ 
,
ΰΰ  
OrderId
αα 
=
αα 
orders
αα 
[
αα 
$num
αα 
]
αα 
.
αα  
Id
αα  "
,
αα" #
Amount
ββ 
=
ββ 
orders
ββ 
[
ββ 
$num
ββ 
]
ββ 
.
ββ 
TotalAmount
ββ *
,
ββ* +
Status
γγ 
=
γγ 
PaymentStatus
γγ "
.
γγ" #
	Completed
γγ# ,
,
γγ, -
Method
δδ 
=
δδ 
PaymentMethod
δδ "
.
δδ" #
Card
δδ# '
,
δδ' (#
StripePaymentIntentId
εε !
=
εε" #
$str
εε$ 3
,
εε3 4
	CreatedAt
ζζ 
=
ζζ 
orders
ζζ 
[
ζζ 
$num
ζζ  
]
ζζ  !
.
ζζ! "
	CreatedAt
ζζ" +
,
ζζ+ ,
PaidAt
ηη 
=
ηη 
orders
ηη 
[
ηη 
$num
ηη 
]
ηη 
.
ηη 
	CreatedAt
ηη (
.
ηη( )

AddMinutes
ηη) 3
(
ηη3 4
$num
ηη4 5
)
ηη5 6
,
ηη6 7
LoyaltyPointsUsed
θθ 
=
θθ 
null
θθ  $
}
ιι 	
,
ιι	 

new
κκ 
(
κκ 
)
κκ 
{
λλ 	
Id
μμ 
=
μμ 
Guid
μμ 
.
μμ 
NewGuid
μμ 
(
μμ 
)
μμ 
,
μμ  
OrderId
νν 
=
νν 
orders
νν 
[
νν 
$num
νν 
]
νν 
.
νν  
Id
νν  "
,
νν" #
Amount
ξξ 
=
ξξ 
orders
ξξ 
[
ξξ 
$num
ξξ 
]
ξξ 
.
ξξ 
TotalAmount
ξξ *
,
ξξ* +
Status
οο 
=
οο 
PaymentStatus
οο "
.
οο" #
	Completed
οο# ,
,
οο, -
Method
ππ 
=
ππ 
PaymentMethod
ππ "
.
ππ" #
Cash
ππ# '
,
ππ' (
	CreatedAt
ρρ 
=
ρρ 
orders
ρρ 
[
ρρ 
$num
ρρ  
]
ρρ  !
.
ρρ! "
	CreatedAt
ρρ" +
,
ρρ+ ,
PaidAt
ςς 
=
ςς 
orders
ςς 
[
ςς 
$num
ςς 
]
ςς 
.
ςς 
	CreatedAt
ςς (
.
ςς( )

AddMinutes
ςς) 3
(
ςς3 4
$num
ςς4 5
)
ςς5 6
,
ςς6 7
LoyaltyPointsUsed
σσ 
=
σσ 
null
σσ  $
}
ττ 	
,
ττ	 

new
υυ 
(
υυ 
)
υυ 
{
φφ 	
Id
χχ 
=
χχ 
Guid
χχ 
.
χχ 
NewGuid
χχ 
(
χχ 
)
χχ 
,
χχ  
OrderId
ψψ 
=
ψψ 
orders
ψψ 
[
ψψ 
$num
ψψ 
]
ψψ 
.
ψψ  
Id
ψψ  "
,
ψψ" #
Amount
ωω 
=
ωω 
orders
ωω 
[
ωω 
$num
ωω 
]
ωω 
.
ωω 
TotalAmount
ωω *
,
ωω* +
Status
ϊϊ 
=
ϊϊ 
PaymentStatus
ϊϊ "
.
ϊϊ" #
	Completed
ϊϊ# ,
,
ϊϊ, -
Method
ϋϋ 
=
ϋϋ 
PaymentMethod
ϋϋ "
.
ϋϋ" #
Card
ϋϋ# '
,
ϋϋ' (#
StripePaymentIntentId
όό !
=
όό" #
$str
όό$ 3
,
όό3 4
	CreatedAt
ύύ 
=
ύύ 
orders
ύύ 
[
ύύ 
$num
ύύ  
]
ύύ  !
.
ύύ! "
	CreatedAt
ύύ" +
,
ύύ+ ,
PaidAt
ώώ 
=
ώώ 
orders
ώώ 
[
ώώ 
$num
ώώ 
]
ώώ 
.
ώώ 
	CreatedAt
ώώ (
.
ώώ( )

AddMinutes
ώώ) 3
(
ώώ3 4
$num
ώώ4 5
)
ώώ5 6
,
ώώ6 7
LoyaltyPointsUsed
 
=
 
null
  $
}
€€ 	
,
€€	 

new
 
(
 
)
 
{
‚‚ 	
Id
ƒƒ 
=
ƒƒ 
Guid
ƒƒ 
.
ƒƒ 
NewGuid
ƒƒ 
(
ƒƒ 
)
ƒƒ 
,
ƒƒ  
OrderId
„„ 
=
„„ 
orders
„„ 
[
„„ 
$num
„„ 
]
„„ 
.
„„  
Id
„„  "
,
„„" #
Amount
…… 
=
…… 
orders
…… 
[
…… 
$num
…… 
]
…… 
.
…… 
TotalAmount
…… *
,
……* +
Status
†† 
=
†† 
PaymentStatus
†† "
.
††" #
	Completed
††# ,
,
††, -
Method
‡‡ 
=
‡‡ 
PaymentMethod
‡‡ "
.
‡‡" #
Card
‡‡# '
,
‡‡' (#
StripePaymentIntentId
 !
=
" #
$str
$ 3
,
3 4
	CreatedAt
‰‰ 
=
‰‰ 
orders
‰‰ 
[
‰‰ 
$num
‰‰  
]
‰‰  !
.
‰‰! "
	CreatedAt
‰‰" +
,
‰‰+ ,
PaidAt
 
=
 
orders
 
[
 
$num
 
]
 
.
 
	CreatedAt
 (
.
( )

AddMinutes
) 3
(
3 4
$num
4 5
)
5 6
,
6 7
LoyaltyPointsUsed
‹‹ 
=
‹‹ 
null
‹‹  $
}
 	
,
	 

new
 
(
 
)
 
{
 	
Id
 
=
 
Guid
 
.
 
NewGuid
 
(
 
)
 
,
  
OrderId
 
=
 
orders
 
[
 
$num
 
]
 
.
  
Id
  "
,
" #
Amount
‘‘ 
=
‘‘ 
orders
‘‘ 
[
‘‘ 
$num
‘‘ 
]
‘‘ 
.
‘‘ 
TotalAmount
‘‘ *
,
‘‘* +
Status
’’ 
=
’’ 
PaymentStatus
’’ "
.
’’" #
	Completed
’’# ,
,
’’, -
Method
““ 
=
““ 
PaymentMethod
““ "
.
““" #
Cash
““# '
,
““' (
	CreatedAt
”” 
=
”” 
orders
”” 
[
”” 
$num
””  
]
””  !
.
””! "
	CreatedAt
””" +
,
””+ ,
PaidAt
•• 
=
•• 
orders
•• 
[
•• 
$num
•• 
]
•• 
.
•• 
	CreatedAt
•• (
.
••( )

AddMinutes
••) 3
(
••3 4
$num
••4 5
)
••5 6
,
••6 7
LoyaltyPointsUsed
–– 
=
–– 
null
––  $
}
—— 	
,
——	 

new
 
(
 
)
 
{
™™ 	
Id
 
=
 
Guid
 
.
 
NewGuid
 
(
 
)
 
,
  
OrderId
›› 
=
›› 
orders
›› 
[
›› 
$num
›› 
]
›› 
.
››  
Id
››  "
,
››" #
Amount
 
=
 
orders
 
[
 
$num
 
]
 
.
 
TotalAmount
 *
,
* +
Status
 
=
 
PaymentStatus
 "
.
" #
	Completed
# ,
,
, -
Method
 
=
 
PaymentMethod
 "
.
" #
Card
# '
,
' (#
StripePaymentIntentId
 !
=
" #
$str
$ 3
,
3 4
	CreatedAt
   
=
   
orders
   
[
   
$num
    
]
    !
.
  ! "
	CreatedAt
  " +
,
  + ,
PaidAt
΅΅ 
=
΅΅ 
orders
΅΅ 
[
΅΅ 
$num
΅΅ 
]
΅΅ 
.
΅΅ 
	CreatedAt
΅΅ (
.
΅΅( )

AddMinutes
΅΅) 3
(
΅΅3 4
$num
΅΅4 5
)
΅΅5 6
,
΅΅6 7
LoyaltyPointsUsed
ΆΆ 
=
ΆΆ 
null
ΆΆ  $
}
££ 	
}
¤¤ 
;
¤¤ 
await
¦¦ 
context
¦¦ 
.
¦¦ 

OrderItems
¦¦  
.
¦¦  !
AddRangeAsync
¦¦! .
(
¦¦. /

orderItems
¦¦/ 9
)
¦¦9 :
;
¦¦: ;
await
§§ 
context
§§ 
.
§§ 
SaveChangesAsync
§§ &
(
§§& '
)
§§' (
;
§§( )
}
¨¨ 
}©© γ‡
FC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
new+ .!
WebApplicationOptions/ D
{ 
Args 
=	 

args 
, 
ContentRootPath 
= 

AppContext  
.  !
BaseDirectory! .
,. /
WebRootPath 
= 
$str 
} 
) 
; 
if 
( 
! 
builder 
. 
Environment 
. 
IsDevelopment &
(& '
)' (
)( )
{   
builder!! 
.!! 
Configuration!! 
.!! 
Sources!! !
."" 	
OfType""	 
<"" 
	Microsoft"" 
."" 

Extensions"" $
.""$ %
Configuration""% 2
.""2 3
Json""3 7
.""7 8#
JsonConfigurationSource""8 O
>""O P
(""P Q
)""Q R
.## 	
ToList##	 
(## 
)## 
.$$ 	
ForEach$$	 
($$ 
s$$ 
=>$$ 
s$$ 
.$$ 
ReloadOnChange$$ &
=$$' (
false$$) .
)$$. /
;$$/ 0
}%% 
var(( 
port(( 
=((	 

Environment(( 
.(( "
GetEnvironmentVariable(( -
(((- .
$str((. 4
)((4 5
??((6 8
$str((9 ?
;((? @
builder)) 
.)) 
WebHost)) 
.)) 
UseUrls)) 
()) 
$")) 
$str)) )
{))) *
port))* .
})). /
"))/ 0
)))0 1
;))1 2
var,, 
connectionString,, 
=,, 
Environment,, "
.,," #"
GetEnvironmentVariable,,# 9
(,,9 :
$str,,: H
),,H I
;,,I J
if.. 
(.. 
string.. 

...
 
IsNullOrEmpty.. 
(.. 
connectionString.. )
)..) *
)..* +
{// 
connectionString11 
=11 
builder11 
.11 
Configuration11 ,
.11, -
GetConnectionString11- @
(11@ A
$str11A T
)11T U
;11U V
Console22 
.22 
	WriteLine22 
(22 
$str22 :
)22: ;
;22; <
}33 
else44 
{55 
Console77 
.77 
	WriteLine77 
(77 
$str77 ;
)77; <
;77< =
var:: 
lastPart:: 
=:: 
connectionString:: #
.::# $
Length::$ *
>::+ ,
$num::- /
?::0 1
connectionString::2 B
.::B C
	Substring::C L
(::L M
connectionString::M ]
.::] ^
Length::^ d
-::e f
$num::g i
)::i j
:::k l
connectionString::m }
;::} ~
Console;; 
.;; 
	WriteLine;; 
(;; 
$";; 
$str;; ;
{;;; <
lastPart;;< D
};;D E
";;E F
);;F G
;;;G H
}<< 
var?? 
dataSourceBuilder?? 
=?? 
new?? #
NpgsqlDataSourceBuilder?? 3
(??3 4
connectionString??4 D
)??D E
;??E F
dataSourceBuilder@@ 
.@@ 
EnableDynamicJson@@ #
(@@# $
)@@$ %
;@@% &
varAA 

dataSourceAA 
=AA 
dataSourceBuilderAA "
.AA" #
BuildAA# (
(AA( )
)AA) *
;AA* +
builderBB 
.BB 
ServicesBB 
.BB 
AddDbContextBB 
<BB 
AppDbContextBB *
>BB* +
(BB+ ,
optionsBB, 3
=>BB4 6
optionsBB7 >
.BB> ?
	UseNpgsqlBB? H
(BBH I

dataSourceBBI S
)BBS T
)BBT U
;BBU V
varEE 
stripeSecretKeyEE 
=EE 
EnvironmentEE !
.EE! ""
GetEnvironmentVariableEE" 8
(EE8 9
$strEE9 L
)EEL M
??FF 
builderFF  
.FF  !
ConfigurationFF! .
[FF. /
$strFF/ A
]FFA B
??GG 
$strGG 
;GG 
varII 
stripePublicKeyII 
=II 
EnvironmentII !
.II! ""
GetEnvironmentVariableII" 8
(II8 9
$strII9 L
)IIL M
??JJ 
builderJJ  
.JJ  !
ConfigurationJJ! .
[JJ. /
$strJJ/ A
]JJA B
??KK 
$strKK 
;KK 
varMM 
stripeWebhookSecretMM 
=MM 
EnvironmentMM %
.MM% &"
GetEnvironmentVariableMM& <
(MM< =
$strMM= T
)MMT U
??NN 
builderNN $
.NN$ %
ConfigurationNN% 2
[NN2 3
$strNN3 I
]NNI J
??OO 
$strOO 
;OO  
builderQQ 
.QQ 
ServicesQQ 
.QQ 
	ConfigureQQ 
<QQ 
StripeSettingsQQ )
>QQ) *
(QQ* +
optionsQQ+ 2
=>QQ3 5
{RR 
optionsSS 
.SS 
	PublicKeySS 
=SS 
stripePublicKeySS '
;SS' (
optionsTT 
.TT 
	SecretKeyTT 
=TT 
stripeSecretKeyTT '
;TT' (
optionsUU 
.UU 
WebhookSecretUU 
=UU 
stripeWebhookSecretUU /
;UU/ 0
}VV 
)VV 
;VV 
builderXX 
.XX 
ServicesXX 
.XX 
AddSingletonXX 
<XX 
StripeXX $
.XX$ %
StripeClientXX% 1
>XX1 2
(XX2 3
providerXX3 ;
=>XX< >
{YY 
returnZZ 

newZZ 
StripeZZ 
.ZZ 
StripeClientZZ "
(ZZ" #
stripeSecretKeyZZ# 2
)ZZ2 3
;ZZ3 4
}[[ 
)[[ 
;[[ 
builder^^ 
.^^ 
Services^^ 
.^^ 

AddMediatR^^ 
(^^ 
cfg^^ 
=>^^  "
{__ 
cfg`` 
.`` (
RegisterServicesFromAssembly`` $
(``$ %
typeof``% +
(``+ ,
Program``, 3
)``3 4
.``4 5
Assembly``5 =
)``= >
;``> ?
cfgaa 
.aa 
AddOpenBehavioraa 
(aa 
typeofaa 
(aa 
ValidationBehavioraa 1
<aa1 2
,aa2 3
>aa3 4
)aa4 5
)aa5 6
;aa6 7
}bb 
)bb 
;bb 
buildercc 
.cc 
Servicescc 
.cc %
AddValidatorsFromAssemblycc *
(cc* +
typeofcc+ 1
(cc1 2
Programcc2 9
)cc9 :
.cc: ;
Assemblycc; C
)ccC D
;ccD E
builderff 
.ff 
Servicesff 
.ff 
	AddScopedff 
<ff 
IJwtServiceff &
,ff& '

JwtServiceff( 2
>ff2 3
(ff3 4
)ff4 5
;ff5 6
varii 
jwtSecretKeyii 
=ii 
Environmentii 
.ii "
GetEnvironmentVariableii 5
(ii5 6
$strii6 F
)iiF G
??jj 
builderjj 
.jj 
Configurationjj 
[jj 
$strjj ,
]jj, -
!jj- .
;jj. /
varll 
	jwtIssuerll 
=ll 
Environmentll 
.ll "
GetEnvironmentVariablell 2
(ll2 3
$strll3 ?
)ll? @
??mm 
buildermm 
.mm 
Configurationmm 
[mm 
$strmm )
]mm) *
!mm* +
;mm+ ,
varoo 
jwtAudienceoo 
=oo 
Environmentoo 
.oo "
GetEnvironmentVariableoo 4
(oo4 5
$stroo5 C
)ooC D
??pp 
builderpp 
.pp 
Configurationpp 
[pp 
$strpp +
]pp+ ,
!pp, -
;pp- .
builderrr 
.rr 
Servicesrr 
.rr 
AddAuthenticationrr "
(rr" #
JwtBearerDefaultsrr# 4
.rr4 5 
AuthenticationSchemerr5 I
)rrI J
.ss 
AddJwtBearerss 
(ss 
optionsss 
=>ss 
{tt 
optionsuu 
.uu %
TokenValidationParametersuu )
=uu* +
newuu, /%
TokenValidationParametersuu0 I
{vv 	$
ValidateIssuerSigningKeyww $
=ww% &
trueww' +
,ww+ ,
IssuerSigningKeyxx 
=xx 
newxx " 
SymmetricSecurityKeyxx# 7
(xx7 8
Encodingyy 
.yy 
UTF8yy 
.yy 
GetBytesyy &
(yy& '
jwtSecretKeyyy' 3
)yy3 4
)yy4 5
,yy5 6
ValidateIssuerzz 
=zz 
truezz !
,zz! "
ValidIssuer{{ 
={{ 
	jwtIssuer{{ #
,{{# $
ValidateAudience|| 
=|| 
true|| #
,||# $
ValidAudience}} 
=}} 
jwtAudience}} '
,}}' (
ValidateLifetime~~ 
=~~ 
true~~ #
,~~# $
	ClockSkew 
= 
TimeSpan  
.  !
Zero! %
,% &
RoleClaimType
€€ 
=
€€ 

ClaimTypes
€€ &
.
€€& '
Role
€€' +
,
€€+ ,
NameClaimType
 
=
 

ClaimTypes
 &
.
& '
NameIdentifier
' 5
}
‚‚ 	
;
‚‚	 

}
ƒƒ 
)
ƒƒ 
;
ƒƒ 
builder†† 
.
†† 
Services
†† 
.
†† 
AddAuthorization
†† !
(
††! "
)
††" #
;
††# $
builder‰‰ 
.
‰‰ 
Services
‰‰ 
.
‰‰ %
AddEndpointsApiExplorer
‰‰ (
(
‰‰( )
)
‰‰) *
;
‰‰* +
builder 
.
 
Services
 
.
 
AddSwaggerGen
 
(
 
options
 &
=>
' )
{‹‹ 
options
 
.
 
CustomSchemaIds
 
(
 
type
  
=>
! #
type
$ (
.
( )
FullName
) 1
?
1 2
.
2 3
Replace
3 :
(
: ;
$str
; >
,
> ?
$str
@ C
)
C D
)
D E
;
E F
options
 
.
 #
AddSecurityDefinition
 !
(
! "
$str
" *
,
* +
new
, /
	Microsoft
0 9
.
9 :
OpenApi
: A
.
A B
Models
B H
.
H I#
OpenApiSecurityScheme
I ^
{
 
Name
 
=
 
$str
 
,
 
Type
  $
=
% &
	Microsoft
' 0
.
0 1
OpenApi
1 8
.
8 9
Models
9 ?
.
? @ 
SecuritySchemeType
@ R
.
R S
Http
S W
,
W X
Scheme
 
=
 
$str
 
,
 
BearerFormat
 '
=
( )
$str
* /
,
/ 0
In
1 3
=
4 5
	Microsoft
6 ?
.
? @
OpenApi
@ G
.
G H
Models
H N
.
N O
ParameterLocation
O `
.
` a
Header
a g
,
g h
Description
‘‘ 
=
‘‘ 
$str
‘‘ u
}
’’ 
)
’’ 
;
’’ 
options
““ 
.
““ $
AddSecurityRequirement
““ "
(
““" #
new
““# &
	Microsoft
““' 0
.
““0 1
OpenApi
““1 8
.
““8 9
Models
““9 ?
.
““? @(
OpenApiSecurityRequirement
““@ Z
{
”” 
{
•• 	
new
••
 
	Microsoft
•• 
.
•• 
OpenApi
•• 
.
••  
Models
••  &
.
••& '#
OpenApiSecurityScheme
••' <
{
••= >
	Reference
••? H
=
••I J
new
••K N
	Microsoft
••O X
.
••X Y
OpenApi
••Y `
.
••` a
Models
••a g
.
••g h
OpenApiReference
••h x
{
••y z
Type
••{ 
=••€ 
	Microsoft••‚ ‹
.••‹ 
OpenApi•• “
.••“ ”
Models••” 
.•• ›
ReferenceType••› ¨
.••¨ ©
SecurityScheme••© ·
,••· Έ
Id••Ή »
=••Ό ½
$str••Ύ Ζ
}••Η Θ
}••Ι Κ
,••Κ Λ
Array••Μ Ρ
.••Ρ 
Empty•• Χ
<••Χ Ψ
string••Ψ ή
>••ή ί
(••ί ΰ
)••ΰ α
}••β γ
}
–– 
)
–– 
;
–– 
}—— 
)
—— 
;
—— 
builder 
.
 
Services
 
.
 
AddCors
 
(
 
options
  
=>
! #
{›› 
options
 
.
 
	AddPolicy
 
(
 
$str
 %
,
% &
policy
' -
=>
. 0
{
 
policy
 
.
  
SetIsOriginAllowed
 !
(
! "
origin
" (
=>
) +
{
 	
if
   
(
   
string
   
.
    
IsNullOrWhiteSpace
   )
(
  ) *
origin
  * 0
)
  0 1
)
  1 2
return
  3 9
false
  : ?
;
  ? @
try
΅΅ 
{
ΆΆ 
var
££ 
uri
££ 
=
££ 
new
££ 
Uri
££ !
(
££! "
origin
££" (
)
££( )
;
££) *
return
¤¤ 
uri
¤¤ 
.
¤¤ 
Host
¤¤ 
==
¤¤  "
$str
¤¤# .
||
¥¥ 
uri
¥¥ 
.
¥¥ 
Host
¥¥ 
==
¥¥  "
$str
¥¥# .
||
¦¦ 
uri
¦¦ 
.
¦¦ 
Host
¦¦ 
.
¦¦  
EndsWith
¦¦  (
(
¦¦( )
$str
¦¦) 8
)
¦¦8 9
||
§§ 
uri
§§ 
.
§§ 
Host
§§ 
.
§§  
EndsWith
§§  (
(
§§( )
$str
§§) 6
)
§§6 7
;
§§7 8
}
¨¨ 
catch
©© 
{
©© 
return
©© 
false
©©  
;
©©  !
}
©©" #
}
 	
)
	 

.
«« 	
AllowAnyHeader
««	 
(
«« 
)
«« 
.
¬¬ 	
AllowAnyMethod
¬¬	 
(
¬¬ 
)
¬¬ 
.
­­ 	
AllowCredentials
­­	 
(
­­ 
)
­­ 
;
­­ 
}
®® 
)
®® 
;
®® 
}―― 
)
―― 
;
―― 
var±± 
app
±± 
=
±± 	
builder
±±
 
.
±± 
Build
±± 
(
±± 
)
±± 
;
±± 
app²² 
.
²² 
UseCors
²² 
(
²² 
$str
²² 
)
²² 
;
²² 
appµµ 
.
µµ 

UseSwagger
µµ 
(
µµ 
)
µµ 
;
µµ 
app¶¶ 
.
¶¶ 
UseSwaggerUI
¶¶ 
(
¶¶ 
)
¶¶ 
;
¶¶ 
appΈΈ 
.
ΈΈ 
UseAuthentication
ΈΈ 
(
ΈΈ 
)
ΈΈ 
;
ΈΈ 
if»» 
(
»» 
app
»» 
.
»» 
Environment
»» 
.
»» 
IsDevelopment
»» !
(
»»! "
)
»»" #
)
»»# $
{ΌΌ 
app
½½ 
.
½½ 
Use
½½ 
(
½½ 
async
½½ 
(
½½ 
ctx
½½ 
,
½½ 
next
½½ 
)
½½ 
=>
½½  
{
ΎΎ 
if
ΏΏ 

(
ΏΏ 
ctx
ΏΏ 
.
ΏΏ 
Request
ΏΏ 
.
ΏΏ 
Path
ΏΏ 
.
ΏΏ  
StartsWithSegments
ΏΏ /
(
ΏΏ/ 0
$str
ΏΏ0 6
)
ΏΏ6 7
&&
ΐΐ 
!
ΐΐ 
(
ΐΐ 
ctx
ΐΐ 
.
ΐΐ 
User
ΐΐ 
?
ΐΐ 
.
ΐΐ 
Identity
ΐΐ #
?
ΐΐ# $
.
ΐΐ$ %
IsAuthenticated
ΐΐ% 4
??
ΐΐ5 7
false
ΐΐ8 =
)
ΐΐ= >
)
ΐΐ> ?
{
ΑΑ 	
using
ΒΒ 
var
ΒΒ 
scope
ΒΒ 
=
ΒΒ 
app
ΒΒ !
.
ΒΒ! "
Services
ΒΒ" *
.
ΒΒ* +
CreateScope
ΒΒ+ 6
(
ΒΒ6 7
)
ΒΒ7 8
;
ΒΒ8 9
var
ΓΓ 
db
ΓΓ 
=
ΓΓ 
scope
ΓΓ 
.
ΓΓ 
ServiceProvider
ΓΓ *
.
ΓΓ* + 
GetRequiredService
ΓΓ+ =
<
ΓΓ= >
AppDbContext
ΓΓ> J
>
ΓΓJ K
(
ΓΓK L
)
ΓΓL M
;
ΓΓM N
var
ΔΔ 
devUser
ΔΔ 
=
ΔΔ 
await
ΔΔ 
db
ΔΔ  "
.
ΔΔ" #
Users
ΔΔ# (
.
ΔΔ( )
OrderByDescending
ΔΔ) :
(
ΔΔ: ;
u
ΔΔ; <
=>
ΔΔ= ?
u
ΔΔ@ A
.
ΔΔA B
	CreatedAt
ΔΔB K
)
ΔΔK L
.
ΔΔL M!
FirstOrDefaultAsync
ΔΔM `
(
ΔΔ` a
u
ΔΔa b
=>
ΔΔc e
u
ΔΔf g
.
ΔΔg h
Role
ΔΔh l
==
ΔΔm o
$str
ΔΔp w
||
ΔΔx z
u
ΔΔ{ |
.
ΔΔ| }
RoleΔΔ} 
==ΔΔ‚ „
$strΔΔ… 
)ΔΔ 
??
ΕΕ 
await
ΕΕ 
db
ΕΕ 
.
ΕΕ 
Users
ΕΕ !
.
ΕΕ! "
OrderByDescending
ΕΕ" 3
(
ΕΕ3 4
u
ΕΕ4 5
=>
ΕΕ6 8
u
ΕΕ9 :
.
ΕΕ: ;
	CreatedAt
ΕΕ; D
)
ΕΕD E
.
ΕΕE F!
FirstOrDefaultAsync
ΕΕF Y
(
ΕΕY Z
)
ΕΕZ [
;
ΕΕ[ \
if
ΖΖ 
(
ΖΖ 
devUser
ΖΖ 
!=
ΖΖ 
null
ΖΖ 
)
ΖΖ  
{
ΗΗ 
var
ΘΘ 
claims
ΘΘ 
=
ΘΘ 
new
ΘΘ  
List
ΘΘ! %
<
ΘΘ% &
Claim
ΘΘ& +
>
ΘΘ+ ,
{
ΙΙ 
new
ΚΚ 
(
ΚΚ 

ClaimTypes
ΚΚ "
.
ΚΚ" #
NameIdentifier
ΚΚ# 1
,
ΚΚ1 2
devUser
ΚΚ3 :
.
ΚΚ: ;
Id
ΚΚ; =
.
ΚΚ= >
ToString
ΚΚ> F
(
ΚΚF G
)
ΚΚG H
)
ΚΚH I
,
ΚΚI J
new
ΛΛ 
(
ΛΛ 
$str
ΛΛ 
,
ΛΛ 
devUser
ΛΛ &
.
ΛΛ& '
Id
ΛΛ' )
.
ΛΛ) *
ToString
ΛΛ* 2
(
ΛΛ2 3
)
ΛΛ3 4
)
ΛΛ4 5
,
ΛΛ5 6
new
ΜΜ 
(
ΜΜ 

ClaimTypes
ΜΜ "
.
ΜΜ" #
Email
ΜΜ# (
,
ΜΜ( )
devUser
ΜΜ* 1
.
ΜΜ1 2
Email
ΜΜ2 7
)
ΜΜ7 8
,
ΜΜ8 9
new
ΝΝ 
(
ΝΝ 

ClaimTypes
ΝΝ "
.
ΝΝ" #
Name
ΝΝ# '
,
ΝΝ' (
string
ΝΝ) /
.
ΝΝ/ 0 
IsNullOrWhiteSpace
ΝΝ0 B
(
ΝΝB C
devUser
ΝΝC J
.
ΝΝJ K
FullName
ΝΝK S
)
ΝΝS T
?
ΝΝU V
devUser
ΝΝW ^
.
ΝΝ^ _
Email
ΝΝ_ d
:
ΝΝe f
devUser
ΝΝg n
.
ΝΝn o
FullName
ΝΝo w
)
ΝΝw x
,
ΝΝx y
new
ΞΞ 
(
ΞΞ 

ClaimTypes
ΞΞ "
.
ΞΞ" #
Role
ΞΞ# '
,
ΞΞ' (
string
ΞΞ) /
.
ΞΞ/ 0 
IsNullOrWhiteSpace
ΞΞ0 B
(
ΞΞB C
devUser
ΞΞC J
.
ΞΞJ K
Role
ΞΞK O
)
ΞΞO P
?
ΞΞQ R
$str
ΞΞS Z
:
ΞΞ[ \
devUser
ΞΞ] d
.
ΞΞd e
Role
ΞΞe i
)
ΞΞi j
,
ΞΞj k
new
ΟΟ 
(
ΟΟ 
$str
ΟΟ 
,
ΟΟ 
string
ΟΟ  &
.
ΟΟ& ' 
IsNullOrWhiteSpace
ΟΟ' 9
(
ΟΟ9 :
devUser
ΟΟ: A
.
ΟΟA B
Role
ΟΟB F
)
ΟΟF G
?
ΟΟH I
$str
ΟΟJ Q
:
ΟΟR S
devUser
ΟΟT [
.
ΟΟ[ \
Role
ΟΟ\ `
)
ΟΟ` a
}
ΠΠ 
;
ΠΠ 
ctx
ΡΡ 
.
ΡΡ 
User
ΡΡ 
=
ΡΡ 
new
ΡΡ 
ClaimsPrincipal
ΡΡ .
(
ΡΡ. /
new
ΡΡ/ 2
ClaimsIdentity
ΡΡ3 A
(
ΡΡA B
claims
ΡΡB H
,
ΡΡH I 
authenticationType
ΡΡJ \
:
ΡΡ\ ]
$str
ΡΡ^ i
)
ΡΡi j
)
ΡΡj k
;
ΡΡk l
}
 
}
ΣΣ 	
await
ΤΤ 
next
ΤΤ 
(
ΤΤ 
)
ΤΤ 
;
ΤΤ 
}
ΥΥ 
)
ΥΥ 
;
ΥΥ 
}ΦΦ 
appΧΧ 
.
ΧΧ 
UseAuthorization
ΧΧ 
(
ΧΧ 
)
ΧΧ 
;
ΧΧ 
usingΪΪ 
(
ΪΪ 
var
ΪΪ 

scope
ΪΪ 
=
ΪΪ 
app
ΪΪ 
.
ΪΪ 
Services
ΪΪ 
.
ΪΪ  
CreateScope
ΪΪ  +
(
ΪΪ+ ,
)
ΪΪ, -
)
ΪΪ- .
{ΫΫ 
var
άά 
context
άά 
=
άά 
scope
άά 
.
άά 
ServiceProvider
άά '
.
άά' ( 
GetRequiredService
άά( :
<
άά: ;
AppDbContext
άά; G
>
άάG H
(
άάH I
)
άάI J
;
άάJ K
try
έέ 
{
ήή 
Console
ίί 
.
ίί 
	WriteLine
ίί 
(
ίί 
$str
ίί 5
)
ίί5 6
;
ίί6 7
await
ΰΰ 
context
ΰΰ 
.
ΰΰ 
Database
ΰΰ 
.
ΰΰ 
MigrateAsync
ΰΰ +
(
ΰΰ+ ,
)
ΰΰ, -
;
ΰΰ- .
Console
αα 
.
αα 
	WriteLine
αα 
(
αα 
$str
αα =
)
αα= >
;
αα> ?
Console
γγ 
.
γγ 
	WriteLine
γγ 
(
γγ 
$str
γγ 2
)
γγ2 3
;
γγ3 4
await
δδ 
DatabaseSeeder
δδ 
.
δδ 
	SeedAsync
δδ &
(
δδ& '
context
δδ' .
)
δδ. /
;
δδ/ 0
Console
εε 
.
εε 
	WriteLine
εε 
(
εε 
$str
εε :
)
εε: ;
;
εε; <
}
ζζ 
catch
ηη 	
(
ηη
 
	Exception
ηη 
ex
ηη 
)
ηη 
{
θθ 
var
ιι 
logger
ιι 
=
ιι 
scope
ιι 
.
ιι 
ServiceProvider
ιι *
.
ιι* + 
GetRequiredService
ιι+ =
<
ιι= >
ILogger
ιι> E
<
ιιE F
Program
ιιF M
>
ιιM N
>
ιιN O
(
ιιO P
)
ιιP Q
;
ιιQ R
logger
κκ 
.
κκ 
LogError
κκ 
(
κκ 
ex
κκ 
,
κκ 
$str
κκ A
)
κκA B
;
κκB C
throw
λλ 
;
λλ 
}
μμ 
}νν 
varππ 
	authGroup
ππ 
=
ππ 
app
ππ 
.
ππ 
MapGroup
ππ 
(
ππ 
$str
ππ '
)
ππ' (
.
ππ( )
WithTags
ππ) 1
(
ππ1 2
$str
ππ2 B
)
ππB C
;
ππC D
	authGroupςς 	
.
ςς	 

MapPost
ςς
 
(
ςς 
$str
ςς 
,
ςς 
async
ςς $
(
ςς% &
Register
ςς& .
.
ςς. /
Command
ςς/ 6
command
ςς7 >
,
ςς> ?
ISender
ςς@ G
sender
ςςH N
)
ςςN O
=>
ςςP R
{σσ 
var
ττ 
result
ττ 
=
ττ 
await
ττ 
sender
ττ 
.
ττ 
Send
ττ "
(
ττ" #
command
ττ# *
)
ττ* +
;
ττ+ ,
return
υυ 

result
υυ 
.
υυ 
	IsSuccess
υυ 
?
φφ 	
Results
φφ
 
.
φφ 
Created
φφ 
(
φφ 
$"
φφ 
$str
φφ '
{
φφ' (
result
φφ( .
.
φφ. /
Value
φφ/ 4
!
φφ4 5
.
φφ5 6
Id
φφ6 8
}
φφ8 9
"
φφ9 :
,
φφ: ;
result
φφ< B
.
φφB C
Value
φφC H
)
φφH I
:
χχ 	
Results
χχ
 
.
χχ 

BadRequest
χχ 
(
χχ 
new
χχ  
{
χχ! "
errors
χχ# )
=
χχ* +
result
χχ, 2
.
χχ2 3
Errors
χχ3 9
}
χχ: ;
)
χχ; <
;
χχ< =
}ψψ 
)
ψψ 
.ωω 
WithName
ωω 	
(
ωω	 

$str
ωω
 
)
ωω 
.ϊϊ 
AllowAnonymous
ϊϊ 
(
ϊϊ 
)
ϊϊ 
.ϋϋ 
Produces
ϋϋ 	
<
ϋϋ	 

UserDto
ϋϋ
 
>
ϋϋ 
(
ϋϋ 
StatusCodes
ϋϋ 
.
ϋϋ 
Status201Created
ϋϋ /
)
ϋϋ/ 0
.όό 
Produces
όό 	
<
όό	 

object
όό
 
>
όό 
(
όό 
StatusCodes
όό 
.
όό !
Status400BadRequest
όό 1
)
όό1 2
;
όό2 3
	authGroupώώ 	
.
ώώ	 

MapPost
ώώ
 
(
ώώ 
$str
ώώ 
,
ώώ 
async
ώώ !
(
ώώ" #
Login
ώώ# (
.
ώώ( )
Query
ώώ) .
query
ώώ/ 4
,
ώώ4 5
ISender
ώώ6 =
sender
ώώ> D
)
ώώD E
=>
ώώF H
{ 
var
€€ 
result
€€ 
=
€€ 
await
€€ 
sender
€€ 
.
€€ 
Send
€€ "
(
€€" #
query
€€# (
)
€€( )
;
€€) *
return
 

result
 
.
 
	IsSuccess
 
?
 
Results
 %
.
% &
Ok
& (
(
( )
result
) /
.
/ 0
Value
0 5
)
5 6
:
7 8
Results
9 @
.
@ A

BadRequest
A K
(
K L
new
L O
{
P Q
errors
R X
=
Y Z
result
[ a
.
a b
Errors
b h
}
i j
)
j k
;
k l
}‚‚ 
)
‚‚ 
.ƒƒ 
WithName
ƒƒ 	
(
ƒƒ	 

$str
ƒƒ
 
)
ƒƒ 
.„„ 
AllowAnonymous
„„ 
(
„„ 
)
„„ 
.…… 
Produces
…… 	
<
……	 

AuthResponseDto
……
 
>
…… 
(
…… 
StatusCodes
…… &
.
……& '
Status200OK
……' 2
)
……2 3
.†† 
Produces
†† 	
<
††	 

object
††
 
>
†† 
(
†† 
StatusCodes
†† 
.
†† !
Status400BadRequest
†† 1
)
††1 2
;
††2 3
	authGroup 	
.
	 

MapGet

 
(
 
$str
 
,
 
async
 
(
 
ClaimsPrincipal
 .
user
/ 3
,
3 4
ISender
5 <
sender
= C
)
C D
=>
E G
{‰‰ 
var
 
userIdClaim
 
=
 
user
 
.
 
	FindFirst
 $
(
$ %

ClaimTypes
% /
.
/ 0
NameIdentifier
0 >
)
> ?
?
? @
.
@ A
Value
A F
??
‹‹ 
user
‹‹ 
.
‹‹ 
	FindFirst
‹‹ $
(
‹‹$ %
$str
‹‹% *
)
‹‹* +
?
‹‹+ ,
.
‹‹, -
Value
‹‹- 2
;
‹‹2 3
if
 
(
 
string
 
.
 
IsNullOrEmpty
 
(
 
userIdClaim
 (
)
( )
||
* ,
!
- .
Guid
. 2
.
2 3
TryParse
3 ;
(
; <
userIdClaim
< G
,
G H
out
I L
var
M P
userId
Q W
)
W X
)
X Y
{
 
return
 
Results
 
.
 
Unauthorized
 #
(
# $
)
$ %
;
% &
}
 
var
’’ 
result
’’ 
=
’’ 
await
’’ 
sender
’’ 
.
’’ 
Send
’’ "
(
’’" #
new
’’# &
GetCurrentUser
’’' 5
.
’’5 6
Query
’’6 ;
{
’’< =
UserId
’’> D
=
’’E F
userId
’’G M
}
’’N O
)
’’O P
;
’’P Q
return
““ 

result
““ 
.
““ 
	IsSuccess
““ 
?
““ 
Results
““ %
.
““% &
Ok
““& (
(
““( )
result
““) /
.
““/ 0
Value
““0 5
)
““5 6
:
““7 8
Results
““9 @
.
““@ A
NotFound
““A I
(
““I J
new
““J M
{
““N O
errors
““P V
=
““W X
result
““Y _
.
““_ `
Errors
““` f
}
““g h
)
““h i
;
““i j
}”” 
)
”” 
.•• 
WithName
•• 	
(
••	 

$str
••
 
)
•• 
.–– "
RequireAuthorization
–– 
(
–– 
)
–– 
.—— 
Produces
—— 	
<
——	 

UserDto
——
 
>
—— 
(
—— 
StatusCodes
—— 
.
—— 
Status200OK
—— *
)
——* +
. 
Produces
 	
(
	 

StatusCodes

 
.
 #
Status401Unauthorized
 +
)
+ ,
.™™ 
Produces
™™ 	
<
™™	 

object
™™
 
>
™™ 
(
™™ 
StatusCodes
™™ 
.
™™ 
Status404NotFound
™™ /
)
™™/ 0
;
™™0 1
var 
	menuGroup
 
=
 
app
 
.
 
MapGroup
 
(
 
$str
 '
)
' (
.
( )
WithTags
) 1
(
1 2
$str
2 8
)
8 9
;
9 :
	menuGroup 	
.
	 

MapGet

 
(
 
$str
 
,
 
async
 
(
 
ISender
 $
sender
% +
)
+ ,
=>
- /
{ 
var
   
result
   
=
   
await
   
sender
   
.
   
Send
   "
(
  " #
new
  # &
GetMenu
  ' .
.
  . /
Query
  / 4
(
  4 5
)
  5 6
)
  6 7
;
  7 8
return
΅΅ 

result
΅΅ 
.
΅΅ 
	IsSuccess
΅΅ 
?
΅΅ 
Results
΅΅ %
.
΅΅% &
Ok
΅΅& (
(
΅΅( )
result
΅΅) /
.
΅΅/ 0
Value
΅΅0 5
)
΅΅5 6
:
΅΅7 8
Results
΅΅9 @
.
΅΅@ A

BadRequest
΅΅A K
(
΅΅K L
new
΅΅L O
{
΅΅P Q
error
΅΅R W
=
΅΅X Y
result
΅΅Z `
.
΅΅` a
Error
΅΅a f
}
΅΅g h
)
΅΅h i
;
΅΅i j
}ΆΆ 
)
ΆΆ 
.££ 
WithName
££ 	
(
££	 

$str
££
 
)
££ 
.¤¤ 
AllowAnonymous
¤¤ 
(
¤¤ 
)
¤¤ 
.¥¥ 
Produces
¥¥ 	
<
¥¥	 

List
¥¥
 
<
¥¥ 

ProductDto
¥¥ 
>
¥¥ 
>
¥¥ 
(
¥¥ 
StatusCodes
¥¥ '
.
¥¥' (
Status200OK
¥¥( 3
)
¥¥3 4
;
¥¥4 5
	menuGroup§§ 	
.
§§	 

MapGet
§§
 
(
§§ 
$str
§§ 
,
§§ 
async
§§ $
(
§§% &
Guid
§§& *
id
§§+ -
,
§§- .
ISender
§§/ 6
sender
§§7 =
)
§§= >
=>
§§? A
{¨¨ 
var
©© 
result
©© 
=
©© 
await
©© 
sender
©© 
.
©© 
Send
©© "
(
©©" #
new
©©# &
GetProductById
©©' 5
.
©©5 6
Query
©©6 ;
(
©©; <
id
©©< >
)
©©> ?
)
©©? @
;
©©@ A
return
 

result
 
.
 
	IsSuccess
 
?
 
Results
 %
.
% &
Ok
& (
(
( )
result
) /
.
/ 0
Value
0 5
)
5 6
:
7 8
Results
9 @
.
@ A
NotFound
A I
(
I J
new
J M
{
N O
error
P U
=
V W
result
X ^
.
^ _
Error
_ d
}
e f
)
f g
;
g h
}«« 
)
«« 
.¬¬ 
WithName
¬¬ 	
(
¬¬	 

$str
¬¬
 
)
¬¬ 
.­­ 
AllowAnonymous
­­ 
(
­­ 
)
­­ 
.®® 
Produces
®® 	
<
®®	 


ProductDto
®®
 
>
®® 
(
®® 
StatusCodes
®® !
.
®®! "
Status200OK
®®" -
)
®®- .
.―― 
Produces
―― 	
<
――	 

object
――
 
>
―― 
(
―― 
StatusCodes
―― 
.
―― 
Status404NotFound
―― /
)
――/ 0
;
――0 1
	menuGroup±± 	
.
±±	 

MapPost
±±
 
(
±± 
$str
±± 
,
±± 
async
±± 
(
±± 
CreateProduct
±± +
.
±±+ ,
Command
±±, 3
command
±±4 ;
,
±±; <
ISender
±±= D
sender
±±E K
)
±±K L
=>
±±M O
{²² 
var
³³ 
result
³³ 
=
³³ 
await
³³ 
sender
³³ 
.
³³ 
Send
³³ "
(
³³" #
command
³³# *
)
³³* +
;
³³+ ,
if
΄΄ 
(
΄΄ 
!
΄΄ 	
result
΄΄	 
.
΄΄ 
	IsSuccess
΄΄ 
)
΄΄ 
return
µµ 
Results
µµ 
.
µµ 

BadRequest
µµ !
(
µµ! "
new
µµ" %
{
µµ& '
errors
µµ( .
=
µµ/ 0
result
µµ1 7
.
µµ7 8
Errors
µµ8 >
.
µµ> ?
Any
µµ? B
(
µµB C
)
µµC D
?
µµE F
result
µµG M
.
µµM N
Errors
µµN T
:
µµU V
new
µµW Z
List
µµ[ _
<
µµ_ `
string
µµ` f
>
µµf g
{
µµh i
result
µµj p
.
µµp q
Error
µµq v
!
µµv w
}
µµx y
}
µµz {
)
µµ{ |
;
µµ| }
return
·· 

Results
·· 
.
·· 
CreatedAtRoute
·· !
(
··! "
$str
··" 2
,
··2 3
new
··4 7
{
··8 9
id
··: <
=
··= >
result
··? E
.
··E F
Value
··F K
!
··K L
.
··L M
Id
··M O
}
··P Q
,
··Q R
result
··S Y
.
··Y Z
Value
··Z _
)
··_ `
;
··` a
}ΈΈ 
)
ΈΈ 
.ΉΉ 
WithName
ΉΉ 	
(
ΉΉ	 

$str
ΉΉ
 
)
ΉΉ 
.ΊΊ 
Produces
ΊΊ 	
<
ΊΊ	 


ProductDto
ΊΊ
 
>
ΊΊ 
(
ΊΊ 
StatusCodes
ΊΊ !
.
ΊΊ! "
Status201Created
ΊΊ" 2
)
ΊΊ2 3
.»» 
Produces
»» 	
<
»»	 

object
»»
 
>
»» 
(
»» 
StatusCodes
»» 
.
»» !
Status400BadRequest
»» 1
)
»»1 2
;
»»2 3
	menuGroup½½ 	
.
½½	 

MapPut
½½
 
(
½½ 
$str
½½ 
,
½½ 
async
½½ $
(
½½% &
Guid
½½& *
id
½½+ -
,
½½- .
UpdateProduct
½½/ <
.
½½< =
Command
½½= D
command
½½E L
,
½½L M
ISender
½½N U
sender
½½V \
)
½½\ ]
=>
½½^ `
{ΎΎ 
if
ΏΏ 
(
ΏΏ 
id
ΏΏ 

!=
ΏΏ 
command
ΏΏ 
.
ΏΏ 
Id
ΏΏ 
)
ΏΏ 
return
ΐΐ 
Results
ΐΐ 
.
ΐΐ 

BadRequest
ΐΐ !
(
ΐΐ! "
new
ΐΐ" %
{
ΐΐ& '
error
ΐΐ( -
=
ΐΐ. /
$str
ΐΐ0 W
}
ΐΐX Y
)
ΐΐY Z
;
ΐΐZ [
var
ΒΒ 
result
ΒΒ 
=
ΒΒ 
await
ΒΒ 
sender
ΒΒ 
.
ΒΒ 
Send
ΒΒ "
(
ΒΒ" #
command
ΒΒ# *
)
ΒΒ* +
;
ΒΒ+ ,
if
ΓΓ 
(
ΓΓ 
!
ΓΓ 	
result
ΓΓ	 
.
ΓΓ 
	IsSuccess
ΓΓ 
)
ΓΓ 
return
ΔΔ 
Results
ΔΔ 
.
ΔΔ 

BadRequest
ΔΔ !
(
ΔΔ! "
new
ΔΔ" %
{
ΔΔ& '
errors
ΔΔ( .
=
ΔΔ/ 0
result
ΔΔ1 7
.
ΔΔ7 8
Errors
ΔΔ8 >
.
ΔΔ> ?
Any
ΔΔ? B
(
ΔΔB C
)
ΔΔC D
?
ΔΔE F
result
ΔΔG M
.
ΔΔM N
Errors
ΔΔN T
:
ΔΔU V
new
ΔΔW Z
List
ΔΔ[ _
<
ΔΔ_ `
string
ΔΔ` f
>
ΔΔf g
{
ΔΔh i
result
ΔΔj p
.
ΔΔp q
Error
ΔΔq v
!
ΔΔv w
}
ΔΔx y
}
ΔΔz {
)
ΔΔ{ |
;
ΔΔ| }
return
ΖΖ 

Results
ΖΖ 
.
ΖΖ 
Ok
ΖΖ 
(
ΖΖ 
result
ΖΖ 
.
ΖΖ 
Value
ΖΖ "
)
ΖΖ" #
;
ΖΖ# $
}ΗΗ 
)
ΗΗ 
.ΘΘ 
WithName
ΘΘ 	
(
ΘΘ	 

$str
ΘΘ
 
)
ΘΘ 
.ΙΙ 
Produces
ΙΙ 	
<
ΙΙ	 


ProductDto
ΙΙ
 
>
ΙΙ 
(
ΙΙ 
StatusCodes
ΙΙ !
.
ΙΙ! "
Status200OK
ΙΙ" -
)
ΙΙ- .
.ΚΚ 
Produces
ΚΚ 	
<
ΚΚ	 

object
ΚΚ
 
>
ΚΚ 
(
ΚΚ 
StatusCodes
ΚΚ 
.
ΚΚ !
Status400BadRequest
ΚΚ 1
)
ΚΚ1 2
;
ΚΚ2 3
	menuGroupΜΜ 	
.
ΜΜ	 

	MapDelete
ΜΜ
 
(
ΜΜ 
$str
ΜΜ  
,
ΜΜ  !
async
ΜΜ" '
(
ΜΜ( )
Guid
ΜΜ) -
id
ΜΜ. 0
,
ΜΜ0 1
ISender
ΜΜ2 9
sender
ΜΜ: @
)
ΜΜ@ A
=>
ΜΜB D
{ΝΝ 
var
ΞΞ 
result
ΞΞ 
=
ΞΞ 
await
ΞΞ 
sender
ΞΞ 
.
ΞΞ 
Send
ΞΞ "
(
ΞΞ" #
new
ΞΞ# &
DeleteProduct
ΞΞ' 4
.
ΞΞ4 5
Command
ΞΞ5 <
(
ΞΞ< =
id
ΞΞ= ?
)
ΞΞ? @
)
ΞΞ@ A
;
ΞΞA B
return
ΟΟ 

result
ΟΟ 
.
ΟΟ 
	IsSuccess
ΟΟ 
?
ΟΟ 
Results
ΟΟ %
.
ΟΟ% &
	NoContent
ΟΟ& /
(
ΟΟ/ 0
)
ΟΟ0 1
:
ΟΟ2 3
Results
ΟΟ4 ;
.
ΟΟ; <

BadRequest
ΟΟ< F
(
ΟΟF G
new
ΟΟG J
{
ΟΟK L
error
ΟΟM R
=
ΟΟS T
result
ΟΟU [
.
ΟΟ[ \
Error
ΟΟ\ a
}
ΟΟb c
)
ΟΟc d
;
ΟΟd e
}ΠΠ 
)
ΠΠ 
.ΡΡ 
WithName
ΡΡ 	
(
ΡΡ	 

$str
ΡΡ
 
)
ΡΡ 
. 
Produces
 	
(
	 

StatusCodes

 
.
  
Status204NoContent
 (
)
( )
.ΣΣ 
Produces
ΣΣ 	
<
ΣΣ	 

object
ΣΣ
 
>
ΣΣ 
(
ΣΣ 
StatusCodes
ΣΣ 
.
ΣΣ !
Status400BadRequest
ΣΣ 1
)
ΣΣ1 2
;
ΣΣ2 3
varΦΦ 
ordersGroup
ΦΦ 
=
ΦΦ 
app
ΦΦ 
.
ΦΦ 
MapGroup
ΦΦ 
(
ΦΦ 
$str
ΦΦ +
)
ΦΦ+ ,
.
ΦΦ, -
WithTags
ΦΦ- 5
(
ΦΦ5 6
$str
ΦΦ6 >
)
ΦΦ> ?
;
ΦΦ? @
ordersGroupΨΨ 
.
ΨΨ 
MapPost
ΨΨ 
(
ΨΨ 
$str
ΨΨ 
,
ΨΨ 
async
ΨΨ 
(
ΨΨ  
CreateOrder
ΨΨ  +
.
ΨΨ+ ,
Command
ΨΨ, 3
command
ΨΨ4 ;
,
ΨΨ; <
ClaimsPrincipal
ΨΨ= L
user
ΨΨM Q
,
ΨΨQ R
ISender
ΨΨS Z
sender
ΨΨ[ a
)
ΨΨa b
=>
ΨΨc e
{ΩΩ 
var
ΪΪ 
userIdClaim
ΪΪ 
=
ΪΪ 
user
ΪΪ 
.
ΪΪ 
	FindFirst
ΪΪ $
(
ΪΪ$ %

ClaimTypes
ΪΪ% /
.
ΪΪ/ 0
NameIdentifier
ΪΪ0 >
)
ΪΪ> ?
?
ΪΪ? @
.
ΪΪ@ A
Value
ΪΪA F
??
ΪΪG I
user
ΪΪJ N
.
ΪΪN O
	FindFirst
ΪΪO X
(
ΪΪX Y
$str
ΪΪY ^
)
ΪΪ^ _
?
ΪΪ_ `
.
ΪΪ` a
Value
ΪΪa f
;
ΪΪf g
if
ΫΫ 
(
ΫΫ 
string
ΫΫ 
.
ΫΫ 
IsNullOrEmpty
ΫΫ 
(
ΫΫ 
userIdClaim
ΫΫ (
)
ΫΫ( )
||
ΫΫ* ,
!
ΫΫ- .
Guid
ΫΫ. 2
.
ΫΫ2 3
TryParse
ΫΫ3 ;
(
ΫΫ; <
userIdClaim
ΫΫ< G
,
ΫΫG H
out
ΫΫI L
var
ΫΫM P!
authenticatedUserId
ΫΫQ d
)
ΫΫd e
)
ΫΫe f
{
άά 
return
έέ 
Results
έέ 
.
έέ 
Unauthorized
έέ #
(
έέ# $
)
έέ$ %
;
έέ% &
}
ήή 
if
ίί 
(
ίί 
command
ίί 
.
ίί 
UserId
ίί 
!=
ίί !
authenticatedUserId
ίί -
)
ίί- .
{
ίί/ 0
return
ίί1 7
Results
ίί8 ?
.
ίί? @
Forbid
ίί@ F
(
ίίF G
)
ίίG H
;
ίίH I
}
ίίJ K
var
αα 
result
αα 
=
αα 
await
αα 
sender
αα 
.
αα 
Send
αα "
(
αα" #
command
αα# *
)
αα* +
;
αα+ ,
return
ββ 

result
ββ 
.
ββ 
	IsSuccess
ββ 
?
ββ 
Results
ββ %
.
ββ% &
Created
ββ& -
(
ββ- .
$"
ββ. 0
$str
ββ0 <
{
ββ< =
result
ββ= C
.
ββC D
Value
ββD I
!
ββI J
.
ββJ K
Id
ββK M
}
ββM N
"
ββN O
,
ββO P
result
ββQ W
.
ββW X
Value
ββX ]
)
ββ] ^
:
ββ_ `
Results
ββa h
.
ββh i

BadRequest
ββi s
(
ββs t
new
ββt w
{
ββx y
errorsββz €
=ββ ‚
resultββƒ ‰
.ββ‰ 
Errorsββ 
}ββ‘ ’
)ββ’ “
;ββ“ ”
}γγ 
)
γγ 
.δδ 
WithName
δδ 	
(
δδ	 

$str
δδ
 
)
δδ 
.εε "
RequireAuthorization
εε 
(
εε 
)
εε 
.ζζ 
Produces
ζζ 	
<
ζζ	 

OrderDto
ζζ
 
>
ζζ 
(
ζζ 
StatusCodes
ζζ 
.
ζζ  
Status201Created
ζζ  0
)
ζζ0 1
.ηη 
Produces
ηη 	
(
ηη	 

StatusCodes
ηη
 
.
ηη #
Status401Unauthorized
ηη +
)
ηη+ ,
.θθ 
Produces
θθ 	
(
θθ	 

StatusCodes
θθ
 
.
θθ  
Status403Forbidden
θθ (
)
θθ( )
.ιι 
Produces
ιι 	
<
ιι	 

object
ιι
 
>
ιι 
(
ιι 
StatusCodes
ιι 
.
ιι !
Status400BadRequest
ιι 1
)
ιι1 2
;
ιι2 3
ordersGroupλλ 
.
λλ 
MapGet
λλ 
(
λλ 
$str
λλ (
,
λλ( )
async
λλ* /
(
λλ0 1
Guid
λλ1 5
userId
λλ6 <
,
λλ< =
ClaimsPrincipal
λλ> M
user
λλN R
,
λλR S
ISender
λλT [
sender
λλ\ b
)
λλb c
=>
λλd f
{μμ 
var
νν 
userIdClaim
νν 
=
νν 
user
νν 
.
νν 
	FindFirst
νν $
(
νν$ %

ClaimTypes
νν% /
.
νν/ 0
NameIdentifier
νν0 >
)
νν> ?
?
νν? @
.
νν@ A
Value
ννA F
??
ννG I
user
ννJ N
.
ννN O
	FindFirst
ννO X
(
ννX Y
$str
ννY ^
)
νν^ _
?
νν_ `
.
νν` a
Value
ννa f
;
ννf g
if
ξξ 
(
ξξ 
string
ξξ 
.
ξξ 
IsNullOrEmpty
ξξ 
(
ξξ 
userIdClaim
ξξ (
)
ξξ( )
||
ξξ* ,
!
ξξ- .
Guid
ξξ. 2
.
ξξ2 3
TryParse
ξξ3 ;
(
ξξ; <
userIdClaim
ξξ< G
,
ξξG H
out
ξξI L
var
ξξM P!
authenticatedUserId
ξξQ d
)
ξξd e
)
ξξe f
{
οο 
return
ππ 
Results
ππ 
.
ππ 
Unauthorized
ππ #
(
ππ# $
)
ππ$ %
;
ππ% &
}
ρρ 
var
ςς 
userRole
ςς 
=
ςς 
user
ςς 
.
ςς 
	FindFirst
ςς !
(
ςς! "

ClaimTypes
ςς" ,
.
ςς, -
Role
ςς- 1
)
ςς1 2
?
ςς2 3
.
ςς3 4
Value
ςς4 9
;
ςς9 :
if
σσ 
(
σσ 
userId
σσ 
!=
σσ !
authenticatedUserId
σσ %
&&
σσ& (
userRole
σσ) 1
!=
σσ2 4
$str
σσ5 <
&&
σσ= ?
userRole
σσ@ H
!=
σσI K
$str
σσL S
)
σσS T
{
ττ 
return
υυ 
Results
υυ 
.
υυ 
Forbid
υυ 
(
υυ 
)
υυ 
;
υυ  
}
φφ 
var
χχ 
result
χχ 
=
χχ 
await
χχ 
sender
χχ 
.
χχ 
Send
χχ "
(
χχ" #
new
χχ# &
GetUserOrders
χχ' 4
.
χχ4 5
Query
χχ5 :
{
χχ; <
UserId
χχ= C
=
χχD E
userId
χχF L
}
χχM N
)
χχN O
;
χχO P
return
ψψ 

result
ψψ 
.
ψψ 
	IsSuccess
ψψ 
?
ψψ 
Results
ψψ %
.
ψψ% &
Ok
ψψ& (
(
ψψ( )
result
ψψ) /
.
ψψ/ 0
Value
ψψ0 5
)
ψψ5 6
:
ψψ7 8
Results
ψψ9 @
.
ψψ@ A

BadRequest
ψψA K
(
ψψK L
new
ψψL O
{
ψψP Q
errors
ψψR X
=
ψψY Z
result
ψψ[ a
.
ψψa b
Errors
ψψb h
}
ψψi j
)
ψψj k
;
ψψk l
}ωω 
)
ωω 
.ϊϊ 
WithName
ϊϊ 	
(
ϊϊ	 

$str
ϊϊ
 
)
ϊϊ 
.ϋϋ "
RequireAuthorization
ϋϋ 
(
ϋϋ 
)
ϋϋ 
.όό 
Produces
όό 	
<
όό	 

List
όό
 
<
όό 
OrderDto
όό 
>
όό 
>
όό 
(
όό 
StatusCodes
όό %
.
όό% &
Status200OK
όό& 1
)
όό1 2
.ύύ 
Produces
ύύ 	
(
ύύ	 

StatusCodes
ύύ
 
.
ύύ #
Status401Unauthorized
ύύ +
)
ύύ+ ,
.ώώ 
Produces
ώώ 	
(
ώώ	 

StatusCodes
ώώ
 
.
ώώ  
Status403Forbidden
ώώ (
)
ώώ( )
. 
Produces
 	
<
	 

object

 
>
 
(
 
StatusCodes
 
.
 !
Status400BadRequest
 1
)
1 2
;
2 3
ordersGroup 
.
 
MapGet
 
(
 
$str
 $
,
$ %
async
& +
(
, -
Guid
- 1
orderId
2 9
,
9 :
ClaimsPrincipal
; J
user
K O
,
O P
ISender
Q X
sender
Y _
)
_ `
=>
a c
{‚‚ 
var
ƒƒ 
userIdClaim
ƒƒ 
=
ƒƒ 
user
ƒƒ 
.
ƒƒ 
	FindFirst
ƒƒ $
(
ƒƒ$ %

ClaimTypes
ƒƒ% /
.
ƒƒ/ 0
NameIdentifier
ƒƒ0 >
)
ƒƒ> ?
?
ƒƒ? @
.
ƒƒ@ A
Value
ƒƒA F
??
ƒƒG I
user
ƒƒJ N
.
ƒƒN O
	FindFirst
ƒƒO X
(
ƒƒX Y
$str
ƒƒY ^
)
ƒƒ^ _
?
ƒƒ_ `
.
ƒƒ` a
Value
ƒƒa f
;
ƒƒf g
if
„„ 
(
„„ 
string
„„ 
.
„„ 
IsNullOrEmpty
„„ 
(
„„ 
userIdClaim
„„ (
)
„„( )
||
„„* ,
!
„„- .
Guid
„„. 2
.
„„2 3
TryParse
„„3 ;
(
„„; <
userIdClaim
„„< G
,
„„G H
out
„„I L
var
„„M P!
authenticatedUserId
„„Q d
)
„„d e
)
„„e f
{
…… 
return
†† 
Results
†† 
.
†† 
Unauthorized
†† #
(
††# $
)
††$ %
;
††% &
}
‡‡ 
var
 
result
 
=
 
await
 
sender
 
.
 
Send
 "
(
" #
new
# &
GetOrderById
' 3
.
3 4
Query
4 9
{
: ;
OrderId
< C
=
D E
orderId
F M
,
M N
UserId
O U
=
V W!
authenticatedUserId
X k
}
l m
)
m n
;
n o
return
‰‰ 

result
‰‰ 
.
‰‰ 
	IsSuccess
‰‰ 
?
‰‰ 
Results
‰‰ %
.
‰‰% &
Ok
‰‰& (
(
‰‰( )
result
‰‰) /
.
‰‰/ 0
Value
‰‰0 5
)
‰‰5 6
:
‰‰7 8
Results
‰‰9 @
.
‰‰@ A
NotFound
‰‰A I
(
‰‰I J
new
‰‰J M
{
‰‰N O
errors
‰‰P V
=
‰‰W X
result
‰‰Y _
.
‰‰_ `
Errors
‰‰` f
}
‰‰g h
)
‰‰h i
;
‰‰i j
} 
)
 
.‹‹ 
WithName
‹‹ 	
(
‹‹	 

$str
‹‹
 
)
‹‹ 
. "
RequireAuthorization
 
(
 
)
 
. 
Produces
 	
<
	 

OrderDto

 
>
 
(
 
StatusCodes
 
.
  
Status200OK
  +
)
+ ,
. 
Produces
 	
(
	 

StatusCodes

 
.
 #
Status401Unauthorized
 +
)
+ ,
. 
Produces
 	
<
	 

object

 
>
 
(
 
StatusCodes
 
.
 
Status404NotFound
 /
)
/ 0
;
0 1
ordersGroup‘‘ 
.
‘‘ 
	MapDelete
‘‘ 
(
‘‘ 
$str
‘‘ '
,
‘‘' (
async
‘‘) .
(
‘‘/ 0
Guid
‘‘0 4
orderId
‘‘5 <
,
‘‘< =
string
‘‘> D
?
‘‘D E 
cancellationReason
‘‘F X
,
‘‘X Y
ClaimsPrincipal
‘‘Z i
user
‘‘j n
,
‘‘n o
ISender
‘‘p w
sender
‘‘x ~
)
‘‘~ 
=>‘‘€ ‚
{’’ 
var
““ 
userIdClaim
““ 
=
““ 
user
““ 
.
““ 
	FindFirst
““ $
(
““$ %

ClaimTypes
““% /
.
““/ 0
NameIdentifier
““0 >
)
““> ?
?
““? @
.
““@ A
Value
““A F
??
““G I
user
““J N
.
““N O
	FindFirst
““O X
(
““X Y
$str
““Y ^
)
““^ _
?
““_ `
.
““` a
Value
““a f
;
““f g
if
”” 
(
”” 
string
”” 
.
”” 
IsNullOrEmpty
”” 
(
”” 
userIdClaim
”” (
)
””( )
||
””* ,
!
””- .
Guid
””. 2
.
””2 3
TryParse
””3 ;
(
””; <
userIdClaim
””< G
,
””G H
out
””I L
var
””M P!
authenticatedUserId
””Q d
)
””d e
)
””e f
{
•• 
return
–– 
Results
–– 
.
–– 
Unauthorized
–– #
(
––# $
)
––$ %
;
––% &
}
—— 
var
 
result
 
=
 
await
 
sender
 
.
 
Send
 "
(
" #
new
# &
CancelOrder
' 2
.
2 3
Command
3 :
{
™™ 
OrderId
 
=
 
orderId
 
,
 
UserId
›› 
=
›› !
authenticatedUserId
›› $
,
››$ % 
CancellationReason
 
=
  
cancellationReason
 /
}
 
)
 
;
 
return
 

result
 
.
 
	IsSuccess
 
?
 
Results
 %
.
% &
Ok
& (
(
( )
result
) /
.
/ 0
Value
0 5
)
5 6
:
7 8
Results
9 @
.
@ A

BadRequest
A K
(
K L
new
L O
{
P Q
errors
R X
=
Y Z
result
[ a
.
a b
Errors
b h
}
i j
)
j k
;
k l
} 
)
 
.   
WithName
   	
(
  	 

$str
  
 
)
   
.΅΅ "
RequireAuthorization
΅΅ 
(
΅΅ 
)
΅΅ 
.ΆΆ 
Produces
ΆΆ 	
<
ΆΆ	 

OrderDto
ΆΆ
 
>
ΆΆ 
(
ΆΆ 
StatusCodes
ΆΆ 
.
ΆΆ  
Status200OK
ΆΆ  +
)
ΆΆ+ ,
.££ 
Produces
££ 	
(
££	 

StatusCodes
££
 
.
££ #
Status401Unauthorized
££ +
)
££+ ,
.¤¤ 
Produces
¤¤ 	
<
¤¤	 

object
¤¤
 
>
¤¤ 
(
¤¤ 
StatusCodes
¤¤ 
.
¤¤ !
Status400BadRequest
¤¤ 1
)
¤¤1 2
;
¤¤2 3
var§§ 
kitchenGroup
§§ 
=
§§ 
app
§§ 
.
§§ 
MapGroup
§§ 
(
§§  
$str
§§  -
)
§§- .
.
§§. /
WithTags
§§/ 7
(
§§7 8
$str
§§8 A
)
§§A B
;
§§B C
kitchenGroup©© 
.
©© 
MapGet
©© 
(
©© 
$str
©© 
,
©© 
async
©©  %
(
©©& '
ISender
©©' .
sender
©©/ 5
)
©©5 6
=>
©©7 9
{ 
var
«« 
result
«« 
=
«« 
await
«« 
sender
«« 
.
«« 
Send
«« "
(
««" #
new
««# &
GetPendingOrders
««' 7
.
««7 8
Query
««8 =
(
««= >
)
««> ?
)
««? @
;
««@ A
return
¬¬ 

result
¬¬ 
.
¬¬ 
	IsSuccess
¬¬ 
?
¬¬ 
Results
¬¬ %
.
¬¬% &
Ok
¬¬& (
(
¬¬( )
result
¬¬) /
.
¬¬/ 0
Value
¬¬0 5
)
¬¬5 6
:
¬¬7 8
Results
¬¬9 @
.
¬¬@ A

BadRequest
¬¬A K
(
¬¬K L
new
¬¬L O
{
¬¬P Q
errors
¬¬R X
=
¬¬Y Z
result
¬¬[ a
.
¬¬a b
Errors
¬¬b h
}
¬¬i j
)
¬¬j k
;
¬¬k l
}­­ 
)
­­ 
.®® 
WithName
®® 	
(
®®	 

$str
®®
 
)
®® 
.―― "
RequireAuthorization
―― 
(
―― 
policy
―― 
=>
―― 
policy
――  &
.
――& '
RequireRole
――' 2
(
――2 3
$str
――3 :
,
――: ;
$str
――< C
)
――C D
)
――D E
.°° 
Produces
°° 	
<
°°	 

List
°°
 
<
°° 
OrderDto
°° 
>
°° 
>
°° 
(
°° 
StatusCodes
°° %
.
°°% &
Status200OK
°°& 1
)
°°1 2
.±± 
Produces
±± 	
(
±±	 

StatusCodes
±±
 
.
±± #
Status401Unauthorized
±± +
)
±±+ ,
.²² 
Produces
²² 	
(
²²	 

StatusCodes
²²
 
.
²²  
Status403Forbidden
²² (
)
²²( )
.³³ 
Produces
³³ 	
<
³³	 

object
³³
 
>
³³ 
(
³³ 
StatusCodes
³³ 
.
³³ !
Status400BadRequest
³³ 1
)
³³1 2
;
³³2 3
kitchenGroupµµ 
.
µµ 
MapPatch
µµ 
(
µµ 
$str
µµ 5
,
µµ5 6
async
µµ7 <
(
µµ= >
Guid
µµ> B
orderId
µµC J
,
µµJ K
UpdateOrderStatus
µµL ]
.
µµ] ^
Command
µµ^ e
command
µµf m
,
µµm n
ISender
µµo v
sender
µµw }
)
µµ} ~
=>µµ 
{¶¶ 
var
·· 
updatedCommand
·· 
=
·· 
command
··  
with
··! %
{
··& '
OrderId
··( /
=
··0 1
orderId
··2 9
}
··: ;
;
··; <
var
ΈΈ 
result
ΈΈ 
=
ΈΈ 
await
ΈΈ 
sender
ΈΈ 
.
ΈΈ 
Send
ΈΈ "
(
ΈΈ" #
updatedCommand
ΈΈ# 1
)
ΈΈ1 2
;
ΈΈ2 3
return
ΉΉ 

result
ΉΉ 
.
ΉΉ 
	IsSuccess
ΉΉ 
?
ΉΉ 
Results
ΉΉ %
.
ΉΉ% &
Ok
ΉΉ& (
(
ΉΉ( )
result
ΉΉ) /
.
ΉΉ/ 0
Value
ΉΉ0 5
)
ΉΉ5 6
:
ΉΉ7 8
Results
ΉΉ9 @
.
ΉΉ@ A

BadRequest
ΉΉA K
(
ΉΉK L
new
ΉΉL O
{
ΉΉP Q
errors
ΉΉR X
=
ΉΉY Z
result
ΉΉ[ a
.
ΉΉa b
Errors
ΉΉb h
}
ΉΉi j
)
ΉΉj k
;
ΉΉk l
}ΊΊ 
)
ΊΊ 
.»» 
WithName
»» 	
(
»»	 

$str
»»
 
)
»» 
.ΌΌ "
RequireAuthorization
ΌΌ 
(
ΌΌ 
policy
ΌΌ 
=>
ΌΌ 
policy
ΌΌ  &
.
ΌΌ& '
RequireRole
ΌΌ' 2
(
ΌΌ2 3
$str
ΌΌ3 :
,
ΌΌ: ;
$str
ΌΌ< C
)
ΌΌC D
)
ΌΌD E
.½½ 
Produces
½½ 	
<
½½	 

OrderDto
½½
 
>
½½ 
(
½½ 
StatusCodes
½½ 
.
½½  
Status200OK
½½  +
)
½½+ ,
.ΎΎ 
Produces
ΎΎ 	
(
ΎΎ	 

StatusCodes
ΎΎ
 
.
ΎΎ #
Status401Unauthorized
ΎΎ +
)
ΎΎ+ ,
.ΏΏ 
Produces
ΏΏ 	
(
ΏΏ	 

StatusCodes
ΏΏ
 
.
ΏΏ  
Status403Forbidden
ΏΏ (
)
ΏΏ( )
.ΐΐ 
Produces
ΐΐ 	
<
ΐΐ	 

object
ΐΐ
 
>
ΐΐ 
(
ΐΐ 
StatusCodes
ΐΐ 
.
ΐΐ !
Status400BadRequest
ΐΐ 1
)
ΐΐ1 2
;
ΐΐ2 3
kitchenGroupΒΒ 
.
ΒΒ 
MapGet
ΒΒ 
(
ΒΒ 
$str
ΒΒ &
,
ΒΒ& '
async
ΒΒ( -
(
ΒΒ. /
DateTime
ΒΒ/ 7
?
ΒΒ7 8

reportDate
ΒΒ9 C
,
ΒΒC D
ISender
ΒΒE L
sender
ΒΒM S
)
ΒΒS T
=>
ΒΒU W
{ΓΓ 
var
ΔΔ 
result
ΔΔ 
=
ΔΔ 
await
ΔΔ 
sender
ΔΔ 
.
ΔΔ 
Send
ΔΔ "
(
ΔΔ" #
new
ΔΔ# &%
GetDailyInventoryReport
ΔΔ' >
.
ΔΔ> ?
Query
ΔΔ? D
{
ΔΔE F

ReportDate
ΔΔG Q
=
ΔΔR S

reportDate
ΔΔT ^
}
ΔΔ_ `
)
ΔΔ` a
;
ΔΔa b
return
ΕΕ 

result
ΕΕ 
.
ΕΕ 
	IsSuccess
ΕΕ 
?
ΕΕ 
Results
ΕΕ %
.
ΕΕ% &
Ok
ΕΕ& (
(
ΕΕ( )
result
ΕΕ) /
.
ΕΕ/ 0
Value
ΕΕ0 5
)
ΕΕ5 6
:
ΕΕ7 8
Results
ΕΕ9 @
.
ΕΕ@ A

BadRequest
ΕΕA K
(
ΕΕK L
new
ΕΕL O
{
ΕΕP Q
errors
ΕΕR X
=
ΕΕY Z
result
ΕΕ[ a
.
ΕΕa b
Errors
ΕΕb h
}
ΕΕi j
)
ΕΕj k
;
ΕΕk l
}ΖΖ 
)
ΖΖ 
.ΗΗ 
WithName
ΗΗ 	
(
ΗΗ	 

$str
ΗΗ
 #
)
ΗΗ# $
.ΘΘ "
RequireAuthorization
ΘΘ 
(
ΘΘ 
policy
ΘΘ 
=>
ΘΘ 
policy
ΘΘ  &
.
ΘΘ& '
RequireRole
ΘΘ' 2
(
ΘΘ2 3
$str
ΘΘ3 :
,
ΘΘ: ;
$str
ΘΘ< C
)
ΘΘC D
)
ΘΘD E
.ΙΙ 
Produces
ΙΙ 	
<
ΙΙ	 

object
ΙΙ
 
>
ΙΙ 
(
ΙΙ 
StatusCodes
ΙΙ 
.
ΙΙ 
Status200OK
ΙΙ )
)
ΙΙ) *
.ΚΚ 
Produces
ΚΚ 	
(
ΚΚ	 

StatusCodes
ΚΚ
 
.
ΚΚ #
Status401Unauthorized
ΚΚ +
)
ΚΚ+ ,
.ΛΛ 
Produces
ΛΛ 	
(
ΛΛ	 

StatusCodes
ΛΛ
 
.
ΛΛ  
Status403Forbidden
ΛΛ (
)
ΛΛ( )
.ΜΜ 
Produces
ΜΜ 	
<
ΜΜ	 

object
ΜΜ
 
>
ΜΜ 
(
ΜΜ 
StatusCodes
ΜΜ 
.
ΜΜ !
Status400BadRequest
ΜΜ 1
)
ΜΜ1 2
;
ΜΜ2 3
varΟΟ 
paymentsGroup
ΟΟ 
=
ΟΟ 
app
ΟΟ 
.
ΟΟ 
MapGroup
ΟΟ  
(
ΟΟ  !
$str
ΟΟ! /
)
ΟΟ/ 0
.
ΟΟ0 1
WithTags
ΟΟ1 9
(
ΟΟ9 :
$str
ΟΟ: D
)
ΟΟD E
;
ΟΟE F
paymentsGroupΡΡ 
.
ΡΡ 
MapPost
ΡΡ 
(
ΡΡ 
$str
ΡΡ  
,
ΡΡ  !
async
ΡΡ" '
(
ΡΡ( )
ProcessPayment
ΡΡ) 7
.
ΡΡ7 8
Command
ΡΡ8 ?
command
ΡΡ@ G
,
ΡΡG H
ISender
ΡΡI P
sender
ΡΡQ W
)
ΡΡW X
=>
ΡΡY [
{
 
var
ΣΣ 
result
ΣΣ 
=
ΣΣ 
await
ΣΣ 
sender
ΣΣ !
.
ΣΣ! "
Send
ΣΣ" &
(
ΣΣ& '
command
ΣΣ' .
)
ΣΣ. /
;
ΣΣ/ 0
return
ΤΤ 
result
ΤΤ 
.
ΤΤ 
	IsSuccess
ΤΤ 
?
ΥΥ 
Results
ΥΥ 
.
ΥΥ 
Ok
ΥΥ 
(
ΥΥ 
result
ΥΥ 
.
ΥΥ  
Value
ΥΥ  %
)
ΥΥ% &
:
ΦΦ 
Results
ΦΦ 
.
ΦΦ 

BadRequest
ΦΦ  
(
ΦΦ  !
new
ΦΦ! $
{
ΦΦ% &
errors
ΦΦ' -
=
ΦΦ. /
result
ΦΦ0 6
.
ΦΦ6 7
Errors
ΦΦ7 =
}
ΦΦ> ?
)
ΦΦ? @
;
ΦΦ@ A
}
ΧΧ 
)
ΧΧ 
.
ΨΨ 
WithName
ΨΨ 
(
ΨΨ 
$str
ΨΨ 
)
ΨΨ 
.
ΩΩ "
RequireAuthorization
ΩΩ 
(
ΩΩ 
)
ΩΩ 
.
ΪΪ 
Produces
ΪΪ 
<
ΪΪ 

PaymentDto
ΪΪ 
>
ΪΪ 
(
ΪΪ 
StatusCodes
ΪΪ %
.
ΪΪ% &
Status200OK
ΪΪ& 1
)
ΪΪ1 2
.
ΫΫ 
Produces
ΫΫ 
<
ΫΫ 
object
ΫΫ 
>
ΫΫ 
(
ΫΫ 
StatusCodes
ΫΫ !
.
ΫΫ! "!
Status400BadRequest
ΫΫ" 5
)
ΫΫ5 6
;
ΫΫ6 7
paymentsGroupέέ 
.
έέ 
MapGet
έέ 
(
έέ 
$str
έέ 2
,
έέ2 3
async
έέ4 9
(
έέ: ;
Guid
έέ; ?
userId
έέ@ F
,
έέF G
int
έέH K
?
έέK L
page
έέM Q
,
έέQ R
int
έέS V
?
έέV W
pageSize
έέX `
,
έέ` a
string
έέb h
?
έέh i
status
έέj p
,
έέp q
string
έέr x
?
έέx y
methodέέz €
,έέ€ 
ISenderέέ‚ ‰
senderέέ 
,έέ ‘
ClaimsPrincipalέέ’ ΅
userέέΆ ¦
)έέ¦ §
=>έέ¨ 
{
ήή 
var
ίί 
userIdClaim
ίί 
=
ίί 
user
ίί 
.
ίί 
	FindFirst
ίί (
(
ίί( )

ClaimTypes
ίί) 3
.
ίί3 4
NameIdentifier
ίί4 B
)
ίίB C
?
ίίC D
.
ίίD E
Value
ίίE J
??
ίίK M
user
ίίN R
.
ίίR S
	FindFirst
ίίS \
(
ίί\ ]
$str
ίί] b
)
ίίb c
?
ίίc d
.
ίίd e
Value
ίίe j
;
ίίj k
var
ΰΰ 
userRole
ΰΰ 
=
ΰΰ 
user
ΰΰ 
.
ΰΰ 
	FindFirst
ΰΰ %
(
ΰΰ% &

ClaimTypes
ΰΰ& 0
.
ΰΰ0 1
Role
ΰΰ1 5
)
ΰΰ5 6
?
ΰΰ6 7
.
ΰΰ7 8
Value
ΰΰ8 =
;
ΰΰ= >
if
αα 

(
αα 
string
αα 
.
αα 
IsNullOrEmpty
αα  
(
αα  !
userIdClaim
αα! ,
)
αα, -
||
αα. 0
!
αα1 2
Guid
αα2 6
.
αα6 7
TryParse
αα7 ?
(
αα? @
userIdClaim
αα@ K
,
ααK L
out
ααM P
var
ααQ T
currentUserId
ααU b
)
ααb c
)
ααc d
return
ββ 
Results
ββ 
.
ββ 
Unauthorized
ββ '
(
ββ' (
)
ββ( )
;
ββ) *
if
γγ 

(
γγ 
userId
γγ 
!=
γγ 
currentUserId
γγ #
&&
γγ$ &
userRole
γγ' /
!=
γγ0 2
$str
γγ3 :
&&
γγ; =
userRole
γγ> F
!=
γγG I
$str
γγJ Q
)
γγQ R
return
δδ 
Results
δδ 
.
δδ 
Forbid
δδ !
(
δδ! "
)
δδ" #
;
δδ# $
if
ζζ 

(
ζζ 
page
ζζ 
.
ζζ 
HasValue
ζζ 
&&
ζζ 
pageSize
ζζ %
.
ζζ% &
HasValue
ζζ& .
)
ζζ. /
{
ηη 	
var
θθ 
result
θθ 
=
θθ 
await
θθ 
sender
θθ %
.
θθ% &
Send
θθ& *
(
θθ* +
new
θθ+ .
GetUserPayments
θθ/ >
.
θθ> ?
Query
θθ? D
(
θθD E
userId
θθE K
,
θθK L
page
θθM Q
.
θθQ R
Value
θθR W
,
θθW X
pageSize
θθY a
.
θθa b
Value
θθb g
,
θθg h
status
θθi o
,
θθo p
method
θθq w
)
θθw x
)
θθx y
;
θθy z
return
ιι 
result
ιι 
.
ιι 
	IsSuccess
ιι #
?
ιι$ %
Results
ιι& -
.
ιι- .
Ok
ιι. 0
(
ιι0 1
result
ιι1 7
.
ιι7 8
Value
ιι8 =
)
ιι= >
:
ιι? @
Results
ιιA H
.
ιιH I

BadRequest
ιιI S
(
ιιS T
new
ιιT W
{
ιιX Y
errors
ιιZ `
=
ιιa b
result
ιιc i
.
ιιi j
Errors
ιιj p
}
ιιq r
)
ιιr s
;
ιιs t
}
κκ 	
else
λλ 
{
μμ 	
var
νν 
payments
νν 
=
νν 
await
νν  
sender
νν! '
.
νν' (
Send
νν( ,
(
νν, -
new
νν- 0
GetUserPayments
νν1 @
.
νν@ A
Query
ννA F
(
ννF G
userId
ννG M
)
ννM N
)
ννN O
;
ννO P
return
ξξ 
Results
ξξ 
.
ξξ 
Ok
ξξ 
(
ξξ 
payments
ξξ &
)
ξξ& '
;
ξξ' (
}
οο 	
}
ππ 
)
ππ 
.
ρρ 
WithName
ρρ 
(
ρρ 
$str
ρρ %
)
ρρ% &
.
ςς "
RequireAuthorization
ςς 
(
ςς 
)
ςς 
.
σσ 
Produces
σσ 
(
σσ 
StatusCodes
σσ 
.
σσ 
Status200OK
σσ %
)
σσ% &
.
ττ 
Produces
ττ 
(
ττ 
StatusCodes
ττ 
.
ττ #
Status401Unauthorized
ττ /
)
ττ/ 0
.
υυ 
Produces
υυ 
(
υυ 
StatusCodes
υυ 
.
υυ  
Status403Forbidden
υυ ,
)
υυ, -
;
υυ- .
paymentsGroupχχ 
.
χχ 
MapGet
χχ 
(
χχ 
$str
χχ ,
,
χχ, -
async
χχ. 3
(
χχ4 5
Guid
χχ5 9
orderId
χχ: A
,
χχA B
ISender
χχC J
sender
χχK Q
,
χχQ R
ClaimsPrincipal
χχS b
user
χχc g
)
χχg h
=>
χχi k
{
ψψ 
var
ωω 
payments
ωω 
=
ωω 
await
ωω 
sender
ωω #
.
ωω# $
Send
ωω$ (
(
ωω( )
new
ωω) ,
GetOrderPayments
ωω- =
.
ωω= >
Query
ωω> C
(
ωωC D
orderId
ωωD K
)
ωωK L
)
ωωL M
;
ωωM N
return
ϊϊ 
Results
ϊϊ 
.
ϊϊ 
Ok
ϊϊ 
(
ϊϊ 
payments
ϊϊ "
)
ϊϊ" #
;
ϊϊ# $
}
ϋϋ 
)
ϋϋ 
.
όό 
WithName
όό 
(
όό 
$str
όό  
)
όό  !
.
ύύ "
RequireAuthorization
ύύ 
(
ύύ 
)
ύύ 
.
ώώ 
Produces
ώώ 
<
ώώ 
List
ώώ 
<
ώώ 

PaymentDto
ώώ 
>
ώώ 
>
ώώ 
(
ώώ  
StatusCodes
ώώ  +
.
ώώ+ ,
Status200OK
ώώ, 7
)
ώώ7 8
.
 
Produces
 
(
 
StatusCodes
 
.
 #
Status401Unauthorized
 /
)
/ 0
;
0 1
app‚‚ 
.
‚‚ 
MapPost
‚‚ 
(
‚‚ 
$str
‚‚ *
,
‚‚* +
async
‚‚, 1
(
‚‚2 3
HttpRequest
‚‚3 >
req
‚‚? B
,
‚‚B C
AppDbContext
‚‚D P
db
‚‚Q S
,
‚‚S T
IConfiguration
‚‚U c
config
‚‚d j
)
‚‚j k
=>
‚‚l n
{ƒƒ 
string
„„ 

json
„„ 
=
„„ 
await
„„ 
new
„„ 
StreamReader
„„ (
(
„„( )
req
„„) ,
.
„„, -
Body
„„- 1
)
„„1 2
.
„„2 3
ReadToEndAsync
„„3 A
(
„„A B
)
„„B C
;
„„C D
var
†† 
webhookSecret
†† 
=
†† 
Environment
†† #
.
††# $$
GetEnvironmentVariable
††$ :
(
††: ;
$str
††; R
)
††R S
??
‡‡ 

config
‡‡ 
[
‡‡ 
$str
‡‡ (
]
‡‡( )
;
‡‡) *
try
‰‰ 
{
 
var
‹‹ 
stripeEvent
‹‹ 
=
‹‹ 
Stripe
‹‹  
.
‹‹  !
EventUtility
‹‹! -
.
‹‹- .
ConstructEvent
‹‹. <
(
‹‹< =
json
 
,
 
req
 
.
 
Headers
 
[
 
$str
 *
]
* +
,
+ ,
webhookSecret
 
)
 	
;
	 

if
‘‘ 

(
‘‘ 
stripeEvent
‘‘ 
.
‘‘ 
Type
‘‘ 
==
‘‘ 
$str
‘‘  <
)
‘‘< =
{
’’ 	
var
““ 
session
““ 
=
““ 
stripeEvent
““ %
.
““% &
Data
““& *
.
““* +
Object
““+ 1
as
““2 4
Stripe
““5 ;
.
““; <
Checkout
““< D
.
““D E
Session
““E L
;
““L M
if
”” 
(
”” 
session
”” 
!=
”” 
null
”” 
&&
””  "
session
””# *
.
””* +
Metadata
””+ 3
.
””3 4
TryGetValue
””4 ?
(
””? @
$str
””@ I
,
””I J
out
””K N
var
””O R

orderIdStr
””S ]
)
””] ^
&&
””_ a
Guid
””b f
.
””f g
TryParse
””g o
(
””o p

orderIdStr
””p z
,
””z {
out
””| 
var””€ ƒ
orderId””„ ‹
)””‹ 
)”” 
{
•• 
var
–– 
payment
–– 
=
–– 
await
–– #
db
––$ &
.
––& '
Payments
––' /
.
––/ 0!
FirstOrDefaultAsync
––0 C
(
––C D
p
––D E
=>
––F H
p
––I J
.
––J K
StripeSessionId
––K Z
==
––[ ]
session
––^ e
.
––e f
Id
––f h
)
––h i
;
––i j
var
—— 
order
—— 
=
—— 
await
—— !
db
——" $
.
——$ %
Orders
——% +
.
——+ ,!
FirstOrDefaultAsync
——, ?
(
——? @
o
——@ A
=>
——B D
o
——E F
.
——F G
Id
——G I
==
——J L
orderId
——M T
)
——T U
;
——U V
if
™™ 
(
™™ 
payment
™™ 
!=
™™ 
null
™™ #
&&
™™$ &
order
™™' ,
!=
™™- /
null
™™0 4
)
™™4 5
{
 
payment
›› 
.
›› 
Status
›› "
=
››# $
PaymentStatus
››% 2
.
››2 3
	Completed
››3 <
;
››< =
payment
 
.
 
PaidAt
 "
=
# $
DateTime
% -
.
- .
UtcNow
. 4
;
4 5
order
 
.
 
PaymentStatus
 '
=
( )
$str
* 0
;
0 1
await
 
db
 
.
 
SaveChangesAsync
 -
(
- .
)
. /
;
/ 0
Console
   
.
   
	WriteLine
   %
(
  % &
$"
  & (
$str
  ( F
{
  F G
orderId
  G N
}
  N O
"
  O P
)
  P Q
;
  Q R
}
΅΅ 
}
ΆΆ 
}
££ 	
else
¤¤ 
if
¤¤ 
(
¤¤ 
stripeEvent
¤¤ 
.
¤¤ 
Type
¤¤ !
==
¤¤" $
$str
¤¤% ?
)
¤¤? @
{
¥¥ 	
var
¦¦ 
session
¦¦ 
=
¦¦ 
stripeEvent
¦¦ %
.
¦¦% &
Data
¦¦& *
.
¦¦* +
Object
¦¦+ 1
as
¦¦2 4
Stripe
¦¦5 ;
.
¦¦; <
Checkout
¦¦< D
.
¦¦D E
Session
¦¦E L
;
¦¦L M
if
§§ 
(
§§ 
session
§§ 
!=
§§ 
null
§§ 
)
§§  
{
¨¨ 
var
©© 
payment
©© 
=
©© 
await
©© #
db
©©$ &
.
©©& '
Payments
©©' /
.
©©/ 0!
FirstOrDefaultAsync
©©0 C
(
©©C D
p
©©D E
=>
©©F H
p
©©I J
.
©©J K
StripeSessionId
©©K Z
==
©©[ ]
session
©©^ e
.
©©e f
Id
©©f h
)
©©h i
;
©©i j
if
 
(
 
payment
 
!=
 
null
 #
)
# $
{
«« 
payment
¬¬ 
.
¬¬ 
Status
¬¬ "
=
¬¬# $
PaymentStatus
¬¬% 2
.
¬¬2 3
Failed
¬¬3 9
;
¬¬9 :
payment
­­ 
.
­­ 
FailureReason
­­ )
=
­­* +
$str
­­, =
;
­­= >
payment
®® 
.
®® 
FailedAt
®® $
=
®®% &
DateTime
®®' /
.
®®/ 0
UtcNow
®®0 6
;
®®6 7
await
―― 
db
―― 
.
―― 
SaveChangesAsync
―― -
(
――- .
)
――. /
;
――/ 0
Console
±± 
.
±± 
	WriteLine
±± %
(
±±% &
$"
±±& (
$str
±±( F
{
±±F G
session
±±G N
.
±±N O
Id
±±O Q
}
±±Q R
"
±±R S
)
±±S T
;
±±T U
}
²² 
}
³³ 
}
΄΄ 	
return
¶¶ 
Results
¶¶ 
.
¶¶ 
Ok
¶¶ 
(
¶¶ 
)
¶¶ 
;
¶¶ 
}
·· 
catch
ΈΈ 	
(
ΈΈ
 
StripeException
ΈΈ 
ex
ΈΈ 
)
ΈΈ 
{
ΉΉ 
Console
ΊΊ 
.
ΊΊ 
	WriteLine
ΊΊ 
(
ΊΊ 
$"
ΊΊ 
$str
ΊΊ 4
{
ΊΊ4 5
ex
ΊΊ5 7
.
ΊΊ7 8
Message
ΊΊ8 ?
}
ΊΊ? @
"
ΊΊ@ A
)
ΊΊA B
;
ΊΊB C
return
»» 
Results
»» 
.
»» 

BadRequest
»» !
(
»»! "
new
»»" %
{
»»& '
error
»»( -
=
»». /
ex
»»0 2
.
»»2 3
Message
»»3 :
}
»»; <
)
»»< =
;
»»= >
}
ΌΌ 
}½½ 
)
½½ 
.ΎΎ 
AllowAnonymous
ΎΎ 
(
ΎΎ 
)
ΎΎ 
;
ΎΎ 
paymentsGroupΐΐ 
.
ΐΐ 
MapPatch
ΐΐ 
(
ΐΐ 
$str
ΐΐ 1
,
ΐΐ1 2
async
ΐΐ3 8
(
ΐΐ9 :
Guid
ΐΐ: >
	paymentId
ΐΐ? H
,
ΐΐH I
string
ΐΐJ P
?
ΐΐP Q
reason
ΐΐR X
,
ΐΐX Y
ClaimsPrincipal
ΐΐZ i
user
ΐΐj n
,
ΐΐn o
ISender
ΐΐp w
sender
ΐΐx ~
)
ΐΐ~ 
=>ΐΐ€ ‚
{
ΑΑ 
var
ΒΒ 
userRole
ΒΒ 
=
ΒΒ 
user
ΒΒ 
.
ΒΒ 
	FindFirst
ΒΒ %
(
ΒΒ% &

ClaimTypes
ΒΒ& 0
.
ΒΒ0 1
Role
ΒΒ1 5
)
ΒΒ5 6
?
ΒΒ6 7
.
ΒΒ7 8
Value
ΒΒ8 =
;
ΒΒ= >
if
ΓΓ 

(
ΓΓ 
userRole
ΓΓ 
!=
ΓΓ 
$str
ΓΓ 
&&
ΓΓ  "
userRole
ΓΓ# +
!=
ΓΓ, .
$str
ΓΓ/ 6
)
ΓΓ6 7
return
ΔΔ 
Results
ΔΔ 
.
ΔΔ 
Forbid
ΔΔ !
(
ΔΔ! "
)
ΔΔ" #
;
ΔΔ# $
var
ΖΖ 
result
ΖΖ 
=
ΖΖ 
await
ΖΖ 
sender
ΖΖ !
.
ΖΖ! "
Send
ΖΖ" &
(
ΖΖ& '
new
ΖΖ' *
RefundPayment
ΖΖ+ 8
.
ΖΖ8 9
Command
ΖΖ9 @
(
ΖΖ@ A
	paymentId
ΖΖA J
,
ΖΖJ K
reason
ΖΖL R
)
ΖΖR S
)
ΖΖS T
;
ΖΖT U
return
ΗΗ 
result
ΗΗ 
.
ΗΗ 
	IsSuccess
ΗΗ 
?
ΗΗ  !
Results
ΗΗ" )
.
ΗΗ) *
Ok
ΗΗ* ,
(
ΗΗ, -
result
ΗΗ- 3
.
ΗΗ3 4
Value
ΗΗ4 9
)
ΗΗ9 :
:
ΗΗ; <
Results
ΗΗ= D
.
ΗΗD E

BadRequest
ΗΗE O
(
ΗΗO P
new
ΗΗP S
{
ΗΗT U
errors
ΗΗV \
=
ΗΗ] ^
result
ΗΗ_ e
.
ΗΗe f
Errors
ΗΗf l
}
ΗΗm n
)
ΗΗn o
;
ΗΗo p
}
ΘΘ 
)
ΘΘ 
.
ΙΙ 
WithName
ΙΙ 
(
ΙΙ 
$str
ΙΙ 
)
ΙΙ 
.
ΚΚ "
RequireAuthorization
ΚΚ 
(
ΚΚ 
policy
ΚΚ  
=>
ΚΚ! #
policy
ΚΚ$ *
.
ΚΚ* +
RequireRole
ΚΚ+ 6
(
ΚΚ6 7
$str
ΚΚ7 >
,
ΚΚ> ?
$str
ΚΚ@ G
)
ΚΚG H
)
ΚΚH I
.
ΛΛ 
Produces
ΛΛ 
<
ΛΛ 

PaymentDto
ΛΛ 
>
ΛΛ 
(
ΛΛ 
StatusCodes
ΛΛ %
.
ΛΛ% &
Status200OK
ΛΛ& 1
)
ΛΛ1 2
.
ΜΜ 
Produces
ΜΜ 
<
ΜΜ 
object
ΜΜ 
>
ΜΜ 
(
ΜΜ 
StatusCodes
ΜΜ !
.
ΜΜ! "!
Status400BadRequest
ΜΜ" 5
)
ΜΜ5 6
.
ΝΝ 
Produces
ΝΝ 
(
ΝΝ 
StatusCodes
ΝΝ 
.
ΝΝ  
Status403Forbidden
ΝΝ ,
)
ΝΝ, -
;
ΝΝ- .
paymentsGroupΟΟ 
.
ΟΟ 
MapGet
ΟΟ 
(
ΟΟ 
$str
ΟΟ 
,
ΟΟ 
async
ΟΟ 
(
ΟΟ  !
int
ΟΟ! $
page
ΟΟ% )
,
ΟΟ) *
int
ΟΟ+ .
pageSize
ΟΟ/ 7
,
ΟΟ7 8
string
ΟΟ9 ?
?
ΟΟ? @
status
ΟΟA G
,
ΟΟG H
string
ΟΟI O
?
ΟΟO P
method
ΟΟQ W
,
ΟΟW X
ISender
ΟΟY `
sender
ΟΟa g
,
ΟΟg h
ClaimsPrincipal
ΟΟi x
user
ΟΟy }
)
ΟΟ} ~
=>ΟΟ 
{
ΠΠ 
var
ΡΡ 
userRole
ΡΡ 
=
ΡΡ 
user
ΡΡ 
.
ΡΡ 
	FindFirst
ΡΡ %
(
ΡΡ% &
System
ΡΡ& ,
.
ΡΡ, -
Security
ΡΡ- 5
.
ΡΡ5 6
Claims
ΡΡ6 <
.
ΡΡ< =

ClaimTypes
ΡΡ= G
.
ΡΡG H
Role
ΡΡH L
)
ΡΡL M
?
ΡΡM N
.
ΡΡN O
Value
ΡΡO T
;
ΡΡT U
if
 

(
 
userRole
 
!=
 
$str
 
&&
  "
userRole
# +
!=
, .
$str
/ 6
)
6 7
return
ΣΣ 
Results
ΣΣ 
.
ΣΣ 
Forbid
ΣΣ !
(
ΣΣ! "
)
ΣΣ" #
;
ΣΣ# $
var
ΥΥ 
result
ΥΥ 
=
ΥΥ 
await
ΥΥ 
sender
ΥΥ !
.
ΥΥ! "
Send
ΥΥ" &
(
ΥΥ& '
new
ΥΥ' *
GetAllPayments
ΥΥ+ 9
.
ΥΥ9 :
Query
ΥΥ: ?
(
ΥΥ? @
page
ΥΥ@ D
,
ΥΥD E
pageSize
ΥΥF N
,
ΥΥN O
status
ΥΥP V
,
ΥΥV W
method
ΥΥX ^
)
ΥΥ^ _
)
ΥΥ_ `
;
ΥΥ` a
return
ΦΦ 
result
ΦΦ 
.
ΦΦ 
	IsSuccess
ΦΦ 
?
ΧΧ 
Results
ΧΧ 
.
ΧΧ 
Ok
ΧΧ 
(
ΧΧ 
result
ΧΧ 
.
ΧΧ  
Value
ΧΧ  %
)
ΧΧ% &
:
ΨΨ 
Results
ΨΨ 
.
ΨΨ 

BadRequest
ΨΨ  
(
ΨΨ  !
new
ΨΨ! $
{
ΨΨ% &
errors
ΨΨ' -
=
ΨΨ. /
result
ΨΨ0 6
.
ΨΨ6 7
Errors
ΨΨ7 =
}
ΨΨ> ?
)
ΨΨ? @
;
ΨΨ@ A
}
ΩΩ 
)
ΩΩ 
.
ΪΪ 
WithName
ΪΪ 
(
ΪΪ 
$str
ΪΪ 
)
ΪΪ 
.
ΫΫ "
RequireAuthorization
ΫΫ 
(
ΫΫ 
policy
ΫΫ  
=>
ΫΫ! #
policy
ΫΫ$ *
.
ΫΫ* +
RequireRole
ΫΫ+ 6
(
ΫΫ6 7
$str
ΫΫ7 >
,
ΫΫ> ?
$str
ΫΫ@ G
)
ΫΫG H
)
ΫΫH I
.
άά 
Produces
άά 
<
άά 
PagedResult
άά 
<
άά 

PaymentDto
άά $
>
άά$ %
>
άά% &
(
άά& '
StatusCodes
άά' 2
.
άά2 3
Status200OK
άά3 >
)
άά> ?
.
έέ 
Produces
έέ 
(
έέ 
StatusCodes
έέ 
.
έέ  
Status403Forbidden
έέ ,
)
έέ, -
;
έέ- .
varΰΰ 
loyaltyGroup
ΰΰ 
=
ΰΰ 
app
ΰΰ 
.
ΰΰ 
MapGroup
ΰΰ 
(
ΰΰ  
$str
ΰΰ  -
)
ΰΰ- .
.
ΰΰ. /
WithTags
ΰΰ/ 7
(
ΰΰ7 8
$str
ΰΰ8 A
)
ΰΰA B
;
ΰΰB C
loyaltyGroupββ 
.
ββ 
MapGet
ββ 
(
ββ 
$str
ββ 
,
ββ 
async
ββ $
(
ββ% &
ClaimsPrincipal
ββ& 5
user
ββ6 :
,
ββ: ;
ISender
ββ< C
sender
ββD J
)
ββJ K
=>
ββL N
{γγ 
var
δδ 
userIdClaim
δδ 
=
δδ 
user
δδ 
.
δδ 
	FindFirst
δδ $
(
δδ$ %

ClaimTypes
δδ% /
.
δδ/ 0
NameIdentifier
δδ0 >
)
δδ> ?
?
δδ? @
.
δδ@ A
Value
δδA F
??
δδG I
user
δδJ N
.
δδN O
	FindFirst
δδO X
(
δδX Y
$str
δδY ^
)
δδ^ _
?
δδ_ `
.
δδ` a
Value
δδa f
;
δδf g
if
εε 
(
εε 
string
εε 
.
εε 
IsNullOrEmpty
εε 
(
εε 
userIdClaim
εε (
)
εε( )
||
εε* ,
!
εε- .
Guid
εε. 2
.
εε2 3
TryParse
εε3 ;
(
εε; <
userIdClaim
εε< G
,
εεG H
out
εεI L
var
εεM P
userId
εεQ W
)
εεW X
)
εεX Y
return
ζζ 
Results
ζζ 
.
ζζ 
Unauthorized
ζζ #
(
ζζ# $
)
ζζ$ %
;
ζζ% &
var
θθ 
result
θθ 
=
θθ 
await
θθ 
sender
θθ 
.
θθ 
Send
θθ "
(
θθ" #
new
θθ# &
GetLoyaltyPoints
θθ' 7
.
θθ7 8
Query
θθ8 =
(
θθ= >
userId
θθ> D
)
θθD E
)
θθE F
;
θθF G
return
ιι 

result
ιι 
.
ιι 
	IsSuccess
ιι 
?
ιι 
Results
ιι %
.
ιι% &
Ok
ιι& (
(
ιι( )
result
ιι) /
.
ιι/ 0
Value
ιι0 5
)
ιι5 6
:
ιι7 8
Results
ιι9 @
.
ιι@ A

BadRequest
ιιA K
(
ιιK L
new
ιιL O
{
ιιP Q
errors
ιιR X
=
ιιY Z
result
ιι[ a
.
ιιa b
Errors
ιιb h
}
ιιi j
)
ιιj k
;
ιιk l
}κκ 
)
κκ 
.λλ 
WithName
λλ 	
(
λλ	 

$str
λλ
 
)
λλ 
.μμ "
RequireAuthorization
μμ 
(
μμ 
)
μμ 
.νν 
Produces
νν 	
<
νν	 

LoyaltyPointsDto
νν
 
>
νν 
(
νν 
StatusCodes
νν '
.
νν' (
Status200OK
νν( 3
)
νν3 4
.ξξ 
Produces
ξξ 	
(
ξξ	 

StatusCodes
ξξ
 
.
ξξ #
Status401Unauthorized
ξξ +
)
ξξ+ ,
.οο 
Produces
οο 	
<
οο	 

object
οο
 
>
οο 
(
οο 
StatusCodes
οο 
.
οο !
Status400BadRequest
οο 1
)
οο1 2
;
οο2 3
loyaltyGroupρρ 
.
ρρ 
MapGet
ρρ 
(
ρρ 
$str
ρρ #
,
ρρ# $
async
ρρ% *
(
ρρ+ ,
ClaimsPrincipal
ρρ, ;
user
ρρ< @
,
ρρ@ A
int
ρρB E
page
ρρF J
,
ρρJ K
int
ρρL O
pageSize
ρρP X
,
ρρX Y
ISender
ρρZ a
sender
ρρb h
)
ρρh i
=>
ρρj l
{ςς 
var
σσ 
userIdClaim
σσ 
=
σσ 
user
σσ 
.
σσ 
	FindFirst
σσ $
(
σσ$ %

ClaimTypes
σσ% /
.
σσ/ 0
NameIdentifier
σσ0 >
)
σσ> ?
?
σσ? @
.
σσ@ A
Value
σσA F
??
σσG I
user
σσJ N
.
σσN O
	FindFirst
σσO X
(
σσX Y
$str
σσY ^
)
σσ^ _
?
σσ_ `
.
σσ` a
Value
σσa f
;
σσf g
if
ττ 
(
ττ 
string
ττ 
.
ττ 
IsNullOrEmpty
ττ 
(
ττ 
userIdClaim
ττ (
)
ττ( )
||
ττ* ,
!
ττ- .
Guid
ττ. 2
.
ττ2 3
TryParse
ττ3 ;
(
ττ; <
userIdClaim
ττ< G
,
ττG H
out
ττI L
var
ττM P
userId
ττQ W
)
ττW X
)
ττX Y
return
υυ 
Results
υυ 
.
υυ 
Unauthorized
υυ #
(
υυ# $
)
υυ$ %
;
υυ% &
var
χχ 
result
χχ 
=
χχ 
await
χχ 
sender
χχ 
.
χχ 
Send
χχ "
(
χχ" #
new
χχ# &$
GetLoyaltyTransactions
χχ' =
.
χχ= >
Query
χχ> C
(
χχC D
userId
χχD J
,
χχJ K
page
χχL P
,
χχP Q
pageSize
χχR Z
)
χχZ [
)
χχ[ \
;
χχ\ ]
return
ψψ 

result
ψψ 
.
ψψ 
	IsSuccess
ψψ 
?
ψψ 
Results
ψψ %
.
ψψ% &
Ok
ψψ& (
(
ψψ( )
result
ψψ) /
.
ψψ/ 0
Value
ψψ0 5
)
ψψ5 6
:
ψψ7 8
Results
ψψ9 @
.
ψψ@ A

BadRequest
ψψA K
(
ψψK L
new
ψψL O
{
ψψP Q
errors
ψψR X
=
ψψY Z
result
ψψ[ a
.
ψψa b
Errors
ψψb h
}
ψψi j
)
ψψj k
;
ψψk l
}ωω 
)
ωω 
.ϊϊ 
WithName
ϊϊ 	
(
ϊϊ	 

$str
ϊϊ
 "
)
ϊϊ" #
.ϋϋ "
RequireAuthorization
ϋϋ 
(
ϋϋ 
)
ϋϋ 
.όό 
Produces
όό 	
<
όό	 

List
όό
 
<
όό #
LoyaltyTransactionDto
όό $
>
όό$ %
>
όό% &
(
όό& '
StatusCodes
όό' 2
.
όό2 3
Status200OK
όό3 >
)
όό> ?
.ύύ 
Produces
ύύ 	
(
ύύ	 

StatusCodes
ύύ
 
.
ύύ #
Status401Unauthorized
ύύ +
)
ύύ+ ,
.ώώ 
Produces
ώώ 	
<
ώώ	 

object
ώώ
 
>
ώώ 
(
ώώ 
StatusCodes
ώώ 
.
ώώ !
Status400BadRequest
ώώ 1
)
ώώ1 2
;
ώώ2 3
loyaltyGroup€€ 
.
€€ 
MapPost
€€ 
(
€€ 
$str
€€ 
,
€€ 
async
€€  %
(
€€& '!
RedeemLoyaltyPoints
€€' :
.
€€: ;
Command
€€; B
command
€€C J
,
€€J K
ClaimsPrincipal
€€L [
user
€€\ `
,
€€` a
ISender
€€b i
sender
€€j p
)
€€p q
=>
€€r t
{ 
var
‚‚ 
userIdClaim
‚‚ 
=
‚‚ 
user
‚‚ 
.
‚‚ 
	FindFirst
‚‚ $
(
‚‚$ %

ClaimTypes
‚‚% /
.
‚‚/ 0
NameIdentifier
‚‚0 >
)
‚‚> ?
?
‚‚? @
.
‚‚@ A
Value
‚‚A F
??
‚‚G I
user
‚‚J N
.
‚‚N O
	FindFirst
‚‚O X
(
‚‚X Y
$str
‚‚Y ^
)
‚‚^ _
?
‚‚_ `
.
‚‚` a
Value
‚‚a f
;
‚‚f g
if
ƒƒ 
(
ƒƒ 
string
ƒƒ 
.
ƒƒ 
IsNullOrEmpty
ƒƒ 
(
ƒƒ 
userIdClaim
ƒƒ (
)
ƒƒ( )
||
ƒƒ* ,
!
ƒƒ- .
Guid
ƒƒ. 2
.
ƒƒ2 3
TryParse
ƒƒ3 ;
(
ƒƒ; <
userIdClaim
ƒƒ< G
,
ƒƒG H
out
ƒƒI L
var
ƒƒM P!
authenticatedUserId
ƒƒQ d
)
ƒƒd e
)
ƒƒe f
return
„„ 
Results
„„ 
.
„„ 
Unauthorized
„„ #
(
„„# $
)
„„$ %
;
„„% &
if
†† 
(
†† 
command
†† 
.
†† 
UserId
†† 
!=
†† !
authenticatedUserId
†† -
)
††- .
return
‡‡ 
Results
‡‡ 
.
‡‡ 
Forbid
‡‡ 
(
‡‡ 
)
‡‡ 
;
‡‡  
var
‰‰ 
result
‰‰ 
=
‰‰ 
await
‰‰ 
sender
‰‰ 
.
‰‰ 
Send
‰‰ "
(
‰‰" #
command
‰‰# *
)
‰‰* +
;
‰‰+ ,
return
 

result
 
.
 
	IsSuccess
 
?
 
Results
 %
.
% &
Ok
& (
(
( )
result
) /
.
/ 0
Value
0 5
)
5 6
:
7 8
Results
9 @
.
@ A

BadRequest
A K
(
K L
new
L O
{
P Q
errors
R X
=
Y Z
result
[ a
.
a b
Errors
b h
}
i j
)
j k
;
k l
}‹‹ 
)
‹‹ 
. 
WithName
 	
(
	 

$str

 
)
  
. "
RequireAuthorization
 
(
 
)
 
. 
Produces
 	
<
	 
#
RedeemPointsResultDto

 
>
  
(
  !
StatusCodes
! ,
.
, -
Status200OK
- 8
)
8 9
. 
Produces
 	
(
	 

StatusCodes

 
.
 #
Status401Unauthorized
 +
)
+ ,
. 
Produces
 	
(
	 

StatusCodes

 
.
  
Status403Forbidden
 (
)
( )
.‘‘ 
Produces
‘‘ 	
<
‘‘	 

object
‘‘
 
>
‘‘ 
(
‘‘ 
StatusCodes
‘‘ 
.
‘‘ !
Status400BadRequest
‘‘ 1
)
‘‘1 2
;
‘‘2 3
loyaltyGroup““ 
.
““ 
MapPost
““ 
(
““ 
$str
““ 
,
““ 
async
““ $
(
““% & 
AwardLoyaltyPoints
““& 8
.
““8 9
Command
““9 @
command
““A H
,
““H I
ClaimsPrincipal
““J Y
user
““Z ^
,
““^ _
ISender
““` g
sender
““h n
)
““n o
=>
““p r
{”” 
var
•• 
userRole
•• 
=
•• 
user
•• 
.
•• 
	FindFirst
•• !
(
••! "

ClaimTypes
••" ,
.
••, -
Role
••- 1
)
••1 2
?
••2 3
.
••3 4
Value
••4 9
;
••9 :
if
–– 
(
–– 
userRole
–– 
!=
–– 
$str
–– 
&&
–– 
userRole
–– '
!=
––( *
$str
––+ 2
)
––2 3
return
—— 
Results
—— 
.
—— 
Forbid
—— 
(
—— 
)
—— 
;
——  
var
™™ 
result
™™ 
=
™™ 
await
™™ 
sender
™™ 
.
™™ 
Send
™™ "
(
™™" #
command
™™# *
)
™™* +
;
™™+ ,
return
 

result
 
.
 
	IsSuccess
 
?
 
Results
 %
.
% &
Ok
& (
(
( )
new
) ,
{
- .
message
/ 6
=
7 8
$str
9 V
}
W X
)
X Y
:
Z [
Results
\ c
.
c d

BadRequest
d n
(
n o
new
o r
{
s t
errors
u {
=
| }
result~ „
.„ …
Errors… ‹
} 
) 
; 
}›› 
)
›› 
. 
WithName
 	
(
	 

$str

 
)
 
. "
RequireAuthorization
 
(
 
policy
 
=>
 
policy
  &
.
& '
RequireRole
' 2
(
2 3
$str
3 :
,
: ;
$str
< C
)
C D
)
D E
. 
Produces
 	
<
	 

object

 
>
 
(
 
StatusCodes
 
.
 
Status200OK
 )
)
) *
. 
Produces
 	
(
	 

StatusCodes

 
.
  
Status403Forbidden
 (
)
( )
.   
Produces
   	
<
  	 

object
  
 
>
   
(
   
StatusCodes
   
.
   !
Status400BadRequest
   1
)
  1 2
;
  2 3
appΆΆ 
.
ΆΆ 
Run
ΆΆ 
(
ΆΆ 
)
ΆΆ 	
;
ΆΆ	 
” 
WC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Persistence\AppDbContext.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Persistence (
;( )
public 
class 
AppDbContext 
( 
DbContextOptions *
<* +
AppDbContext+ 7
>7 8
options9 @
)@ A
:B C
	DbContextD M
(M N
optionsN U
)U V
{ 
public 

DbSet 
< 
User 
> 
Users 
{ 
get "
;" #
set$ '
;' (
}) *
public		 

DbSet		 
<		 
Product		 
>		 
Products		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
public

 

DbSet

 
<

 
Order

 
>

 
Orders

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
public 

DbSet 
< 
	OrderItem 
> 

OrderItems &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 

DbSet 
< 
Payment 
> 
Payments "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

DbSet 
< 
LoyaltyTransaction #
># $
LoyaltyTransactions% 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
	protected 
override 
void 
OnModelCreating +
(+ ,
ModelBuilder, 8
modelBuilder9 E
)E F
{ 
base 
. 
OnModelCreating 
( 
modelBuilder )
)) *
;* +
modelBuilder 
. 
Entity 
< 
User  
>  !
(! "
entity" (
=>) +
{ 	
entity 
. 
HasKey 
( 
u 
=> 
u  
.  !
Id! #
)# $
;$ %
entity 
. 
Property 
( 
u 
=>  
u! "
." #
Email# (
)( )
. 

IsRequired 
( 
) 
. 
HasMaxLength 
( 
$num !
)! "
;" #
entity 
. 
HasIndex 
( 
u 
=>  
u! "
." #
Email# (
)( )
. 
IsUnique 
( 
) 
; 
entity 
. 
Property 
( 
u 
=>  
u! "
." #
FullName# +
)+ ,
.   

IsRequired   
(   
)   
.!! 
HasMaxLength!! 
(!! 
$num!! !
)!!! "
;!!" #
entity## 
.## 
Property## 
(## 
u## 
=>##  
u##! "
.##" #
PhoneNumber### .
)##. /
.$$ 

IsRequired$$ 
($$ 
)$$ 
.%% 
HasMaxLength%% 
(%% 
$num%%  
)%%  !
;%%! "
entity'' 
.'' 
Property'' 
('' 
u'' 
=>''  
u''! "
.''" #
	StudentId''# ,
)'', -
.(( 
HasMaxLength(( 
((( 
$num((  
)((  !
;((! "
entity** 
.** 
Property** 
(** 
u** 
=>**  
u**! "
.**" #
LoyaltyPoints**# 0
)**0 1
.++ 
HasDefaultValue++  
(++  !
$num++! "
)++" #
;++# $
entity.. 
... 
Property.. 
(.. 
u.. 
=>..  
u..! "
..." #
	CreatedAt..# ,
).., -
.// 
HasDefaultValueSql// #
(//# $
$str//$ +
)//+ ,
;//, -
}00 	
)00	 

;00
 
modelBuilder33 
.33 
Entity33 
<33 
Product33 #
>33# $
(33$ %
entity33% +
=>33, .
{44 	
entity55 
.55 
HasKey55 
(55 
p55 
=>55 
p55  
.55  !
Id55! #
)55# $
;55$ %
entity77 
.77 
Property77 
(77 
p77 
=>77  
p77! "
.77" #
Name77# '
)77' (
.88 

IsRequired88 
(88 
)88 
.99 
HasMaxLength99 
(99 
$num99 !
)99! "
;99" #
entity;; 
.;; 
Property;; 
(;; 
p;; 
=>;;  
p;;! "
.;;" #
Description;;# .
);;. /
.<< 
HasMaxLength<< 
(<< 
$num<< !
)<<! "
;<<" #
entity>> 
.>> 
Property>> 
(>> 
p>> 
=>>>  
p>>! "
.>>" #
Price>># (
)>>( )
.?? 
HasColumnType?? 
(?? 
$str?? .
)??. /
.@@ 

IsRequired@@ 
(@@ 
)@@ 
;@@ 
entityBB 
.BB 
PropertyBB 
(BB 
pBB 
=>BB  
pBB! "
.BB" #
CategoryBB# +
)BB+ ,
.CC 

IsRequiredCC 
(CC 
)CC 
.DD 
HasMaxLengthDD 
(DD 
$numDD  
)DD  !
;DD! "
entityFF 
.FF 
PropertyFF 
(FF 
pFF 
=>FF  
pFF! "
.FF" #
ImageUrlFF# +
)FF+ ,
.GG 
HasMaxLengthGG 
(GG 
$numGG !
)GG! "
;GG" #
entityII 
.II 
PropertyII 
(II 
pII 
=>II  
pII! "
.II" #
DietaryRestrictionsII# 6
)II6 7
.JJ 
HasMaxLengthJJ 
(JJ 
$numJJ !
)JJ! "
;JJ" #
entityLL 
.LL 
PropertyLL 
(LL 
pLL 
=>LL  
pLL! "
.LL" #
IsAvailableLL# .
)LL. /
.MM 
HasDefaultValueMM  
(MM  !
trueMM! %
)MM% &
;MM& '
entityOO 
.OO 
PropertyOO 
(OO 
pOO 
=>OO  
pOO! "
.OO" #
	AllergensOO# ,
)OO, -
.PP 
HasColumnTypePP 
(PP 
$strPP &
)PP& '
.QQ 
HasDefaultValueSqlQQ #
(QQ# $
$strQQ$ 1
)QQ1 2
;QQ2 3
entitySS 
.SS 
PropertySS 
(SS 
pSS 
=>SS  
pSS! "
.SS" #
	CreatedAtSS# ,
)SS, -
.TT 
HasDefaultValueSqlTT #
(TT# $
$strTT$ +
)TT+ ,
;TT, -
entityVV 
.VV 
HasIndexVV 
(VV 
pVV 
=>VV  
pVV! "
.VV" #
CategoryVV# +
)VV+ ,
;VV, -
entityWW 
.WW 
HasIndexWW 
(WW 
pWW 
=>WW  
pWW! "
.WW" #
IsAvailableWW# .
)WW. /
;WW/ 0
}XX 	
)XX	 

;XX
 
modelBuilder[[ 
.[[ 
Entity[[ 
<[[ 
Order[[ !
>[[! "
([[" #
entity[[# )
=>[[* ,
{\\ 	
entity]] 
.]] 
HasKey]] 
(]] 
o]] 
=>]] 
o]]  
.]]  !
Id]]! #
)]]# $
;]]$ %
entity__ 
.__ 
Property__ 
(__ 
o__ 
=>__  
o__! "
.__" #
OrderNumber__# .
)__. /
.`` 

IsRequired`` 
(`` 
)`` 
.aa 
HasMaxLengthaa 
(aa 
$numaa  
)aa  !
;aa! "
entitycc 
.cc 
HasIndexcc 
(cc 
occ 
=>cc  
occ! "
.cc" #
OrderNumbercc# .
)cc. /
.dd 
IsUniquedd 
(dd 
)dd 
;dd 
entityff 
.ff 
Propertyff 
(ff 
off 
=>ff  
off! "
.ff" #
Statusff# )
)ff) *
.gg 

IsRequiredgg 
(gg 
)gg 
.hh 
HasMaxLengthhh 
(hh 
$numhh  
)hh  !
;hh! "
entityjj 
.jj 
Propertyjj 
(jj 
ojj 
=>jj  
ojj! "
.jj" #
PaymentStatusjj# 0
)jj0 1
.kk 

IsRequiredkk 
(kk 
)kk 
.ll 
HasMaxLengthll 
(ll 
$numll  
)ll  !
;ll! "
entitynn 
.nn 
Propertynn 
(nn 
onn 
=>nn  
onn! "
.nn" #
PaymentMethodnn# 0
)nn0 1
.oo 
HasMaxLengthoo 
(oo 
$numoo  
)oo  !
;oo! "
entityqq 
.qq 
Propertyqq 
(qq 
oqq 
=>qq  
oqq! "
.qq" #
Notesqq# (
)qq( )
.rr 
HasMaxLengthrr 
(rr 
$numrr !
)rr! "
;rr" #
entitytt 
.tt 
Propertytt 
(tt 
ott 
=>tt  
ott! "
.tt" #
TotalAmounttt# .
)tt. /
.uu 
HasColumnTypeuu 
(uu 
$struu .
)uu. /
;uu/ 0
entityww 
.ww 
HasOneww 
(ww 
oww 
=>ww 
oww  
.ww  !
Userww! %
)ww% &
.xx 
WithManyxx 
(xx 
)xx 
.yy 
HasForeignKeyyy 
(yy 
oyy  
=>yy! #
oyy$ %
.yy% &
UserIdyy& ,
)yy, -
.zz 
OnDeletezz 
(zz 
DeleteBehaviorzz (
.zz( )
Restrictzz) 1
)zz1 2
;zz2 3
entity|| 
.|| 
HasMany|| 
(|| 
o|| 
=>|| 
o||  !
.||! "

OrderItems||" ,
)||, -
.}} 
WithOne}} 
(}} 
oi}} 
=>}} 
oi}} !
.}}! "
Order}}" '
)}}' (
.~~ 
HasForeignKey~~ 
(~~ 
oi~~ !
=>~~" $
oi~~% '
.~~' (
OrderId~~( /
)~~/ 0
. 
OnDelete 
( 
DeleteBehavior (
.( )
Cascade) 0
)0 1
;1 2
}
€€ 	
)
€€	 

;
€€
 
modelBuilder
ƒƒ 
.
ƒƒ 
Entity
ƒƒ 
<
ƒƒ 
	OrderItem
ƒƒ %
>
ƒƒ% &
(
ƒƒ& '
entity
ƒƒ' -
=>
ƒƒ. 0
{
„„ 	
entity
…… 
.
…… 
HasKey
…… 
(
…… 
oi
…… 
=>
…… 
oi
……  "
.
……" #
Id
……# %
)
……% &
;
……& '
entity
‡‡ 
.
‡‡ 
Property
‡‡ 
(
‡‡ 
oi
‡‡ 
=>
‡‡ !
oi
‡‡" $
.
‡‡$ %
Quantity
‡‡% -
)
‡‡- .
.
 

IsRequired
 
(
 
)
 
;
 
entity
 
.
 
Property
 
(
 
oi
 
=>
 !
oi
" $
.
$ %
	UnitPrice
% .
)
. /
.
‹‹ 
HasColumnType
‹‹ 
(
‹‹ 
$str
‹‹ .
)
‹‹. /
;
‹‹/ 0
entity
 
.
 
Property
 
(
 
oi
 
=>
 !
oi
" $
.
$ %
Subtotal
% -
)
- .
.
 
HasColumnType
 
(
 
$str
 .
)
. /
;
/ 0
entity
 
.
 
Property
 
(
 
oi
 
=>
 !
oi
" $
.
$ %!
SpecialInstructions
% 8
)
8 9
.
‘‘ 
HasMaxLength
‘‘ 
(
‘‘ 
$num
‘‘ !
)
‘‘! "
;
‘‘" #
entity
““ 
.
““ 
HasOne
““ 
(
““ 
oi
““ 
=>
““ 
oi
““  "
.
““" #
Product
““# *
)
““* +
.
”” 
WithMany
”” 
(
”” 
)
”” 
.
•• 
HasForeignKey
•• 
(
•• 
oi
•• !
=>
••" $
oi
••% '
.
••' (
	ProductId
••( 1
)
••1 2
.
–– 
OnDelete
–– 
(
–– 
DeleteBehavior
–– (
.
––( )
Restrict
––) 1
)
––1 2
;
––2 3
}
—— 	
)
——	 

;
——
 
modelBuilder
 
.
 
Entity
 
<
 
Payment
 #
>
# $
(
$ %
entity
% +
=>
, .
{
›› 	
entity
 
.
 
HasKey
 
(
 
p
 
=>
 
p
  
.
  !
Id
! #
)
# $
;
$ %
entity
 
.
 
Property
 
(
 
p
 
=>
  
p
! "
.
" #
Amount
# )
)
) *
.
 
HasColumnType
 
(
 
$str
 .
)
. /
.
   

IsRequired
   
(
   
)
   
;
   
entity
ΆΆ 
.
ΆΆ 
Property
ΆΆ 
(
ΆΆ 
p
ΆΆ 
=>
ΆΆ  
p
ΆΆ! "
.
ΆΆ" #
Status
ΆΆ# )
)
ΆΆ) *
.
££ 

IsRequired
££ 
(
££ 
)
££ 
.
¤¤ 
HasConversion
¤¤ 
<
¤¤ 
string
¤¤ %
>
¤¤% &
(
¤¤& '
)
¤¤' (
;
¤¤( )
entity
¦¦ 
.
¦¦ 
Property
¦¦ 
(
¦¦ 
p
¦¦ 
=>
¦¦  
p
¦¦! "
.
¦¦" #
Method
¦¦# )
)
¦¦) *
.
§§ 

IsRequired
§§ 
(
§§ 
)
§§ 
.
¨¨ 
HasConversion
¨¨ 
<
¨¨ 
string
¨¨ %
>
¨¨% &
(
¨¨& '
)
¨¨' (
;
¨¨( )
entity
 
.
 
Property
 
(
 
p
 
=>
  
p
! "
.
" ##
StripePaymentIntentId
# 8
)
8 9
.
«« 
HasMaxLength
«« 
(
«« 
$num
«« !
)
««! "
;
««" #
entity
­­ 
.
­­ 
Property
­­ 
(
­­ 
p
­­ 
=>
­­  
p
­­! "
.
­­" #
StripeSessionId
­­# 2
)
­­2 3
.
®® 
HasMaxLength
®® 
(
®® 
$num
®® !
)
®®! "
;
®®" #
entity
°° 
.
°° 
Property
°° 
(
°° 
p
°° 
=>
°°  
p
°°! "
.
°°" #
FailureReason
°°# 0
)
°°0 1
.
±± 
HasMaxLength
±± 
(
±± 
$num
±± !
)
±±! "
;
±±" #
entity
΄΄ 
.
΄΄ 
Property
΄΄ 
(
΄΄ 
p
΄΄ 
=>
΄΄  
p
΄΄! "
.
΄΄" #
	CreatedAt
΄΄# ,
)
΄΄, -
.
µµ  
HasDefaultValueSql
µµ #
(
µµ# $
$str
µµ$ +
)
µµ+ ,
;
µµ, -
entity
·· 
.
·· 
HasIndex
·· 
(
·· 
p
·· 
=>
··  
p
··! "
.
··" #
Status
··# )
)
··) *
;
··* +
entity
ΈΈ 
.
ΈΈ 
HasIndex
ΈΈ 
(
ΈΈ 
p
ΈΈ 
=>
ΈΈ  
p
ΈΈ! "
.
ΈΈ" ##
StripePaymentIntentId
ΈΈ# 8
)
ΈΈ8 9
;
ΈΈ9 :
}
ΉΉ 	
)
ΉΉ	 

;
ΉΉ
 
modelBuilder
ΌΌ 
.
ΌΌ 
Entity
ΌΌ 
<
ΌΌ  
LoyaltyTransaction
ΌΌ .
>
ΌΌ. /
(
ΌΌ/ 0
entity
ΌΌ0 6
=>
ΌΌ7 9
{
½½ 	
entity
ΎΎ 
.
ΎΎ 
HasKey
ΎΎ 
(
ΎΎ 
lt
ΎΎ 
=>
ΎΎ 
lt
ΎΎ  "
.
ΎΎ" #
Id
ΎΎ# %
)
ΎΎ% &
;
ΎΎ& '
entity
ΐΐ 
.
ΐΐ 
Property
ΐΐ 
(
ΐΐ 
lt
ΐΐ 
=>
ΐΐ !
lt
ΐΐ" $
.
ΐΐ$ %
PointsChange
ΐΐ% 1
)
ΐΐ1 2
.
ΑΑ 

IsRequired
ΑΑ 
(
ΑΑ 
)
ΑΑ 
;
ΑΑ 
entity
ΓΓ 
.
ΓΓ 
Property
ΓΓ 
(
ΓΓ 
lt
ΓΓ 
=>
ΓΓ !
lt
ΓΓ" $
.
ΓΓ$ %
Type
ΓΓ% )
)
ΓΓ) *
.
ΔΔ 

IsRequired
ΔΔ 
(
ΔΔ 
)
ΔΔ 
.
ΕΕ 
HasConversion
ΕΕ 
<
ΕΕ 
string
ΕΕ %
>
ΕΕ% &
(
ΕΕ& '
)
ΕΕ' (
;
ΕΕ( )
entity
ΗΗ 
.
ΗΗ 
Property
ΗΗ 
(
ΗΗ 
lt
ΗΗ 
=>
ΗΗ !
lt
ΗΗ" $
.
ΗΗ$ %
Description
ΗΗ% 0
)
ΗΗ0 1
.
ΘΘ 

IsRequired
ΘΘ 
(
ΘΘ 
)
ΘΘ 
.
ΙΙ 
HasMaxLength
ΙΙ 
(
ΙΙ 
$num
ΙΙ !
)
ΙΙ! "
;
ΙΙ" #
entity
ΜΜ 
.
ΜΜ 
Property
ΜΜ 
(
ΜΜ 
lt
ΜΜ 
=>
ΜΜ !
lt
ΜΜ" $
.
ΜΜ$ %
	CreatedAt
ΜΜ% .
)
ΜΜ. /
.
ΝΝ  
HasDefaultValueSql
ΝΝ #
(
ΝΝ# $
$str
ΝΝ$ +
)
ΝΝ+ ,
;
ΝΝ, -
entity
ΟΟ 
.
ΟΟ 
HasOne
ΟΟ 
(
ΟΟ 
lt
ΟΟ 
=>
ΟΟ 
lt
ΟΟ  "
.
ΟΟ" #
User
ΟΟ# '
)
ΟΟ' (
.
ΠΠ 
WithMany
ΠΠ 
(
ΠΠ 
u
ΠΠ 
=>
ΠΠ 
u
ΠΠ  
.
ΠΠ  !!
LoyaltyTransactions
ΠΠ! 4
)
ΠΠ4 5
.
ΡΡ 
HasForeignKey
ΡΡ 
(
ΡΡ 
lt
ΡΡ !
=>
ΡΡ" $
lt
ΡΡ% '
.
ΡΡ' (
UserId
ΡΡ( .
)
ΡΡ. /
.
 
OnDelete
 
(
 
DeleteBehavior
 (
.
( )
Restrict
) 1
)
1 2
;
2 3
entity
ΪΪ 
.
ΪΪ 
HasIndex
ΪΪ 
(
ΪΪ 
lt
ΪΪ 
=>
ΪΪ !
lt
ΪΪ" $
.
ΪΪ$ %
UserId
ΪΪ% +
)
ΪΪ+ ,
;
ΪΪ, -
entity
ΫΫ 
.
ΫΫ 
HasIndex
ΫΫ 
(
ΫΫ 
lt
ΫΫ 
=>
ΫΫ !
lt
ΫΫ" $
.
ΫΫ$ %
	CreatedAt
ΫΫ% .
)
ΫΫ. /
;
ΫΫ/ 0
}
άά 	
)
άά	 

;
άά
 
}
έέ 
}ήή Η&
oC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Migrations\20251210143339_UpdateLoyaltyToDecimal.cs
	namespace 	

CampusEats
 
. 
Backend 
. 

Migrations '
{ 
public 

partial 
class "
UpdateLoyaltyToDecimal /
:0 1
	Migration2 ;
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
AlterColumn (
<( )
decimal) 0
>0 1
(1 2
name 
: 
$str %
,% &
table 
: 
$str 
, 
type 
: 
$str 
,  
nullable 
: 
false 
,  
defaultValue 
: 
$num  
,  !

oldClrType 
: 
typeof "
(" #
int# &
)& '
,' (
oldType 
: 
$str "
," #
oldDefaultValue 
:  
$num! "
)" #
;# $
migrationBuilder 
. 
AlterColumn (
<( )
decimal) 0
>0 1
(1 2
name 
: 
$str )
,) *
table 
: 
$str !
,! "
type 
: 
$str 
,  
nullable 
: 
true 
, 

oldClrType 
: 
typeof "
(" #
int# &
)& '
,' (
oldType 
: 
$str "
," #
oldNullable 
: 
true !
)! "
;" #
migrationBuilder   
.   
AlterColumn   (
<  ( )
decimal  ) 0
>  0 1
(  1 2
name!! 
:!! 
$str!! $
,!!$ %
table"" 
:"" 
$str"" ,
,"", -
type## 
:## 
$str## 
,##  
nullable$$ 
:$$ 
false$$ 
,$$  

oldClrType%% 
:%% 
typeof%% "
(%%" #
int%%# &
)%%& '
,%%' (
oldType&& 
:&& 
$str&& "
)&&" #
;&&# $
}'' 	
	protected** 
override** 
void** 
Down**  $
(**$ %
MigrationBuilder**% 5
migrationBuilder**6 F
)**F G
{++ 	
migrationBuilder,, 
.,, 
AlterColumn,, (
<,,( )
int,,) ,
>,,, -
(,,- .
name-- 
:-- 
$str-- %
,--% &
table.. 
:.. 
$str.. 
,.. 
type// 
:// 
$str// 
,//  
nullable00 
:00 
false00 
,00  
defaultValue11 
:11 
$num11 
,11  

oldClrType22 
:22 
typeof22 "
(22" #
decimal22# *
)22* +
,22+ ,
oldType33 
:33 
$str33 "
,33" #
oldDefaultValue44 
:44  
$num44! #
)44# $
;44$ %
migrationBuilder66 
.66 
AlterColumn66 (
<66( )
int66) ,
>66, -
(66- .
name77 
:77 
$str77 )
,77) *
table88 
:88 
$str88 !
,88! "
type99 
:99 
$str99 
,99  
nullable:: 
::: 
true:: 
,:: 

oldClrType;; 
:;; 
typeof;; "
(;;" #
decimal;;# *
);;* +
,;;+ ,
oldType<< 
:<< 
$str<< "
,<<" #
oldNullable== 
:== 
true== !
)==! "
;==" #
migrationBuilder?? 
.?? 
AlterColumn?? (
<??( )
int??) ,
>??, -
(??- .
name@@ 
:@@ 
$str@@ $
,@@$ %
tableAA 
:AA 
$strAA ,
,AA, -
typeBB 
:BB 
$strBB 
,BB  
nullableCC 
:CC 
falseCC 
,CC  

oldClrTypeDD 
:DD 
typeofDD "
(DD" #
decimalDD# *
)DD* +
,DD+ ,
oldTypeEE 
:EE 
$strEE "
)EE" #
;EE# $
}FF 	
}GG 
}HH ―
hC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Migrations\20251125064841_AddPaymentTable.cs
	namespace 	

CampusEats
 
. 
Backend 
. 

Migrations '
{ 
public 

partial 
class 
AddPaymentTable (
:) *
	Migration+ 4
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
	AddColumn &
<& '
int' *
>* +
(+ ,
name 
: 
$str )
,) *
table 
: 
$str !
,! "
type 
: 
$str 
,  
nullable 
: 
true 
) 
;  
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str )
,) *
table 
: 
$str !
)! "
;" #
} 	
} 
} Κ
{C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Migrations\20251112110150_AddUserPasswordHashRoleAndIsActive.cs
	namespace 	

CampusEats
 
. 
Backend 
. 

Migrations '
{ 
public 

partial 
class .
"AddUserPasswordHashRoleAndIsActive ;
:< =
	Migration> G
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
	AddColumn &
<& '
bool' +
>+ ,
(, -
name 
: 
$str  
,  !
table 
: 
$str 
, 
type 
: 
$str 
,  
nullable 
: 
false 
,  
defaultValue 
: 
false #
)# $
;$ %
migrationBuilder 
. 
	AddColumn &
<& '
string' -
>- .
(. /
name 
: 
$str $
,$ %
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue 
: 
$str  
)  !
;! "
migrationBuilder 
. 
	AddColumn &
<& '
string' -
>- .
(. /
name 
: 
$str 
, 
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue   
:   
$str    
)    !
;  ! "
}!! 	
	protected$$ 
override$$ 
void$$ 
Down$$  $
($$$ %
MigrationBuilder$$% 5
migrationBuilder$$6 F
)$$F G
{%% 	
migrationBuilder&& 
.&& 

DropColumn&& '
(&&' (
name'' 
:'' 
$str''  
,''  !
table(( 
:(( 
$str(( 
)(( 
;((  
migrationBuilder** 
.** 

DropColumn** '
(**' (
name++ 
:++ 
$str++ $
,++$ %
table,, 
:,, 
$str,, 
),, 
;,,  
migrationBuilder.. 
... 

DropColumn.. '
(..' (
name// 
:// 
$str// 
,// 
table00 
:00 
$str00 
)00 
;00  
}11 	
}22 
}33 ΐ©
nC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Migrations\20251112104908_FixOrderRelationships.cs
	namespace 	

CampusEats
 
. 
Backend 
. 

Migrations '
{ 
public		 

partial		 
class		 !
FixOrderRelationships		 .
:		/ 0
	Migration		1 :
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
DropForeignKey +
(+ ,
name 
: 
$str =
,= >
table 
: 
$str ,
), -
;- .
migrationBuilder 
. 
	DropIndex &
(& '
name 
: 
$str +
,+ ,
table 
: 
$str !
)! "
;" #
migrationBuilder 
. 
	DropIndex &
(& '
name 
: 
$str +
,+ ,
table 
: 
$str 
)  
;  !
migrationBuilder 
. 
	DropIndex &
(& '
name 
: 
$str (
,( )
table 
: 
$str 
)  
;  !
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str #
,# $
table   
:   
$str   
)    
;    !
migrationBuilder"" 
."" 

DropColumn"" '
(""' (
name## 
:## 
$str## "
,##" #
table$$ 
:$$ 
$str$$ 
)$$  
;$$  !
migrationBuilder&& 
.&& 
RenameColumn&& )
(&&) *
name'' 
:'' 
$str'' 
,''  
table(( 
:(( 
$str(( 
,((  
newName)) 
:)) 
$str)) $
)))$ %
;))% &
migrationBuilder++ 
.++ 
RenameColumn++ )
(++) *
name,, 
:,, 
$str,, !
,,,! "
table-- 
:-- 
$str-- 
,--  
newName.. 
:.. 
$str.. "
).." #
;..# $
migrationBuilder00 
.00 
RenameColumn00 )
(00) *
name11 
:11 
$str11 *
,11* +
table22 
:22 
$str22 
,22  
newName33 
:33 
$str33  
)33  !
;33! "
migrationBuilder55 
.55 
AlterColumn55 (
<55( )
decimal55) 0
>550 1
(551 2
name66 
:66 
$str66 #
,66# $
table77 
:77 
$str77 
,77  
type88 
:88 
$str88 %
,88% &
nullable99 
:99 
false99 
,99  

oldClrType:: 
::: 
typeof:: "
(::" #
decimal::# *
)::* +
,::+ ,
oldType;; 
:;; 
$str;; (
);;( )
;;;) *
migrationBuilder== 
.== 
AlterColumn== (
<==( )
string==) /
>==/ 0
(==0 1
name>> 
:>> 
$str>> 
,>> 
table?? 
:?? 
$str?? 
,??  
type@@ 
:@@ 
$str@@ -
,@@- .
	maxLengthAA 
:AA 
$numAA 
,AA 
nullableBB 
:BB 
falseBB 
,BB  

oldClrTypeCC 
:CC 
typeofCC "
(CC" #
stringCC# )
)CC) *
,CC* +
oldTypeDD 
:DD 
$strDD 
)DD  
;DD  !
migrationBuilderFF 
.FF 
AlterColumnFF (
<FF( )
DateTimeFF) 1
>FF1 2
(FF2 3
nameGG 
:GG 
$strGG !
,GG! "
tableHH 
:HH 
$strHH 
,HH  
typeII 
:II 
$strII 0
,II0 1
nullableJJ 
:JJ 
falseJJ 
,JJ  

oldClrTypeKK 
:KK 
typeofKK "
(KK" #
DateTimeKK# +
)KK+ ,
,KK, -
oldTypeLL 
:LL 
$strLL 3
,LL3 4
oldDefaultValueSqlMM "
:MM" #
$strMM$ +
)MM+ ,
;MM, -
migrationBuilderOO 
.OO 
	AddColumnOO &
<OO& '
stringOO' -
>OO- .
(OO. /
namePP 
:PP 
$strPP %
,PP% &
tableQQ 
:QQ 
$strQQ 
,QQ  
typeRR 
:RR 
$strRR -
,RR- .
	maxLengthSS 
:SS 
$numSS 
,SS 
nullableTT 
:TT 
trueTT 
)TT 
;TT  
migrationBuilderVV 
.VV 
	AddColumnVV &
<VV& '
stringVV' -
>VV- .
(VV. /
nameWW 
:WW 
$strWW %
,WW% &
tableXX 
:XX 
$strXX 
,XX  
typeYY 
:YY 
$strYY -
,YY- .
	maxLengthZZ 
:ZZ 
$numZZ 
,ZZ 
nullable[[ 
:[[ 
false[[ 
,[[  
defaultValue\\ 
:\\ 
$str\\  
)\\  !
;\\! "
migrationBuilder^^ 
.^^ 
AlterColumn^^ (
<^^( )
decimal^^) 0
>^^0 1
(^^1 2
name__ 
:__ 
$str__ !
,__! "
table`` 
:`` 
$str`` #
,``# $
typeaa 
:aa 
$straa %
,aa% &
nullablebb 
:bb 
falsebb 
,bb  

oldClrTypecc 
:cc 
typeofcc "
(cc" #
decimalcc# *
)cc* +
,cc+ ,
oldTypedd 
:dd 
$strdd (
)dd( )
;dd) *
migrationBuilderff 
.ff 
AlterColumnff (
<ff( )
decimalff) 0
>ff0 1
(ff1 2
namegg 
:gg 
$strgg  
,gg  !
tablehh 
:hh 
$strhh #
,hh# $
typeii 
:ii 
$strii %
,ii% &
nullablejj 
:jj 
falsejj 
,jj  

oldClrTypekk 
:kk 
typeofkk "
(kk" #
decimalkk# *
)kk* +
,kk+ ,
oldTypell 
:ll 
$strll (
)ll( )
;ll) *
migrationBuildernn 
.nn 
AlterColumnnn (
<nn( )
stringnn) /
>nn/ 0
(nn0 1
nameoo 
:oo 
$stroo +
,oo+ ,
tablepp 
:pp 
$strpp #
,pp# $
typeqq 
:qq 
$strqq .
,qq. /
	maxLengthrr 
:rr 
$numrr 
,rr 
nullabless 
:ss 
truess 
,ss 

oldClrTypett 
:tt 
typeoftt "
(tt" #
stringtt# )
)tt) *
,tt* +
oldTypeuu 
:uu 
$struu 1
,uu1 2
oldMaxLengthvv 
:vv 
$numvv !
,vv! "
oldNullableww 
:ww 
trueww !
)ww! "
;ww" #
migrationBuilderyy 
.yy 
	AddColumnyy &
<yy& '
Guidyy' +
>yy+ ,
(yy, -
namezz 
:zz 
$strzz "
,zz" #
table{{ 
:{{ 
$str{{ #
,{{# $
type|| 
:|| 
$str|| 
,|| 
nullable}} 
:}} 
true}} 
)}} 
;}}  
migrationBuilder 
. 
CreateIndex (
(( )
name
€€ 
:
€€ 
$str
€€ +
,
€€+ ,
table
 
:
 
$str
 !
,
! "
column
‚‚ 
:
‚‚ 
$str
‚‚ !
)
‚‚! "
;
‚‚" #
migrationBuilder
„„ 
.
„„ 
CreateIndex
„„ (
(
„„( )
name
…… 
:
…… 
$str
…… )
,
……) *
table
†† 
:
†† 
$str
†† 
,
††  
column
‡‡ 
:
‡‡ 
$str
‡‡ !
)
‡‡! "
;
‡‡" #
migrationBuilder
‰‰ 
.
‰‰ 
CreateIndex
‰‰ (
(
‰‰( )
name
 
:
 
$str
 0
,
0 1
table
‹‹ 
:
‹‹ 
$str
‹‹ #
,
‹‹# $
column
 
:
 
$str
 $
)
$ %
;
% &
migrationBuilder
 
.
 
AddForeignKey
 *
(
* +
name
 
:
 
$str
 =
,
= >
table
 
:
 
$str
 ,
,
, -
column
‘‘ 
:
‘‘ 
$str
‘‘ !
,
‘‘! "
principalTable
’’ 
:
’’ 
$str
’’  (
,
’’( )
principalColumn
““ 
:
““  
$str
““! %
)
““% &
;
““& '
migrationBuilder
•• 
.
•• 
AddForeignKey
•• *
(
••* +
name
–– 
:
–– 
$str
–– 9
,
––9 :
table
—— 
:
—— 
$str
—— #
,
——# $
column
 
:
 
$str
 $
,
$ %
principalTable
™™ 
:
™™ 
$str
™™  *
,
™™* +
principalColumn
 
:
  
$str
! %
)
% &
;
& '
migrationBuilder
 
.
 
AddForeignKey
 *
(
* +
name
 
:
 
$str
 /
,
/ 0
table
 
:
 
$str
 
,
  
column
 
:
 
$str
 !
,
! "
principalTable
   
:
   
$str
    '
,
  ' (
principalColumn
΅΅ 
:
΅΅  
$str
΅΅! %
)
΅΅% &
;
΅΅& '
}
ΆΆ 	
	protected
¥¥ 
override
¥¥ 
void
¥¥ 
Down
¥¥  $
(
¥¥$ %
MigrationBuilder
¥¥% 5
migrationBuilder
¥¥6 F
)
¥¥F G
{
¦¦ 	
migrationBuilder
§§ 
.
§§ 
DropForeignKey
§§ +
(
§§+ ,
name
¨¨ 
:
¨¨ 
$str
¨¨ =
,
¨¨= >
table
©© 
:
©© 
$str
©© ,
)
©©, -
;
©©- .
migrationBuilder
«« 
.
«« 
DropForeignKey
«« +
(
««+ ,
name
¬¬ 
:
¬¬ 
$str
¬¬ 9
,
¬¬9 :
table
­­ 
:
­­ 
$str
­­ #
)
­­# $
;
­­$ %
migrationBuilder
―― 
.
―― 
DropForeignKey
―― +
(
――+ ,
name
°° 
:
°° 
$str
°° /
,
°°/ 0
table
±± 
:
±± 
$str
±± 
)
±±  
;
±±  !
migrationBuilder
³³ 
.
³³ 
	DropIndex
³³ &
(
³³& '
name
΄΄ 
:
΄΄ 
$str
΄΄ +
,
΄΄+ ,
table
µµ 
:
µµ 
$str
µµ !
)
µµ! "
;
µµ" #
migrationBuilder
·· 
.
·· 
	DropIndex
·· &
(
··& '
name
ΈΈ 
:
ΈΈ 
$str
ΈΈ )
,
ΈΈ) *
table
ΉΉ 
:
ΉΉ 
$str
ΉΉ 
)
ΉΉ  
;
ΉΉ  !
migrationBuilder
»» 
.
»» 
	DropIndex
»» &
(
»»& '
name
ΌΌ 
:
ΌΌ 
$str
ΌΌ 0
,
ΌΌ0 1
table
½½ 
:
½½ 
$str
½½ #
)
½½# $
;
½½$ %
migrationBuilder
ΏΏ 
.
ΏΏ 

DropColumn
ΏΏ '
(
ΏΏ' (
name
ΐΐ 
:
ΐΐ 
$str
ΐΐ %
,
ΐΐ% &
table
ΑΑ 
:
ΑΑ 
$str
ΑΑ 
)
ΑΑ  
;
ΑΑ  !
migrationBuilder
ΓΓ 
.
ΓΓ 

DropColumn
ΓΓ '
(
ΓΓ' (
name
ΔΔ 
:
ΔΔ 
$str
ΔΔ %
,
ΔΔ% &
table
ΕΕ 
:
ΕΕ 
$str
ΕΕ 
)
ΕΕ  
;
ΕΕ  !
migrationBuilder
ΗΗ 
.
ΗΗ 

DropColumn
ΗΗ '
(
ΗΗ' (
name
ΘΘ 
:
ΘΘ 
$str
ΘΘ "
,
ΘΘ" #
table
ΙΙ 
:
ΙΙ 
$str
ΙΙ #
)
ΙΙ# $
;
ΙΙ$ %
migrationBuilder
ΛΛ 
.
ΛΛ 
RenameColumn
ΛΛ )
(
ΛΛ) *
name
ΜΜ 
:
ΜΜ 
$str
ΜΜ 
,
ΜΜ  
table
ΝΝ 
:
ΝΝ 
$str
ΝΝ 
,
ΝΝ  
newName
ΞΞ 
:
ΞΞ 
$str
ΞΞ $
)
ΞΞ$ %
;
ΞΞ% &
migrationBuilder
ΠΠ 
.
ΠΠ 
RenameColumn
ΠΠ )
(
ΠΠ) *
name
ΡΡ 
:
ΡΡ 
$str
ΡΡ !
,
ΡΡ! "
table
 
:
 
$str
 
,
  
newName
ΣΣ 
:
ΣΣ 
$str
ΣΣ "
)
ΣΣ" #
;
ΣΣ# $
migrationBuilder
ΥΥ 
.
ΥΥ 
RenameColumn
ΥΥ )
(
ΥΥ) *
name
ΦΦ 
:
ΦΦ 
$str
ΦΦ 
,
ΦΦ 
table
ΧΧ 
:
ΧΧ 
$str
ΧΧ 
,
ΧΧ  
newName
ΨΨ 
:
ΨΨ 
$str
ΨΨ -
)
ΨΨ- .
;
ΨΨ. /
migrationBuilder
ΪΪ 
.
ΪΪ 
AlterColumn
ΪΪ (
<
ΪΪ( )
decimal
ΪΪ) 0
>
ΪΪ0 1
(
ΪΪ1 2
name
ΫΫ 
:
ΫΫ 
$str
ΫΫ #
,
ΫΫ# $
table
άά 
:
άά 
$str
άά 
,
άά  
type
έέ 
:
έέ 
$str
έέ %
,
έέ% &
nullable
ήή 
:
ήή 
false
ήή 
,
ήή  

oldClrType
ίί 
:
ίί 
typeof
ίί "
(
ίί" #
decimal
ίί# *
)
ίί* +
,
ίί+ ,
oldType
ΰΰ 
:
ΰΰ 
$str
ΰΰ (
)
ΰΰ( )
;
ΰΰ) *
migrationBuilder
ββ 
.
ββ 
AlterColumn
ββ (
<
ββ( )
string
ββ) /
>
ββ/ 0
(
ββ0 1
name
γγ 
:
γγ 
$str
γγ 
,
γγ 
table
δδ 
:
δδ 
$str
δδ 
,
δδ  
type
εε 
:
εε 
$str
εε 
,
εε 
nullable
ζζ 
:
ζζ 
false
ζζ 
,
ζζ  

oldClrType
ηη 
:
ηη 
typeof
ηη "
(
ηη" #
string
ηη# )
)
ηη) *
,
ηη* +
oldType
θθ 
:
θθ 
$str
θθ 0
,
θθ0 1
oldMaxLength
ιι 
:
ιι 
$num
ιι  
)
ιι  !
;
ιι! "
migrationBuilder
λλ 
.
λλ 
AlterColumn
λλ (
<
λλ( )
DateTime
λλ) 1
>
λλ1 2
(
λλ2 3
name
μμ 
:
μμ 
$str
μμ !
,
μμ! "
table
νν 
:
νν 
$str
νν 
,
νν  
type
ξξ 
:
ξξ 
$str
ξξ 0
,
ξξ0 1
nullable
οο 
:
οο 
false
οο 
,
οο  
defaultValueSql
ππ 
:
ππ  
$str
ππ! (
,
ππ( )

oldClrType
ρρ 
:
ρρ 
typeof
ρρ "
(
ρρ" #
DateTime
ρρ# +
)
ρρ+ ,
,
ρρ, -
oldType
ςς 
:
ςς 
$str
ςς 3
)
ςς3 4
;
ςς4 5
migrationBuilder
ττ 
.
ττ 
	AddColumn
ττ &
<
ττ& '
DateTime
ττ' /
>
ττ/ 0
(
ττ0 1
name
υυ 
:
υυ 
$str
υυ #
,
υυ# $
table
φφ 
:
φφ 
$str
φφ 
,
φφ  
type
χχ 
:
χχ 
$str
χχ 0
,
χχ0 1
nullable
ψψ 
:
ψψ 
true
ψψ 
)
ψψ 
;
ψψ  
migrationBuilder
ϊϊ 
.
ϊϊ 
	AddColumn
ϊϊ &
<
ϊϊ& '
DateTime
ϊϊ' /
>
ϊϊ/ 0
(
ϊϊ0 1
name
ϋϋ 
:
ϋϋ 
$str
ϋϋ "
,
ϋϋ" #
table
όό 
:
όό 
$str
όό 
,
όό  
type
ύύ 
:
ύύ 
$str
ύύ 0
,
ύύ0 1
nullable
ώώ 
:
ώώ 
true
ώώ 
)
ώώ 
;
ώώ  
migrationBuilder
€€ 
.
€€ 
AlterColumn
€€ (
<
€€( )
decimal
€€) 0
>
€€0 1
(
€€1 2
name
 
:
 
$str
 !
,
! "
table
‚‚ 
:
‚‚ 
$str
‚‚ #
,
‚‚# $
type
ƒƒ 
:
ƒƒ 
$str
ƒƒ %
,
ƒƒ% &
nullable
„„ 
:
„„ 
false
„„ 
,
„„  

oldClrType
…… 
:
…… 
typeof
…… "
(
……" #
decimal
……# *
)
……* +
,
……+ ,
oldType
†† 
:
†† 
$str
†† (
)
††( )
;
††) *
migrationBuilder
 
.
 
AlterColumn
 (
<
( )
decimal
) 0
>
0 1
(
1 2
name
‰‰ 
:
‰‰ 
$str
‰‰  
,
‰‰  !
table
 
:
 
$str
 #
,
# $
type
‹‹ 
:
‹‹ 
$str
‹‹ %
,
‹‹% &
nullable
 
:
 
false
 
,
  

oldClrType
 
:
 
typeof
 "
(
" #
decimal
# *
)
* +
,
+ ,
oldType
 
:
 
$str
 (
)
( )
;
) *
migrationBuilder
 
.
 
AlterColumn
 (
<
( )
string
) /
>
/ 0
(
0 1
name
‘‘ 
:
‘‘ 
$str
‘‘ +
,
‘‘+ ,
table
’’ 
:
’’ 
$str
’’ #
,
’’# $
type
““ 
:
““ 
$str
““ .
,
““. /
	maxLength
”” 
:
”” 
$num
”” 
,
”” 
nullable
•• 
:
•• 
true
•• 
,
•• 

oldClrType
–– 
:
–– 
typeof
–– "
(
––" #
string
––# )
)
––) *
,
––* +
oldType
—— 
:
—— 
$str
—— 1
,
——1 2
oldMaxLength
 
:
 
$num
 !
,
! "
oldNullable
™™ 
:
™™ 
true
™™ !
)
™™! "
;
™™" #
migrationBuilder
›› 
.
›› 
CreateIndex
›› (
(
››( )
name
 
:
 
$str
 +
,
+ ,
table
 
:
 
$str
 !
,
! "
column
 
:
 
$str
 !
,
! "
unique
 
:
 
true
 
)
 
;
 
migrationBuilder
΅΅ 
.
΅΅ 
CreateIndex
΅΅ (
(
΅΅( )
name
ΆΆ 
:
ΆΆ 
$str
ΆΆ +
,
ΆΆ+ ,
table
££ 
:
££ 
$str
££ 
,
££  
column
¤¤ 
:
¤¤ 
$str
¤¤ #
)
¤¤# $
;
¤¤$ %
migrationBuilder
¦¦ 
.
¦¦ 
CreateIndex
¦¦ (
(
¦¦( )
name
§§ 
:
§§ 
$str
§§ (
,
§§( )
table
¨¨ 
:
¨¨ 
$str
¨¨ 
,
¨¨  
column
©© 
:
©© 
$str
©©  
)
©©  !
;
©©! "
migrationBuilder
«« 
.
«« 
AddForeignKey
«« *
(
««* +
name
¬¬ 
:
¬¬ 
$str
¬¬ =
,
¬¬= >
table
­­ 
:
­­ 
$str
­­ ,
,
­­, -
column
®® 
:
®® 
$str
®® !
,
®®! "
principalTable
―― 
:
―― 
$str
――  (
,
――( )
principalColumn
°° 
:
°°  
$str
°°! %
,
°°% &
onDelete
±± 
:
±± 
ReferentialAction
±± +
.
±±+ ,
SetNull
±±, 3
)
±±3 4
;
±±4 5
}
²² 	
}
³³ 
}΄΄ Α‰
fC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Migrations\20251106214039_InitialCreate.cs
	namespace 	

CampusEats
 
. 
Backend 
. 

Migrations '
{ 
public

 

partial

 
class

 
InitialCreate

 &
:

' (
	Migration

) 2
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str  
,  !
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
Guid& *
>* +
(+ ,
type, 0
:0 1
$str2 8
,8 9
nullable: B
:B C
falseD I
)I J
,J K
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 N
,N O
	maxLengthP Y
:Y Z
$num[ ^
,^ _
nullable` h
:h i
falsej o
)o p
,p q
Description 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= U
,U V
	maxLengthW `
:` a
$numb e
,e f
nullableg o
:o p
falseq v
)v w
,w x
Price 
= 
table !
.! "
Column" (
<( )
decimal) 0
>0 1
(1 2
type2 6
:6 7
$str8 G
,G H
nullableI Q
:Q R
falseS X
)X Y
,Y Z
Category 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: Q
,Q R
	maxLengthS \
:\ ]
$num^ `
,` a
nullableb j
:j k
falsel q
)q r
,r s
ImageUrl 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: R
,R S
	maxLengthT ]
:] ^
$num_ b
,b c
nullabled l
:l m
truen r
)r s
,s t
	Allergens 
= 
table  %
.% &
Column& ,
<, -
List- 1
<1 2
string2 8
>8 9
>9 :
(: ;
type; ?
:? @
$strA H
,H I
nullableJ R
:R S
falseT Y
,Y Z
defaultValueSql[ j
:j k
$strl y
)y z
,z {
DietaryRestrictions '
=( )
table* /
./ 0
Column0 6
<6 7
string7 =
>= >
(> ?
type? C
:C D
$strE ]
,] ^
	maxLength_ h
:h i
$numj m
,m n
nullableo w
:w x
truey }
)} ~
,~ 
IsAvailable 
=  !
table" '
.' (
Column( .
<. /
bool/ 3
>3 4
(4 5
type5 9
:9 :
$str; D
,D E
nullableF N
:N O
falseP U
,U V
defaultValueW c
:c d
truee i
)i j
,j k
	CreatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= W
,W X
nullableY a
:a b
falsec h
,h i
defaultValueSqlj y
:y z
$str	{ ‚
)
‚ ƒ
,
ƒ „
	UpdatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= W
,W X
nullableY a
:a b
truec g
)g h
} 
, 
constraints 
: 
table "
=># %
{   
table!! 
.!! 

PrimaryKey!! $
(!!$ %
$str!!% 2
,!!2 3
x!!4 5
=>!!6 8
x!!9 :
.!!: ;
Id!!; =
)!!= >
;!!> ?
}"" 
)"" 
;"" 
migrationBuilder$$ 
.$$ 
CreateTable$$ (
($$( )
name%% 
:%% 
$str%% 
,%% 
columns&& 
:&& 
table&& 
=>&& !
new&&" %
{'' 
Id(( 
=(( 
table(( 
.(( 
Column(( %
<((% &
Guid((& *
>((* +
(((+ ,
type((, 0
:((0 1
$str((2 8
,((8 9
nullable((: B
:((B C
false((D I
)((I J
,((J K
Email)) 
=)) 
table)) !
.))! "
Column))" (
<))( )
string))) /
>))/ 0
())0 1
type))1 5
:))5 6
$str))7 O
,))O P
	maxLength))Q Z
:))Z [
$num))\ _
,))_ `
nullable))a i
:))i j
false))k p
)))p q
,))q r
FullName** 
=** 
table** $
.**$ %
Column**% +
<**+ ,
string**, 2
>**2 3
(**3 4
type**4 8
:**8 9
$str**: R
,**R S
	maxLength**T ]
:**] ^
$num**_ b
,**b c
nullable**d l
:**l m
false**n s
)**s t
,**t u
PhoneNumber++ 
=++  !
table++" '
.++' (
Column++( .
<++. /
string++/ 5
>++5 6
(++6 7
type++7 ;
:++; <
$str++= T
,++T U
	maxLength++V _
:++_ `
$num++a c
,++c d
nullable++e m
:++m n
false++o t
)++t u
,++u v
	StudentId,, 
=,, 
table,,  %
.,,% &
Column,,& ,
<,,, -
string,,- 3
>,,3 4
(,,4 5
type,,5 9
:,,9 :
$str,,; R
,,,R S
	maxLength,,T ]
:,,] ^
$num,,_ a
,,,a b
nullable,,c k
:,,k l
true,,m q
),,q r
,,,r s
LoyaltyPoints-- !
=--" #
table--$ )
.--) *
Column--* 0
<--0 1
int--1 4
>--4 5
(--5 6
type--6 :
:--: ;
$str--< E
,--E F
nullable--G O
:--O P
false--Q V
,--V W
defaultValue--X d
:--d e
$num--f g
)--g h
,--h i
	CreatedAt.. 
=.. 
table..  %
...% &
Column..& ,
<.., -
DateTime..- 5
>..5 6
(..6 7
type..7 ;
:..; <
$str..= W
,..W X
nullable..Y a
:..a b
false..c h
,..h i
defaultValueSql..j y
:..y z
$str	..{ ‚
)
..‚ ƒ
,
..ƒ „
	UpdatedAt// 
=// 
table//  %
.//% &
Column//& ,
<//, -
DateTime//- 5
>//5 6
(//6 7
type//7 ;
://; <
$str//= W
,//W X
nullable//Y a
://a b
true//c g
)//g h
}00 
,00 
constraints11 
:11 
table11 "
=>11# %
{22 
table33 
.33 

PrimaryKey33 $
(33$ %
$str33% /
,33/ 0
x331 2
=>333 5
x336 7
.337 8
Id338 :
)33: ;
;33; <
}44 
)44 
;44 
migrationBuilder66 
.66 
CreateTable66 (
(66( )
name77 
:77 
$str77 
,77 
columns88 
:88 
table88 
=>88 !
new88" %
{99 
Id:: 
=:: 
table:: 
.:: 
Column:: %
<::% &
Guid::& *
>::* +
(::+ ,
type::, 0
:::0 1
$str::2 8
,::8 9
nullable::: B
:::B C
false::D I
)::I J
,::J K
OrderNumber;; 
=;;  !
table;;" '
.;;' (
Column;;( .
<;;. /
string;;/ 5
>;;5 6
(;;6 7
type;;7 ;
:;;; <
$str;;= T
,;;T U
	maxLength;;V _
:;;_ `
$num;;a c
,;;c d
nullable;;e m
:;;m n
false;;o t
);;t u
,;;u v
UserId<< 
=<< 
table<< "
.<<" #
Column<<# )
<<<) *
Guid<<* .
><<. /
(<</ 0
type<<0 4
:<<4 5
$str<<6 <
,<<< =
nullable<<> F
:<<F G
false<<H M
)<<M N
,<<N O
TotalAmount== 
===  !
table==" '
.==' (
Column==( .
<==. /
decimal==/ 6
>==6 7
(==7 8
type==8 <
:==< =
$str==> M
,==M N
nullable==O W
:==W X
false==Y ^
)==^ _
,==_ `
Status>> 
=>> 
table>> "
.>>" #
Column>># )
<>>) *
string>>* 0
>>>0 1
(>>1 2
type>>2 6
:>>6 7
$str>>8 >
,>>> ?
nullable>>@ H
:>>H I
false>>J O
)>>O P
,>>P Q

PreparedAt?? 
=??  
table??! &
.??& '
Column??' -
<??- .
DateTime??. 6
>??6 7
(??7 8
type??8 <
:??< =
$str??> X
,??X Y
nullable??Z b
:??b c
true??d h
)??h i
,??i j
ReadyAt@@ 
=@@ 
table@@ #
.@@# $
Column@@$ *
<@@* +
DateTime@@+ 3
>@@3 4
(@@4 5
type@@5 9
:@@9 :
$str@@; U
,@@U V
nullable@@W _
:@@_ `
true@@a e
)@@e f
,@@f g
CompletedAtAA 
=AA  !
tableAA" '
.AA' (
ColumnAA( .
<AA. /
DateTimeAA/ 7
>AA7 8
(AA8 9
typeAA9 =
:AA= >
$strAA? Y
,AAY Z
nullableAA[ c
:AAc d
trueAAe i
)AAi j
,AAj k
	CreatedAtBB 
=BB 
tableBB  %
.BB% &
ColumnBB& ,
<BB, -
DateTimeBB- 5
>BB5 6
(BB6 7
typeBB7 ;
:BB; <
$strBB= W
,BBW X
nullableBBY a
:BBa b
falseBBc h
,BBh i
defaultValueSqlBBj y
:BBy z
$str	BB{ ‚
)
BB‚ ƒ
,
BBƒ „
CancelledAtCC 
=CC  !
tableCC" '
.CC' (
ColumnCC( .
<CC. /
DateTimeCC/ 7
>CC7 8
(CC8 9
typeCC9 =
:CC= >
$strCC? Y
,CCY Z
nullableCC[ c
:CCc d
trueCCe i
)CCi j
,CCj k
CancellationReasonDD &
=DD' (
tableDD) .
.DD. /
ColumnDD/ 5
<DD5 6
stringDD6 <
>DD< =
(DD= >
typeDD> B
:DDB C
$strDDD \
,DD\ ]
	maxLengthDD^ g
:DDg h
$numDDi l
,DDl m
nullableDDn v
:DDv w
trueDDx |
)DD| }
,DD} ~
	PaymentIdEE 
=EE 
tableEE  %
.EE% &
ColumnEE& ,
<EE, -
GuidEE- 1
>EE1 2
(EE2 3
typeEE3 7
:EE7 8
$strEE9 ?
,EE? @
nullableEEA I
:EEI J
trueEEK O
)EEO P
}FF 
,FF 
constraintsGG 
:GG 
tableGG "
=>GG# %
{HH 
tableII 
.II 

PrimaryKeyII $
(II$ %
$strII% 0
,II0 1
xII2 3
=>II4 6
xII7 8
.II8 9
IdII9 ;
)II; <
;II< =
tableJJ 
.JJ 

ForeignKeyJJ $
(JJ$ %
nameKK 
:KK 
$strKK 6
,KK6 7
columnLL 
:LL 
xLL  !
=>LL" $
xLL% &
.LL& '
UserIdLL' -
,LL- .
principalTableMM &
:MM& '
$strMM( /
,MM/ 0
principalColumnNN '
:NN' (
$strNN) -
,NN- .
onDeleteOO  
:OO  !
ReferentialActionOO" 3
.OO3 4
RestrictOO4 <
)OO< =
;OO= >
}PP 
)PP 
;PP 
migrationBuilderRR 
.RR 
CreateTableRR (
(RR( )
nameSS 
:SS 
$strSS +
,SS+ ,
columnsTT 
:TT 
tableTT 
=>TT !
newTT" %
{UU 
IdVV 
=VV 
tableVV 
.VV 
ColumnVV %
<VV% &
GuidVV& *
>VV* +
(VV+ ,
typeVV, 0
:VV0 1
$strVV2 8
,VV8 9
nullableVV: B
:VVB C
falseVVD I
)VVI J
,VVJ K
UserIdWW 
=WW 
tableWW "
.WW" #
ColumnWW# )
<WW) *
GuidWW* .
>WW. /
(WW/ 0
typeWW0 4
:WW4 5
$strWW6 <
,WW< =
nullableWW> F
:WWF G
falseWWH M
)WWM N
,WWN O
PointsChangeXX  
=XX! "
tableXX# (
.XX( )
ColumnXX) /
<XX/ 0
intXX0 3
>XX3 4
(XX4 5
typeXX5 9
:XX9 :
$strXX; D
,XXD E
nullableXXF N
:XXN O
falseXXP U
)XXU V
,XXV W
TypeYY 
=YY 
tableYY  
.YY  !
ColumnYY! '
<YY' (
stringYY( .
>YY. /
(YY/ 0
typeYY0 4
:YY4 5
$strYY6 <
,YY< =
nullableYY> F
:YYF G
falseYYH M
)YYM N
,YYN O
DescriptionZZ 
=ZZ  !
tableZZ" '
.ZZ' (
ColumnZZ( .
<ZZ. /
stringZZ/ 5
>ZZ5 6
(ZZ6 7
typeZZ7 ;
:ZZ; <
$strZZ= U
,ZZU V
	maxLengthZZW `
:ZZ` a
$numZZb e
,ZZe f
nullableZZg o
:ZZo p
falseZZq v
)ZZv w
,ZZw x
OrderId[[ 
=[[ 
table[[ #
.[[# $
Column[[$ *
<[[* +
Guid[[+ /
>[[/ 0
([[0 1
type[[1 5
:[[5 6
$str[[7 =
,[[= >
nullable[[? G
:[[G H
true[[I M
)[[M N
,[[N O
	CreatedAt\\ 
=\\ 
table\\  %
.\\% &
Column\\& ,
<\\, -
DateTime\\- 5
>\\5 6
(\\6 7
type\\7 ;
:\\; <
$str\\= W
,\\W X
nullable\\Y a
:\\a b
false\\c h
,\\h i
defaultValueSql\\j y
:\\y z
$str	\\{ ‚
)
\\‚ ƒ
}]] 
,]] 
constraints^^ 
:^^ 
table^^ "
=>^^# %
{__ 
table`` 
.`` 

PrimaryKey`` $
(``$ %
$str``% =
,``= >
x``? @
=>``A C
x``D E
.``E F
Id``F H
)``H I
;``I J
tableaa 
.aa 

ForeignKeyaa $
(aa$ %
namebb 
:bb 
$strbb E
,bbE F
columncc 
:cc 
xcc  !
=>cc" $
xcc% &
.cc& '
OrderIdcc' .
,cc. /
principalTabledd &
:dd& '
$strdd( 0
,dd0 1
principalColumnee '
:ee' (
$stree) -
,ee- .
onDeleteff  
:ff  !
ReferentialActionff" 3
.ff3 4
SetNullff4 ;
)ff; <
;ff< =
tablegg 
.gg 

ForeignKeygg $
(gg$ %
namehh 
:hh 
$strhh C
,hhC D
columnii 
:ii 
xii  !
=>ii" $
xii% &
.ii& '
UserIdii' -
,ii- .
principalTablejj &
:jj& '
$strjj( /
,jj/ 0
principalColumnkk '
:kk' (
$strkk) -
,kk- .
onDeletell  
:ll  !
ReferentialActionll" 3
.ll3 4
Restrictll4 <
)ll< =
;ll= >
}mm 
)mm 
;mm 
migrationBuilderoo 
.oo 
CreateTableoo (
(oo( )
namepp 
:pp 
$strpp "
,pp" #
columnsqq 
:qq 
tableqq 
=>qq !
newqq" %
{rr 
Idss 
=ss 
tabless 
.ss 
Columnss %
<ss% &
Guidss& *
>ss* +
(ss+ ,
typess, 0
:ss0 1
$strss2 8
,ss8 9
nullabless: B
:ssB C
falsessD I
)ssI J
,ssJ K
OrderIdtt 
=tt 
tablett #
.tt# $
Columntt$ *
<tt* +
Guidtt+ /
>tt/ 0
(tt0 1
typett1 5
:tt5 6
$strtt7 =
,tt= >
nullablett? G
:ttG H
falsettI N
)ttN O
,ttO P
	ProductIduu 
=uu 
tableuu  %
.uu% &
Columnuu& ,
<uu, -
Guiduu- 1
>uu1 2
(uu2 3
typeuu3 7
:uu7 8
$struu9 ?
,uu? @
nullableuuA I
:uuI J
falseuuK P
)uuP Q
,uuQ R
Quantityvv 
=vv 
tablevv $
.vv$ %
Columnvv% +
<vv+ ,
intvv, /
>vv/ 0
(vv0 1
typevv1 5
:vv5 6
$strvv7 @
,vv@ A
nullablevvB J
:vvJ K
falsevvL Q
)vvQ R
,vvR S
	UnitPriceww 
=ww 
tableww  %
.ww% &
Columnww& ,
<ww, -
decimalww- 4
>ww4 5
(ww5 6
typeww6 :
:ww: ;
$strww< K
,wwK L
nullablewwM U
:wwU V
falsewwW \
)ww\ ]
,ww] ^
Subtotalxx 
=xx 
tablexx $
.xx$ %
Columnxx% +
<xx+ ,
decimalxx, 3
>xx3 4
(xx4 5
typexx5 9
:xx9 :
$strxx; J
,xxJ K
nullablexxL T
:xxT U
falsexxV [
)xx[ \
,xx\ ]
SpecialInstructionsyy '
=yy( )
tableyy* /
.yy/ 0
Columnyy0 6
<yy6 7
stringyy7 =
>yy= >
(yy> ?
typeyy? C
:yyC D
$stryyE ]
,yy] ^
	maxLengthyy_ h
:yyh i
$numyyj m
,yym n
nullableyyo w
:yyw x
trueyyy }
)yy} ~
}zz 
,zz 
constraints{{ 
:{{ 
table{{ "
=>{{# %
{|| 
table}} 
.}} 

PrimaryKey}} $
(}}$ %
$str}}% 4
,}}4 5
x}}6 7
=>}}8 :
x}}; <
.}}< =
Id}}= ?
)}}? @
;}}@ A
table~~ 
.~~ 

ForeignKey~~ $
(~~$ %
name 
: 
$str <
,< =
column
€€ 
:
€€ 
x
€€  !
=>
€€" $
x
€€% &
.
€€& '
OrderId
€€' .
,
€€. /
principalTable
 &
:
& '
$str
( 0
,
0 1
principalColumn
‚‚ '
:
‚‚' (
$str
‚‚) -
,
‚‚- .
onDelete
ƒƒ  
:
ƒƒ  !
ReferentialAction
ƒƒ" 3
.
ƒƒ3 4
Cascade
ƒƒ4 ;
)
ƒƒ; <
;
ƒƒ< =
table
„„ 
.
„„ 

ForeignKey
„„ $
(
„„$ %
name
…… 
:
…… 
$str
…… @
,
……@ A
column
†† 
:
†† 
x
††  !
=>
††" $
x
††% &
.
††& '
	ProductId
††' 0
,
††0 1
principalTable
‡‡ &
:
‡‡& '
$str
‡‡( 2
,
‡‡2 3
principalColumn
 '
:
' (
$str
) -
,
- .
onDelete
‰‰  
:
‰‰  !
ReferentialAction
‰‰" 3
.
‰‰3 4
Restrict
‰‰4 <
)
‰‰< =
;
‰‰= >
}
 
)
 
;
 
migrationBuilder
 
.
 
CreateTable
 (
(
( )
name
 
:
 
$str
  
,
  !
columns
 
:
 
table
 
=>
 !
new
" %
{
 
Id
 
=
 
table
 
.
 
Column
 %
<
% &
Guid
& *
>
* +
(
+ ,
type
, 0
:
0 1
$str
2 8
,
8 9
nullable
: B
:
B C
false
D I
)
I J
,
J K
OrderId
‘‘ 
=
‘‘ 
table
‘‘ #
.
‘‘# $
Column
‘‘$ *
<
‘‘* +
Guid
‘‘+ /
>
‘‘/ 0
(
‘‘0 1
type
‘‘1 5
:
‘‘5 6
$str
‘‘7 =
,
‘‘= >
nullable
‘‘? G
:
‘‘G H
false
‘‘I N
)
‘‘N O
,
‘‘O P
Amount
’’ 
=
’’ 
table
’’ "
.
’’" #
Column
’’# )
<
’’) *
decimal
’’* 1
>
’’1 2
(
’’2 3
type
’’3 7
:
’’7 8
$str
’’9 H
,
’’H I
nullable
’’J R
:
’’R S
false
’’T Y
)
’’Y Z
,
’’Z [
Status
““ 
=
““ 
table
““ "
.
““" #
Column
““# )
<
““) *
string
““* 0
>
““0 1
(
““1 2
type
““2 6
:
““6 7
$str
““8 >
,
““> ?
nullable
““@ H
:
““H I
false
““J O
)
““O P
,
““P Q
Method
”” 
=
”” 
table
”” "
.
””" #
Column
””# )
<
””) *
string
””* 0
>
””0 1
(
””1 2
type
””2 6
:
””6 7
$str
””8 >
,
””> ?
nullable
””@ H
:
””H I
false
””J O
)
””O P
,
””P Q#
StripePaymentIntentId
•• )
=
••* +
table
••, 1
.
••1 2
Column
••2 8
<
••8 9
string
••9 ?
>
••? @
(
••@ A
type
••A E
:
••E F
$str
••G _
,
••_ `
	maxLength
••a j
:
••j k
$num
••l o
,
••o p
nullable
••q y
:
••y z
true
••{ 
)•• €
,••€ 
StripeSessionId
–– #
=
––$ %
table
––& +
.
––+ ,
Column
––, 2
<
––2 3
string
––3 9
>
––9 :
(
––: ;
type
––; ?
:
––? @
$str
––A Y
,
––Y Z
	maxLength
––[ d
:
––d e
$num
––f i
,
––i j
nullable
––k s
:
––s t
true
––u y
)
––y z
,
––z {
	CreatedAt
—— 
=
—— 
table
——  %
.
——% &
Column
——& ,
<
——, -
DateTime
——- 5
>
——5 6
(
——6 7
type
——7 ;
:
——; <
$str
——= W
,
——W X
nullable
——Y a
:
——a b
false
——c h
,
——h i
defaultValueSql
——j y
:
——y z
$str——{ ‚
)——‚ ƒ
,——ƒ „
PaidAt
 
=
 
table
 "
.
" #
Column
# )
<
) *
DateTime
* 2
>
2 3
(
3 4
type
4 8
:
8 9
$str
: T
,
T U
nullable
V ^
:
^ _
true
` d
)
d e
,
e f
FailedAt
™™ 
=
™™ 
table
™™ $
.
™™$ %
Column
™™% +
<
™™+ ,
DateTime
™™, 4
>
™™4 5
(
™™5 6
type
™™6 :
:
™™: ;
$str
™™< V
,
™™V W
nullable
™™X `
:
™™` a
true
™™b f
)
™™f g
,
™™g h
FailureReason
 !
=
" #
table
$ )
.
) *
Column
* 0
<
0 1
string
1 7
>
7 8
(
8 9
type
9 =
:
= >
$str
? W
,
W X
	maxLength
Y b
:
b c
$num
d g
,
g h
nullable
i q
:
q r
true
s w
)
w x
}
›› 
,
›› 
constraints
 
:
 
table
 "
=>
# %
{
 
table
 
.
 

PrimaryKey
 $
(
$ %
$str
% 2
,
2 3
x
4 5
=>
6 8
x
9 :
.
: ;
Id
; =
)
= >
;
> ?
table
 
.
 

ForeignKey
 $
(
$ %
name
   
:
   
$str
   :
,
  : ;
column
΅΅ 
:
΅΅ 
x
΅΅  !
=>
΅΅" $
x
΅΅% &
.
΅΅& '
OrderId
΅΅' .
,
΅΅. /
principalTable
ΆΆ &
:
ΆΆ& '
$str
ΆΆ( 0
,
ΆΆ0 1
principalColumn
££ '
:
££' (
$str
££) -
,
££- .
onDelete
¤¤  
:
¤¤  !
ReferentialAction
¤¤" 3
.
¤¤3 4
Cascade
¤¤4 ;
)
¤¤; <
;
¤¤< =
}
¥¥ 
)
¥¥ 
;
¥¥ 
migrationBuilder
§§ 
.
§§ 
CreateIndex
§§ (
(
§§( )
name
¨¨ 
:
¨¨ 
$str
¨¨ 8
,
¨¨8 9
table
©© 
:
©© 
$str
©© ,
,
©©, -
column
 
:
 
$str
 #
)
# $
;
$ %
migrationBuilder
¬¬ 
.
¬¬ 
CreateIndex
¬¬ (
(
¬¬( )
name
­­ 
:
­­ 
$str
­­ 6
,
­­6 7
table
®® 
:
®® 
$str
®® ,
,
®®, -
column
―― 
:
―― 
$str
―― !
)
――! "
;
――" #
migrationBuilder
±± 
.
±± 
CreateIndex
±± (
(
±±( )
name
²² 
:
²² 
$str
²² 5
,
²²5 6
table
³³ 
:
³³ 
$str
³³ ,
,
³³, -
column
΄΄ 
:
΄΄ 
$str
΄΄  
)
΄΄  !
;
΄΄! "
migrationBuilder
¶¶ 
.
¶¶ 
CreateIndex
¶¶ (
(
¶¶( )
name
·· 
:
·· 
$str
·· -
,
··- .
table
ΈΈ 
:
ΈΈ 
$str
ΈΈ #
,
ΈΈ# $
column
ΉΉ 
:
ΉΉ 
$str
ΉΉ !
)
ΉΉ! "
;
ΉΉ" #
migrationBuilder
»» 
.
»» 
CreateIndex
»» (
(
»»( )
name
ΌΌ 
:
ΌΌ 
$str
ΌΌ /
,
ΌΌ/ 0
table
½½ 
:
½½ 
$str
½½ #
,
½½# $
column
ΎΎ 
:
ΎΎ 
$str
ΎΎ #
)
ΎΎ# $
;
ΎΎ$ %
migrationBuilder
ΐΐ 
.
ΐΐ 
CreateIndex
ΐΐ (
(
ΐΐ( )
name
ΑΑ 
:
ΑΑ 
$str
ΑΑ +
,
ΑΑ+ ,
table
ΒΒ 
:
ΒΒ 
$str
ΒΒ 
,
ΒΒ  
column
ΓΓ 
:
ΓΓ 
$str
ΓΓ #
)
ΓΓ# $
;
ΓΓ$ %
migrationBuilder
ΕΕ 
.
ΕΕ 
CreateIndex
ΕΕ (
(
ΕΕ( )
name
ΖΖ 
:
ΖΖ 
$str
ΖΖ -
,
ΖΖ- .
table
ΗΗ 
:
ΗΗ 
$str
ΗΗ 
,
ΗΗ  
column
ΘΘ 
:
ΘΘ 
$str
ΘΘ %
,
ΘΘ% &
unique
ΙΙ 
:
ΙΙ 
true
ΙΙ 
)
ΙΙ 
;
ΙΙ 
migrationBuilder
ΛΛ 
.
ΛΛ 
CreateIndex
ΛΛ (
(
ΛΛ( )
name
ΜΜ 
:
ΜΜ 
$str
ΜΜ (
,
ΜΜ( )
table
ΝΝ 
:
ΝΝ 
$str
ΝΝ 
,
ΝΝ  
column
ΞΞ 
:
ΞΞ 
$str
ΞΞ  
)
ΞΞ  !
;
ΞΞ! "
migrationBuilder
ΠΠ 
.
ΠΠ 
CreateIndex
ΠΠ (
(
ΠΠ( )
name
ΡΡ 
:
ΡΡ 
$str
ΡΡ (
,
ΡΡ( )
table
 
:
 
$str
 
,
  
column
ΣΣ 
:
ΣΣ 
$str
ΣΣ  
)
ΣΣ  !
;
ΣΣ! "
migrationBuilder
ΥΥ 
.
ΥΥ 
CreateIndex
ΥΥ (
(
ΥΥ( )
name
ΦΦ 
:
ΦΦ 
$str
ΦΦ +
,
ΦΦ+ ,
table
ΧΧ 
:
ΧΧ 
$str
ΧΧ !
,
ΧΧ! "
column
ΨΨ 
:
ΨΨ 
$str
ΨΨ !
,
ΨΨ! "
unique
ΩΩ 
:
ΩΩ 
true
ΩΩ 
)
ΩΩ 
;
ΩΩ 
migrationBuilder
ΫΫ 
.
ΫΫ 
CreateIndex
ΫΫ (
(
ΫΫ( )
name
άά 
:
άά 
$str
άά *
,
άά* +
table
έέ 
:
έέ 
$str
έέ !
,
έέ! "
column
ήή 
:
ήή 
$str
ήή  
)
ήή  !
;
ήή! "
migrationBuilder
ΰΰ 
.
ΰΰ 
CreateIndex
ΰΰ (
(
ΰΰ( )
name
αα 
:
αα 
$str
αα 9
,
αα9 :
table
ββ 
:
ββ 
$str
ββ !
,
ββ! "
column
γγ 
:
γγ 
$str
γγ /
)
γγ/ 0
;
γγ0 1
migrationBuilder
εε 
.
εε 
CreateIndex
εε (
(
εε( )
name
ζζ 
:
ζζ 
$str
ζζ ,
,
ζζ, -
table
ηη 
:
ηη 
$str
ηη !
,
ηη! "
column
θθ 
:
θθ 
$str
θθ "
)
θθ" #
;
θθ# $
migrationBuilder
κκ 
.
κκ 
CreateIndex
κκ (
(
κκ( )
name
λλ 
:
λλ 
$str
λλ /
,
λλ/ 0
table
μμ 
:
μμ 
$str
μμ !
,
μμ! "
column
νν 
:
νν 
$str
νν %
)
νν% &
;
νν& '
migrationBuilder
οο 
.
οο 
CreateIndex
οο (
(
οο( )
name
ππ 
:
ππ 
$str
ππ &
,
ππ& '
table
ρρ 
:
ρρ 
$str
ρρ 
,
ρρ 
column
ςς 
:
ςς 
$str
ςς 
,
ςς  
unique
σσ 
:
σσ 
true
σσ 
)
σσ 
;
σσ 
}
ττ 	
	protected
χχ 
override
χχ 
void
χχ 
Down
χχ  $
(
χχ$ %
MigrationBuilder
χχ% 5
migrationBuilder
χχ6 F
)
χχF G
{
ψψ 	
migrationBuilder
ωω 
.
ωω 
	DropTable
ωω &
(
ωω& '
name
ϊϊ 
:
ϊϊ 
$str
ϊϊ +
)
ϊϊ+ ,
;
ϊϊ, -
migrationBuilder
όό 
.
όό 
	DropTable
όό &
(
όό& '
name
ύύ 
:
ύύ 
$str
ύύ "
)
ύύ" #
;
ύύ# $
migrationBuilder
 
.
 
	DropTable
 &
(
& '
name
€€ 
:
€€ 
$str
€€  
)
€€  !
;
€€! "
migrationBuilder
‚‚ 
.
‚‚ 
	DropTable
‚‚ &
(
‚‚& '
name
ƒƒ 
:
ƒƒ 
$str
ƒƒ  
)
ƒƒ  !
;
ƒƒ! "
migrationBuilder
…… 
.
…… 
	DropTable
…… &
(
……& '
name
†† 
:
†† 
$str
†† 
)
†† 
;
††  
migrationBuilder
 
.
 
	DropTable
 &
(
& '
name
‰‰ 
:
‰‰ 
$str
‰‰ 
)
‰‰ 
;
‰‰ 
}
 	
}
‹‹ 
} ΅=
^C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Payments\RefundPayment.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Payments& .
;. /
public

 
static

 
class

 
RefundPayment

 !
{ 
public 

record 
Command 
( 
Guid 
	PaymentId (
,( )
string* 0
?0 1
Reason2 8
)8 9
:: ;
IRequest< D
<D E
ResultE K
<K L

PaymentDtoL V
>V W
>W X
;X Y
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
	PaymentId $
)$ %
.% &
NotEmpty& .
(. /
)/ 0
;0 1
} 	
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Command4 ;
,; <
Result= C
<C D

PaymentDtoD N
>N O
>O P
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
private 
readonly 
StripeClient %
_stripeClient& 3
;3 4
public 
Handler 
( 
AppDbContext #
context$ +
,+ ,
StripeClient- 9
stripeClient: F
)F G
{ 	
_context 
= 
context 
; 
_stripeClient 
= 
stripeClient (
;( )
} 	
public!! 
async!! 
Task!! 
<!! 
Result!!  
<!!  !

PaymentDto!!! +
>!!+ ,
>!!, -
Handle!!. 4
(!!4 5
Command!!5 <
request!!= D
,!!D E
CancellationToken!!F W
cancellationToken!!X i
)!!i j
{"" 	
var## 
payment## 
=## 
await## 
_context##  (
.##( )
Payments##) 1
.$$ 
Include$$ 
($$ 
p$$ 
=>$$ 
p$$ 
.$$  
Order$$  %
)$$% &
.%% 
FirstOrDefaultAsync%% $
(%%$ %
p%%% &
=>%%' )
p%%* +
.%%+ ,
Id%%, .
==%%/ 1
request%%2 9
.%%9 :
	PaymentId%%: C
,%%C D
cancellationToken%%E V
)%%V W
;%%W X
if'' 
('' 
payment'' 
=='' 
null'' 
)''  
return(( 
Result(( 
<(( 

PaymentDto(( (
>((( )
.(() *
Failure((* 1
(((1 2
$str((2 E
)((E F
;((F G
if)) 
()) 
payment)) 
.)) 
Status)) 
!=)) !
PaymentStatus))" /
.))/ 0
	Completed))0 9
)))9 :
return** 
Result** 
<** 

PaymentDto** (
>**( )
.**) *
Failure*** 1
(**1 2
$str**2 _
)**_ `
;**` a
if++ 
(++ 
payment++ 
.++ 
Method++ 
!=++ !
PaymentMethod++" /
.++/ 0
Card++0 4
)++4 5
return,, 
Result,, 
<,, 

PaymentDto,, (
>,,( )
.,,) *
Failure,,* 1
(,,1 2
$str,,2 ]
),,] ^
;,,^ _
try// 
{00 
var11 
refundOptions11 !
=11" #
new11$ '
Stripe11( .
.11. /
RefundCreateOptions11/ B
{22 
PaymentIntent33 !
=33" #
payment33$ +
.33+ ,!
StripePaymentIntentId33, A
,33A B
Reason44 
=44 
string44 #
.44# $
IsNullOrWhiteSpace44$ 6
(446 7
request447 >
.44> ?
Reason44? E
)44E F
?44G H
null44I M
:44N O
$str44P g
}55 
;55 
var66 
refundService66 !
=66" #
new66$ '
Stripe66( .
.66. /
RefundService66/ <
(66< =
_stripeClient66= J
)66J K
;66K L
var77 
refund77 
=77 
await77 "
refundService77# 0
.770 1
CreateAsync771 <
(77< =
refundOptions77= J
,77J K
cancellationToken77L ]
:77] ^
cancellationToken77_ p
)77p q
;77q r
payment:: 
.:: 
Status:: 
=::  
PaymentStatus::! .
.::. /
Refunded::/ 7
;::7 8
payment;; 
.;; 
FailedAt;;  
=;;! "
DateTime;;# +
.;;+ ,
UtcNow;;, 2
;;;2 3
payment<< 
.<< 
FailureReason<< %
=<<& '
request<<( /
.<</ 0
Reason<<0 6
??<<7 9
$str<<: L
;<<L M
await>> 
_context>> 
.>> 
SaveChangesAsync>> /
(>>/ 0
cancellationToken>>0 A
)>>A B
;>>B C
return@@ 
Result@@ 
<@@ 

PaymentDto@@ (
>@@( )
.@@) *
Success@@* 1
(@@1 2
new@@2 5

PaymentDto@@6 @
{AA 
IdBB 
=BB 
paymentBB  
.BB  !
IdBB! #
,BB# $
OrderIdCC 
=CC 
paymentCC %
.CC% &
OrderIdCC& -
,CC- .
AmountDD 
=DD 
paymentDD $
.DD$ %
AmountDD% +
,DD+ ,
StatusEE 
=EE 
paymentEE $
.EE$ %
StatusEE% +
,EE+ ,
MethodFF 
=FF 
paymentFF $
.FF$ %
MethodFF% +
,FF+ ,!
StripePaymentIntentIdGG )
=GG* +
paymentGG, 3
.GG3 4!
StripePaymentIntentIdGG4 I
,GGI J
StripeSessionIdHH #
=HH$ %
paymentHH& -
.HH- .
StripeSessionIdHH. =
,HH= >
	CreatedAtII 
=II 
paymentII  '
.II' (
	CreatedAtII( 1
,II1 2
PaidAtJJ 
=JJ 
paymentJJ $
.JJ$ %
PaidAtJJ% +
,JJ+ ,
FailedAtKK 
=KK 
paymentKK &
.KK& '
FailedAtKK' /
,KK/ 0
FailureReasonLL !
=LL" #
paymentLL$ +
.LL+ ,
FailureReasonLL, 9
,LL9 :
LoyaltyPointsUsedMM %
=MM& '
paymentMM( /
.MM/ 0
LoyaltyPointsUsedMM0 A
}NN 
)NN 
;NN 
}OO 
catchPP 
(PP 
StripeExceptionPP "
exPP# %
)PP% &
{QQ 
returnRR 
ResultRR 
<RR 

PaymentDtoRR (
>RR( )
.RR) *
FailureRR* 1
(RR1 2
$strRR2 J
+RRK L
exRRM O
.RRO P
MessageRRP W
)RRW X
;RRX Y
}SS 
}TT 	
}UU 
}VV °­
_C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Payments\ProcessPayment.cs
	namespace

 	

CampusEats


 
.

 
Backend

 
.

 
Features

 %
.

% &
Payments

& .
;

. /
public 
static 
class 
ProcessPayment "
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,

PaymentDto, 6
>6 7
>7 8
{ 
public 
Guid 
OrderId 
{ 
get !
;! "
init# '
;' (
}) *
public 
string 
PaymentMethod #
{$ %
get& )
;) *
init+ /
;/ 0
}1 2
=3 4
string5 ;
.; <
Empty< A
;A B
public 
decimal 
Amount 
{ 
get  #
;# $
init% )
;) *
}+ ,
public 
decimal 
? 
LoyaltyPointsUsed )
{* +
get, /
;/ 0
init1 5
;5 6
}7 8
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
OrderId "
)" #
.# $
NotEmpty$ ,
(, -
)- .
;. /
RuleFor 
( 
x 
=> 
x 
. 
PaymentMethod (
)( )
.) *
NotEmpty* 2
(2 3
)3 4
.4 5
Must5 9
(9 :
m: ;
=>< >
PaymentMethodExists? R
(R S
mS T
)T U
)U V
. 
WithMessage 
( 
$str X
)X Y
;Y Z
RuleFor 
( 
x 
=> 
x 
. 
Amount !
)! "
." #
GreaterThan# .
(. /
$num/ 1
)1 2
;2 3
} 	
private   
bool   
PaymentMethodExists   (
(  ( )
string  ) /
value  0 5
)  5 6
=>  7 9
Enum!! 
.!! 
TryParse!! 
<!! 
PaymentMethod!! '
>!!' (
(!!( )
value!!) .
,!!. /
true!!0 4
,!!4 5
out!!6 9
var!!: =
_!!> ?
)!!? @
;!!@ A
}"" 
internal$$ 
sealed$$ 
class$$ 
Handler$$ !
:$$" #
IRequestHandler$$$ 3
<$$3 4
Command$$4 ;
,$$; <
Result$$= C
<$$C D

PaymentDto$$D N
>$$N O
>$$O P
{%% 
private&& 
readonly&& 
AppDbContext&& %
_context&&& .
;&&. /
private'' 
readonly'' 
StripeClient'' %
_stripeClient''& 3
;''3 4
public)) 
Handler)) 
()) 
AppDbContext)) #
context))$ +
,))+ ,
StripeClient))- 9
stripeClient)): F
)))F G
{** 	
_context++ 
=++ 
context++ 
;++ 
_stripeClient,, 
=,, 
stripeClient,, (
;,,( )
}-- 	
public// 
async// 
Task// 
<// 
Result//  
<//  !

PaymentDto//! +
>//+ ,
>//, -
Handle//. 4
(//4 5
Command//5 <
request//= D
,//D E
CancellationToken//F W
cancellationToken//X i
)//i j
{00 	
var11 
order11 
=11 
await11 
_context11 &
.11& '
Orders11' -
.11- .
Include11. 5
(115 6
o116 7
=>118 :
o11; <
.11< =
User11= A
)11A B
.22 
FirstOrDefaultAsync22 $
(22$ %
o22% &
=>22' )
o22* +
.22+ ,
Id22, .
==22/ 1
request222 9
.229 :
OrderId22: A
,22A B
cancellationToken22C T
)22T U
;22U V
if44 
(44 
order44 
is44 
null44 
)44 
return55 
Result55 
<55 

PaymentDto55 (
>55( )
.55) *
Failure55* 1
(551 2
$str552 C
)55C D
;55D E
if66 
(66 
order66 
.66 
PaymentStatus66 #
==66$ &
$str66' -
)66- .
return77 
Result77 
<77 

PaymentDto77 (
>77( )
.77) *
Failure77* 1
(771 2
$str772 I
)77I J
;77J K
var:: 
existingPayments::  
=::! "
await::# (
_context::) 1
.::1 2
Payments::2 :
.;; 
Where;; 
(;; 
p;; 
=>;; 
p;; 
.;; 
OrderId;; %
==;;& (
order;;) .
.;;. /
Id;;/ 1
&&;;2 4
(;;5 6
p;;6 7
.;;7 8
Status;;8 >
==;;? A
PaymentStatus;;B O
.;;O P
	Completed;;P Y
||;;Z \
p;;] ^
.;;^ _
Status;;_ e
==;;f h
PaymentStatus;;i v
.;;v w
Pending;;w ~
);;~ 
)	;; €
.<< 
Where<< 
(<< 
p<< 
=><< 
p<< 
.<< 
Status<< $
==<<% '
PaymentStatus<<( 5
.<<5 6
	Completed<<6 ?
)<<? @
.== 
SumAsync== 
(== 
p== 
=>== 
p==  
.==  !
Amount==! '
,==' (
cancellationToken==) :
)==: ;
;==; <
var?? 
remainingAmount?? 
=??  !
order??" '
.??' (
TotalAmount??( 3
-??4 5
existingPayments??6 F
;??F G
ifBB 
(BB 
requestBB 
.BB 
AmountBB 
<=BB !
$numBB" #
)BB# $
returnCC 
ResultCC 
<CC 

PaymentDtoCC (
>CC( )
.CC) *
FailureCC* 1
(CC1 2
$strCC2 Q
)CCQ R
;CCR S
ifEE 
(EE 
MathEE 
.EE 
AbsEE 
(EE 
requestEE  
.EE  !
AmountEE! '
-EE( )
remainingAmountEE* 9
)EE9 :
>EE; <
$numEE= B
)EEB C
returnFF 
ResultFF 
<FF 

PaymentDtoFF (
>FF( )
.FF) *
FailureFF* 1
(FF1 2
$"FF2 4
$strFF4 D
{FFD E
requestFFE L
.FFL M
AmountFFM S
}FFS T
$strFFT w
{FFw x
remainingAmount	FFx ‡
}
FF‡ 
$str
FF ‰
"
FF‰ 
)
FF ‹
;
FF‹ 
ifHH 
(HH 
!HH 
EnumHH 
.HH 
TryParseHH 
<HH 
PaymentMethodHH ,
>HH, -
(HH- .
requestHH. 5
.HH5 6
PaymentMethodHH6 C
,HHC D
trueHHE I
,HHI J
outHHK N
varHHO R
methodHHS Y
)HHY Z
)HHZ [
returnII 
ResultII 
<II 

PaymentDtoII (
>II( )
.II) *
FailureII* 1
(II1 2
$strII2 J
)IIJ K
;IIK L
varKK 
paymentKK 
=KK 
newKK 
PaymentKK %
{LL 
IdMM 
=MM 
GuidMM 
.MM 
NewGuidMM !
(MM! "
)MM" #
,MM# $
OrderIdNN 
=NN 
orderNN 
.NN  
IdNN  "
,NN" #
AmountOO 
=OO 
requestOO  
.OO  !
AmountOO! '
,OO' (
MethodPP 
=PP 
methodPP 
,PP  
	CreatedAtQQ 
=QQ 
DateTimeQQ $
.QQ$ %
UtcNowQQ% +
,QQ+ ,
StatusRR 
=RR 
PaymentStatusRR &
.RR& '
PendingRR' .
}SS 
;SS 
ifUU 
(UU 
methodUU 
==UU 
PaymentMethodUU '
.UU' (
CardUU( ,
)UU, -
{VV 
varXX 
frontendUrlXX 
=XX  !
EnvironmentXX" -
.XX- ."
GetEnvironmentVariableXX. D
(XXD E
$strXXE S
)XXS T
??XXU W
$strXXX o
;XXo p
var[[ 
sessionOptions[[ "
=[[# $
new[[% (
Stripe[[) /
.[[/ 0
Checkout[[0 8
.[[8 9 
SessionCreateOptions[[9 M
{\\ 
PaymentMethodTypes]] &
=]]' (
new]]) ,
List]]- 1
<]]1 2
string]]2 8
>]]8 9
{]]: ;
$str]]< B
}]]C D
,]]D E
Mode^^ 
=^^ 
$str^^ $
,^^$ %
	LineItems__ 
=__ 
new__  #
List__$ (
<__( )
Stripe__) /
.__/ 0
Checkout__0 8
.__8 9"
SessionLineItemOptions__9 O
>__O P
{`` 
newaa 
Stripeaa "
.aa" #
Checkoutaa# +
.aa+ ,"
SessionLineItemOptionsaa, B
{bb 
	PriceDatacc %
=cc& '
newcc( +
Stripecc, 2
.cc2 3
Checkoutcc3 ;
.cc; <+
SessionLineItemPriceDataOptionscc< [
{dd 
Currencyee  (
=ee) *
$stree+ 0
,ee0 1
ProductDataff  +
=ff, -
newff. 1
Stripeff2 8
.ff8 9
Checkoutff9 A
.ffA B6
*SessionLineItemPriceDataProductDataOptionsffB l
{gg  !
Namehh$ (
=hh) *
$"hh+ -
$strhh- ?
{hh? @
orderhh@ E
.hhE F
OrderNumberhhF Q
}hhQ R
"hhR S
,hhS T
Descriptionii$ /
=ii0 1
$"ii2 4
$strii4 >
{ii> ?
orderii? D
.iiD E
IdiiE G
}iiG H
$striiH _
"ii_ `
}jj  !
,jj! "

UnitAmountkk  *
=kk+ ,
(kk- .
longkk. 2
)kk2 3
(kk3 4
requestkk4 ;
.kk; <
Amountkk< B
*kkC D
$numkkE H
)kkH I
}ll 
,ll 
Quantitymm $
=mm% &
$nummm' (
}nn 
}oo 
,oo 

SuccessUrlqq 
=qq  
$"qq! #
{qq# $
frontendUrlqq$ /
}qq/ 0
$strqq0 n
{qqn o
orderqqo t
.qqt u
Idqqu w
}qqw x
"qqx y
,qqy z
	CancelUrlrr 
=rr 
$"rr  "
{rr" #
frontendUrlrr# .
}rr. /
$strrr/ I
{rrI J
orderrrJ O
.rrO P
IdrrP R
}rrR S
"rrS T
,rrT U
Metadatass 
=ss 
newss "

Dictionaryss# -
<ss- .
stringss. 4
,ss4 5
stringss6 <
>ss< =
{tt 
[uu 
$struu "
]uu" #
=uu$ %
orderuu& +
.uu+ ,
Iduu, .
.uu. /
ToStringuu/ 7
(uu7 8
)uu8 9
,uu9 :
[vv 
$strvv !
]vv! "
=vv# $
ordervv% *
.vv* +
UserIdvv+ 1
.vv1 2
ToStringvv2 :
(vv: ;
)vv; <
}ww 
}xx 
;xx 
varzz 
sessionServicezz "
=zz# $
newzz% (
Stripezz) /
.zz/ 0
Checkoutzz0 8
.zz8 9
SessionServicezz9 G
(zzG H
_stripeClientzzH U
)zzU V
;zzV W
try|| 
{}} 
var~~ 
session~~ 
=~~  !
await~~" '
sessionService~~( 6
.~~6 7
CreateAsync~~7 B
(~~B C
sessionOptions~~C Q
,~~Q R
cancellationToken~~S d
:~~d e
cancellationToken~~f w
)~~w x
;~~x y
payment
€€ 
.
€€ 
StripeSessionId
€€ +
=
€€, -
session
€€. 5
.
€€5 6
Id
€€6 8
;
€€8 9
payment
 
.
 
Status
 "
=
# $
PaymentStatus
% 2
.
2 3
Pending
3 :
;
: ;
_context
ƒƒ 
.
ƒƒ 
Payments
ƒƒ %
.
ƒƒ% &
Add
ƒƒ& )
(
ƒƒ) *
payment
ƒƒ* 1
)
ƒƒ1 2
;
ƒƒ2 3
await
„„ 
_context
„„ "
.
„„" #
SaveChangesAsync
„„# 3
(
„„3 4
cancellationToken
„„4 E
)
„„E F
;
„„F G
return
†† 
Result
†† !
<
††! "

PaymentDto
††" ,
>
††, -
.
††- .
Success
††. 5
(
††5 6
new
††6 9

PaymentDto
††: D
{
‡‡ 
Id
 
=
 
payment
 $
.
$ %
Id
% '
,
' (
OrderId
‰‰ 
=
‰‰  !
payment
‰‰" )
.
‰‰) *
OrderId
‰‰* 1
,
‰‰1 2
Amount
 
=
  
payment
! (
.
( )
Amount
) /
,
/ 0
Status
‹‹ 
=
‹‹  
payment
‹‹! (
.
‹‹( )
Status
‹‹) /
,
‹‹/ 0
Method
 
=
  
payment
! (
.
( )
Method
) /
,
/ 0
StripeSessionId
 '
=
( )
payment
* 1
.
1 2
StripeSessionId
2 A
,
A B 
StripeClientSecret
 *
=
+ ,
session
- 4
.
4 5
Url
5 8
,
8 9
	CreatedAt
 !
=
" #
payment
$ +
.
+ ,
	CreatedAt
, 5
}
 
)
 
;
 
}
‘‘ 
catch
’’ 
(
’’ 
StripeException
’’ &
ex
’’' )
)
’’) *
{
““ 
payment
”” 
.
”” 
Status
”” "
=
””# $
PaymentStatus
””% 2
.
””2 3
Failed
””3 9
;
””9 :
payment
•• 
.
•• 
FailureReason
•• )
=
••* +
ex
••, .
.
••. /
StripeError
••/ :
?
••: ;
.
••; <
Message
••< C
??
••D F
ex
••G I
.
••I J
Message
••J Q
;
••Q R
payment
–– 
.
–– 
FailedAt
–– $
=
––% &
DateTime
––' /
.
––/ 0
UtcNow
––0 6
;
––6 7
_context
 
.
 
Payments
 %
.
% &
Add
& )
(
) *
payment
* 1
)
1 2
;
2 3
await
™™ 
_context
™™ "
.
™™" #
SaveChangesAsync
™™# 3
(
™™3 4
cancellationToken
™™4 E
)
™™E F
;
™™F G
return
 
Result
 !
<
! "

PaymentDto
" ,
>
, -
.
- .
Failure
. 5
(
5 6
$str
6 O
+
P Q
payment
R Y
.
Y Z
FailureReason
Z g
)
g h
;
h i
}
›› 
}
 
else
 
if
 
(
 
method
 
==
 
PaymentMethod
 ,
.
, -
Cash
- 1
)
1 2
{
 
payment
 
.
 
Status
 
=
  
PaymentStatus
! .
.
. /
Pending
/ 6
;
6 7
}
   
else
΅΅ 
if
΅΅ 
(
΅΅ 
method
΅΅ 
==
΅΅ 
PaymentMethod
΅΅ ,
.
΅΅, -
LoyaltyPoints
΅΅- :
)
΅΅: ;
{
ΆΆ 
var
££ 
pointsNeeded
££  
=
££! "
request
££# *
.
££* +
LoyaltyPointsUsed
££+ <
??
££= ?
$num
££@ B
;
££B C
if
¤¤ 
(
¤¤ 
order
¤¤ 
.
¤¤ 
User
¤¤ 
.
¤¤ 
LoyaltyPoints
¤¤ ,
<
¤¤- .
pointsNeeded
¤¤/ ;
)
¤¤; <
return
¥¥ 
Result
¥¥ !
<
¥¥! "

PaymentDto
¥¥" ,
>
¥¥, -
.
¥¥- .
Failure
¥¥. 5
(
¥¥5 6
$str
¥¥6 S
)
¥¥S T
;
¥¥T U
order
§§ 
.
§§ 
User
§§ 
.
§§ 
LoyaltyPoints
§§ (
-=
§§) +
pointsNeeded
§§, 8
;
§§8 9
payment
¨¨ 
.
¨¨ 
Status
¨¨ 
=
¨¨  
PaymentStatus
¨¨! .
.
¨¨. /
	Completed
¨¨/ 8
;
¨¨8 9
payment
©© 
.
©© 
PaidAt
©© 
=
©©  
DateTime
©©! )
.
©©) *
UtcNow
©©* 0
;
©©0 1
payment
 
.
 
LoyaltyPointsUsed
 )
=
* +
pointsNeeded
, 8
;
8 9
}
«« 
else
¬¬ 
{
­­ 
return
®® 
Result
®® 
<
®® 

PaymentDto
®® (
>
®®( )
.
®®) *
Failure
®®* 1
(
®®1 2
$str
®®2 J
)
®®J K
;
®®K L
}
―― 
_context
±± 
.
±± 
Payments
±± 
.
±± 
Add
±± !
(
±±! "
payment
±±" )
)
±±) *
;
±±* +
await
²² 
_context
²² 
.
²² 
SaveChangesAsync
²² +
(
²²+ ,
cancellationToken
²², =
)
²²= >
;
²²> ?
var
µµ 
amountCovered
µµ 
=
µµ 
existingPayments
µµ  0
;
µµ0 1
if
¶¶ 
(
¶¶ 
payment
¶¶ 
.
¶¶ 
Status
¶¶ 
==
¶¶ !
PaymentStatus
¶¶" /
.
¶¶/ 0
	Completed
¶¶0 9
)
¶¶9 :
amountCovered
¶¶; H
+=
¶¶I K
payment
¶¶L S
.
¶¶S T
Amount
¶¶T Z
;
¶¶Z [
if
ΉΉ 
(
ΉΉ 
amountCovered
ΉΉ 
>=
ΉΉ  
order
ΉΉ! &
.
ΉΉ& '
TotalAmount
ΉΉ' 2
-
ΉΉ3 4
$num
ΉΉ5 :
)
ΉΉ: ;
{
ΊΊ 
order
»» 
.
»» 
PaymentStatus
»» #
=
»»$ %
$str
»»& ,
;
»», -
}
ΌΌ 
else
½½ 
{
ΎΎ 
if
ΏΏ 
(
ΏΏ 
existingPayments
ΏΏ $
>
ΏΏ% &
$num
ΏΏ' (
)
ΏΏ( )
order
ΐΐ 
.
ΐΐ 
PaymentStatus
ΐΐ '
=
ΐΐ( )
$str
ΐΐ* 3
;
ΐΐ3 4
else
ΑΑ 
order
ΒΒ 
.
ΒΒ 
PaymentStatus
ΒΒ '
=
ΒΒ( )
$str
ΒΒ* 3
;
ΒΒ3 4
}
ΓΓ 
await
ΕΕ 
_context
ΕΕ 
.
ΕΕ 
SaveChangesAsync
ΕΕ +
(
ΕΕ+ ,
cancellationToken
ΕΕ, =
)
ΕΕ= >
;
ΕΕ> ?
return
ΗΗ 
Result
ΗΗ 
<
ΗΗ 

PaymentDto
ΗΗ $
>
ΗΗ$ %
.
ΗΗ% &
Success
ΗΗ& -
(
ΗΗ- .
new
ΗΗ. 1

PaymentDto
ΗΗ2 <
{
ΘΘ 
Id
ΙΙ 
=
ΙΙ 
payment
ΙΙ 
.
ΙΙ 
Id
ΙΙ 
,
ΙΙ  
OrderId
ΚΚ 
=
ΚΚ 
payment
ΚΚ !
.
ΚΚ! "
OrderId
ΚΚ" )
,
ΚΚ) *
Amount
ΛΛ 
=
ΛΛ 
payment
ΛΛ  
.
ΛΛ  !
Amount
ΛΛ! '
,
ΛΛ' (
Status
ΜΜ 
=
ΜΜ 
payment
ΜΜ  
.
ΜΜ  !
Status
ΜΜ! '
,
ΜΜ' (
Method
ΝΝ 
=
ΝΝ 
payment
ΝΝ  
.
ΝΝ  !
Method
ΝΝ! '
,
ΝΝ' (#
StripePaymentIntentId
ΞΞ %
=
ΞΞ& '
payment
ΞΞ( /
.
ΞΞ/ 0#
StripePaymentIntentId
ΞΞ0 E
,
ΞΞE F
StripeSessionId
ΟΟ 
=
ΟΟ  !
payment
ΟΟ" )
.
ΟΟ) *
StripeSessionId
ΟΟ* 9
,
ΟΟ9 : 
StripeClientSecret
ΠΠ "
=
ΠΠ# $
null
ΠΠ% )
,
ΠΠ) *
	CreatedAt
ΡΡ 
=
ΡΡ 
payment
ΡΡ #
.
ΡΡ# $
	CreatedAt
ΡΡ$ -
,
ΡΡ- .
PaidAt
 
=
 
payment
  
.
  !
PaidAt
! '
,
' (
FailedAt
ΣΣ 
=
ΣΣ 
payment
ΣΣ "
.
ΣΣ" #
FailedAt
ΣΣ# +
,
ΣΣ+ ,
FailureReason
ΤΤ 
=
ΤΤ 
payment
ΤΤ  '
.
ΤΤ' (
FailureReason
ΤΤ( 5
,
ΤΤ5 6
LoyaltyPointsUsed
ΥΥ !
=
ΥΥ" #
payment
ΥΥ$ +
.
ΥΥ+ ,
LoyaltyPointsUsed
ΥΥ, =
}
ΦΦ 
)
ΦΦ 
;
ΦΦ 
}
ΧΧ 	
}
ΨΨ 
}ΩΩ γ8
`C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Payments\GetUserPayments.cs
public 
static 
class 
GetUserPayments #
{ 
public 

record 
Query 
( 
Guid		 
UserId		 
,		 
int

 
Page

 
=

 
$num

 
,

 
int 
PageSize 
= 
$num 
, 
string 
? 
Status 
= 
null 
, 
string 
? 
Method 
= 
null 
) 
: 
IRequest 
< 
Result 
< 
PagedResult #
<# $

PaymentDto$ .
>. /
>/ 0
>0 1
;1 2
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
PagedResultB M
<M N

PaymentDtoN X
>X Y
>Y Z
>Z [
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
PagedResult! ,
<, -

PaymentDto- 7
>7 8
>8 9
>9 :
Handle; A
(A B
QueryB G
requestH O
,O P
CancellationTokenQ b
cancellationTokenc t
)t u
{ 	
var 
query 
= 
_context  
.  !
Payments! )
. 
Include 
( 
p 
=> 
p 
.  
Order  %
)% &
. 
Where 
( 
p 
=> 
p 
. 
Order #
.# $
UserId$ *
==+ -
request. 5
.5 6
UserId6 <
)< =
;= >
if 
( 
! 
string 
. 
IsNullOrWhiteSpace *
(* +
request+ 2
.2 3
Status3 9
)9 :
&&; =
Enum   
.   
TryParse   
<   
PaymentStatus   +
>  + ,
(  , -
request  - 4
.  4 5
Status  5 ;
,  ; <
true  = A
,  A B
out  C F
var  G J
status  K Q
)  Q R
)  R S
query!! 
=!! 
query!! 
.!! 
Where!! #
(!!# $
p!!$ %
=>!!& (
p!!) *
.!!* +
Status!!+ 1
==!!2 4
status!!5 ;
)!!; <
;!!< =
if## 
(## 
!## 
string## 
.## 
IsNullOrWhiteSpace## *
(##* +
request##+ 2
.##2 3
Method##3 9
)##9 :
&&##; =
Enum$$ 
.$$ 
TryParse$$ 
<$$ 
PaymentMethod$$ +
>$$+ ,
($$, -
request$$- 4
.$$4 5
Method$$5 ;
,$$; <
true$$= A
,$$A B
out$$C F
var$$G J
method$$K Q
)$$Q R
)$$R S
query%% 
=%% 
query%% 
.%% 
Where%% #
(%%# $
p%%$ %
=>%%& (
p%%) *
.%%* +
Method%%+ 1
==%%2 4
method%%5 ;
)%%; <
;%%< =
var'' 

totalCount'' 
='' 
await'' "
query''# (
.''( )

CountAsync'') 3
(''3 4
cancellationToken''4 E
)''E F
;''F G
var)) 
items)) 
=)) 
await)) 
query)) #
.** 
OrderByDescending** "
(**" #
p**# $
=>**% '
p**( )
.**) *
	CreatedAt*** 3
)**3 4
.++ 
Skip++ 
(++ 
(++ 
request++ 
.++ 
Page++ #
-++$ %
$num++& '
)++' (
*++) *
request+++ 2
.++2 3
PageSize++3 ;
)++; <
.,, 
Take,, 
(,, 
request,, 
.,, 
PageSize,, &
),,& '
.-- 
Select-- 
(-- 
p-- 
=>-- 
new--  

PaymentDto--! +
{.. 
Id// 
=// 
p// 
.// 
Id// 
,// 
OrderId00 
=00 
p00 
.00  
OrderId00  '
,00' (
Amount11 
=11 
p11 
.11 
Amount11 %
,11% &
Status22 
=22 
p22 
.22 
Status22 %
,22% &
Method33 
=33 
p33 
.33 
Method33 %
,33% &!
StripePaymentIntentId44 )
=44* +
p44, -
.44- .!
StripePaymentIntentId44. C
,44C D
StripeSessionId55 #
=55$ %
p55& '
.55' (
StripeSessionId55( 7
,557 8
StripeClientSecret66 &
=66' (
null66) -
,66- .
	CreatedAt77 
=77 
p77  !
.77! "
	CreatedAt77" +
,77+ ,
PaidAt88 
=88 
p88 
.88 
PaidAt88 %
,88% &
FailedAt99 
=99 
p99  
.99  !
FailedAt99! )
,99) *
FailureReason:: !
=::" #
p::$ %
.::% &
FailureReason::& 3
,::3 4
LoyaltyPointsUsed;; %
=;;& '
p;;( )
.;;) *
LoyaltyPointsUsed;;* ;
}<< 
)<< 
.== 
ToListAsync== 
(== 
cancellationToken== .
)==. /
;==/ 0
return?? 
Result?? 
<?? 
PagedResult?? %
<??% &

PaymentDto??& 0
>??0 1
>??1 2
.??2 3
Success??3 :
(??: ;
new??; >
PagedResult??? J
<??J K

PaymentDto??K U
>??U V
{@@ 
CurrentPageAA 
=AA 
requestAA %
.AA% &
PageAA& *
,AA* +
PageSizeBB 
=BB 
requestBB "
.BB" #
PageSizeBB# +
,BB+ ,

TotalCountCC 
=CC 

totalCountCC '
,CC' (
ItemsDD 
=DD 
itemsDD 
}EE 
)EE 
;EE 
}FF 	
}GG 
}HH ¥
aC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Payments\GetOrderPayments.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Payments& .
;. /
public 
static 
class 
GetOrderPayments $
{ 
public		 

record		 
Query		 
(		 
Guid		 
OrderId		 $
)		$ %
:		& '
IRequest		( 0
<		0 1
List		1 5
<		5 6

PaymentDto		6 @
>		@ A
>		A B
;		B C
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
List; ?
<? @

PaymentDto@ J
>J K
>K L
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
=>- /
_context0 8
=9 :
context; B
;B C
public 
async 
Task 
< 
List 
< 

PaymentDto )
>) *
>* +
Handle, 2
(2 3
Query3 8
request9 @
,@ A
CancellationTokenB S
cancellationTokenT e
)e f
{ 	
var 
payments 
= 
await  
_context! )
.) *
Payments* 2
. 
Where 
( 
x 
=> 
x 
. 
OrderId %
==& (
request) 0
.0 1
OrderId1 8
)8 9
. 
OrderByDescending "
(" #
x# $
=>% '
x( )
.) *
	CreatedAt* 3
)3 4
. 
Select 
( 
p 
=> 
new  

PaymentDto! +
{ 
Id 
= 
p 
. 
Id 
, 
OrderId 
= 
p 
.  
OrderId  '
,' (
Amount 
= 
p 
. 
Amount %
,% &
Status 
= 
p 
. 
Status %
,% &
Method 
= 
p 
. 
Method %
,% &!
StripePaymentIntentId )
=* +
p, -
.- .!
StripePaymentIntentId. C
,C D
StripeSessionId #
=$ %
p& '
.' (
StripeSessionId( 7
,7 8
	CreatedAt 
= 
p  !
.! "
	CreatedAt" +
,+ ,
PaidAt 
= 
p 
. 
PaidAt %
,% &
FailedAt   
=   
p    
.    !
FailedAt  ! )
,  ) *
FailureReason!! !
=!!" #
p!!$ %
.!!% &
FailureReason!!& 3
,!!3 4
LoyaltyPointsUsed"" %
=""& '
p""( )
."") *
LoyaltyPointsUsed""* ;
}## 
)## 
.$$ 
ToListAsync$$ 
($$ 
cancellationToken$$ .
)$$. /
;$$/ 0
return&& 
payments&& 
;&& 
}'' 	
}(( 
})) 7
_C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Payments\GetAllPayments.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Payments& .
;. /
public 
static 
class 
GetAllPayments "
{		 
public

 

record

 
Query

 
(

 
int 
Page 
= 
$num 
, 
int 
PageSize 
= 
$num 
, 
string 
? 
Status 
= 
null 
, 
string 
? 
Method 
= 
null 
) 
: 
IRequest 
< 
Result 
< 
PagedResult #
<# $

PaymentDto$ .
>. /
>/ 0
>0 1
;1 2
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
PagedResultB M
<M N

PaymentDtoN X
>X Y
>Y Z
>Z [
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
=>- /
_context0 8
=9 :
context; B
;B C
public 
async 
Task 
< 
Result  
<  !
PagedResult! ,
<, -

PaymentDto- 7
>7 8
>8 9
>9 :
Handle; A
(A B
QueryB G
requestH O
,O P
CancellationTokenQ b
cancellationTokenc t
)t u
{ 	
var 
query 
= 
_context  
.  !
Payments! )
.) *
AsQueryable* 5
(5 6
)6 7
;7 8
if 
( 
! 
string 
. 
IsNullOrWhiteSpace *
(* +
request+ 2
.2 3
Status3 9
)9 :
&&; =
Enum 
. 
TryParse 
< 
PaymentStatus +
>+ ,
(, -
request- 4
.4 5
Status5 ;
,; <
true= A
,A B
outC F
varG J
statusK Q
)Q R
)R S
query 
= 
query 
. 
Where #
(# $
p$ %
=>& (
p) *
.* +
Status+ 1
==2 4
status5 ;
); <
;< =
if 
( 
! 
string 
. 
IsNullOrWhiteSpace *
(* +
request+ 2
.2 3
Method3 9
)9 :
&&; =
Enum 
. 
TryParse 
< 
PaymentMethod +
>+ ,
(, -
request- 4
.4 5
Method5 ;
,; <
true= A
,A B
outC F
varG J
methodK Q
)Q R
)R S
query   
=   
query   
.   
Where   #
(  # $
p  $ %
=>  & (
p  ) *
.  * +
Method  + 1
==  2 4
method  5 ;
)  ; <
;  < =
var"" 

totalCount"" 
="" 
await"" "
query""# (
.""( )

CountAsync"") 3
(""3 4
cancellationToken""4 E
)""E F
;""F G
var$$ 
items$$ 
=$$ 
await$$ 
query$$ #
.$$# $
OrderByDescending$$$ 5
($$5 6
p$$6 7
=>$$8 :
p$$; <
.$$< =
	CreatedAt$$= F
)$$F G
.%%# $
Skip%%$ (
(%%( )
(%%) *
request%%* 1
.%%1 2
Page%%2 6
-%%7 8
$num%%9 :
)%%: ;
*%%< =
request%%> E
.%%E F
PageSize%%F N
)%%N O
.&&# $
Take&&$ (
(&&( )
request&&) 0
.&&0 1
PageSize&&1 9
)&&9 :
.''# $
Select''$ *
(''* +
p''+ ,
=>''- /
new''0 3

PaymentDto''4 >
{((# $
Id))' )
=))* +
p)), -
.))- .
Id)). 0
,))0 1
OrderId**' .
=**/ 0
p**1 2
.**2 3
OrderId**3 :
,**: ;
Amount++' -
=++. /
p++0 1
.++1 2
Amount++2 8
,++8 9
Status,,' -
=,,. /
p,,0 1
.,,1 2
Status,,2 8
,,,8 9
Method--' -
=--. /
p--0 1
.--1 2
Method--2 8
,--8 9!
StripePaymentIntentId..' <
=..= >
p..? @
...@ A!
StripePaymentIntentId..A V
,..V W
StripeSessionId//' 6
=//7 8
p//9 :
.//: ;
StripeSessionId//; J
,//J K
StripeClientSecret00' 9
=00: ;
null00< @
,00@ A
	CreatedAt11' 0
=111 2
p113 4
.114 5
	CreatedAt115 >
,11> ?
PaidAt22' -
=22. /
p220 1
.221 2
PaidAt222 8
,228 9
FailedAt33' /
=330 1
p332 3
.333 4
FailedAt334 <
,33< =
FailureReason44' 4
=445 6
p447 8
.448 9
FailureReason449 F
,44F G
LoyaltyPointsUsed55' 8
=559 :
p55; <
.55< =
LoyaltyPointsUsed55= N
}66# $
)66$ %
.77# $
ToListAsync77$ /
(77/ 0
cancellationToken770 A
)77A B
;77B C
return99 
Result99 
<99 
PagedResult99 %
<99% &

PaymentDto99& 0
>990 1
>991 2
.992 3
Success993 :
(99: ;
new99; >
PagedResult99? J
<99J K

PaymentDto99K U
>99U V
{:: 
CurrentPage;; 
=;; 
request;; %
.;;% &
Page;;& *
,;;* +
PageSize<< 
=<< 
request<< "
.<<" #
PageSize<<# +
,<<+ ,

TotalCount== 
=== 

totalCount== '
,==' (
Items>> 
=>> 
items>> 
}?? 
)?? 
;?? 
}@@ 	
}AA 
}BB ο3
\C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Orders\GetUserOrders.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Orders& ,
;, -
public		 
static		 
class		 
GetUserOrders		 !
{

 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
List* .
<. /
OrderDto/ 7
>7 8
>8 9
>9 :
{ 
public 
Guid 
UserId 
{ 
get  
;  !
init" &
;& '
}( )
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
ListB F
<F G
OrderDtoG O
>O P
>P Q
>Q R
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
List! %
<% &
OrderDto& .
>. /
>/ 0
>0 1
Handle2 8
(8 9
Query9 >
request? F
,F G
CancellationTokenH Y
cancellationTokenZ k
)k l
{ 	
var 

userExists 
= 
await "
_context# +
.+ ,
Users, 1
.1 2
AnyAsync2 :
(: ;
u; <
=>= ?
u@ A
.A B
IdB D
==E G
requestH O
.O P
UserIdP V
,V W
cancellationTokenX i
)i j
;j k
if 
( 
! 

userExists 
) 
{   
return!! 
Result!! 
<!! 
List!! "
<!!" #
OrderDto!!# +
>!!+ ,
>!!, -
.!!- .
Failure!!. 5
(!!5 6
$"!!6 8
$str!!8 E
{!!E F
request!!F M
.!!M N
UserId!!N T
}!!T U
$str!!U _
"!!_ `
)!!` a
;!!a b
}"" 
var%% 
orders%% 
=%% 
await%% 
_context%% '
.%%' (
Orders%%( .
.&& 
AsNoTracking&& 
(&& 
)&& 
.'' 
Where'' 
('' 
o'' 
=>'' 
o'' 
.'' 
UserId'' $
==''% '
request''( /
.''/ 0
UserId''0 6
)''6 7
.(( 
Include(( 
((( 
o(( 
=>(( 
o(( 
.((  

OrderItems((  *
)((* +
.)) 
ThenInclude))  
())  !
oi))! #
=>))$ &
oi))' )
.))) *
Product))* 1
)))1 2
.** 
OrderByDescending** "
(**" #
o**# $
=>**% '
o**( )
.**) *
	CreatedAt*** 3
)**3 4
.++ 
ToListAsync++ 
(++ 
cancellationToken++ .
)++. /
;++/ 0
var.. 
	orderDtos.. 
=.. 
orders.. "
..." #
Select..# )
(..) *
order..* /
=>..0 2
new..3 6
OrderDto..7 ?
{// 
Id00 
=00 
order00 
.00 
Id00 
,00 
OrderNumber11 
=11 
order11 #
.11# $
OrderNumber11$ /
,11/ 0
UserId22 
=22 
order22 
.22 
UserId22 %
,22% &
TotalAmount33 
=33 
order33 #
.33# $
TotalAmount33$ /
,33/ 0
Status44 
=44 
order44 
.44 
Status44 %
,44% &
PaymentStatus55 
=55 
order55  %
.55% &
PaymentStatus55& 3
,553 4
PaymentMethod66 
=66 
order66  %
.66% &
PaymentMethod66& 3
,663 4
Notes77 
=77 
order77 
.77 
Notes77 #
,77# $
	CreatedAt88 
=88 
order88 !
.88! "
	CreatedAt88" +
,88+ ,
	UpdatedAt99 
=99 
order99 !
.99! "
	UpdatedAt99" +
,99+ ,
CompletedAt:: 
=:: 
order:: #
.::# $
CompletedAt::$ /
,::/ 0

OrderItems;; 
=;; 
order;; "
.;;" #

OrderItems;;# -
.;;- .
Select;;. 4
(;;4 5
oi;;5 7
=>;;8 :
new;;; >
OrderItemDto;;? K
{<< 
Id== 
=== 
oi== 
.== 
Id== 
,== 
	ProductId>> 
=>> 
oi>>  "
.>>" #
	ProductId>># ,
,>>, -
ProductName?? 
=??  !
oi??" $
.??$ %
Product??% ,
.??, -
Name??- 1
,??1 2
Quantity@@ 
=@@ 
oi@@ !
.@@! "
Quantity@@" *
,@@* +
	UnitPriceAA 
=AA 
oiAA  "
.AA" #
	UnitPriceAA# ,
,AA, -
SubtotalBB 
=BB 
oiBB !
.BB! "
SubtotalBB" *
,BB* +
SpecialInstructionsCC '
=CC( )
oiCC* ,
.CC, -
SpecialInstructionsCC- @
}DD 
)DD 
.DD 
ToListDD 
(DD 
)DD 
}EE 
)EE 
.EE 
ToListEE 
(EE 
)EE 
;EE 
returnGG 
ResultGG 
<GG 
ListGG 
<GG 
OrderDtoGG '
>GG' (
>GG( )
.GG) *
SuccessGG* 1
(GG1 2
	orderDtosGG2 ;
)GG; <
;GG< =
}HH 	
}II 
}JJ 0
[C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Orders\GetOrderById.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Orders& ,
;, -
public		 
static		 
class		 
GetOrderById		  
{

 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
OrderDto* 2
>2 3
>3 4
{ 
public 
Guid 
OrderId 
{ 
get !
;! "
init# '
;' (
}) *
public 
Guid 
UserId 
{ 
get  
;  !
init" &
;& '
}( )
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
OrderDtoB J
>J K
>K L
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
OrderDto! )
>) *
>* +
Handle, 2
(2 3
Query3 8
request9 @
,@ A
CancellationTokenB S
cancellationTokenT e
)e f
{ 	
var 
order 
= 
await 
_context &
.& '
Orders' -
.   
AsNoTracking   
(   
)   
.!! 
Include!! 
(!! 
o!! 
=>!! 
o!! 
.!!  

OrderItems!!  *
)!!* +
."" 
ThenInclude""  
(""  !
oi""! #
=>""$ &
oi""' )
."") *
Product""* 1
)""1 2
.## 
FirstOrDefaultAsync## $
(##$ %
o##% &
=>##' )
o##* +
.##+ ,
Id##, .
==##/ 1
request##2 9
.##9 :
OrderId##: A
,##A B
cancellationToken##C T
)##T U
;##U V
if&& 
(&& 
order&& 
is&& 
null&& 
)&& 
{'' 
return(( 
Result(( 
<(( 
OrderDto(( &
>((& '
.((' (
Failure((( /
(((/ 0
$"((0 2
$str((2 @
{((@ A
request((A H
.((H I
OrderId((I P
}((P Q
$str((Q [
"(([ \
)((\ ]
;((] ^
})) 
if,, 
(,, 
order,, 
.,, 
UserId,, 
!=,, 
request,,  '
.,,' (
UserId,,( .
),,. /
{-- 
return.. 
Result.. 
<.. 
OrderDto.. &
>..& '
...' (
Failure..( /
(../ 0
$str..0 [
)..[ \
;..\ ]
}// 
var22 
orderDto22 
=22 
new22 
OrderDto22 '
{33 
Id44 
=44 
order44 
.44 
Id44 
,44 
OrderNumber55 
=55 
order55 #
.55# $
OrderNumber55$ /
,55/ 0
UserId66 
=66 
order66 
.66 
UserId66 %
,66% &
TotalAmount77 
=77 
order77 #
.77# $
TotalAmount77$ /
,77/ 0
Status88 
=88 
order88 
.88 
Status88 %
,88% &
PaymentStatus99 
=99 
order99  %
.99% &
PaymentStatus99& 3
,993 4
PaymentMethod:: 
=:: 
order::  %
.::% &
PaymentMethod::& 3
,::3 4
Notes;; 
=;; 
order;; 
.;; 
Notes;; #
,;;# $
	CreatedAt<< 
=<< 
order<< !
.<<! "
	CreatedAt<<" +
,<<+ ,
	UpdatedAt== 
=== 
order== !
.==! "
	UpdatedAt==" +
,==+ ,
CompletedAt>> 
=>> 
order>> #
.>># $
CompletedAt>>$ /
,>>/ 0

OrderItems?? 
=?? 
order?? "
.??" #

OrderItems??# -
.??- .
Select??. 4
(??4 5
oi??5 7
=>??8 :
new??; >
OrderItemDto??? K
{@@ 
IdAA 
=AA 
oiAA 
.AA 
IdAA 
,AA 
	ProductIdBB 
=BB 
oiBB  "
.BB" #
	ProductIdBB# ,
,BB, -
ProductNameCC 
=CC  !
oiCC" $
.CC$ %
ProductCC% ,
.CC, -
NameCC- 1
,CC1 2
QuantityDD 
=DD 
oiDD !
.DD! "
QuantityDD" *
,DD* +
	UnitPriceEE 
=EE 
oiEE  "
.EE" #
	UnitPriceEE# ,
,EE, -
SubtotalFF 
=FF 
oiFF !
.FF! "
SubtotalFF" *
,FF* +
SpecialInstructionsGG '
=GG( )
oiGG* ,
.GG, -
SpecialInstructionsGG- @
}HH 
)HH 
.HH 
ToListHH 
(HH 
)HH 
}II 
;II 
returnKK 
ResultKK 
<KK 
OrderDtoKK "
>KK" #
.KK# $
SuccessKK$ +
(KK+ ,
orderDtoKK, 4
)KK4 5
;KK5 6
}LL 	
}MM 
}NN “‹
ZC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Orders\CreateOrder.cs
	namespace		 	

CampusEats		
 
.		 
Backend		 
.		 
Features		 %
.		% &
Orders		& ,
;		, -
public 
static 
class 
CreateOrder 
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,
OrderDto, 4
>4 5
>5 6
{ 
public 
Guid 
UserId 
{ 
get  
;  !
init" &
;& '
}( )
public 
string 
? 
PaymentMethod $
{% &
get' *
;* +
init, 0
;0 1
}2 3
public 
string 
? 
Notes 
{ 
get "
;" #
init$ (
;( )
}* +
public 
List 
< 
OrderItemRequest $
>$ %
Items& +
{, -
get. 1
;1 2
init3 7
;7 8
}9 :
=; <
new= @
(@ A
)A B
;B C
} 
public 

record 
OrderItemRequest "
{ 
public 
Guid 
	ProductId 
{ 
get  #
;# $
init% )
;) *
}+ ,
public 
int 
Quantity 
{ 
get !
;! "
init# '
;' (
}) *
public 
string 
? 
SpecialInstructions *
{+ ,
get- 0
;0 1
init2 6
;6 7
}8 9
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public   
	Validator   
(   
)   
{!! 	
RuleFor"" 
("" 
x"" 
=>"" 
x"" 
."" 
UserId"" !
)""! "
.## 
NotEmpty## 
(## 
)## 
.## 
WithMessage## '
(##' (
$str##( =
)##= >
;##> ?
RuleFor%% 
(%% 
x%% 
=>%% 
x%% 
.%% 
Items%%  
)%%  !
.&& 
NotEmpty&& 
(&& 
)&& 
.&& 
WithMessage&& '
(&&' (
$str&&( N
)&&N O
.'' 
Must'' 
('' 
items'' 
=>'' 
items'' $
.''$ %
Count''% *
>''+ ,
$num''- .
)''. /
.''/ 0
WithMessage''0 ;
(''; <
$str''< b
)''b c
;''c d
RuleForEach)) 
()) 
x)) 
=>)) 
x)) 
.)) 
Items)) $
)))$ %
.))% &

ChildRules))& 0
())0 1
item))1 5
=>))6 8
{** 
item++ 
.++ 
RuleFor++ 
(++ 
x++ 
=>++ !
x++" #
.++# $
	ProductId++$ -
)++- .
.,, 
NotEmpty,, 
(,, 
),, 
.,,  
WithMessage,,  +
(,,+ ,
$str,,, D
),,D E
;,,E F
item.. 
... 
RuleFor.. 
(.. 
x.. 
=>.. !
x.." #
...# $
Quantity..$ ,
).., -
.// 
GreaterThan//  
(//  !
$num//! "
)//" #
.//# $
WithMessage//$ /
(/// 0
$str//0 Q
)//Q R
.00 
LessThanOrEqualTo00 &
(00& '
$num00' )
)00) *
.00* +
WithMessage00+ 6
(006 7
$str007 X
)00X Y
;00Y Z
}11 
)11 
;11 
RuleFor33 
(33 
x33 
=>33 
x33 
.33 
PaymentMethod33 (
)33( )
.44 
Must44 
(44 
pm44 
=>44 
string44 "
.44" #
IsNullOrEmpty44# 0
(440 1
pm441 3
)443 4
||445 7
new448 ;
[44; <
]44< =
{44> ?
$str44@ F
,44F G
$str44H N
,44N O
$str44P Y
}44Z [
.44[ \
Contains44\ d
(44d e
pm44e g
)44g h
)44h i
.55 
When55 
(55 
x55 
=>55 
!55 
string55 "
.55" #
IsNullOrEmpty55# 0
(550 1
x551 2
.552 3
PaymentMethod553 @
)55@ A
)55A B
.66 
WithMessage66 
(66 
$str66 Q
)66Q R
;66R S
}77 	
}88 
internal;; 
sealed;; 
class;; 
Handler;; !
:;;" #
IRequestHandler;;$ 3
<;;3 4
Command;;4 ;
,;;; <
Result;;= C
<;;C D
OrderDto;;D L
>;;L M
>;;M N
{<< 
private== 
readonly== 
AppDbContext== %
_context==& .
;==. /
public?? 
Handler?? 
(?? 
AppDbContext?? #
context??$ +
)??+ ,
{@@ 	
_contextAA 
=AA 
contextAA 
;AA 
}BB 	
publicDD 
asyncDD 
TaskDD 
<DD 
ResultDD  
<DD  !
OrderDtoDD! )
>DD) *
>DD* +
HandleDD, 2
(DD2 3
CommandDD3 :
requestDD; B
,DDB C
CancellationTokenDDD U
cancellationTokenDDV g
)DDg h
{EE 	
varGG 

userExistsGG 
=GG 
awaitGG "
_contextGG# +
.GG+ ,
UsersGG, 1
.GG1 2
AnyAsyncGG2 :
(GG: ;
uGG; <
=>GG= ?
uGG@ A
.GGA B
IdGGB D
==GGE G
requestGGH O
.GGO P
UserIdGGP V
,GGV W
cancellationTokenGGX i
)GGi j
;GGj k
ifHH 
(HH 
!HH 

userExistsHH 
)HH 
{II 
returnJJ 
ResultJJ 
<JJ 
OrderDtoJJ &
>JJ& '
.JJ' (
FailureJJ( /
(JJ/ 0
$"JJ0 2
$strJJ2 ?
{JJ? @
requestJJ@ G
.JJG H
UserIdJJH N
}JJN O
$strJJO Y
"JJY Z
)JJZ [
;JJ[ \
}KK 
varNN 

productIdsNN 
=NN 
requestNN $
.NN$ %
ItemsNN% *
.NN* +
SelectNN+ 1
(NN1 2
iNN2 3
=>NN4 6
iNN7 8
.NN8 9
	ProductIdNN9 B
)NNB C
.NNC D
DistinctNND L
(NNL M
)NNM N
.NNN O
ToListNNO U
(NNU V
)NNV W
;NNW X
varQQ 
productsQQ 
=QQ 
awaitQQ  
_contextQQ! )
.QQ) *
ProductsQQ* 2
.RR 
WhereRR 
(RR 
pRR 
=>RR 

productIdsRR &
.RR& '
ContainsRR' /
(RR/ 0
pRR0 1
.RR1 2
IdRR2 4
)RR4 5
)RR5 6
.SS 
ToListAsyncSS 
(SS 
cancellationTokenSS .
)SS. /
;SS/ 0
ifVV 
(VV 
productsVV 
.VV 
CountVV 
!=VV !

productIdsVV" ,
.VV, -
CountVV- 2
)VV2 3
{WW 
varXX 

missingIdsXX 
=XX  

productIdsXX! +
.XX+ ,
ExceptXX, 2
(XX2 3
productsXX3 ;
.XX; <
SelectXX< B
(XXB C
pXXC D
=>XXE G
pXXH I
.XXI J
IdXXJ L
)XXL M
)XXM N
.XXN O
ToListXXO U
(XXU V
)XXV W
;XXW X
returnYY 
ResultYY 
<YY 
OrderDtoYY &
>YY& '
.YY' (
FailureYY( /
(YY/ 0
$"YY0 2
$strYY2 F
{YYF G
stringYYG M
.YYM N
JoinYYN R
(YYR S
$strYYS W
,YYW X

missingIdsYYY c
)YYc d
}YYd e
"YYe f
)YYf g
;YYg h
}ZZ 
var]] 
unavailableProducts]] #
=]]$ %
products]]& .
.]]. /
Where]]/ 4
(]]4 5
p]]5 6
=>]]7 9
!]]: ;
p]]; <
.]]< =
IsAvailable]]= H
)]]H I
.]]I J
ToList]]J P
(]]P Q
)]]Q R
;]]R S
if^^ 
(^^ 
unavailableProducts^^ #
.^^# $
Any^^$ '
(^^' (
)^^( )
)^^) *
{__ 
var`` 
unavailableNames`` $
=``% &
string``' -
.``- .
Join``. 2
(``2 3
$str``3 7
,``7 8
unavailableProducts``9 L
.``L M
Select``M S
(``S T
p``T U
=>``V X
p``Y Z
.``Z [
Name``[ _
)``_ `
)``` a
;``a b
returnaa 
Resultaa 
<aa 
OrderDtoaa &
>aa& '
.aa' (
Failureaa( /
(aa/ 0
$"aa0 2
$straa2 J
{aaJ K
unavailableNamesaaK [
}aa[ \
"aa\ ]
)aa] ^
;aa^ _
}bb 
varee 
orderee 
=ee 
newee 
Orderee !
{ff 
Idgg 
=gg 
Guidgg 
.gg 
NewGuidgg !
(gg! "
)gg" #
,gg# $
OrderNumberhh 
=hh 
GenerateOrderNumberhh 1
(hh1 2
)hh2 3
,hh3 4
UserIdii 
=ii 
requestii  
.ii  !
UserIdii! '
,ii' (
Statusjj 
=jj 
$strjj "
,jj" #
PaymentStatuskk 
=kk 
$strkk  )
,kk) *
PaymentMethodll 
=ll 
requestll  '
.ll' (
PaymentMethodll( 5
,ll5 6
Notesmm 
=mm 
requestmm 
.mm  
Notesmm  %
,mm% &
	CreatedAtnn 
=nn 
DateTimenn $
.nn$ %
UtcNownn% +
}oo 
;oo 
varrr 

orderItemsrr 
=rr 
newrr  
Listrr! %
<rr% &
	OrderItemrr& /
>rr/ 0
(rr0 1
)rr1 2
;rr2 3
decimalss 
totalAmountss 
=ss  !
$numss" #
;ss# $
foreachuu 
(uu 
varuu 
itemRequestuu $
inuu% '
requestuu( /
.uu/ 0
Itemsuu0 5
)uu5 6
{vv 
varww 
productww 
=ww 
productsww &
.ww& '
Firstww' ,
(ww, -
pww- .
=>ww/ 1
pww2 3
.ww3 4
Idww4 6
==ww7 9
itemRequestww: E
.wwE F
	ProductIdwwF O
)wwO P
;wwP Q
varxx 
subtotalxx 
=xx 
productxx &
.xx& '
Pricexx' ,
*xx- .
itemRequestxx/ :
.xx: ;
Quantityxx; C
;xxC D
varzz 
	orderItemzz 
=zz 
newzz  #
	OrderItemzz$ -
{{{ 
Id|| 
=|| 
Guid|| 
.|| 
NewGuid|| %
(||% &
)||& '
,||' (
OrderId}} 
=}} 
order}} #
.}}# $
Id}}$ &
,}}& '
	ProductId~~ 
=~~ 
product~~  '
.~~' (
Id~~( *
,~~* +
Quantity 
= 
itemRequest *
.* +
Quantity+ 3
,3 4
	UnitPrice
€€ 
=
€€ 
product
€€  '
.
€€' (
Price
€€( -
,
€€- .
Subtotal
 
=
 
subtotal
 '
,
' (!
SpecialInstructions
‚‚ '
=
‚‚( )
itemRequest
‚‚* 5
.
‚‚5 6!
SpecialInstructions
‚‚6 I
}
ƒƒ 
;
ƒƒ 

orderItems
…… 
.
…… 
Add
…… 
(
…… 
	orderItem
…… (
)
……( )
;
……) *
totalAmount
†† 
+=
†† 
subtotal
†† '
;
††' (
}
‡‡ 
order
‰‰ 
.
‰‰ 
TotalAmount
‰‰ 
=
‰‰ 
totalAmount
‰‰  +
;
‰‰+ ,
order
 
.
 

OrderItems
 
=
 

orderItems
 )
;
) *
_context
 
.
 
Orders
 
.
 
Add
 
(
  
order
  %
)
% &
;
& '
await
 
_context
 
.
 
SaveChangesAsync
 +
(
+ ,
cancellationToken
, =
)
= >
;
> ?
var
‘‘ 
dto
‘‘ 
=
‘‘ 
new
‘‘ 
OrderDto
‘‘ "
{
’’ 
Id
““ 
=
““ 
order
““ 
.
““ 
Id
““ 
,
““ 
OrderNumber
”” 
=
”” 
order
”” #
.
””# $
OrderNumber
””$ /
,
””/ 0
UserId
•• 
=
•• 
order
•• 
.
•• 
UserId
•• %
,
••% &
TotalAmount
–– 
=
–– 
order
–– #
.
––# $
TotalAmount
––$ /
,
––/ 0
Status
—— 
=
—— 
order
—— 
.
—— 
Status
—— %
,
——% &
PaymentStatus
 
=
 
order
  %
.
% &
PaymentStatus
& 3
,
3 4
PaymentMethod
™™ 
=
™™ 
order
™™  %
.
™™% &
PaymentMethod
™™& 3
,
™™3 4
Notes
 
=
 
order
 
.
 
Notes
 #
,
# $
	CreatedAt
›› 
=
›› 
order
›› !
.
››! "
	CreatedAt
››" +
,
››+ ,
	UpdatedAt
 
=
 
order
 !
.
! "
	UpdatedAt
" +
,
+ ,
CompletedAt
 
=
 
order
 #
.
# $
CompletedAt
$ /
,
/ 0

OrderItems
 
=
 

orderItems
 '
.
' (
Select
( .
(
. /
oi
/ 1
=>
2 4
new
5 8
OrderItemDto
9 E
{
 
Id
   
=
   
oi
   
.
   
Id
   
,
   
	ProductId
΅΅ 
=
΅΅ 
oi
΅΅  "
.
΅΅" #
	ProductId
΅΅# ,
,
΅΅, -
ProductName
ΆΆ 
=
ΆΆ  !
products
ΆΆ" *
.
ΆΆ* +
First
ΆΆ+ 0
(
ΆΆ0 1
p
ΆΆ1 2
=>
ΆΆ3 5
p
ΆΆ6 7
.
ΆΆ7 8
Id
ΆΆ8 :
==
ΆΆ; =
oi
ΆΆ> @
.
ΆΆ@ A
	ProductId
ΆΆA J
)
ΆΆJ K
.
ΆΆK L
Name
ΆΆL P
,
ΆΆP Q
Quantity
££ 
=
££ 
oi
££ !
.
££! "
Quantity
££" *
,
££* +
	UnitPrice
¤¤ 
=
¤¤ 
oi
¤¤  "
.
¤¤" #
	UnitPrice
¤¤# ,
,
¤¤, -
Subtotal
¥¥ 
=
¥¥ 
oi
¥¥ !
.
¥¥! "
Subtotal
¥¥" *
,
¥¥* +!
SpecialInstructions
¦¦ '
=
¦¦( )
oi
¦¦* ,
.
¦¦, -!
SpecialInstructions
¦¦- @
}
§§ 
)
§§ 
.
§§ 
ToList
§§ 
(
§§ 
)
§§ 
}
¨¨ 
;
¨¨ 
return
 
Result
 
<
 
OrderDto
 "
>
" #
.
# $
Success
$ +
(
+ ,
dto
, /
)
/ 0
;
0 1
}
«« 	
private
®® 
static
®® 
string
®® !
GenerateOrderNumber
®® 1
(
®®1 2
)
®®2 3
{
―― 	
var
°° 
date
°° 
=
°° 
DateTime
°° 
.
°°  
UtcNow
°°  &
.
°°& '
ToString
°°' /
(
°°/ 0
$str
°°0 :
)
°°: ;
;
°°; <
var
±± 
random
±± 
=
±± 
new
±± 
Random
±± #
(
±±# $
)
±±$ %
.
±±% &
Next
±±& *
(
±±* +
$num
±±+ /
,
±±/ 0
$num
±±1 5
)
±±5 6
;
±±6 7
return
²² 
$"
²² 
$str
²² 
{
²² 
date
²² 
}
²² 
$str
²²  
{
²²  !
random
²²! '
}
²²' (
"
²²( )
;
²²) *
}
³³ 	
}
΄΄ 
}µµ ύR
ZC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Orders\CancelOrder.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Orders& ,
;, -
public

 
static

 
class

 
CancelOrder

 
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,
OrderDto, 4
>4 5
>5 6
{ 
public 
Guid 
OrderId 
{ 
get !
;! "
init# '
;' (
}) *
public 
Guid 
UserId 
{ 
get  
;  !
init" &
;& '
}( )
public 
string 
? 
CancellationReason )
{* +
get, /
;/ 0
init1 5
;5 6
}7 8
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
OrderId "
)" #
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( >
)> ?
;? @
RuleFor 
( 
x 
=> 
x 
. 
UserId !
)! "
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( =
)= >
;> ?
RuleFor 
( 
x 
=> 
x 
. 
CancellationReason -
)- .
.   
MaximumLength   
(   
$num   "
)  " #
.  # $
WithMessage  $ /
(  / 0
$str  0 b
)  b c
.!! 
When!! 
(!! 
x!! 
=>!! 
!!! 
string!! "
.!!" #
IsNullOrEmpty!!# 0
(!!0 1
x!!1 2
.!!2 3
CancellationReason!!3 E
)!!E F
)!!F G
;!!G H
}"" 	
}## 
internal&& 
sealed&& 
class&& 
Handler&& !
:&&" #
IRequestHandler&&$ 3
<&&3 4
Command&&4 ;
,&&; <
Result&&= C
<&&C D
OrderDto&&D L
>&&L M
>&&M N
{'' 
private(( 
readonly(( 
AppDbContext(( %
_context((& .
;((. /
public** 
Handler** 
(** 
AppDbContext** #
context**$ +
)**+ ,
{++ 	
_context,, 
=,, 
context,, 
;,, 
}-- 	
public// 
async// 
Task// 
<// 
Result//  
<//  !
OrderDto//! )
>//) *
>//* +
Handle//, 2
(//2 3
Command//3 :
request//; B
,//B C
CancellationToken//D U
cancellationToken//V g
)//g h
{00 	
var22 
order22 
=22 
await22 
_context22 &
.22& '
Orders22' -
.33 
Include33 
(33 
o33 
=>33 
o33 
.33  

OrderItems33  *
)33* +
.44 
ThenInclude44  
(44  !
oi44! #
=>44$ &
oi44' )
.44) *
Product44* 1
)441 2
.55 
FirstOrDefaultAsync55 $
(55$ %
o55% &
=>55' )
o55* +
.55+ ,
Id55, .
==55/ 1
request552 9
.559 :
OrderId55: A
,55A B
cancellationToken55C T
)55T U
;55U V
if77 
(77 
order77 
is77 
null77 
)77 
{88 
return99 
Result99 
<99 
OrderDto99 &
>99& '
.99' (
Failure99( /
(99/ 0
$"990 2
$str992 @
{99@ A
request99A H
.99H I
OrderId99I P
}99P Q
$str99Q [
"99[ \
)99\ ]
;99] ^
}:: 
if== 
(== 
order== 
.== 
UserId== 
!=== 
request==  '
.==' (
UserId==( .
)==. /
{>> 
return?? 
Result?? 
<?? 
OrderDto?? &
>??& '
.??' (
Failure??( /
(??/ 0
$str??0 ]
)??] ^
;??^ _
}@@ 
ifCC 
(CC 
orderCC 
.CC 
StatusCC 
==CC 
$strCC  +
)CC+ ,
{DD 
returnEE 
ResultEE 
<EE 
OrderDtoEE &
>EE& '
.EE' (
FailureEE( /
(EE/ 0
$strEE0 O
)EEO P
;EEP Q
}FF 
ifHH 
(HH 
orderHH 
.HH 
StatusHH 
==HH 
$strHH  +
)HH+ ,
{II 
returnJJ 
ResultJJ 
<JJ 
OrderDtoJJ &
>JJ& '
.JJ' (
FailureJJ( /
(JJ/ 0
$strJJ0 L
)JJL M
;JJM N
}KK 
varNN 
timeSinceCreationNN !
=NN" #
DateTimeNN$ ,
.NN, -
UtcNowNN- 3
-NN4 5
orderNN6 ;
.NN; <
	CreatedAtNN< E
;NNE F
ifOO 
(OO 
orderOO 
.OO 
StatusOO 
==OO 
$strOO  +
&&OO, .
timeSinceCreationOO/ @
.OO@ A
TotalMinutesOOA M
>OON O
$numOOP Q
)OOQ R
{PP 
returnQQ 
ResultQQ 
<QQ 
OrderDtoQQ &
>QQ& '
.QQ' (
FailureQQ( /
(QQ/ 0
$strRR p
)RRp q
;RRq r
}SS 
orderVV 
.VV 
StatusVV 
=VV 
$strVV &
;VV& '
orderWW 
.WW 
PaymentStatusWW 
=WW  !
$strWW" ,
;WW, -
orderXX 
.XX 
	UpdatedAtXX 
=XX 
DateTimeXX &
.XX& '
UtcNowXX' -
;XX- .
if[[ 
([[ 
![[ 
string[[ 
.[[ 
IsNullOrEmpty[[ %
([[% &
request[[& -
.[[- .
CancellationReason[[. @
)[[@ A
)[[A B
{\\ 
order]] 
.]] 
Notes]] 
=]] 
string]] $
.]]$ %
IsNullOrEmpty]]% 2
(]]2 3
order]]3 8
.]]8 9
Notes]]9 >
)]]> ?
?^^ 
$"^^ 
$str^^ #
{^^# $
request^^$ +
.^^+ ,
CancellationReason^^, >
}^^> ?
"^^? @
:__ 
$"__ 
{__ 
order__ 
.__ 
Notes__ $
}__$ %
$str__% 2
{__2 3
request__3 :
.__: ;
CancellationReason__; M
}__M N
"__N O
;__O P
}`` 
awaithh 
_contexthh 
.hh 
SaveChangesAsynchh +
(hh+ ,
cancellationTokenhh, =
)hh= >
;hh> ?
varkk 
orderDtokk 
=kk 
newkk 
OrderDtokk '
{ll 
Idmm 
=mm 
ordermm 
.mm 
Idmm 
,mm 
OrderNumbernn 
=nn 
ordernn #
.nn# $
OrderNumbernn$ /
,nn/ 0
UserIdoo 
=oo 
orderoo 
.oo 
UserIdoo %
,oo% &
TotalAmountpp 
=pp 
orderpp #
.pp# $
TotalAmountpp$ /
,pp/ 0
Statusqq 
=qq 
orderqq 
.qq 
Statusqq %
,qq% &
PaymentStatusrr 
=rr 
orderrr  %
.rr% &
PaymentStatusrr& 3
,rr3 4
PaymentMethodss 
=ss 
orderss  %
.ss% &
PaymentMethodss& 3
,ss3 4
Notestt 
=tt 
ordertt 
.tt 
Notestt #
,tt# $
	CreatedAtuu 
=uu 
orderuu !
.uu! "
	CreatedAtuu" +
,uu+ ,
	UpdatedAtvv 
=vv 
ordervv !
.vv! "
	UpdatedAtvv" +
,vv+ ,
CompletedAtww 
=ww 
orderww #
.ww# $
CompletedAtww$ /
,ww/ 0

OrderItemsxx 
=xx 
orderxx "
.xx" #

OrderItemsxx# -
.xx- .
Selectxx. 4
(xx4 5
oixx5 7
=>xx8 :
newxx; >
OrderItemDtoxx? K
{yy 
Idzz 
=zz 
oizz 
.zz 
Idzz 
,zz 
	ProductId{{ 
={{ 
oi{{  "
.{{" #
	ProductId{{# ,
,{{, -
ProductName|| 
=||  !
oi||" $
.||$ %
Product||% ,
.||, -
Name||- 1
,||1 2
Quantity}} 
=}} 
oi}} !
.}}! "
Quantity}}" *
,}}* +
	UnitPrice~~ 
=~~ 
oi~~  "
.~~" #
	UnitPrice~~# ,
,~~, -
Subtotal 
= 
oi !
.! "
Subtotal" *
,* +!
SpecialInstructions
€€ '
=
€€( )
oi
€€* ,
.
€€, -!
SpecialInstructions
€€- @
}
 
)
 
.
 
ToList
 
(
 
)
 
}
‚‚ 
;
‚‚ 
return
„„ 
Result
„„ 
<
„„ 
OrderDto
„„ "
>
„„" #
.
„„# $
Success
„„$ +
(
„„+ ,
orderDto
„„, 4
)
„„4 5
;
„„5 6
}
…… 	
}
†† 
}‡‡ O
ZC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Menu\UpdateProduct.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Menu& *
;* +
public

 
static

 
class

 
UpdateProduct

 !
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,

ProductDto, 6
>6 7
>7 8
{ 
public 
Guid 
Id 
{ 
get 
; 
init "
;" #
}$ %
public 
string 
Name 
{ 
get  
;  !
init" &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 
string 
Description !
{" #
get$ '
;' (
init) -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 
decimal 
Price 
{ 
get "
;" #
init$ (
;( )
}* +
public 
string 
Category 
{  
get! $
;$ %
init& *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
? 
ImageUrl 
{  !
get" %
;% &
init' +
;+ ,
}- .
public 
List 
< 
string 
> 
	Allergens %
{& '
get( +
;+ ,
init- 1
;1 2
}3 4
=5 6
new7 :
(: ;
); <
;< =
public 
string 
? 
DietaryRestrictions *
{+ ,
get- 0
;0 1
init2 6
;6 7
}8 9
public 
bool 
IsAvailable 
{  !
get" %
;% &
init' +
;+ ,
}- .
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Id 
) 
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( @
)@ A
;A B
RuleFor   
(   
x   
=>   
x   
.   
Name   
)    
.!! 
NotEmpty!! 
(!! 
)!! 
.!! 
WithMessage!! '
(!!' (
$str!!( B
)!!B C
."" 
MaximumLength"" 
("" 
$num"" "
)""" #
.""# $
WithMessage""$ /
(""/ 0
$str""0 [
)""[ \
;""\ ]
RuleFor$$ 
($$ 
x$$ 
=>$$ 
x$$ 
.$$ 
Description$$ &
)$$& '
.%% 
NotEmpty%% 
(%% 
)%% 
.%% 
WithMessage%% '
(%%' (
$str%%( A
)%%A B
.&& 
MaximumLength&& 
(&& 
$num&& "
)&&" #
.&&# $
WithMessage&&$ /
(&&/ 0
$str&&0 Z
)&&Z [
;&&[ \
RuleFor(( 
((( 
x(( 
=>(( 
x(( 
.(( 
Price((  
)((  !
.)) 
GreaterThan)) 
()) 
$num)) 
))) 
.))  
WithMessage))  +
())+ ,
$str)), J
)))J K
.** 
LessThanOrEqualTo** "
(**" #
$num**# '
)**' (
.**( )
WithMessage**) 4
(**4 5
$str**5 S
)**S T
;**T U
RuleFor,, 
(,, 
x,, 
=>,, 
x,, 
.,, 
Category,, #
),,# $
.-- 
NotEmpty-- 
(-- 
)-- 
.-- 
WithMessage-- '
(--' (
$str--( >
)--> ?
... 
Must.. 
(.. 
category.. 
=>.. !
new.." %
[..% &
]..& '
{..( )
$str..* 0
,..0 1
$str..2 9
,..9 :
$str..; D
,..D E
$str..F M
}..N O
...O P
Contains..P X
(..X Y
category..Y a
)..a b
)..b c
.// 
WithMessage// 
(// 
$str// S
)//S T
;//T U
}00 	
}11 
internal33 
sealed33 
class33 
Handler33 !
:33" #
IRequestHandler33$ 3
<333 4
Command334 ;
,33; <
Result33= C
<33C D

ProductDto33D N
>33N O
>33O P
{44 
private55 
readonly55 
AppDbContext55 %
_context55& .
;55. /
public77 
Handler77 
(77 
AppDbContext77 #
context77$ +
)77+ ,
{88 	
_context99 
=99 
context99 
;99 
}:: 	
public<< 
async<< 
Task<< 
<<< 
Result<<  
<<<  !

ProductDto<<! +
><<+ ,
><<, -
Handle<<. 4
(<<4 5
Command<<5 <
request<<= D
,<<D E
CancellationToken<<F W
cancellationToken<<X i
)<<i j
{== 	
var>> 
product>> 
=>> 
await>> 
_context>>  (
.>>( )
Products>>) 1
.?? 
FirstOrDefaultAsync?? $
(??$ %
p??% &
=>??' )
p??* +
.??+ ,
Id??, .
==??/ 1
request??2 9
.??9 :
Id??: <
,??< =
cancellationToken??> O
)??O P
;??P Q
ifAA 
(AA 
productAA 
isAA 
nullAA 
)AA  
{BB 
returnCC 
ResultCC 
<CC 

ProductDtoCC (
>CC( )
.CC) *
FailureCC* 1
(CC1 2
$"CC2 4
$strCC4 D
{CCD E
requestCCE L
.CCL M
IdCCM O
}CCO P
$strCCP Z
"CCZ [
)CC[ \
;CC\ ]
}DD 
productFF 
.FF 
NameFF 
=FF 
requestFF "
.FF" #
NameFF# '
;FF' (
productGG 
.GG 
DescriptionGG 
=GG  !
requestGG" )
.GG) *
DescriptionGG* 5
;GG5 6
productHH 
.HH 
PriceHH 
=HH 
requestHH #
.HH# $
PriceHH$ )
;HH) *
productII 
.II 
CategoryII 
=II 
requestII &
.II& '
CategoryII' /
;II/ 0
productJJ 
.JJ 
ImageUrlJJ 
=JJ 
requestJJ &
.JJ& '
ImageUrlJJ' /
;JJ/ 0
productKK 
.KK 
	AllergensKK 
=KK 
requestKK  '
.KK' (
	AllergensKK( 1
;KK1 2
productLL 
.LL 
DietaryRestrictionsLL '
=LL( )
requestLL* 1
.LL1 2
DietaryRestrictionsLL2 E
;LLE F
productMM 
.MM 
IsAvailableMM 
=MM  !
requestMM" )
.MM) *
IsAvailableMM* 5
;MM5 6
productNN 
.NN 
	UpdatedAtNN 
=NN 
DateTimeNN  (
.NN( )
UtcNowNN) /
;NN/ 0
awaitPP 
_contextPP 
.PP 
SaveChangesAsyncPP +
(PP+ ,
cancellationTokenPP, =
)PP= >
;PP> ?
varRR 
dtoRR 
=RR 
newRR 

ProductDtoRR $
{SS 
IdTT 
=TT 
productTT 
.TT 
IdTT 
,TT  
NameUU 
=UU 
productUU 
.UU 
NameUU #
,UU# $
DescriptionVV 
=VV 
productVV %
.VV% &
DescriptionVV& 1
,VV1 2
PriceWW 
=WW 
productWW 
.WW  
PriceWW  %
,WW% &
CategoryXX 
=XX 
productXX "
.XX" #
CategoryXX# +
,XX+ ,
ImageUrlYY 
=YY 
productYY "
.YY" #
ImageUrlYY# +
,YY+ ,
	AllergensZZ 
=ZZ 
productZZ #
.ZZ# $
	AllergensZZ$ -
,ZZ- .
DietaryRestrictions[[ #
=[[$ %
product[[& -
.[[- .
DietaryRestrictions[[. A
,[[A B
IsAvailable\\ 
=\\ 
product\\ %
.\\% &
IsAvailable\\& 1
,\\1 2
	CreatedAt]] 
=]] 
product]] #
.]]# $
	CreatedAt]]$ -
,]]- .
	UpdatedAt^^ 
=^^ 
product^^ #
.^^# $
	UpdatedAt^^$ -
}__ 
;__ 
returnaa 
Resultaa 
<aa 

ProductDtoaa $
>aa$ %
.aa% &
Successaa& -
(aa- .
dtoaa. 1
)aa1 2
;aa2 3
}bb 	
}cc 
}dd Υ$
[C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Menu\GetProductById.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Menu& *
;* +
public

 
static

 
class

 
GetProductById

 "
{ 
public 

record 
Query 
( 
Guid 
Id 
)  
:! "
IRequest# +
<+ ,
Result, 2
<2 3

ProductDto3 =
>= >
>> ?
;? @
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Query/ 4
>4 5
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Id 
) 
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( @
)@ A
;A B
} 	
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B

ProductDtoB L
>L M
>M N
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public   
async   
Task   
<   
Result    
<    !

ProductDto  ! +
>  + ,
>  , -
Handle  . 4
(  4 5
Query  5 :
request  ; B
,  B C
CancellationToken  D U
cancellationToken  V g
)  g h
{!! 	
var"" 
product"" 
="" 
await"" 
_context""  (
.""( )
Products"") 1
.## 
AsNoTracking## 
(## 
)## 
.$$ 
FirstOrDefaultAsync$$ $
($$$ %
p$$% &
=>$$' )
p$$* +
.$$+ ,
Id$$, .
==$$/ 1
request$$2 9
.$$9 :
Id$$: <
,$$< =
cancellationToken$$> O
)$$O P
;$$P Q
if&& 
(&& 
product&& 
is&& 
null&& 
)&&  
{'' 
return(( 
Result(( 
<(( 

ProductDto(( (
>((( )
.(() *
Failure((* 1
(((1 2
$"((2 4
$str((4 D
{((D E
request((E L
.((L M
Id((M O
}((O P
$str((P Z
"((Z [
)(([ \
;((\ ]
})) 
var++ 
dto++ 
=++ 
new++ 

ProductDto++ $
{,, 
Id-- 
=-- 
product-- 
.-- 
Id-- 
,--  
Name.. 
=.. 
product.. 
... 
Name.. #
,..# $
Description// 
=// 
product// %
.//% &
Description//& 1
,//1 2
Price00 
=00 
product00 
.00  
Price00  %
,00% &
Category11 
=11 
product11 "
.11" #
Category11# +
,11+ ,
ImageUrl22 
=22 
product22 "
.22" #
ImageUrl22# +
,22+ ,
	Allergens33 
=33 
product33 #
.33# $
	Allergens33$ -
,33- .
DietaryRestrictions44 #
=44$ %
product44& -
.44- .
DietaryRestrictions44. A
,44A B
IsAvailable55 
=55 
product55 %
.55% &
IsAvailable55& 1
,551 2
	CreatedAt66 
=66 
product66 #
.66# $
	CreatedAt66$ -
,66- .
	UpdatedAt77 
=77 
product77 #
.77# $
	UpdatedAt77$ -
}88 
;88 
return:: 
Result:: 
<:: 

ProductDto:: $
>::$ %
.::% &
Success::& -
(::- .
dto::. 1
)::1 2
;::2 3
};; 	
}<< 
}== 
TC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Menu\GetMenu.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Menu& *
;* +
public		 
static		 
class		 
GetMenu		 
{

 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
List* .
<. /

ProductDto/ 9
>9 :
>: ;
>; <
;< =
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
ListB F
<F G

ProductDtoG Q
>Q R
>R S
>S T
{ 
private 
readonly 
AppDbContext %

_dbContext& 0
;0 1
public 
Handler 
( 
AppDbContext #
	dbContext$ -
)- .
{ 	

_dbContext 
= 
	dbContext "
;" #
} 	
public 
async 
Task 
< 
Result  
<  !
List! %
<% &

ProductDto& 0
>0 1
>1 2
>2 3
Handle4 :
(: ;
Query; @
requestA H
,H I
CancellationTokenJ [
cancellationToken\ m
)m n
{ 	
var 
products 
= 
await  

_dbContext! +
.+ ,
Products, 4
. 
AsNoTracking 
( 
) 
. 
Where 
( 
p 
=> 
p 
. 
IsAvailable )
)) *
. 
Select 
( 
p 
=> 
new  

ProductDto! +
{ 
Id 
= 
p 
. 
Id 
, 
Name 
= 
p 
. 
Name !
,! "
Description   
=    !
p  " #
.  # $
Description  $ /
,  / 0
Price!! 
=!! 
p!! 
.!! 
Price!! #
,!!# $
Category"" 
="" 
p""  
.""  !
Category""! )
,"") *
ImageUrl## 
=## 
p##  
.##  !
ImageUrl##! )
,##) *
	Allergens$$ 
=$$ 
p$$  !
.$$! "
	Allergens$$" +
,$$+ ,
DietaryRestrictions%% '
=%%( )
p%%* +
.%%+ ,
DietaryRestrictions%%, ?
,%%? @
IsAvailable&& 
=&&  !
p&&" #
.&&# $
IsAvailable&&$ /
,&&/ 0
	CreatedAt'' 
='' 
p''  !
.''! "
	CreatedAt''" +
,''+ ,
	UpdatedAt(( 
=(( 
p((  !
.((! "
	UpdatedAt((" +
})) 
))) 
.** 
ToListAsync** 
(** 
cancellationToken** .
)**. /
;**/ 0
return,, 
Result,, 
<,, 
List,, 
<,, 

ProductDto,, )
>,,) *
>,,* +
.,,+ ,
Success,,, 3
(,,3 4
products,,4 <
),,< =
;,,= >
}-- 	
}.. 
}// ‹
ZC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Menu\DeleteProduct.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Menu& *
;* +
public		 
static		 
class		 
DeleteProduct		 !
{

 
public 

record 
Command 
( 
Guid 
Id !
)! "
:# $
IRequest% -
<- .
Result. 4
>4 5
;5 6
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Id 
) 
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( @
)@ A
;A B
} 	
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Command4 ;
,; <
Result= C
>C D
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
}   	
public"" 
async"" 
Task"" 
<"" 
Result""  
>""  !
Handle""" (
(""( )
Command"") 0
request""1 8
,""8 9
CancellationToken"": K
cancellationToken""L ]
)""] ^
{## 	
var$$ 
product$$ 
=$$ 
await$$ 
_context$$  (
.$$( )
Products$$) 1
.%% 
FirstOrDefaultAsync%% $
(%%$ %
p%%% &
=>%%' )
p%%* +
.%%+ ,
Id%%, .
==%%/ 1
request%%2 9
.%%9 :
Id%%: <
,%%< =
cancellationToken%%> O
)%%O P
;%%P Q
if'' 
('' 
product'' 
is'' 
null'' 
)''  
{(( 
return)) 
Result)) 
.)) 
Failure)) %
())% &
$"))& (
$str))( 8
{))8 9
request))9 @
.))@ A
Id))A C
}))C D
$str))D N
"))N O
)))O P
;))P Q
}** 
var-- 
	hasOrders-- 
=-- 
await-- !
_context--" *
.--* +

OrderItems--+ 5
... 
AnyAsync.. 
(.. 
oi.. 
=>.. 
oi..  "
..." #
	ProductId..# ,
==..- /
request..0 7
...7 8
Id..8 :
,..: ;
cancellationToken..< M
)..M N
;..N O
if00 
(00 
	hasOrders00 
)00 
{11 
return22 
Result22 
.22 
Failure22 %
(22% &
$str	22& €
)
22€ 
;
22 ‚
}33 
_context55 
.55 
Products55 
.55 
Remove55 $
(55$ %
product55% ,
)55, -
;55- .
await66 
_context66 
.66 
SaveChangesAsync66 +
(66+ ,
cancellationToken66, =
)66= >
;66> ?
return88 
Result88 
.88 
Success88 !
(88! "
)88" #
;88# $
}99 	
}:: 
};; ΆM
ZC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Menu\CreateProduct.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Menu& *
;* +
public

 
static

 
class

 
CreateProduct

 !
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,

ProductDto, 6
>6 7
>7 8
{ 
public 
string 
Name 
{ 
get  
;  !
init" &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 
string 
Description !
{" #
get$ '
;' (
init) -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 
decimal 
Price 
{ 
get "
;" #
init$ (
;( )
}* +
public 
string 
Category 
{  
get! $
;$ %
init& *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
? 
ImageUrl 
{  !
get" %
;% &
init' +
;+ ,
}- .
public 
List 
< 
string 
> 
	Allergens %
{& '
get( +
;+ ,
init- 1
;1 2
}3 4
=5 6
new7 :
(: ;
); <
;< =
public 
string 
? 
DietaryRestrictions *
{+ ,
get- 0
;0 1
init2 6
;6 7
}8 9
public 
bool 
IsAvailable 
{  !
get" %
;% &
init' +
;+ ,
}- .
=/ 0
true1 5
;5 6
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Name 
)  
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( B
)B C
.   
MaximumLength   
(   
$num   "
)  " #
.  # $
WithMessage  $ /
(  / 0
$str  0 [
)  [ \
;  \ ]
RuleFor"" 
("" 
x"" 
=>"" 
x"" 
."" 
Description"" &
)""& '
.## 
NotEmpty## 
(## 
)## 
.## 
WithMessage## '
(##' (
$str##( A
)##A B
.$$ 
MaximumLength$$ 
($$ 
$num$$ "
)$$" #
.$$# $
WithMessage$$$ /
($$/ 0
$str$$0 Z
)$$Z [
;$$[ \
RuleFor&& 
(&& 
x&& 
=>&& 
x&& 
.&& 
Price&&  
)&&  !
.'' 
GreaterThan'' 
('' 
$num'' 
)'' 
.''  
WithMessage''  +
(''+ ,
$str'', J
)''J K
.(( 
LessThanOrEqualTo(( "
(((" #
$num((# '
)((' (
.((( )
WithMessage(() 4
(((4 5
$str((5 S
)((S T
;((T U
RuleFor** 
(** 
x** 
=>** 
x** 
.** 
Category** #
)**# $
.++ 
NotEmpty++ 
(++ 
)++ 
.++ 
WithMessage++ '
(++' (
$str++( >
)++> ?
.,, 
Must,, 
(,, 
category,, 
=>,, !
new,," %
[,,% &
],,& '
{,,( )
$str,,* 0
,,,0 1
$str,,2 9
,,,9 :
$str,,; D
,,,D E
$str,,F M
},,N O
.,,O P
Contains,,P X
(,,X Y
category,,Y a
),,a b
),,b c
.-- 
WithMessage-- 
(-- 
$str-- S
)--S T
;--T U
RuleFor// 
(// 
x// 
=>// 
x// 
.// 
ImageUrl// #
)//# $
.00 
Must00 
(00 
url00 
=>00 
string00 #
.00# $
IsNullOrEmpty00$ 1
(001 2
url002 5
)005 6
||007 9
Uri00: =
.00= >
	TryCreate00> G
(00G H
url00H K
,00K L
UriKind00M T
.00T U
Absolute00U ]
,00] ^
out00_ b
_00c d
)00d e
)00e f
.11 
When11 
(11 
x11 
=>11 
!11 
string11 "
.11" #
IsNullOrEmpty11# 0
(110 1
x111 2
.112 3
ImageUrl113 ;
)11; <
)11< =
.22 
WithMessage22 
(22 
$str22 7
)227 8
;228 9
}33 	
}44 
internal77 
sealed77 
class77 
Handler77 !
:77" #
IRequestHandler77$ 3
<773 4
Command774 ;
,77; <
Result77= C
<77C D

ProductDto77D N
>77N O
>77O P
{88 
private99 
readonly99 
AppDbContext99 %
_context99& .
;99. /
public;; 
Handler;; 
(;; 
AppDbContext;; #
context;;$ +
);;+ ,
{<< 	
_context== 
=== 
context== 
;== 
}>> 	
public@@ 
async@@ 
Task@@ 
<@@ 
Result@@  
<@@  !

ProductDto@@! +
>@@+ ,
>@@, -
Handle@@. 4
(@@4 5
Command@@5 <
request@@= D
,@@D E
CancellationToken@@F W
cancellationToken@@X i
)@@i j
{AA 	
varBB 
productBB 
=BB 
newBB 
ProductBB %
{CC 
IdDD 
=DD 
GuidDD 
.DD 
NewGuidDD !
(DD! "
)DD" #
,DD# $
NameEE 
=EE 
requestEE 
.EE 
NameEE #
,EE# $
DescriptionFF 
=FF 
requestFF %
.FF% &
DescriptionFF& 1
,FF1 2
PriceGG 
=GG 
requestGG 
.GG  
PriceGG  %
,GG% &
CategoryHH 
=HH 
requestHH "
.HH" #
CategoryHH# +
,HH+ ,
ImageUrlII 
=II 
requestII "
.II" #
ImageUrlII# +
,II+ ,
	AllergensJJ 
=JJ 
requestJJ #
.JJ# $
	AllergensJJ$ -
,JJ- .
DietaryRestrictionsKK #
=KK$ %
requestKK& -
.KK- .
DietaryRestrictionsKK. A
,KKA B
IsAvailableLL 
=LL 
requestLL %
.LL% &
IsAvailableLL& 1
,LL1 2
	CreatedAtMM 
=MM 
DateTimeMM $
.MM$ %
UtcNowMM% +
}NN 
;NN 
_contextPP 
.PP 
ProductsPP 
.PP 
AddPP !
(PP! "
productPP" )
)PP) *
;PP* +
awaitQQ 
_contextQQ 
.QQ 
SaveChangesAsyncQQ +
(QQ+ ,
cancellationTokenQQ, =
)QQ= >
;QQ> ?
varSS 
dtoSS 
=SS 
newSS 

ProductDtoSS $
{TT 
IdUU 
=UU 
productUU 
.UU 
IdUU 
,UU  
NameVV 
=VV 
productVV 
.VV 
NameVV #
,VV# $
DescriptionWW 
=WW 
productWW %
.WW% &
DescriptionWW& 1
,WW1 2
PriceXX 
=XX 
productXX 
.XX  
PriceXX  %
,XX% &
CategoryYY 
=YY 
productYY "
.YY" #
CategoryYY# +
,YY+ ,
ImageUrlZZ 
=ZZ 
productZZ "
.ZZ" #
ImageUrlZZ# +
,ZZ+ ,
	Allergens[[ 
=[[ 
product[[ #
.[[# $
	Allergens[[$ -
,[[- .
DietaryRestrictions\\ #
=\\$ %
product\\& -
.\\- .
DietaryRestrictions\\. A
,\\A B
IsAvailable]] 
=]] 
product]] %
.]]% &
IsAvailable]]& 1
,]]1 2
	CreatedAt^^ 
=^^ 
product^^ #
.^^# $
	CreatedAt^^$ -
,^^- .
	UpdatedAt__ 
=__ 
product__ #
.__# $
	UpdatedAt__$ -
}`` 
;`` 
returnbb 
Resultbb 
<bb 

ProductDtobb $
>bb$ %
.bb% &
Successbb& -
(bb- .
dtobb. 1
)bb1 2
;bb2 3
}cc 	
}dd 
}ee ΖD
cC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Loyalty\RedeemLoyaltyPoints.cs
	namespace		 	

CampusEats		
 
.		 
Backend		 
.		 
Features		 %
.		% &
Loyalty		& -
;		- .
public 
static 
class 
RedeemLoyaltyPoints '
{ 
public 

record 
Command 
( 
Guid 
UserId %
,% &
int' *
PointsToRedeem+ 9
,9 :
Guid; ?
?? @
OrderIdA H
=I J
nullK O
)O P
:Q R
IRequestS [
<[ \
Result\ b
<b c!
RedeemPointsResultDtoc x
>x y
>y z
;z {
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
UserId !
)! "
." #
NotEmpty# +
(+ ,
), -
.- .
WithMessage. 9
(9 :
$str: N
)N O
;O P
RuleFor 
( 
x 
=> 
x 
. 
PointsToRedeem )
)) *
. 
GreaterThan 
( 
$num 
) 
.  
WithMessage  +
(+ ,
$str, U
)U V
. 
LessThanOrEqualTo "
(" #
$num# (
)( )
.) *
WithMessage* 5
(5 6
$str6 d
)d e
;e f
} 	
} 
public 

class 
Handler 
: 
IRequestHandler *
<* +
Command+ 2
,2 3
Result4 :
<: ;!
RedeemPointsResultDto; P
>P Q
>Q R
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
private 
const 
decimal 
PointsToMoneyRatio 0
=1 2
$num3 7
;7 8
private 
const 
int !
MinimumPointsToRedeem /
=0 1
$num2 4
;4 5
public   
Handler   
(   
AppDbContext   #
context  $ +
)  + ,
{!! 	
_context"" 
="" 
context"" 
;"" 
}## 	
public%% 
async%% 
Task%% 
<%% 
Result%%  
<%%  !!
RedeemPointsResultDto%%! 6
>%%6 7
>%%7 8
Handle%%9 ?
(%%? @
Command%%@ G
request%%H O
,%%O P
CancellationToken%%Q b
cancellationToken%%c t
)%%t u
{&& 	
var'' 
user'' 
='' 
await'' 
_context'' %
.''% &
Users''& +
.(( 
FirstOrDefaultAsync(( $
((($ %
u((% &
=>((' )
u((* +
.((+ ,
Id((, .
==((/ 1
request((2 9
.((9 :
UserId((: @
,((@ A
cancellationToken((B S
)((S T
;((T U
if** 
(** 
user** 
==** 
null** 
)** 
return++ 
Result++ 
<++ !
RedeemPointsResultDto++ 3
>++3 4
.++4 5
Failure++5 <
(++< =
$str++= M
)++M N
;++N O
if-- 
(-- 
user-- 
.-- 
LoyaltyPoints-- "
<--# $!
MinimumPointsToRedeem--% :
)--: ;
return.. 
Result.. 
<.. !
RedeemPointsResultDto.. 3
>..3 4
...4 5
Failure..5 <
(..< =
$"..= ?
$str..? G
{..G H!
MinimumPointsToRedeem..H ]
}..] ^
$str..^ x
"..x y
)..y z
;..z {
if00 
(00 
request00 
.00 
PointsToRedeem00 &
<00' (!
MinimumPointsToRedeem00) >
)00> ?
return11 
Result11 
<11 !
RedeemPointsResultDto11 3
>113 4
.114 5
Failure115 <
(11< =
$"11= ?
$str11? G
{11G H!
MinimumPointsToRedeem11H ]
}11] ^
$str11^ x
"11x y
)11y z
;11z {
if33 
(33 
user33 
.33 
LoyaltyPoints33 "
<33# $
request33% ,
.33, -
PointsToRedeem33- ;
)33; <
return44 
Result44 
<44 !
RedeemPointsResultDto44 3
>443 4
.444 5
Failure445 <
(44< =
$"44= ?
$str44? ]
{44] ^
user44^ b
.44b c
LoyaltyPoints44c p
}44p q
$str44q y
"44y z
)44z {
;44{ |
var66 
discountAmount66 
=66  
request66! (
.66( )
PointsToRedeem66) 7
*668 9
PointsToMoneyRatio66: L
;66L M
user88 
.88 
LoyaltyPoints88 
-=88 !
request88" )
.88) *
PointsToRedeem88* 8
;888 9
user99 
.99 
	UpdatedAt99 
=99 
DateTime99 %
.99% &
UtcNow99& ,
;99, -
var;; 
transaction;; 
=;; 
new;; !
LoyaltyTransaction;;" 4
{<< 
Id== 
=== 
Guid== 
.== 
NewGuid== !
(==! "
)==" #
,==# $
UserId>> 
=>> 
user>> 
.>> 
Id>>  
,>>  !
PointsChange?? 
=?? 
-??  
request??  '
.??' (
PointsToRedeem??( 6
,??6 7
Type@@ 
=@@ "
LoyaltyTransactionType@@ -
.@@- .
Redeemed@@. 6
,@@6 7
DescriptionAA 
=AA 
requestAA %
.AA% &
OrderIdAA& -
.AA- .
HasValueAA. 6
?BB 
$"BB 
$strBB !
{BB! "
requestBB" )
.BB) *
PointsToRedeemBB* 8
}BB8 9
$strBB9 E
{BBE F
discountAmountBBF T
:BBT U
$strBBU W
}BBW X
$strBBX n
"BBn o
:CC 
$"CC 
$strCC !
{CC! "
requestCC" )
.CC) *
PointsToRedeemCC* 8
}CC8 9
$strCC9 E
{CCE F
discountAmountCCF T
:CCT U
$strCCU W
}CCW X
$strCCX e
"CCe f
,CCf g
OrderIdDD 
=DD 
requestDD !
.DD! "
OrderIdDD" )
,DD) *
	CreatedAtEE 
=EE 
DateTimeEE $
.EE$ %
UtcNowEE% +
}FF 
;FF 
_contextHH 
.HH 
LoyaltyTransactionsHH (
.HH( )
AddHH) ,
(HH, -
transactionHH- 8
)HH8 9
;HH9 :
awaitII 
_contextII 
.II 
SaveChangesAsyncII +
(II+ ,
cancellationTokenII, =
)II= >
;II> ?
varKK 
resultKK 
=KK 
newKK !
RedeemPointsResultDtoKK 2
{LL 
PointsRedeemedMM 
=MM  
requestMM! (
.MM( )
PointsToRedeemMM) 7
,MM7 8
DiscountAmountNN 
=NN  
discountAmountNN! /
,NN/ 0
RemainingPointsOO 
=OO  !
userOO" &
.OO& '
LoyaltyPointsOO' 4
,OO4 5
MessagePP 
=PP 
$"PP 
$strPP 2
{PP2 3
requestPP3 :
.PP: ;
PointsToRedeemPP; I
}PPI J
$strPPJ V
{PPV W
discountAmountPPW e
:PPe f
$strPPf h
}PPh i
$strPPi w
"PPw x
}QQ 
;QQ 
returnSS 
ResultSS 
<SS !
RedeemPointsResultDtoSS /
>SS/ 0
.SS0 1
SuccessSS1 8
(SS8 9
resultSS9 ?
)SS? @
;SS@ A
}TT 	
}UU 
}VV δ&
fC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Loyalty\GetLoyaltyTransactions.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Loyalty& -
;- .
public		 
static		 
class		 "
GetLoyaltyTransactions		 *
{

 
public 

record 
Query 
( 
Guid 
UserId #
,# $
int% (
Page) -
=. /
$num0 1
,1 2
int3 6
PageSize7 ?
=@ A
$numB D
)D E
:F G
IRequestH P
<P Q
ResultQ W
<W X
ListX \
<\ ]!
LoyaltyTransactionDto] r
>r s
>s t
>t u
;u v
public 

class 
Handler 
: 
IRequestHandler *
<* +
Query+ 0
,0 1
Result2 8
<8 9
List9 =
<= >!
LoyaltyTransactionDto> S
>S T
>T U
>U V
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
List! %
<% &!
LoyaltyTransactionDto& ;
>; <
>< =
>= >
Handle? E
(E F
QueryF K
requestL S
,S T
CancellationTokenU f
cancellationTokeng x
)x y
{ 	
var 
user 
= 
await 
_context %
.% &
Users& +
. 
FirstOrDefaultAsync $
($ %
u% &
=>' )
u* +
.+ ,
Id, .
==/ 1
request2 9
.9 :
UserId: @
,@ A
cancellationTokenB S
)S T
;T U
if 
( 
user 
== 
null 
) 
return 
Result 
< 
List "
<" #!
LoyaltyTransactionDto# 8
>8 9
>9 :
.: ;
Failure; B
(B C
$strC S
)S T
;T U
var 
transactions 
= 
await $
_context% -
.- .
LoyaltyTransactions. A
. 
Where 
( 
t 
=> 
t 
. 
UserId $
==% '
request( /
./ 0
UserId0 6
)6 7
.   
OrderByDescending   "
(  " #
t  # $
=>  % '
t  ( )
.  ) *
	CreatedAt  * 3
)  3 4
.!! 
Skip!! 
(!! 
(!! 
request!! 
.!! 
Page!! #
-!!$ %
$num!!& '
)!!' (
*!!) *
request!!+ 2
.!!2 3
PageSize!!3 ;
)!!; <
."" 
Take"" 
("" 
request"" 
."" 
PageSize"" &
)""& '
.## 
Select## 
(## 
t## 
=>## 
new##  !
LoyaltyTransactionDto##! 6
{$$ 
Id%% 
=%% 
t%% 
.%% 
Id%% 
,%% 
UserId&& 
=&& 
t&& 
.&& 
UserId&& %
,&&% &
PointsChange''  
=''! "
t''# $
.''$ %
PointsChange''% 1
,''1 2
Type(( 
=(( 
t(( 
.(( 
Type(( !
.((! "
ToString((" *
(((* +
)((+ ,
,((, -
Description)) 
=))  !
t))" #
.))# $
Description))$ /
,))/ 0
OrderId** 
=** 
t** 
.**  
OrderId**  '
,**' (
	CreatedAt++ 
=++ 
t++  !
.++! "
	CreatedAt++" +
},, 
),, 
.-- 
ToListAsync-- 
(-- 
cancellationToken-- .
)--. /
;--/ 0
return// 
Result// 
<// 
List// 
<// !
LoyaltyTransactionDto// 4
>//4 5
>//5 6
.//6 7
Success//7 >
(//> ?
transactions//? K
)//K L
;//L M
}00 	
}11 
}22 ί$
`C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Loyalty\GetLoyaltyPoints.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Loyalty& -
;- .
public		 
static		 
class		 
GetLoyaltyPoints		 $
{

 
public 

record 
Query 
( 
Guid 
UserId #
)# $
:% &
IRequest' /
</ 0
Result0 6
<6 7
LoyaltyPointsDto7 G
>G H
>H I
;I J
public 

class 
Handler 
: 
IRequestHandler *
<* +
Query+ 0
,0 1
Result2 8
<8 9
LoyaltyPointsDto9 I
>I J
>J K
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
private 
const 
decimal 
PointsToMoneyRatio 0
=1 2
$num3 7
;7 8
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
LoyaltyPointsDto! 1
>1 2
>2 3
Handle4 :
(: ;
Query; @
requestA H
,H I
CancellationTokenJ [
cancellationToken\ m
)m n
{ 	
var 
user 
= 
await 
_context %
.% &
Users& +
. 
Include 
( 
u 
=> 
u 
.  
LoyaltyTransactions  3
)3 4
. 
FirstOrDefaultAsync $
($ %
u% &
=>' )
u* +
.+ ,
Id, .
==/ 1
request2 9
.9 :
UserId: @
,@ A
cancellationTokenB S
)S T
;T U
if 
( 
user 
== 
null 
) 
return 
Result 
< 
LoyaltyPointsDto .
>. /
./ 0
Failure0 7
(7 8
$str8 H
)H I
;I J
var   
totalEarned   
=   
user   "
.  " #
LoyaltyTransactions  # 6
.!! 
Where!! 
(!! 
t!! 
=>!! 
t!! 
.!! 
Type!! "
==!!# %
Domain!!& ,
.!!, -"
LoyaltyTransactionType!!- C
.!!C D
Earned!!D J
)!!J K
."" 
Sum"" 
("" 
t"" 
=>"" 
t"" 
."" 
PointsChange"" (
)""( )
;"") *
var$$ 
totalRedeemed$$ 
=$$ 
Math$$  $
.$$$ %
Abs$$% (
($$( )
user$$) -
.$$- .
LoyaltyTransactions$$. A
.%% 
Where%% 
(%% 
t%% 
=>%% 
t%% 
.%% 
Type%% "
==%%# %
Domain%%& ,
.%%, -"
LoyaltyTransactionType%%- C
.%%C D
Redeemed%%D L
)%%L M
.&& 
Sum&& 
(&& 
t&& 
=>&& 
t&& 
.&& 
PointsChange&& (
)&&( )
)&&) *
;&&* +
var(( 
dto(( 
=(( 
new(( 
LoyaltyPointsDto(( *
{)) 
UserId** 
=** 
user** 
.** 
Id**  
,**  !
CurrentPoints++ 
=++ 
user++  $
.++$ %
LoyaltyPoints++% 2
,++2 3
TotalEarned,, 
=,, 
totalEarned,, )
,,,) *
TotalRedeemed-- 
=-- 
totalRedeemed--  -
,--- .
PointsValue.. 
=.. 
user.. "
..." #
LoyaltyPoints..# 0
*..1 2
PointsToMoneyRatio..3 E
}// 
;// 
return11 
Result11 
<11 
LoyaltyPointsDto11 *
>11* +
.11+ ,
Success11, 3
(113 4
dto114 7
)117 8
;118 9
}22 	
}33 
}44 ο(
bC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Loyalty\AwardLoyaltyPoints.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Loyalty& -
;- .
public

 
static

 
class

 
AwardLoyaltyPoints

 &
{ 
public 

record 
Command 
( 
Guid 
UserId %
,% &
int' *
Points+ 1
,1 2
string3 9
Description: E
,E F
GuidG K
?K L
OrderIdM T
=U V
nullW [
)[ \
:] ^
IRequest_ g
<g h
Resulth n
>n o
;o p
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
UserId !
)! "
." #
NotEmpty# +
(+ ,
), -
.- .
WithMessage. 9
(9 :
$str: N
)N O
;O P
RuleFor 
( 
x 
=> 
x 
. 
Points !
)! "
." #
GreaterThan# .
(. /
$num/ 0
)0 1
.1 2
WithMessage2 =
(= >
$str> ]
)] ^
;^ _
RuleFor 
( 
x 
=> 
x 
. 
Description &
)& '
.' (
NotEmpty( 0
(0 1
)1 2
.2 3
WithMessage3 >
(> ?
$str? X
)X Y
;Y Z
} 	
} 
public 

class 
Handler 
: 
IRequestHandler *
<* +
Command+ 2
,2 3
Result4 :
>: ;
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public!! 
async!! 
Task!! 
<!! 
Result!!  
>!!  !
Handle!!" (
(!!( )
Command!!) 0
request!!1 8
,!!8 9
CancellationToken!!: K
cancellationToken!!L ]
)!!] ^
{"" 	
var## 
user## 
=## 
await## 
_context## %
.##% &
Users##& +
.$$ 
FirstOrDefaultAsync$$ $
($$$ %
u$$% &
=>$$' )
u$$* +
.$$+ ,
Id$$, .
==$$/ 1
request$$2 9
.$$9 :
UserId$$: @
,$$@ A
cancellationToken$$B S
)$$S T
;$$T U
if&& 
(&& 
user&& 
==&& 
null&& 
)&& 
return'' 
Result'' 
.'' 
Failure'' %
(''% &
$str''& 6
)''6 7
;''7 8
user)) 
.)) 
LoyaltyPoints)) 
+=)) !
request))" )
.))) *
Points))* 0
;))0 1
user** 
.** 
	UpdatedAt** 
=** 
DateTime** %
.**% &
UtcNow**& ,
;**, -
var,, 
transaction,, 
=,, 
new,, !
LoyaltyTransaction,," 4
{-- 
Id.. 
=.. 
Guid.. 
... 
NewGuid.. !
(..! "
).." #
,..# $
UserId// 
=// 
user// 
.// 
Id//  
,//  !
PointsChange00 
=00 
request00 &
.00& '
Points00' -
,00- .
Type11 
=11 "
LoyaltyTransactionType11 -
.11- .
Earned11. 4
,114 5
Description22 
=22 
request22 %
.22% &
Description22& 1
,221 2
OrderId33 
=33 
request33 !
.33! "
OrderId33" )
,33) *
	CreatedAt44 
=44 
DateTime44 $
.44$ %
UtcNow44% +
}55 
;55 
_context77 
.77 
LoyaltyTransactions77 (
.77( )
Add77) ,
(77, -
transaction77- 8
)778 9
;779 :
await88 
_context88 
.88 
SaveChangesAsync88 +
(88+ ,
cancellationToken88, =
)88= >
;88> ?
return:: 
Result:: 
.:: 
Success:: !
(::! "
)::" #
;::# $
};; 	
}<< 
}== ΄P
aC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Kitchen\UpdateOrderStatus.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Kitchen& -
;- .
public

 
static

 
class

 
UpdateOrderStatus

 %
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,
OrderDto, 4
>4 5
>5 6
{ 
public 
Guid 
OrderId 
{ 
get !
;! "
init# '
;' (
}) *
public 
string 
Status 
{ 
get "
;" #
init$ (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Command4 ;
,; <
Result= C
<C D
OrderDtoD L
>L M
>M N
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
OrderDto! )
>) *
>* +
Handle, 2
(2 3
Command3 :
request; B
,B C
CancellationTokenD U
cancellationTokenV g
)g h
{ 	
var 
order 
= 
await 
_context &
.& '
Orders' -
. 
Include 
( 
o 
=> 
o 
.  

OrderItems  *
)* +
. 
ThenInclude  
(  !
oi! #
=>$ &
oi' )
.) *
Product* 1
)1 2
.   
FirstOrDefaultAsync   $
(  $ %
o  % &
=>  ' )
o  * +
.  + ,
Id  , .
==  / 1
request  2 9
.  9 :
OrderId  : A
,  A B
cancellationToken  C T
)  T U
;  U V
if"" 
("" 
order"" 
is"" 
null"" 
)"" 
{## 
return$$ 
Result$$ 
<$$ 
OrderDto$$ &
>$$& '
.$$' (
Failure$$( /
($$/ 0
$"$$0 2
$str$$2 8
{$$8 9
request$$9 @
.$$@ A
OrderId$$A H
}$$H I
$str$$I S
"$$S T
)$$T U
;$$U V
}%% 
var(( 
wasCompleted(( 
=(( 
order(( $
.(($ %
Status((% +
==((, .
$str((/ :
;((: ;
order)) 
.)) 
Status)) 
=)) 
request)) "
.))" #
Status))# )
;))) *
order** 
.** 
	UpdatedAt** 
=** 
DateTime** &
.**& '
UtcNow**' -
;**- .
if,, 
(,, 
request,, 
.,, 
Status,, 
==,, !
$str,," -
),,- .
{-- 
order.. 
... 
CompletedAt.. !
=.." #
DateTime..$ ,
..., -
UtcNow..- 3
;..3 4
if// 
(// 
order// 
.// 
PaymentStatus// '
==//( *
$str//+ 4
)//4 5
order//6 ;
.//; <
PaymentStatus//< I
=//J K
$str//L R
;//R S
if22 
(22 
!22 
wasCompleted22 !
)22! "
{33 
var55 
loyaltyPayments55 '
=55( )
await55* /
_context550 8
.558 9
Payments559 A
.66 
Where66 
(66 
p66  
=>66! #
p66$ %
.66% &
OrderId66& -
==66. 0
order661 6
.666 7
Id667 9
&&66: <
p66= >
.66> ?
Method66? E
==66F H
PaymentMethod66I V
.66V W
LoyaltyPoints66W d
)66d e
.77 
SumAsync77 !
(77! "
p77" #
=>77$ &
p77' (
.77( )
Amount77) /
,77/ 0
cancellationToken771 B
)77B C
;77C D
var99 
	netAmount99 !
=99" #
order99$ )
.99) *
TotalAmount99* 5
-996 7
loyaltyPayments998 G
;99G H
var<< 
pointsToAward<< %
=<<& '
	netAmount<<( 1
*<<2 3
$num<<4 9
;<<9 :
var>> 
user>> 
=>> 
await>> $
_context>>% -
.>>- .
Users>>. 3
.>>3 4
	FindAsync>>4 =
(>>= >
new>>> A
object>>B H
[>>H I
]>>I J
{>>K L
order>>M R
.>>R S
UserId>>S Y
}>>Z [
,>>[ \
cancellationToken>>] n
)>>n o
;>>o p
if?? 
(?? 
user?? 
!=?? 
null??  $
)??$ %
{@@ 
userAA 
.AA 
LoyaltyPointsAA *
+=AA+ -
pointsToAwardAA. ;
;AA; <
userBB 
.BB 
	UpdatedAtBB &
=BB' (
DateTimeBB) 1
.BB1 2
UtcNowBB2 8
;BB8 9
varDD 
loyaltyTransactionDD .
=DD/ 0
newDD1 4
LoyaltyTransactionDD5 G
{EE 
IdFF 
=FF  
GuidFF! %
.FF% &
NewGuidFF& -
(FF- .
)FF. /
,FF/ 0
UserIdGG "
=GG# $
userGG% )
.GG) *
IdGG* ,
,GG, -
PointsChangeHH (
=HH) *
pointsToAwardHH+ 8
,HH8 9
TypeII  
=II! ""
LoyaltyTransactionTypeII# 9
.II9 :
EarnedII: @
,II@ A
DescriptionJJ '
=JJ( )
$"JJ* ,
$strJJ, 3
{JJ3 4
pointsToAwardJJ4 A
:JJA B
$strJJB D
}JJD E
$strJJE Y
{JJY Z
orderJJZ _
.JJ_ `
OrderNumberJJ` k
}JJk l
"JJl m
,JJm n
OrderIdKK #
=KK$ %
orderKK& +
.KK+ ,
IdKK, .
,KK. /
	CreatedAtLL %
=LL& '
DateTimeLL( 0
.LL0 1
UtcNowLL1 7
}MM 
;MM 
_contextNN  
.NN  !
LoyaltyTransactionsNN! 4
.NN4 5
AddNN5 8
(NN8 9
loyaltyTransactionNN9 K
)NNK L
;NNL M
}OO 
}PP 
}QQ 
awaitTT 
_contextTT 
.TT 
SaveChangesAsyncTT +
(TT+ ,
cancellationTokenTT, =
)TT= >
;TT> ?
varVV 
orderDtoVV 
=VV 
newVV 
OrderDtoVV '
{WW 
IdXX 
=XX 
orderXX 
.XX 
IdXX 
,XX 
OrderNumberYY 
=YY 
orderYY #
.YY# $
OrderNumberYY$ /
,YY/ 0
UserIdZZ 
=ZZ 
orderZZ 
.ZZ 
UserIdZZ %
,ZZ% &
TotalAmount[[ 
=[[ 
order[[ #
.[[# $
TotalAmount[[$ /
,[[/ 0
Status\\ 
=\\ 
order\\ 
.\\ 
Status\\ %
,\\% &
PaymentStatus]] 
=]] 
order]]  %
.]]% &
PaymentStatus]]& 3
,]]3 4
PaymentMethod^^ 
=^^ 
order^^  %
.^^% &
PaymentMethod^^& 3
,^^3 4
Notes__ 
=__ 
order__ 
.__ 
Notes__ #
,__# $
	CreatedAt`` 
=`` 
order`` !
.``! "
	CreatedAt``" +
,``+ ,
	UpdatedAtaa 
=aa 
orderaa !
.aa! "
	UpdatedAtaa" +
,aa+ ,
CompletedAtbb 
=bb 
orderbb #
.bb# $
CompletedAtbb$ /
,bb/ 0

OrderItemscc 
=cc 
ordercc "
.cc" #

OrderItemscc# -
.cc- .
Selectcc. 4
(cc4 5
oicc5 7
=>cc8 :
newcc; >
OrderItemDtocc? K
{dd 
Idee 
=ee 
oiee 
.ee 
Idee 
,ee 
	ProductIdff 
=ff 
oiff  "
.ff" #
	ProductIdff# ,
,ff, -
ProductNamehh 
=hh  !
oihh" $
.hh$ %
Producthh% ,
!=hh- /
nullhh0 4
?hh5 6
oihh7 9
.hh9 :
Producthh: A
.hhA B
NamehhB F
:hhG H
$strhhI \
,hh\ ]
Quantityii 
=ii 
oiii !
.ii! "
Quantityii" *
,ii* +
	UnitPricejj 
=jj 
oijj  "
.jj" #
	UnitPricejj# ,
,jj, -
Subtotalkk 
=kk 
oikk !
.kk! "
Subtotalkk" *
,kk* +
SpecialInstructionsll '
=ll( )
oill* ,
.ll, -
SpecialInstructionsll- @
}mm 
)mm 
.mm 
ToListmm 
(mm 
)mm 
}nn 
;nn 
returnpp 
Resultpp 
<pp 
OrderDtopp "
>pp" #
.pp# $
Successpp$ +
(pp+ ,
orderDtopp, 4
)pp4 5
;pp5 6
}qq 	
}rr 
}ss §,
`C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Kitchen\GetPendingOrders.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Kitchen& -
;- .
public		 
static		 
class		 
GetPendingOrders		 $
{

 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
List* .
<. /
OrderDto/ 7
>7 8
>8 9
>9 :
{ 
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
ListB F
<F G
OrderDtoG O
>O P
>P Q
>Q R
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
List! %
<% &
OrderDto& .
>. /
>/ 0
>0 1
Handle2 8
(8 9
Query9 >
request? F
,F G
CancellationTokenH Y
cancellationTokenZ k
)k l
{ 	
var 
orders 
= 
await 
_context '
.' (
Orders( .
. 
AsNoTracking 
( 
) 
. 
Where 
( 
o 
=> 
o 
. 
Status $
==% '
$str( 1
||2 4
o5 6
.6 7
Status7 =
==> @
$strA L
||M O
oP Q
.Q R
StatusR X
==Y [
$str\ c
)c d
.   
OrderBy   
(   
o   
=>   
o   
.    
	CreatedAt    )
)  ) *
.!! 
Include!! 
(!! 
o!! 
=>!! 
o!! 
.!!  

OrderItems!!  *
)!!* +
."" 
ThenInclude"" 
("" 
oi"" 
=>""  "
oi""# %
.""% &
Product""& -
)""- .
.## 
ToListAsync## 
(## 
cancellationToken## .
)##. /
;##/ 0
var%% 
	orderDtos%% 
=%% 
orders%% "
.%%" #
Select%%# )
(%%) *
order%%* /
=>%%0 2
new%%3 6
OrderDto%%7 ?
{&& 
Id'' 
='' 
order'' 
.'' 
Id'' 
,'' 
OrderNumber(( 
=(( 
order(( #
.((# $
OrderNumber(($ /
,((/ 0
UserId)) 
=)) 
order)) 
.)) 
UserId)) %
,))% &
TotalAmount** 
=** 
order** #
.**# $
TotalAmount**$ /
,**/ 0
Status++ 
=++ 
order++ 
.++ 
Status++ %
,++% &
PaymentStatus,, 
=,, 
order,,  %
.,,% &
PaymentStatus,,& 3
,,,3 4
PaymentMethod-- 
=-- 
order--  %
.--% &
PaymentMethod--& 3
,--3 4
Notes.. 
=.. 
order.. 
... 
Notes.. #
,..# $
	CreatedAt// 
=// 
order// !
.//! "
	CreatedAt//" +
,//+ ,
	UpdatedAt00 
=00 
order00 !
.00! "
	UpdatedAt00" +
,00+ ,
CompletedAt11 
=11 
order11 #
.11# $
CompletedAt11$ /
,11/ 0

OrderItems22 
=22 
order22 "
.22" #

OrderItems22# -
.22- .
Select22. 4
(224 5
oi225 7
=>228 :
new22; >
OrderItemDto22? K
{33 
Id44 
=44 
oi44 
.44 
Id44 
,44 
	ProductId55 
=55 
oi55  "
.55" #
	ProductId55# ,
,55, -
ProductName77 
=77  !
oi77" $
.77$ %
Product77% ,
!=77- /
null770 4
?775 6
oi777 9
.779 :
Product77: A
.77A B
Name77B F
:77G H
$str77I \
,77\ ]
Quantity88 
=88 
oi88 !
.88! "
Quantity88" *
,88* +
SpecialInstructions99 '
=99( )
oi99* ,
.99, -
SpecialInstructions99- @
}:: 
):: 
.:: 
ToList:: 
(:: 
):: 
};; 
);; 
.;; 
ToList;; 
(;; 
);; 
;;; 
return== 
Result== 
<== 
List== 
<== 
OrderDto== '
>==' (
>==( )
.==) *
Success==* 1
(==1 2
	orderDtos==2 ;
)==; <
;==< =
}>> 	
}?? 
}@@ δF
gC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Kitchen\GetDailyInventoryReport.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Kitchen& -
;- .
public

 
static

 
class

 #
GetDailyInventoryReport

 +
{ 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
InventoryReportDto* <
>< =
>= >
{ 
public 
DateTime 
? 

ReportDate #
{$ %
get& )
;) *
init+ /
;/ 0
}1 2
=3 4
null5 9
;9 :
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
InventoryReportDtoB T
>T U
>U V
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
InventoryReportDto! 3
>3 4
>4 5
Handle6 <
(< =
Query= B
requestC J
,J K
CancellationTokenL ]
cancellationToken^ o
)o p
{ 	
try 
{ 
var 

reportDate 
=  
(! "
request" )
.) *

ReportDate* 4
?4 5
.5 6
Date6 :
??; =
DateTime> F
.F G
UtcNowG M
.M N
DateN R
)R S
;S T

reportDate   
=   
DateTime   !
.  ! "
SpecifyKind  " -
(  - .

reportDate  . 8
,  8 9
DateTimeKind  : F
.  F G
Utc  G J
)  J K
;  K L
var"" 
nextDay"" 
="" 

reportDate"" $
.""$ %
AddDays""% ,
("", -
$num""- .
)"". /
;""/ 0
var'' 
dailyOrders'' 
='' 
await'' #
_context''$ ,
.'', -
Orders''- 3
.(( 
AsNoTracking(( 
((( 
)(( 
.)) 
Where)) 
()) 
o)) 
=>)) 
o)) 
.)) 
Status)) $
==))% '
$str))( 3
&&))4 6
o** 
.** 
CompletedAt** )
>=*** ,

reportDate**- 7
&&**8 :
o++ 
.++ 
CompletedAt++ )
<++* +
nextDay++, 3
)++3 4
.,, 
Include,, 
(,, 
o,, 
=>,, 
o,, 
.,,  

OrderItems,,  *
),,* +
.-- 
ThenInclude--  
(--  !
oi--! #
=>--$ &
oi--' )
.--) *
Product--* 1
)--1 2
... 
ToListAsync.. 
(.. 
cancellationToken.. .
)... /
;../ 0
var11 
allProducts11 
=11  !
await11" '
_context11( 0
.110 1
Products111 9
.22 
AsNoTracking22 !
(22! "
)22" #
.33 
ToListAsync33  
(33  !
cancellationToken33! 2
)332 3
;333 4
var55 
inventoryItems55 "
=55# $
allProducts55% 0
.550 1
Select551 7
(557 8
product558 ?
=>55@ B
{66 
var77 
productOrderItems77 )
=77* +
dailyOrders77, 7
.88 

SelectMany88 #
(88# $
o88$ %
=>88& (
o88) *
.88* +

OrderItems88+ 5
)885 6
.99 
Where99 
(99 
oi99 !
=>99" $
oi99% '
.99' (
	ProductId99( 1
==992 4
product995 <
.99< =
Id99= ?
)99? @
.:: 
ToList:: 
(::  
)::  !
;::! "
var<< 
quantitySold<< $
=<<% &
productOrderItems<<' 8
.<<8 9
Sum<<9 <
(<<< =
oi<<= ?
=><<@ B
oi<<C E
.<<E F
Quantity<<F N
)<<N O
;<<O P
var== 
revenue== 
===  !
productOrderItems==" 3
.==3 4
Sum==4 7
(==7 8
oi==8 :
=>==; =
oi==> @
.==@ A
Subtotal==A I
)==I J
;==J K
var>> 

orderCount>> "
=>># $
productOrderItems>>% 6
.>>6 7
Count>>7 <
;>>< =
var?? 
averageOrderValue?? )
=??* +

orderCount??, 6
>??7 8
$num??9 :
???; <
revenue??= D
/??E F

orderCount??G Q
:??R S
$num??T U
;??U V
ifBB 
(BB 
quantitySoldBB $
==BB% '
$numBB( )
)BB) *
returnBB+ 1
nullBB2 6
;BB6 7
returnDD 
newDD 
InventoryItemDtoDD /
{EE 
	ProductIdFF !
=FF" #
productFF$ +
.FF+ ,
IdFF, .
,FF. /
ProductNameGG #
=GG$ %
productGG& -
.GG- .
NameGG. 2
,GG2 3
QuantitySoldHH $
=HH% &
quantitySoldHH' 3
,HH3 4
	UnitPriceII !
=II" #
productII$ +
.II+ ,
PriceII, 1
,II1 2
SubtotalJJ  
=JJ! "
revenueJJ# *
,JJ* +
RevenueKK 
=KK  !
revenueKK" )
,KK) *

OrderCountLL "
=LL# $

orderCountLL% /
,LL/ 0
AverageOrderValueMM )
=MM* +
averageOrderValueMM, =
}NN 
;NN 
}OO 
)OO 
.PP 
WherePP 
(PP 
iPP 
=>PP 
iPP 
!=PP  
nullPP! %
)PP% &
.QQ 
CastQQ 
<QQ 
InventoryItemDtoQQ &
>QQ& '
(QQ' (
)QQ( )
.RR 
OrderByDescendingRR "
(RR" #
iRR# $
=>RR% '
iRR( )
.RR) *
QuantitySoldRR* 6
)RR6 7
.SS 
ToListSS 
(SS 
)SS 
;SS 
varUU 
totalRevenueUU  
=UU! "
dailyOrdersUU# .
.UU. /
SumUU/ 2
(UU2 3
oUU3 4
=>UU5 7
oUU8 9
.UU9 :
TotalAmountUU: E
)UUE F
;UUF G
varVV  
totalOrdersProcessedVV (
=VV) *
dailyOrdersVV+ 6
.VV6 7
CountVV7 <
;VV< =
varWW 
totalItemsSoldWW "
=WW# $
inventoryItemsWW% 3
.WW3 4
SumWW4 7
(WW7 8
iWW8 9
=>WW: <
iWW= >
.WW> ?
QuantitySoldWW? K
)WWK L
;WWL M
varYY 
inventoryReportYY #
=YY$ %
newYY& )
InventoryReportDtoYY* <
{ZZ 

ReportDate[[ 
=[[  

reportDate[[! +
,[[+ ,
InventoryItems\\ "
=\\# $
inventoryItems\\% 3
,\\3 4
TotalRevenue]]  
=]]! "
totalRevenue]]# /
,]]/ 0 
TotalOrdersProcessed^^ (
=^^) * 
totalOrdersProcessed^^+ ?
,^^? @
TotalItemsSold__ "
=__# $
totalItemsSold__% 3
}`` 
;`` 
returnbb 
Resultbb 
<bb 
InventoryReportDtobb 0
>bb0 1
.bb1 2
Successbb2 9
(bb9 :
inventoryReportbb: I
)bbI J
;bbJ K
}cc 
catchdd 
(dd 
	Exceptiondd 
exdd 
)dd  
{ee 
Consoleff 
.ff 
	WriteLineff !
(ff! "
$"ff" $
$strff$ 6
{ff6 7
exff7 9
.ff9 :
Messageff: A
}ffA B
"ffB C
)ffC D
;ffD E
Consolegg 
.gg 
	WriteLinegg !
(gg! "
exgg" $
.gg$ %

StackTracegg% /
)gg/ 0
;gg0 1
throwhh 
;hh 
}ii 
}jj 	
}kk 
}ll ―L
_C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Authentication\Register.cs
	namespace		 	

CampusEats		
 
.		 
Backend		 
.		 
Features		 %
.		% &
Authentication		& 4
;		4 5
public 
static 
class 
Register 
{ 
public 

record 
Command 
: 
IRequest $
<$ %
Result% +
<+ ,
UserDto, 3
>3 4
>4 5
{ 
public 
string 
Email 
{ 
get !
;! "
init# '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public 
string 
Password 
{  
get! $
;$ %
init& *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
FullName 
{  
get! $
;$ %
init& *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
public 
string 
PhoneNumber !
{" #
get$ '
;' (
init) -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 
string 
? 
	StudentId  
{! "
get# &
;& '
init( ,
;, -
}. /
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Command/ 6
>6 7
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Email  
)  !
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( ;
); <
. 
EmailAddress 
( 
) 
.  
WithMessage  +
(+ ,
$str, B
)B C
. 
MaximumLength 
( 
$num "
)" #
.# $
WithMessage$ /
(/ 0
$str0 T
)T U
;U V
RuleFor!! 
(!! 
x!! 
=>!! 
x!! 
.!! 
Password!! #
)!!# $
."" 
NotEmpty"" 
("" 
)"" 
."" 
WithMessage"" '
(""' (
$str""( >
)""> ?
.## 
MinimumLength## 
(## 
$num##  
)##  !
.##! "
WithMessage##" -
(##- .
$str##. V
)##V W
.$$ 
Matches$$ 
($$ 
$str$$ !
)$$! "
.$$" #
WithMessage$$# .
($$. /
$str$$/ d
)$$d e
.%% 
Matches%% 
(%% 
$str%% !
)%%! "
.%%" #
WithMessage%%# .
(%%. /
$str%%/ d
)%%d e
.&& 
Matches&& 
(&& 
$str&& !
)&&! "
.&&" #
WithMessage&&# .
(&&. /
$str&&/ Z
)&&Z [
.'' 
Matches'' 
('' 
$str'' 4
)''4 5
.''5 6
WithMessage''6 A
(''A B
$str''B x
)''x y
;''y z
RuleFor)) 
()) 
x)) 
=>)) 
x)) 
.)) 
FullName)) #
)))# $
.** 
NotEmpty** 
(** 
)** 
.** 
WithMessage** '
(**' (
$str**( ?
)**? @
.++ 
MaximumLength++ 
(++ 
$num++ "
)++" #
.++# $
WithMessage++$ /
(++/ 0
$str++0 X
)++X Y
;++Y Z
RuleFor-- 
(-- 
x-- 
=>-- 
x-- 
.-- 
PhoneNumber-- &
)--& '
... 
NotEmpty.. 
(.. 
).. 
... 
WithMessage.. '
(..' (
$str..( B
)..B C
.// 
Matches// 
(// 
$str// .
)//. /
./// 0
WithMessage//0 ;
(//; <
$str//< Y
)//Y Z
;//Z [
RuleFor11 
(11 
x11 
=>11 
x11 
.11 
	StudentId11 $
)11$ %
.22 
MaximumLength22 
(22 
$num22 !
)22! "
.22" #
WithMessage22# .
(22. /
$str22/ W
)22W X
;22X Y
}33 	
}44 
internal77 
sealed77 
class77 
Handler77 !
:77" #
IRequestHandler77$ 3
<773 4
Command774 ;
,77; <
Result77= C
<77C D
UserDto77D K
>77K L
>77L M
{88 
private99 
readonly99 
AppDbContext99 %
_context99& .
;99. /
public;; 
Handler;; 
(;; 
AppDbContext;; #
context;;$ +
);;+ ,
{<< 	
_context== 
=== 
context== 
;== 
}>> 	
public@@ 
async@@ 
Task@@ 
<@@ 
Result@@  
<@@  !
UserDto@@! (
>@@( )
>@@) *
Handle@@+ 1
(@@1 2
Command@@2 9
request@@: A
,@@A B
CancellationToken@@C T
cancellationToken@@U f
)@@f g
{AA 	
varCC 
emailExistsCC 
=CC 
awaitCC #
_contextCC$ ,
.CC, -
UsersCC- 2
.DD 
AnyAsyncDD 
(DD 
uDD 
=>DD 
uDD  
.DD  !
EmailDD! &
==DD' )
requestDD* 1
.DD1 2
EmailDD2 7
,DD7 8
cancellationTokenDD9 J
)DDJ K
;DDK L
ifFF 
(FF 
emailExistsFF 
)FF 
{GG 
returnHH 
ResultHH 
<HH 
UserDtoHH %
>HH% &
.HH& '
FailureHH' .
(HH. /
$strHH/ L
)HHL M
;HHM N
}II 
varLL 
passwordHashLL 
=LL 
BCryptLL %
.LL% &
NetLL& )
.LL) *
BCryptLL* 0
.LL0 1
HashPasswordLL1 =
(LL= >
requestLL> E
.LLE F
PasswordLLF N
)LLN O
;LLO P
varOO 
userOO 
=OO 
newOO 
UserOO 
{PP 
IdQQ 
=QQ 
GuidQQ 
.QQ 
NewGuidQQ !
(QQ! "
)QQ" #
,QQ# $
EmailRR 
=RR 
requestRR 
.RR  
EmailRR  %
,RR% &
PasswordHashSS 
=SS 
passwordHashSS +
,SS+ ,
FullNameTT 
=TT 
requestTT "
.TT" #
FullNameTT# +
,TT+ ,
RoleUU 
=UU 
$strUU  
,UU  !
PhoneNumberVV 
=VV 
requestVV %
.VV% &
PhoneNumberVV& 1
,VV1 2
	StudentIdWW 
=WW 
requestWW #
.WW# $
	StudentIdWW$ -
,WW- .
LoyaltyPointsXX 
=XX 
$numXX  !
,XX! "
IsActiveYY 
=YY 
trueYY 
,YY  
	CreatedAtZZ 
=ZZ 
DateTimeZZ $
.ZZ$ %
UtcNowZZ% +
}[[ 
;[[ 
_context]] 
.]] 
Users]] 
.]] 
Add]] 
(]] 
user]] #
)]]# $
;]]$ %
await^^ 
_context^^ 
.^^ 
SaveChangesAsync^^ +
(^^+ ,
cancellationToken^^, =
)^^= >
;^^> ?
varaa 
userDtoaa 
=aa 
newaa 
UserDtoaa %
{bb 
Idcc 
=cc 
usercc 
.cc 
Idcc 
,cc 
Emaildd 
=dd 
userdd 
.dd 
Emaildd "
,dd" #
FullNameee 
=ee 
useree 
.ee  
FullNameee  (
,ee( )
Roleff 
=ff 
userff 
.ff 
Roleff  
,ff  !
PhoneNumbergg 
=gg 
usergg "
.gg" #
PhoneNumbergg# .
,gg. /
	StudentIdhh 
=hh 
userhh  
.hh  !
	StudentIdhh! *
,hh* +
LoyaltyPointsii 
=ii 
userii  $
.ii$ %
LoyaltyPointsii% 2
,ii2 3
IsActivejj 
=jj 
userjj 
.jj  
IsActivejj  (
,jj( )
	CreatedAtkk 
=kk 
userkk  
.kk  !
	CreatedAtkk! *
}ll 
;ll 
returnnn 
Resultnn 
<nn 
UserDtonn !
>nn! "
.nn" #
Successnn# *
(nn* +
userDtonn+ 2
)nn2 3
;nn3 4
}oo 	
}pp 
}qq „8
\C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Authentication\Login.cs
	namespace		 	

CampusEats		
 
.		 
Backend		 
.		 
Features		 %
.		% &
Authentication		& 4
;		4 5
public 
static 
class 
Login 
{ 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
AuthResponseDto* 9
>9 :
>: ;
{ 
public 
string 
Email 
{ 
get !
;! "
init# '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public 
string 
Password 
{  
get! $
;$ %
init& *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
} 
public 

class 
	Validator 
: 
AbstractValidator .
<. /
Query/ 4
>4 5
{ 
public 
	Validator 
( 
) 
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Email  
)  !
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( ;
); <
. 
EmailAddress 
( 
) 
.  
WithMessage  +
(+ ,
$str, B
)B C
;C D
RuleFor 
( 
x 
=> 
x 
. 
Password #
)# $
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( >
)> ?
;? @
} 	
}   
internal## 
sealed## 
class## 
Handler## !
:##" #
IRequestHandler##$ 3
<##3 4
Query##4 9
,##9 :
Result##; A
<##A B
AuthResponseDto##B Q
>##Q R
>##R S
{$$ 
private%% 
readonly%% 
AppDbContext%% %
_context%%& .
;%%. /
private&& 
readonly&& 
IJwtService&& $
_jwtService&&% 0
;&&0 1
public(( 
Handler(( 
((( 
AppDbContext(( #
context(($ +
,((+ ,
IJwtService((- 8

jwtService((9 C
)((C D
{)) 	
_context** 
=** 
context** 
;** 
_jwtService++ 
=++ 

jwtService++ $
;++$ %
},, 	
public.. 
async.. 
Task.. 
<.. 
Result..  
<..  !
AuthResponseDto..! 0
>..0 1
>..1 2
Handle..3 9
(..9 :
Query..: ?
request..@ G
,..G H
CancellationToken..I Z
cancellationToken..[ l
)..l m
{// 	
var11 
user11 
=11 
await11 
_context11 %
.11% &
Users11& +
.22 
AsNoTracking22 
(22 
)22 
.33 
FirstOrDefaultAsync33 $
(33$ %
u33% &
=>33' )
u33* +
.33+ ,
Email33, 1
==332 4
request335 <
.33< =
Email33= B
,33B C
cancellationToken33D U
)33U V
;33V W
if55 
(55 
user55 
is55 
null55 
)55 
{66 
return77 
Result77 
<77 
AuthResponseDto77 -
>77- .
.77. /
Failure77/ 6
(776 7
$str777 R
)77R S
;77S T
}88 
var;; 
passwordValid;; 
=;; 
BCrypt;;  &
.;;& '
Net;;' *
.;;* +
BCrypt;;+ 1
.;;1 2
Verify;;2 8
(;;8 9
request;;9 @
.;;@ A
Password;;A I
,;;I J
user;;K O
.;;O P
PasswordHash;;P \
);;\ ]
;;;] ^
if== 
(== 
!== 
passwordValid== 
)== 
{>> 
return?? 
Result?? 
<?? 
AuthResponseDto?? -
>??- .
.??. /
Failure??/ 6
(??6 7
$str??7 R
)??R S
;??S T
}@@ 
ifCC 
(CC 
!CC 
userCC 
.CC 
IsActiveCC 
)CC 
{DD 
returnEE 
ResultEE 
<EE 
AuthResponseDtoEE -
>EE- .
.EE. /
FailureEE/ 6
(EE6 7
$strEE7 h
)EEh i
;EEi j
}FF 
varII 
tokenII 
=II 
_jwtServiceII #
.II# $
GenerateTokenII$ 1
(II1 2
userII2 6
.II6 7
IdII7 9
,II9 :
userII; ?
.II? @
EmailII@ E
,IIE F
userIIG K
.IIK L
RoleIIL P
,IIP Q
userIIR V
.IIV W
FullNameIIW _
)II_ `
;II` a
varLL 
userDtoLL 
=LL 
newLL 
UserDtoLL %
{MM 
IdNN 
=NN 
userNN 
.NN 
IdNN 
,NN 
EmailOO 
=OO 
userOO 
.OO 
EmailOO "
,OO" #
FullNamePP 
=PP 
userPP 
.PP  
FullNamePP  (
,PP( )
RoleQQ 
=QQ 
userQQ 
.QQ 
RoleQQ  
,QQ  !
PhoneNumberRR 
=RR 
userRR "
.RR" #
PhoneNumberRR# .
,RR. /
	StudentIdSS 
=SS 
userSS  
.SS  !
	StudentIdSS! *
,SS* +
LoyaltyPointsTT 
=TT 
userTT  $
.TT$ %
LoyaltyPointsTT% 2
,TT2 3
IsActiveUU 
=UU 
userUU 
.UU  
IsActiveUU  (
,UU( )
	CreatedAtVV 
=VV 
userVV  
.VV  !
	CreatedAtVV! *
}WW 
;WW 
varYY 
responseYY 
=YY 
newYY 
AuthResponseDtoYY .
{ZZ 
Token[[ 
=[[ 
token[[ 
,[[ 
User\\ 
=\\ 
userDto\\ 
}]] 
;]] 
return__ 
Result__ 
<__ 
AuthResponseDto__ )
>__) *
.__* +
Success__+ 2
(__2 3
response__3 ;
)__; <
;__< =
}`` 	
}aa 
}bb θ
eC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Features\Authentication\GetCurrentUser.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Features %
.% &
Authentication& 4
;4 5
public

 
static

 
class

 
GetCurrentUser

 "
{ 
public 

record 
Query 
: 
IRequest "
<" #
Result# )
<) *
UserDto* 1
>1 2
>2 3
{ 
public 
Guid 
UserId 
{ 
get  
;  !
init" &
;& '
}( )
} 
internal 
sealed 
class 
Handler !
:" #
IRequestHandler$ 3
<3 4
Query4 9
,9 :
Result; A
<A B
UserDtoB I
>I J
>J K
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
Handler 
( 
AppDbContext #
context$ +
)+ ,
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
Result  
<  !
UserDto! (
>( )
>) *
Handle+ 1
(1 2
Query2 7
request8 ?
,? @
CancellationTokenA R
cancellationTokenS d
)d e
{ 	
var 
user 
= 
await 
_context %
.% &
Users& +
. 
AsNoTracking 
( 
) 
.   
FirstOrDefaultAsync   $
(  $ %
u  % &
=>  ' )
u  * +
.  + ,
Id  , .
==  / 1
request  2 9
.  9 :
UserId  : @
,  @ A
cancellationToken  B S
)  S T
;  T U
if"" 
("" 
user"" 
is"" 
null"" 
)"" 
{## 
return$$ 
Result$$ 
<$$ 
UserDto$$ %
>$$% &
.$$& '
Failure$$' .
($$. /
$str$$/ ?
)$$? @
;$$@ A
}%% 
var'' 
userDto'' 
='' 
new'' 
UserDto'' %
{(( 
Id)) 
=)) 
user)) 
.)) 
Id)) 
,)) 
Email** 
=** 
user** 
.** 
Email** "
,**" #
FullName++ 
=++ 
user++ 
.++  
FullName++  (
,++( )
Role,, 
=,, 
user,, 
.,, 
Role,,  
,,,  !
PhoneNumber-- 
=-- 
user-- "
.--" #
PhoneNumber--# .
,--. /
	StudentId.. 
=.. 
user..  
...  !
	StudentId..! *
,..* +
LoyaltyPoints// 
=// 
user//  $
.//$ %
LoyaltyPoints//% 2
,//2 3
IsActive00 
=00 
user00 
.00  
IsActive00  (
,00( )
	CreatedAt11 
=11 
user11  
.11  !
	CreatedAt11! *
}22 
;22 
return44 
Result44 
<44 
UserDto44 !
>44! "
.44" #
Success44# *
(44* +
userDto44+ 2
)442 3
;443 4
}55 	
}66 
}77 ΰ
JC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Domain\User.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Domain #
;# $
public 
class 
User 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
PasswordHash 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

string 
FullName 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public		 

string		 
Role		 
{		 
get		 
;		 
set		 !
;		! "
}		# $
=		% &
string		' -
.		- .
Empty		. 3
;		3 4
public

 

string

 
PhoneNumber

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
=

, -
string

. 4
.

4 5
Empty

5 :
;

: ;
public 

string 
? 
	StudentId 
{ 
get "
;" #
set$ '
;' (
}) *
public 

decimal 
LoyaltyPoints  
{! "
get# &
;& '
set( +
;+ ,
}- .
=/ 0
$num1 2
;2 3
public 

bool 
IsActive 
{ 
get 
; 
set  #
;# $
}% &
=' (
true) -
;- .
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
? 
	UpdatedAt 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

ICollection 
< 
Order 
> 
Orders $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
new5 8
List9 =
<= >
Order> C
>C D
(D E
)E F
;F G
public 

ICollection 
< 
LoyaltyTransaction )
>) *
LoyaltyTransactions+ >
{? @
getA D
;D E
setF I
;I J
}K L
=M N
newO R
ListS W
<W X
LoyaltyTransactionX j
>j k
(k l
)l m
;m n
} Σ
MC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Domain\Product.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Domain #
;# $
public 
class 
Product 
{ 
[ 
Key 
] 	
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
=% &
string' -
.- .
Empty. 3
;3 4
public		 

string		 
Description		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
=		, -
string		. 4
.		4 5
Empty		5 :
;		: ;
public

 

decimal

 
Price

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
public 

string 
Category 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
? 
ImageUrl 
{ 
get !
;! "
set# &
;& '
}( )
public 

List 
< 
string 
> 
	Allergens !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
new2 5
(5 6
)6 7
;7 8
public 

string 
? 
DietaryRestrictions &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 

bool 
IsAvailable 
{ 
get !
;! "
set# &
;& '
}( )
=* +
true, 0
;0 1
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
? 
	UpdatedAt 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

ICollection 
< 
	OrderItem  
>  !

OrderItems" ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
=; <
new= @
ListA E
<E F
	OrderItemF O
>O P
(P Q
)Q R
;R S
} Ο
XC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Domain\LoyaltyTransaction.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Domain #
;# $
public 
class 
LoyaltyTransaction 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

Guid 
UserId 
{ 
get 
; 
set !
;! "
}# $
public 

User 
User 
{ 
get 
; 
set 
;  
}! "
=# $
null% )
!) *
;* +
public		 

decimal		 
PointsChange		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public

 
"
LoyaltyTransactionType

 !
Type

" &
{

' (
get

) ,
;

, -
set

. 1
;

1 2
}

3 4
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 

Guid 
? 
OrderId 
{ 
get 
; 
set  #
;# $
}% &
public 

Order 
? 
Order 
{ 
get 
; 
set "
;" #
}$ %
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
} 
public 
enum "
LoyaltyTransactionType "
{ 
Earned 

= 
$num 
, 
Redeemed 
= 
$num 
, 
Expired 
= 
$num 
, 
Adjusted 
= 
$num 
} «
MC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Domain\Payment.cs
public 
enum 
PaymentStatus 
{ 
Pending 
= 
$num 
, 

Processing 
= 
$num 
, 
	Completed 
= 
$num 
, 
Failed 

= 
$num 
, 
Refunded		 
=		 
$num		 
}

 
public 
enum 
PaymentMethod 
{ 
Card 
=	 

$num 
, 
Cash 
=	 

$num 
, 
LoyaltyPoints 
= 
$num 
, 
Mixed 	
=
 
$num 
} 
public 
class 
Payment 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

Guid 
OrderId 
{ 
get 
; 
set "
;" #
}$ %
public 

Order 
Order 
{ 
get 
; 
set !
;! "
}# $
=% &
null' +
!+ ,
;, -
public 

decimal 
Amount 
{ 
get 
;  
set! $
;$ %
}& '
public 

PaymentStatus 
Status 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
PaymentStatus0 =
.= >
Pending> E
;E F
public 

PaymentMethod 
Method 
{  !
get" %
;% &
set' *
;* +
}, -
public 

string 
? !
StripePaymentIntentId (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 

string 
? 
StripeSessionId "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
? 
PaidAt 
{ 
get !
;! "
set# &
;& '
}( )
public   

DateTime   
?   
FailedAt   
{   
get    #
;  # $
set  % (
;  ( )
}  * +
public!! 

string!! 
?!! 
FailureReason!!  
{!!! "
get!!# &
;!!& '
set!!( +
;!!+ ,
}!!- .
public"" 

decimal"" 
?"" 
LoyaltyPointsUsed"" %
{""& '
get""( +
;""+ ,
set""- 0
;""0 1
}""2 3
}## 7
YC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\Services\JwtService.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
Services$ ,
;, -
public 
	interface 
IJwtService 
{		 
string

 

GenerateToken

 
(

 
Guid

 
userId

 $
,

$ %
string

& ,
email

- 2
,

2 3
string

4 :
role

; ?
,

? @
string

A G
fullName

H P
)

P Q
;

Q R
ClaimsPrincipal 
? 
ValidateToken "
(" #
string# )
token* /
)/ 0
;0 1
} 
public 
class 

JwtService 
: 
IJwtService %
{ 
private 
readonly 
IConfiguration #
_configuration$ 2
;2 3
public 


JwtService 
( 
IConfiguration $
configuration% 2
)2 3
{ 
_configuration 
= 
configuration &
;& '
} 
public 

string 
GenerateToken 
(  
Guid  $
userId% +
,+ ,
string- 3
email4 9
,9 :
string; A
roleB F
,F G
stringH N
fullNameO W
)W X
{ 
var 
securityKey 
= 
new  
SymmetricSecurityKey 2
(2 3
Encoding 
. 
UTF8 
. 
GetBytes "
(" #
_configuration# 1
[1 2
$str2 A
]A B
!B C
)C D
)D E
;E F
var 
credentials 
= 
new 
SigningCredentials 0
(0 1
securityKey1 <
,< =
SecurityAlgorithms> P
.P Q

HmacSha256Q [
)[ \
;\ ]
var 
claims 
= 
new 
[ 
] 
{ 	
new   
Claim   
(   #
JwtRegisteredClaimNames   -
.  - .
Sub  . 1
,  1 2
userId  3 9
.  9 :
ToString  : B
(  B C
)  C D
)  D E
,  E F
new!! 
Claim!! 
(!! #
JwtRegisteredClaimNames!! -
.!!- .
Email!!. 3
,!!3 4
email!!5 :
)!!: ;
,!!; <
new"" 
Claim"" 
("" 

ClaimTypes""  
.""  !
Role""! %
,""% &
role""' +
)""+ ,
,"", -
new## 
Claim## 
(## 

ClaimTypes##  
.##  !
Name##! %
,##% &
fullName##' /
)##/ 0
,##0 1
new$$ 
Claim$$ 
($$ #
JwtRegisteredClaimNames$$ -
.$$- .
Jti$$. 1
,$$1 2
Guid$$3 7
.$$7 8
NewGuid$$8 ?
($$? @
)$$@ A
.$$A B
ToString$$B J
($$J K
)$$K L
)$$L M
,$$M N
new%% 
Claim%% 
(%% #
JwtRegisteredClaimNames%% -
.%%- .
Iat%%. 1
,%%1 2
DateTimeOffset%%3 A
.%%A B
UtcNow%%B H
.%%H I
ToUnixTimeSeconds%%I Z
(%%Z [
)%%[ \
.%%\ ]
ToString%%] e
(%%e f
)%%f g
)%%g h
}&& 	
;&&	 

var(( 
expirationDays(( 
=(( 
int((  
.((  !
Parse((! &
(((& '
_configuration((' 5
[((5 6
$str((6 J
]((J K
!((K L
)((L M
;((M N
var** 
token** 
=** 
new** 
JwtSecurityToken** (
(**( )
issuer++ 
:++ 
_configuration++ "
[++" #
$str++# /
]++/ 0
,++0 1
audience,, 
:,, 
_configuration,, $
[,,$ %
$str,,% 3
],,3 4
,,,4 5
claims-- 
:-- 
claims-- 
,-- 
expires.. 
:.. 
DateTime.. 
... 
UtcNow.. $
...$ %
AddDays..% ,
(.., -
expirationDays..- ;
)..; <
,..< =
signingCredentials// 
:// 
credentials//  +
)00 	
;00	 

return22 
new22 #
JwtSecurityTokenHandler22 *
(22* +
)22+ ,
.22, -

WriteToken22- 7
(227 8
token228 =
)22= >
;22> ?
}33 
public55 

ClaimsPrincipal55 
?55 
ValidateToken55 )
(55) *
string55* 0
token551 6
)556 7
{66 
var77 
tokenHandler77 
=77 
new77 #
JwtSecurityTokenHandler77 6
(776 7
)777 8
;778 9
var88 
securityKey88 
=88 
new88  
SymmetricSecurityKey88 2
(882 3
Encoding99 
.99 
UTF899 
.99 
GetBytes99 "
(99" #
_configuration99# 1
[991 2
$str992 A
]99A B
!99B C
)99C D
)99D E
;99E F
try;; 
{<< 	
var== 
	principal== 
=== 
tokenHandler== (
.==( )
ValidateToken==) 6
(==6 7
token==7 <
,==< =
new==> A%
TokenValidationParameters==B [
{>> $
ValidateIssuerSigningKey?? (
=??) *
true??+ /
,??/ 0
IssuerSigningKey@@  
=@@! "
securityKey@@# .
,@@. /
ValidateIssuerAA 
=AA  
trueAA! %
,AA% &
ValidIssuerBB 
=BB 
_configurationBB ,
[BB, -
$strBB- 9
]BB9 :
,BB: ;
ValidateAudienceCC  
=CC! "
trueCC# '
,CC' (
ValidAudienceDD 
=DD 
_configurationDD  .
[DD. /
$strDD/ =
]DD= >
,DD> ?
ValidateLifetimeEE  
=EE! "
trueEE# '
,EE' (
	ClockSkewFF 
=FF 
TimeSpanFF $
.FF$ %
ZeroFF% )
}GG 
,GG 
outGG 
_GG 
)GG 
;GG 
returnII 
	principalII 
;II 
}JJ 	
catchKK 
{LL 	
returnMM 
nullMM 
;MM 
}NN 	
}OO 
}PP ®
OC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Domain\OrderItem.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Domain #
;# $
public 
class 
	OrderItem 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

Guid 
OrderId 
{ 
get 
; 
set "
;" #
}$ %
public 

Guid 
	ProductId 
{ 
get 
;  
set! $
;$ %
}& '
public 

int 
Quantity 
{ 
get 
; 
set "
;" #
}$ %
public		 

decimal		 
	UnitPrice		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
public

 

decimal

 
Subtotal

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 

string 
? 
SpecialInstructions &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 

Order 
Order 
{ 
get 
; 
set !
;! "
}# $
=% &
null' +
!+ ,
;, -
public 

Product 
Product 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
} ’
KC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Domain\Order.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Domain #
;# $
public 
class 
Order 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
OrderNumber 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 

Guid 
UserId 
{ 
get 
; 
set !
;! "
}# $
public		 

decimal		 
TotalAmount		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public

 

string

 
Status

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
=

' (
$str

) 2
;

2 3
public 

string 
PaymentStatus 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
$str0 9
;9 :
public 

string 
? 
PaymentMethod  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

string 
? 
Notes 
{ 
get 
; 
set  #
;# $
}% &
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
? 
	UpdatedAt 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

DateTime 
? 
CompletedAt  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

User 
User 
{ 
get 
; 
set 
;  
}! "
=# $
null% )
!) *
;* +
public 

ICollection 
< 
	OrderItem  
>  !

OrderItems" ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
=; <
new= @
ListA E
<E F
	OrderItemF O
>O P
(P Q
)Q R
;R S
} ί:
LC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\Result.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
;# $
public 
class 
Result 
< 
T 
> 
{ 
public 

bool 
	IsSuccess 
{ 
get 
;  
}! "
public 

T 
? 
Value 
{ 
get 
; 
} 
public 

string 
? 
Error 
{ 
get 
; 
}  !
public 

List 
< 
string 
> 
Errors 
{  
get! $
;$ %
}& '
private

 
Result

 
(

 
bool

 
	isSuccess

 !
,

! "
T

# $
?

$ %
value

& +
,

+ ,
string

- 3
?

3 4
error

5 :
,

: ;
List

< @
<

@ A
string

A G
>

G H
?

H I
errors

J P
=

Q R
null

S W
)

W X
{ 
	IsSuccess 
= 
	isSuccess 
; 
Value 
= 
value 
; 
Error 
= 
error 
; 
if 

( 
errors 
!= 
null 
&& 
errors $
.$ %
Count% *
>+ ,
$num- .
). /
{ 	
Errors 
= 
errors 
; 
} 	
else 
if 
( 
! 
string 
. 
IsNullOrEmpty &
(& '
error' ,
), -
)- .
{ 	
Errors 
= 
new 
List 
< 
string $
>$ %
{& '
error( -
}. /
;/ 0
} 	
else 
{ 	
Errors 
= 
new 
List 
< 
string $
>$ %
(% &
)& '
;' (
} 	
} 
public   

static   
Result   
<   
T   
>   
Success   #
(  # $
T  $ %
value  & +
)  + ,
=>  - /
new  0 3
(  3 4
true  4 8
,  8 9
value  : ?
,  ? @
null  A E
,  E F
null  G K
)  K L
;  L M
public## 

static## 
Result## 
<## 
T## 
>## 
Failure## #
(### $
string##$ *
error##+ 0
)##0 1
=>##2 4
new$$ 
($$ 
false$$ 
,$$ 
default$$ 
,$$ 
error$$ !
,$$! "
new$$# &
List$$' +
<$$+ ,
string$$, 2
>$$2 3
{$$4 5
error$$6 ;
}$$< =
)$$= >
;$$> ?
public'' 

static'' 
Result'' 
<'' 
T'' 
>'' 
Failure'' #
(''# $
List''$ (
<''( )
string'') /
>''/ 0
errors''1 7
)''7 8
=>''9 ;
new(( 
((( 
false(( 
,(( 
default(( 
,(( 
errors(( "
.((" #
FirstOrDefault((# 1
(((1 2
)((2 3
,((3 4
errors((5 ;
)((; <
;((< =
public++ 

static++ 
implicit++ 
operator++ #
bool++$ (
(++( )
Result++) /
<++/ 0
T++0 1
>++1 2
result++3 9
)++9 :
=>++; =
result++> D
.++D E
	IsSuccess++E N
;++N O
},, 
public// 
class// 
Result// 
{00 
public11 

bool11 
	IsSuccess11 
{11 
get11 
;11  
}11! "
public22 

string22 
?22 
Error22 
{22 
get22 
;22 
}22  !
public33 

List33 
<33 
string33 
>33 
Errors33 
{33  
get33! $
;33$ %
}33& '
private55 
Result55 
(55 
bool55 
	isSuccess55 !
,55! "
string55# )
?55) *
error55+ 0
,550 1
List552 6
<556 7
string557 =
>55= >
?55> ?
errors55@ F
=55G H
null55I M
)55M N
{66 
	IsSuccess77 
=77 
	isSuccess77 
;77 
Error88 
=88 
error88 
;88 
if;; 

(;; 
errors;; 
!=;; 
null;; 
&&;; 
errors;; $
.;;$ %
Count;;% *
>;;+ ,
$num;;- .
);;. /
{<< 	
Errors== 
=== 
errors== 
;== 
}>> 	
else?? 
if?? 
(?? 
!?? 
string?? 
.?? 
IsNullOrEmpty?? &
(??& '
error??' ,
)??, -
)??- .
{@@ 	
ErrorsAA 
=AA 
newAA 
ListAA 
<AA 
stringAA $
>AA$ %
{AA& '
errorAA( -
}AA. /
;AA/ 0
}BB 	
elseCC 
{DD 	
ErrorsEE 
=EE 
newEE 
ListEE 
<EE 
stringEE $
>EE$ %
(EE% &
)EE& '
;EE' (
}FF 	
}GG 
publicII 

staticII 
ResultII 
SuccessII  
(II  !
)II! "
=>II# %
newII& )
(II) *
trueII* .
,II. /
nullII0 4
,II4 5
nullII6 :
)II: ;
;II; <
publicKK 

staticKK 
ResultKK 
FailureKK  
(KK  !
stringKK! '
errorKK( -
)KK- .
=>KK/ 1
newLL 
(LL 
falseLL 
,LL 
errorLL 
,LL 
newLL 
ListLL "
<LL" #
stringLL# )
>LL) *
{LL+ ,
errorLL- 2
}LL3 4
)LL4 5
;LL5 6
publicNN 

staticNN 
ResultNN 
FailureNN  
(NN  !
ListNN! %
<NN% &
stringNN& ,
>NN, -
errorsNN. 4
)NN4 5
=>NN6 8
newOO 
(OO 
falseOO 
,OO 
errorsOO 
.OO 
FirstOrDefaultOO (
(OO( )
)OO) *
,OO* +
errorsOO, 2
)OO2 3
;OO3 4
publicQQ 

staticQQ 
implicitQQ 
operatorQQ #
boolQQ$ (
(QQ( )
ResultQQ) /
resultQQ0 6
)QQ6 7
=>QQ8 :
resultQQ; A
.QQA B
	IsSuccessQQB K
;QQK L
}RR Ό
QC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\PagedResult.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
;# $
public 
class 
PagedResult 
< 
T 
> 
{ 
public 

int 
CurrentPage 
{ 
get  
;  !
set" %
;% &
}' (
public 

int 
PageSize 
{ 
get 
; 
set "
;" #
}$ %
public 

int 

TotalCount 
{ 
get 
;  
set! $
;$ %
}& '
public 

List 
< 
T 
> 
Items 
{ 
get 
; 
set  #
;# $
}% &
=' (
new) ,
(, -
)- .
;. /
}		 ΄
bC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\Exceptions\NotFoundException.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $

Exceptions$ .
;. /
public 
class 
NotFoundException 
:  
	Exception! *
{ 
public 

NotFoundException 
( 
string #
message$ +
)+ ,
:- .
base/ 3
(3 4
message4 ;
); <
{ 
} 
public		 

NotFoundException		 
(		 
string		 #

entityName		$ .
,		. /
object		0 6
key		7 :
)		: ;
:

 	
base


 
(

 
$"

 
{

 

entityName

 
}

 
$str

 '
{

' (
key

( +
}

+ ,
$str

, <
"

< =
)

= >
{ 
} 
} ΐ
UC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\DTOs\ProductDto.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
DTOs$ (
;( )
public 
record 

ProductDto 
{ 
public 

Guid 
Id 
{ 
get 
; 
init 
; 
}  !
public 

string 
Name 
{ 
get 
; 
init "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Description 
{ 
get  #
;# $
init% )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

decimal 
Price 
{ 
get 
; 
init  $
;$ %
}& '
public		 

string		 
Category		 
{		 
get		  
;		  !
init		" &
;		& '
}		( )
=		* +
string		, 2
.		2 3
Empty		3 8
;		8 9
public

 

string

 
?

 
ImageUrl

 
{

 
get

 !
;

! "
init

# '
;

' (
}

) *
public 

List 
< 
string 
> 
	Allergens !
{" #
get$ '
;' (
init) -
;- .
}/ 0
=1 2
new3 6
(6 7
)7 8
;8 9
public 

string 
? 
DietaryRestrictions &
{' (
get) ,
;, -
init. 2
;2 3
}4 5
public 

bool 
IsAvailable 
{ 
get !
;! "
init# '
;' (
}) *
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
init% )
;) *
}+ ,
public 

DateTime 
? 
	UpdatedAt 
{  
get! $
;$ %
init& *
;* +
}, -
} 
UC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\DTOs\PaymentDto.cs
public 
class 

PaymentDto 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

Guid 
OrderId 
{ 
get 
; 
set "
;" #
}$ %
public 

decimal 
Amount 
{ 
get 
;  
set! $
;$ %
}& '
[		 
JsonConverter		 
(		 
typeof		 
(		 #
JsonStringEnumConverter		 1
)		1 2
)		2 3
]		3 4
public

 

PaymentStatus

 
Status

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
[ 
JsonConverter 
( 
typeof 
( #
JsonStringEnumConverter 1
)1 2
)2 3
]3 4
public 

PaymentMethod 
Method 
{  !
get" %
;% &
set' *
;* +
}, -
public 

string 
? !
StripePaymentIntentId (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 

string 
? 
StripeSessionId "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

string 
? 
StripeClientSecret %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
? 
PaidAt 
{ 
get !
;! "
set# &
;& '
}( )
public 

DateTime 
? 
FailedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
? 
FailureReason  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

decimal 
? 
LoyaltyPointsUsed %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} €
SC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\DTOs\OrderDto.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
DTOs$ (
;( )
public 
record 
OrderDto 
{ 
public 

Guid 
Id 
{ 
get 
; 
init 
; 
}  !
public 

string 
OrderNumber 
{ 
get  #
;# $
init% )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

Guid 
UserId 
{ 
get 
; 
init "
;" #
}$ %
public 

decimal 
TotalAmount 
{  
get! $
;$ %
init& *
;* +
}, -
public		 

string		 
Status		 
{		 
get		 
;		 
init		  $
;		$ %
}		& '
=		( )
string		* 0
.		0 1
Empty		1 6
;		6 7
public

 

string

 
PaymentStatus

 
{

  !
get

" %
;

% &
init

' +
;

+ ,
}

- .
=

/ 0
string

1 7
.

7 8
Empty

8 =
;

= >
public 

string 
? 
PaymentMethod  
{! "
get# &
;& '
init( ,
;, -
}. /
public 

string 
? 
Notes 
{ 
get 
; 
init  $
;$ %
}& '
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
init% )
;) *
}+ ,
public 

DateTime 
? 
	UpdatedAt 
{  
get! $
;$ %
init& *
;* +
}, -
public 

DateTime 
? 
CompletedAt  
{! "
get# &
;& '
init( ,
;, -
}. /
public 

List 
< 
OrderItemDto 
> 

OrderItems (
{) *
get+ .
;. /
init0 4
;4 5
}6 7
=8 9
new: =
(= >
)> ?
;? @
} 
public 
record 
OrderItemDto 
{ 
public 

Guid 
Id 
{ 
get 
; 
init 
; 
}  !
public 

Guid 
	ProductId 
{ 
get 
;  
init! %
;% &
}' (
public 

string 
ProductName 
{ 
get  #
;# $
init% )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

int 
Quantity 
{ 
get 
; 
init #
;# $
}% &
public 

decimal 
	UnitPrice 
{ 
get "
;" #
init$ (
;( )
}* +
public 

decimal 
Subtotal 
{ 
get !
;! "
init# '
;' (
}) *
public 

string 
? 
SpecialInstructions &
{' (
get) ,
;, -
init. 2
;2 3
}4 5
} —
UC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\DTOs\LoyaltyDto.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
DTOs$ (
;( )
public 
record 
LoyaltyPointsDto 
{ 
public 

Guid 
UserId 
{ 
get 
; 
init "
;" #
}$ %
public 

decimal 
CurrentPoints  
{! "
get# &
;& '
init( ,
;, -
}. /
public 

decimal 
TotalEarned 
{  
get! $
;$ %
init& *
;* +
}, -
public 

decimal 
TotalRedeemed  
{! "
get# &
;& '
init( ,
;, -
}. /
public		 

decimal		 
PointsValue		 
{		  
get		! $
;		$ %
init		& *
;		* +
}		, -
}

 
public 
record !
LoyaltyTransactionDto #
{ 
public 

Guid 
Id 
{ 
get 
; 
init 
; 
}  !
public 

Guid 
UserId 
{ 
get 
; 
init "
;" #
}$ %
public 

decimal 
PointsChange 
{  !
get" %
;% &
init' +
;+ ,
}- .
public 

string 
Type 
{ 
get 
; 
init "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Description 
{ 
get  #
;# $
init% )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

Guid 
? 
OrderId 
{ 
get 
; 
init  $
;$ %
}& '
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
init% )
;) *
}+ ,
} 
public 
record !
RedeemPointsResultDto #
{ 
public 

decimal 
PointsRedeemed !
{" #
get$ '
;' (
init) -
;- .
}/ 0
public 

decimal 
DiscountAmount !
{" #
get$ '
;' (
init) -
;- .
}/ 0
public 

decimal 
RemainingPoints "
{# $
get% (
;( )
init* .
;. /
}0 1
public 

string 
Message 
{ 
get 
;  
init! %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} Ώ
]C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\DTOs\InventoryReportDto.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
DTOs$ (
;( )
public 
record 
InventoryReportDto  
{ 
public 

DateTime 
? 

ReportDate 
{  !
get" %
;% &
init' +
;+ ,
}- .
public 

List 
< 
InventoryItemDto  
>  !
InventoryItems" 0
{1 2
get3 6
;6 7
init8 <
;< =
}> ?
=@ A
newB E
(E F
)F G
;G H
public 

decimal 
TotalRevenue 
{  !
get" %
;% &
init' +
;+ ,
}- .
public 

int  
TotalOrdersProcessed #
{$ %
get& )
;) *
init+ /
;/ 0
}1 2
public		 

int		 
TotalItemsSold		 
{		 
get		  #
;		# $
init		% )
;		) *
}		+ ,
}

 
public 
record 
InventoryItemDto 
{ 
public 

Guid 
	ProductId 
{ 
get 
;  
init! %
;% &
}' (
public 

string 
ProductName 
{ 
get  #
;# $
init% )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 

string 
Category 
{ 
get  
;  !
init" &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 

int 
QuantitySold 
{ 
get !
;! "
init# '
;' (
}) *
public 

decimal 
	UnitPrice 
{ 
get "
;" #
init$ (
;( )
}* +
public 

decimal 
Subtotal 
{ 
get !
;! "
init# '
;' (
}) *
public 

decimal 
Revenue 
{ 
get  
;  !
init" &
;& '
}( )
public 

int 

OrderCount 
{ 
get 
;  
init! %
;% &
}' (
public 

decimal 
AverageOrderValue $
{% &
get' *
;* +
init, 0
;0 1
}2 3
} Ί"
RC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\DTOs\AuthDto.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
DTOs$ (
;( )
public 
class 
RegisterDto 
{ 
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
FullName 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
PhoneNumber 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public		 

string		 
?		 
	StudentId		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
}

 
public 
class 
LoginDto 
{ 
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
public 
class 
AuthResponseDto 
{ 
public 

string 
Token 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

UserDto 
User 
{ 
get 
; 
set "
;" #
}$ %
=& '
null( ,
!, -
;- .
} 
public 
class 
UserDto 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
=& '
string( .
.. /
Empty/ 4
;4 5
public 

string 
FullName 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

string 
Role 
{ 
get 
; 
set !
;! "
}# $
=% &
string' -
.- .
Empty. 3
;3 4
public 

string 
PhoneNumber 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 

string 
? 
	StudentId 
{ 
get "
;" #
set$ '
;' (
}) *
public   

decimal   
LoyaltyPoints    
{  ! "
get  # &
;  & '
set  ( +
;  + ,
}  - .
public!! 

bool!! 
IsActive!! 
{!! 
get!! 
;!! 
set!!  #
;!!# $
}!!% &
public"" 

DateTime"" 
	CreatedAt"" 
{"" 
get""  #
;""# $
set""% (
;""( )
}""* +
}## Ι
[C:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\Config\StripeSettings.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
Config$ *
;* +
public 
class 
StripeSettings 
{ 
public 

string 
	SecretKey 
{ 
get !
;! "
set# &
;& '
}( )
=* +
$str, .
;. /
public 

string 
	PublicKey 
{ 
get !
;! "
set# &
;& '
}( )
=* +
$str, .
;. /
public		 

string		 
WebhookSecret		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
=		. /
$str		0 2
;		2 3
}

 ν/
bC:\Users\bmate\Source\Repos\campus__eats\CampusEats.Backend\Common\Behaviors\ValidationBehavior.cs
	namespace 	

CampusEats
 
. 
Backend 
. 
Common #
.# $
	Behaviors$ -
;- .
public 
class 
ValidationBehavior 
<  
TRequest  (
,( )
	TResponse* 3
>3 4
:5 6
IPipelineBehavior7 H
<H I
TRequestI Q
,Q R
	TResponseS \
>\ ]
where 	
TRequest
 
: 
IRequest 
< 
	TResponse '
>' (
{		 
private

 
readonly

 
IEnumerable

  
<

  !

IValidator

! +
<

+ ,
TRequest

, 4
>

4 5
>

5 6
_validators

7 B
;

B C
public 

ValidationBehavior 
( 
IEnumerable )
<) *

IValidator* 4
<4 5
TRequest5 =
>= >
>> ?

validators@ J
)J K
{ 
_validators 
= 

validators  
;  !
} 
public 

async 
Task 
< 
	TResponse 
>  
Handle! '
(' (
TRequest 
request 
, "
RequestHandlerDelegate 
< 
	TResponse (
>( )
next* .
,. /
CancellationToken 
cancellationToken +
)+ ,
{ 
if 

( 
! 
_validators 
. 
Any 
( 
) 
) 
{ 	
return 
await 
next 
( 
) 
;  
} 	
var 
context 
= 
new 
ValidationContext +
<+ ,
TRequest, 4
>4 5
(5 6
request6 =
)= >
;> ?
var 
validationResults 
= 
await  %
Task& *
.* +
WhenAll+ 2
(2 3
_validators   
.   
Select   
(   
v    
=>  ! #
v  $ %
.  % &
ValidateAsync  & 3
(  3 4
context  4 ;
,  ; <
cancellationToken  = N
)  N O
)  O P
)  P Q
;  Q R
var"" 
failures"" 
="" 
validationResults"" (
.## 

SelectMany## 
(## 
r## 
=>## 
r## 
.## 
Errors## %
)##% &
.$$ 
Where$$ 
($$ 
f$$ 
=>$$ 
f$$ 
!=$$ 
null$$ !
)$$! "
.%% 
ToList%% 
(%% 
)%% 
;%% 
if(( 

((( 
failures(( 
.(( 
Any(( 
((( 
)(( 
)(( 
{)) 	
var** 
errors** 
=** 
failures** !
.**! "
Select**" (
(**( )
f**) *
=>**+ -
f**. /
.**/ 0
ErrorMessage**0 <
)**< =
.**= >
ToList**> D
(**D E
)**E F
;**F G
if-- 
(-- 
typeof-- 
(-- 
	TResponse--  
)--  !
.--! "
IsGenericType--" /
&&--0 2
typeof.. 
(.. 
	TResponse..  
)..  !
...! "$
GetGenericTypeDefinition.." :
(..: ;
)..; <
==..= ?
typeof..@ F
(..F G
Result..G M
<..M N
>..N O
)..O P
)..P Q
{// 
var00 

resultType00 
=00  
typeof00! '
(00' (
	TResponse00( 1
)001 2
.002 3
GetGenericArguments003 F
(00F G
)00G H
[00H I
$num00I J
]00J K
;00K L
var11 
failureMethod11 !
=11" #
typeof11$ *
(11* +
Result11+ 1
<111 2
>112 3
)113 4
.22 
MakeGenericType22 $
(22$ %

resultType22% /
)22/ 0
.33 
	GetMethod33 
(33 
nameof33 %
(33% &
Result33& ,
<33, -
object33- 3
>333 4
.334 5
Failure335 <
)33< =
,33= >
new33? B
[33B C
]33C D
{33E F
typeof33G M
(33M N
List33N R
<33R S
string33S Y
>33Y Z
)33Z [
}33\ ]
)33] ^
;33^ _
return55 
(55 
	TResponse55 !
)55! "
failureMethod55" /
!55/ 0
.550 1
Invoke551 7
(557 8
null558 <
,55< =
new55> A
object55B H
[55H I
]55I J
{55K L
errors55M S
}55T U
)55U V
!55V W
;55W X
}66 
if99 
(99 
typeof99 
(99 
	TResponse99  
)99  !
==99" $
typeof99% +
(99+ ,
Result99, 2
)992 3
)993 4
{:: 
return;; 
(;; 
	TResponse;; !
);;! "
(;;" #
object;;# )
);;) *
Result;;* 0
.;;0 1
Failure;;1 8
(;;8 9
errors;;9 ?
);;? @
;;;@ A
}<< 
throw?? 
new?? 
ValidationException?? )
(??) *
failures??* 2
)??2 3
;??3 4
}@@ 	
returnCC 
awaitCC 
nextCC 
(CC 
)CC 
;CC 
}DD 
}EE 